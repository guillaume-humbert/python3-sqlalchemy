<html>
<head>
	<title>
    SQLAlchemy Documentation
</title>
    <link href="style.css" rel="stylesheet" type="text/css"></link>
    <link href="syntaxhighlight.css" rel="stylesheet" type="text/css"></link>

    <link href="docs.css" rel="stylesheet" type="text/css"></link>
    <script src="scripts.js"></script>
</head>
<body>


<div style="position:absolute;left:0px;top:0px;"><a name="top"></a>&nbsp;</div>

<div class="doccontainer">

<div class="docheader">


<h1>SQLAlchemy 0.3 Documentation</h1>

<div class="multipage">
<a href="index.html">Multiple Pages</a> |
<a href="documentation.html">One Page</a>
</div>

<div class="">Version: 0.3.3   Last Updated: 12/15/06 01:53:03</div>
</div>



		
	
	<div class="maintoc">

	<a name="table_of_contents"></a>
	<h2>Table of Contents</h2>
	&nbsp;&nbsp;
	<a href="#full_index">(view full table)</a>
	<br/><br/>
	
	<div style="margin-left:50px;">
	

<ul class="toc_list">
    
        
        <li><A style="" href="#tutorial">Tutorial</a></li>
    

    
        
        <li><A style="" href="#dbengine">Database Engines</a></li>
    

    
        
        <li><A style="" href="#metadata">Database Meta Data</a></li>
    

    
        
        <li><A style="" href="#sql">Constructing SQL Queries via Python Expressions</a></li>
    

    
        
        <li><A style="" href="#datamapping">Data Mapping</a></li>
    

    
        
        <li><A style="" href="#unitofwork">Session / Unit of Work</a></li>
    

    
        
        <li><A style="" href="#advdatamapping">Advanced Data Mapping</a></li>
    

    
        
        <li><A style="" href="#types">The Types System</a></li>
    

    
        
        <li><A style="" href="#pooling">Connection Pooling</a></li>
    

    
        
        <li><A style="" href="#plugins">Plugins</a></li>
    

    
        
        <li><A style="" href="#docstrings">Generated Documentation</a></li>
    

</ul>

	</div>

	</div>


	<div class="maintoc">
	<a name="full_index"></a>
	<h2>Table of Contents: Full</h2>
	&nbsp;&nbsp;
	<a href="#table_of_contents">(view brief table)</a>
	<br/><br/>

	<div style="margin-left:50px;">
	

<ul class="toc_list">
    
        
        <li><A style="" href="#tutorial">Tutorial</a></li>
    
    <ul class="small_toc_list">
        
        
    <li><A href="#tutorial_installation">Installation</a></li>

    <ul class="small_toc_list">
        
        
    <li><A href="#tutorial_installation_sqlalchemy">Installing SQLAlchemy</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#tutorial_installation_dbms">Installing a Database API</a></li>

    <ul class="small_toc_list">
    </ul>


    </ul>


        
        
    <li><A href="#tutorial_gettingstarted">Getting Started</a></li>

    <ul class="small_toc_list">
        
        
    <li><A href="#tutorial_gettingstarted_imports">Imports</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#tutorial_gettingstarted_connecting">Connecting to the Database</a></li>

    <ul class="small_toc_list">
    </ul>


    </ul>


        
        
    <li><A href="#tutorial_schemasql">Working with Database Objects</a></li>

    <ul class="small_toc_list">
        
        
    <li><A href="#tutorial_schemasql_metadata">Defining Metadata, Binding to Engines</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#tutorial_schemasql_table_creating">Creating a Table</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#tutorial_schemasql_inserting">Inserting Rows</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#tutorial_schemasql_selecting">Selecting</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#tutorial_schemasql_working">Working with Rows</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#tutorial_schemasql_table_relationships">Table Relationships</a></li>

    <ul class="small_toc_list">
    </ul>


    </ul>


        
        
    <li><A href="#tutorial_orm">Working with Object Mappers</a></li>

    <ul class="small_toc_list">
        
        
    <li><A href="#tutorial_orm_mapper">Creating a Mapper</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#tutorial_orm_session">Obtaining a Session</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#tutorial_orm_query">The Query Object</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#tutorial_orm_changes">Making Changes</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#tutorial_orm_saving">Saving</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#tutorial_orm_relationships">Relationships</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#tutorial_orm_transactions">Transactions</a></li>

    <ul class="small_toc_list">
    </ul>


    </ul>


        
        
    <li><A href="#tutorial_next">Next Steps</a></li>

    <ul class="small_toc_list">
    </ul>


    </ul>

    
        
        <li><A style="" href="#dbengine">Database Engines</a></li>
    
    <ul class="small_toc_list">
        
        
    <li><A href="#dbengine_supported">Supported Databases</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#dbengine_establishing">Establishing a Database Engine</a></li>

    <ul class="small_toc_list">
        
        
    <li><A href="#dbengine_establishing_custom">Custom DBAPI keyword arguments</a></li>

    <ul class="small_toc_list">
    </ul>


    </ul>


        
        
    <li><A href="#dbengine_options">Database Engine Options</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#dbengine_connections">Using Connections</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#dbengine_transactions">Transactions</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#dbengine_implicit">Implicit Execution</a></li>

    <ul class="small_toc_list">
        
        
    <li><A href="#dbengine_implicit_strategies">Implicit Execution Strategies</a></li>

    <ul class="small_toc_list">
    </ul>


    </ul>


    </ul>

    
        
        <li><A style="" href="#metadata">Database Meta Data</a></li>
    
    <ul class="small_toc_list">
        
        
    <li><A href="#metadata_tables">Describing Databases with MetaData</a></li>

    <ul class="small_toc_list">
        
        
    <li><A href="#metadata_tables_binding">Binding MetaData to an Engine</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#metadata_tables_using">Using the global Metadata object</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#metadata_tables_reflecting">Reflecting Tables</a></li>

    <ul class="small_toc_list">
        
        
    <li><A href="#metadata_tables_reflecting_overriding">Overriding Reflected Columns</a></li>

    <ul class="small_toc_list">
    </ul>


    </ul>


        
        
    <li><A href="#metadata_tables_schema">Specifying the Schema Name</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#metadata_tables_onupdate">ON UPDATE and ON DELETE</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#metadata_tables_quoting">Enabling Table / Column Quoting</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#metadata_tables_options">Other Options</a></li>

    <ul class="small_toc_list">
    </ul>


    </ul>


        
        
    <li><A href="#metadata_creating">Creating and Dropping Database Tables</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#metadata_defaults">Column Defaults and OnUpdates</a></li>

    <ul class="small_toc_list">
        
        
    <li><A href="#metadata_defaults_oninsert">Pre-Executed Insert Defaults</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#metadata_defaults_onupdate">Pre-Executed OnUpdate Defaults</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#metadata_defaults_passive">Inline Default Execution: PassiveDefault</a></li>

    <ul class="small_toc_list">
        
        
    <li><A href="#metadata_defaults_passive_postgres">The Catch: Postgres Primary Key Defaults always Pre-Execute</a></li>

    <ul class="small_toc_list">
    </ul>


    </ul>


        
        
    <li><A href="#metadata_defaults_sequences">Defining Sequences</a></li>

    <ul class="small_toc_list">
    </ul>


    </ul>


        
        
    <li><A href="#metadata_constraints">Defining Constraints and Indexes</a></li>

    <ul class="small_toc_list">
        
        
    <li><A href="#metadata_constraints_unique">UNIQUE Constraint</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#metadata_constraints_check">CHECK Constraint</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#metadata_constraints_indexes">Indexes</a></li>

    <ul class="small_toc_list">
    </ul>


    </ul>


        
        
    <li><A href="#metadata_adapting">Adapting Tables to Alternate Metadata</a></li>

    <ul class="small_toc_list">
    </ul>


    </ul>

    
        
        <li><A style="" href="#sql">Constructing SQL Queries via Python Expressions</a></li>
    
    <ul class="small_toc_list">
        
        
    <li><A href="#sql_select">Simple Select</a></li>

    <ul class="small_toc_list">
        
        
    <li><A href="#sql_select_explicit">Explicit Execution</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#sql_select_binding">Binding ClauseElements to Engines</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#sql_select_resultproxy">Getting Results</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#sql_select_labels">Using Column Labels</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#sql_select_columns">Table/Column Specification</a></li>

    <ul class="small_toc_list">
    </ul>


    </ul>


        
        
    <li><A href="#sql_whereclause">WHERE Clause</a></li>

    <ul class="small_toc_list">
        
        
    <li><A href="#sql_whereclause_operators">Operators</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#sql_whereclause_functions">Functions</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#sql_whereclause_literals">Literals</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#sql_whereclause_orderby">Order By</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#sql_whereclause_options">DISTINCT, LIMIT and OFFSET</a></li>

    <ul class="small_toc_list">
    </ul>


    </ul>


        
        
    <li><A href="#sql_join">Inner and Outer Joins</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#sql_alias">Table Aliases</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#sql_subqueries">Subqueries</a></li>

    <ul class="small_toc_list">
        
        
    <li><A href="#sql_subqueries_scalar">Scalar Column Subqueries</a></li>

    <ul class="small_toc_list">
    </ul>


    </ul>


        
        
    <li><A href="#sql_correlated">Correlated Subqueries</a></li>

    <ul class="small_toc_list">
        
        
    <li><A href="#sql_correlated_exists">EXISTS Clauses</a></li>

    <ul class="small_toc_list">
    </ul>


    </ul>


        
        
    <li><A href="#sql_unions">Unions</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#sql_bindparams">Custom Bind Parameters</a></li>

    <ul class="small_toc_list">
        
        
    <li><A href="#sql_bindparams_precompiling">Precompiling a Query</a></li>

    <ul class="small_toc_list">
    </ul>


    </ul>


        
        
    <li><A href="#sql_textual">Literal Text Blocks</a></li>

    <ul class="small_toc_list">
        
        
    <li><A href="#sql_textual_textual_binds">Using Bind Parameters in Text Blocks</a></li>

    <ul class="small_toc_list">
    </ul>


    </ul>


        
        
    <li><A href="#sql_building">Building Select Objects</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#sql_insert">Inserts</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#sql_update">Updates</a></li>

    <ul class="small_toc_list">
        
        
    <li><A href="#sql_update_correlated">Correlated Updates</a></li>

    <ul class="small_toc_list">
    </ul>


    </ul>


        
        
    <li><A href="#sql_delete">Deletes</a></li>

    <ul class="small_toc_list">
    </ul>


    </ul>

    
        
        <li><A style="" href="#datamapping">Data Mapping</a></li>
    
    <ul class="small_toc_list">
        
        
    <li><A href="#datamapping_datamapping">Basic Data Mapping</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#datamapping_synopsis">Synopsis</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#datamapping_query">The Query Object</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#datamapping_saving">Saving Objects</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#datamapping_relations">Defining and Using Relationships</a></li>

    <ul class="small_toc_list">
        
        
    <li><A href="#datamapping_relations_onetomany">One to Many</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#datamapping_relations_lifecycle">Lifecycle Relations</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#datamapping_relations_backreferences">Backreferences</a></li>

    <ul class="small_toc_list">
    </ul>


    </ul>


        
        
    <li><A href="#datamapping_selectrelations">Selecting from Relationships</a></li>

    <ul class="small_toc_list">
        
        
    <li><A href="#datamapping_selectrelations_queryjoins">Selecting With Joins</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#datamapping_selectrelations_relselectby">Creating Joins Using selectby()</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#datamapping_selectrelations_jointo">Generating Join Criterion Using join_to, join_via</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#datamapping_selectrelations_eagerload">Eager Loading</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#datamapping_selectrelations_options">Using Options to Change the Loading Strategy</a></li>

    <ul class="small_toc_list">
    </ul>


    </ul>


        
        
    <li><A href="#datamapping_onetoone">One to One/Many to One</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#datamapping_manytomany">Many to Many</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#datamapping_association">Association Object</a></li>

    <ul class="small_toc_list">
    </ul>


    </ul>

    
        
        <li><A style="" href="#unitofwork">Session / Unit of Work</a></li>
    
    <ul class="small_toc_list">
        
        
    <li><A href="#unitofwork_overview">Overview</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#unitofwork_states">Object States</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#unitofwork_getting">Acquiring a Session</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#unitofwork_identitymap">Introduction to the Identity Map</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#unitofwork_changed">Whats Changed ?</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#unitofwork_api">The Session API</a></li>

    <ul class="small_toc_list">
        
        
    <li><A href="#unitofwork_api_query">query()</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#unitofwork_api_get">get()</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#unitofwork_api_load">load()</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#unitofwork_api_save">save()</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#unitofwork_api_flush">flush()</a></li>

    <ul class="small_toc_list">
        
        
    <li><A href="#unitofwork_api_flush_whatis">Notes on Flush</a></li>

    <ul class="small_toc_list">
    </ul>


    </ul>


        
        
    <li><A href="#unitofwork_api_close">close()</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#unitofwork_api_delete">delete()</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#unitofwork_api_clear">clear()</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#unitofwork_api_refreshexpire">refresh() / expire()</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#unitofwork_api_expunge">expunge()</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#unitofwork_api_bind">bind_mapper() / bind_table()</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#unitofwork_api_update">update()</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#unitofwork_api_saveorupdate">save_or_update()</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#unitofwork_api_merge">merge()</a></li>

    <ul class="small_toc_list">
    </ul>


    </ul>


        
        
    <li><A href="#unitofwork_cascade">Cascade rules</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#unitofwork_transaction">SessionTransaction</a></li>

    <ul class="small_toc_list">
        
        
    <li><A href="#unitofwork_transaction_sql">Using SQL with SessionTransaction</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#unitofwork_transaction_using">Using Engine-level Transactions with Sessions</a></li>

    <ul class="small_toc_list">
    </ul>


    </ul>


        
        
    <li><A href="#unitofwork_logging">Analyzing Object Flushes</a></li>

    <ul class="small_toc_list">
    </ul>


    </ul>

    
        
        <li><A style="" href="#advdatamapping">Advanced Data Mapping</a></li>
    
    <ul class="small_toc_list">
        
        
    <li><A href="#advdatamapping_properties">More On Mapper Properties</a></li>

    <ul class="small_toc_list">
        
        
    <li><A href="#advdatamapping_properties_colname">Overriding Column Names</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#advdatamapping_properties_overriding">Overriding Properties</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#advdatamapping_properties_customlist">Custom List Classes</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#advdatamapping_properties_customjoin">Custom Join Conditions</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#advdatamapping_properties_multiplejoin">Lazy/Eager Joins Multiple Times to One Table</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#advdatamapping_properties_deferred">Deferred Column Loading</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#advdatamapping_properties_working">Working with Large Collections</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#advdatamapping_properties_relationoptions">Relation Options</a></li>

    <ul class="small_toc_list">
    </ul>


    </ul>


        
        
    <li><A href="#advdatamapping_orderby">Controlling Ordering</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#advdatamapping_limits">Limiting Rows</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#advdatamapping_inheritance">Mapping a Class with Table Inheritance</a></li>

    <ul class="small_toc_list">
        
        
    <li><A href="#advdatamapping_inheritance_single">Single Table Inheritance</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#advdatamapping_inheritance_concrete">Concrete Table Inheritance</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#advdatamapping_inheritance_multiple">Multiple Table Inheritance</a></li>

    <ul class="small_toc_list">
    </ul>


    </ul>


        
        
    <li><A href="#advdatamapping_joins">Mapping a Class against Multiple Tables</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#advdatamapping_selects">Mapping a Class against Arbitary Selects</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#advdatamapping_multiple">Multiple Mappers for One Class</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#advdatamapping_recursive">Self Referential Mappers</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#advdatamapping_resultset">Result-Set Mapping</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#advdatamapping_arguments">Mapper Arguments</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#advdatamapping_extending">Extending Mapper</a></li>

    <ul class="small_toc_list">
    </ul>


    </ul>

    
        
        <li><A style="" href="#types">The Types System</a></li>
    
    <ul class="small_toc_list">
        
        
    <li><A href="#types_standard">Built-in Types</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#types_custom">Creating your Own Types</a></li>

    <ul class="small_toc_list">
    </ul>


    </ul>

    
        
        <li><A style="" href="#pooling">Connection Pooling</a></li>
    
    <ul class="small_toc_list">
        
        
    <li><A href="#pooling_establishing">Establishing a Transparent Connection Pool</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#pooling_configuration">Connection Pool Configuration</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#pooling_custom">Custom Pool Construction</a></li>

    <ul class="small_toc_list">
    </ul>


    </ul>

    
        
        <li><A style="" href="#plugins">Plugins</a></li>
    
    <ul class="small_toc_list">
        
        
    <li><A href="#plugins_sessioncontext">SessionContext</a></li>

    <ul class="small_toc_list">
        
        
    <li><A href="#plugins_sessioncontext_sessioncontextext">Using SessionContextExt</a></li>

    <ul class="small_toc_list">
    </ul>


    </ul>


        
        
    <li><A href="#plugins_selectresults">SelectResults</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#plugins_assignmapper">assignmapper</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#plugins_associationproxy">associationproxy</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#plugins_threadlocal">threadlocal</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#plugins_activemapper">ActiveMapper</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#plugins_sqlsoup">SqlSoup</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#plugins_proxyengine">ProxyEngine</a></li>

    <ul class="small_toc_list">
    </ul>


    </ul>

    
        
        <li><A style="" href="#docstrings">Generated Documentation</a></li>
    
    <ul class="small_toc_list">
        
        
    <li><A href="#docstrings_sqlalchemy.sql">module sqlalchemy.sql</a></li>

    <ul class="small_toc_list">
        
        
    <li><A href="#docstrings_sqlalchemy.sql_modfunc">Module Functions</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#docstrings_sqlalchemy.sql_AbstractDialect">class AbstractDialect(object)</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#docstrings_sqlalchemy.sql_Alias">class Alias(FromClause)</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#docstrings_sqlalchemy.sql_ClauseElement">class ClauseElement(object)</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#docstrings_sqlalchemy.sql_ClauseParameters">class ClauseParameters(dict)</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#docstrings_sqlalchemy.sql_ClauseVisitor">class ClauseVisitor(object)</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#docstrings_sqlalchemy.sql_ColumnCollection">class ColumnCollection(OrderedProperties)</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#docstrings_sqlalchemy.sql_ColumnElement">class ColumnElement(Selectable,_CompareMixin)</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#docstrings_sqlalchemy.sql_Compiled">class Compiled(ClauseVisitor)</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#docstrings_sqlalchemy.sql_CompoundSelect">class CompoundSelect(_SelectBaseMixin,FromClause)</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#docstrings_sqlalchemy.sql_Executor">class Executor(object)</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#docstrings_sqlalchemy.sql_FromClause">class FromClause(Selectable)</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#docstrings_sqlalchemy.sql_Join">class Join(FromClause)</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#docstrings_sqlalchemy.sql_Select">class Select(_SelectBaseMixin,FromClause)</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#docstrings_sqlalchemy.sql_Selectable">class Selectable(ClauseElement)</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#docstrings_sqlalchemy.sql_TableClause">class TableClause(FromClause)</a></li>

    <ul class="small_toc_list">
    </ul>


    </ul>


        
        
    <li><A href="#docstrings_sqlalchemy.schema">module sqlalchemy.schema</a></li>

    <ul class="small_toc_list">
        
        
    <li><A href="#docstrings_sqlalchemy.schema_BoundMetaData">class BoundMetaData(MetaData)</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#docstrings_sqlalchemy.schema_CheckConstraint">class CheckConstraint(Constraint)</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#docstrings_sqlalchemy.schema_Column">class Column(SchemaItem,_ColumnClause)</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#docstrings_sqlalchemy.schema_ColumnDefault">class ColumnDefault(DefaultGenerator)</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#docstrings_sqlalchemy.schema_Constraint">class Constraint(SchemaItem)</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#docstrings_sqlalchemy.schema_DefaultGenerator">class DefaultGenerator(SchemaItem)</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#docstrings_sqlalchemy.schema_DynamicMetaData">class DynamicMetaData(MetaData)</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#docstrings_sqlalchemy.schema_ForeignKey">class ForeignKey(SchemaItem)</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#docstrings_sqlalchemy.schema_ForeignKeyConstraint">class ForeignKeyConstraint(Constraint)</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#docstrings_sqlalchemy.schema_Index">class Index(SchemaItem)</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#docstrings_sqlalchemy.schema_MetaData">class MetaData(SchemaItem)</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#docstrings_sqlalchemy.schema_PassiveDefault">class PassiveDefault(DefaultGenerator)</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#docstrings_sqlalchemy.schema_PrimaryKeyConstraint">class PrimaryKeyConstraint(Constraint)</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#docstrings_sqlalchemy.schema_SchemaItem">class SchemaItem(object)</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#docstrings_sqlalchemy.schema_SchemaVisitor">class SchemaVisitor(ClauseVisitor)</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#docstrings_sqlalchemy.schema_Sequence">class Sequence(DefaultGenerator)</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#docstrings_sqlalchemy.schema_Table">class Table(SchemaItem,TableClause)</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#docstrings_sqlalchemy.schema_UniqueConstraint">class UniqueConstraint(Constraint)</a></li>

    <ul class="small_toc_list">
    </ul>


    </ul>


        
        
    <li><A href="#docstrings_sqlalchemy.engine">module sqlalchemy.engine</a></li>

    <ul class="small_toc_list">
        
        
    <li><A href="#docstrings_sqlalchemy.engine_modfunc">Module Functions</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#docstrings_sqlalchemy.engine_Connectable">class Connectable(object)</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#docstrings_sqlalchemy.engine_Connection">class Connection(Connectable)</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#docstrings_sqlalchemy.engine_ConnectionProvider">class ConnectionProvider(object)</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#docstrings_sqlalchemy.engine_DefaultRunner">class DefaultRunner(SchemaVisitor)</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#docstrings_sqlalchemy.engine_Dialect">class Dialect(AbstractDialect)</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#docstrings_sqlalchemy.engine_Engine">class Engine(Executor,Connectable)</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#docstrings_sqlalchemy.engine_ExecutionContext">class ExecutionContext(object)</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#docstrings_sqlalchemy.engine_ResultProxy">class ResultProxy(object)</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#docstrings_sqlalchemy.engine_RowProxy">class RowProxy(object)</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#docstrings_sqlalchemy.engine_SchemaIterator">class SchemaIterator(SchemaVisitor)</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#docstrings_sqlalchemy.engine_Transaction">class Transaction(object)</a></li>

    <ul class="small_toc_list">
    </ul>


    </ul>


        
        
    <li><A href="#docstrings_sqlalchemy.engine.url">module sqlalchemy.engine.url</a></li>

    <ul class="small_toc_list">
        
        
    <li><A href="#docstrings_sqlalchemy.engine.url_modfunc">Module Functions</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#docstrings_sqlalchemy.engine.url_URL">class URL(object)</a></li>

    <ul class="small_toc_list">
    </ul>


    </ul>


        
        
    <li><A href="#docstrings_sqlalchemy.orm">module sqlalchemy.orm</a></li>

    <ul class="small_toc_list">
        
        
    <li><A href="#docstrings_sqlalchemy.orm_modfunc">Module Functions</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#docstrings_sqlalchemy.orm_MapperExtension">class MapperExtension(object)</a></li>

    <ul class="small_toc_list">
    </ul>


    </ul>


        
        
    <li><A href="#docstrings_sqlalchemy.orm.mapper">module sqlalchemy.orm.mapper</a></li>

    <ul class="small_toc_list">
        
        
    <li><A href="#docstrings_sqlalchemy.orm.mapper_modfunc">Module Functions</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#docstrings_sqlalchemy.orm.mapper_Mapper">class Mapper(object)</a></li>

    <ul class="small_toc_list">
    </ul>


    </ul>


        
        
    <li><A href="#docstrings_sqlalchemy.orm.query">module sqlalchemy.orm.query</a></li>

    <ul class="small_toc_list">
        
        
    <li><A href="#docstrings_sqlalchemy.orm.query_Query">class Query(object)</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#docstrings_sqlalchemy.orm.query_QueryContext">class QueryContext(OperationContext)</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#docstrings_sqlalchemy.orm.query_SelectionContext">class SelectionContext(OperationContext)</a></li>

    <ul class="small_toc_list">
    </ul>


    </ul>


        
        
    <li><A href="#docstrings_sqlalchemy.orm.session">module sqlalchemy.orm.session</a></li>

    <ul class="small_toc_list">
        
        
    <li><A href="#docstrings_sqlalchemy.orm.session_modfunc">Module Functions</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#docstrings_sqlalchemy.orm.session_Session">class Session(object)</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#docstrings_sqlalchemy.orm.session_SessionTransaction">class SessionTransaction(object)</a></li>

    <ul class="small_toc_list">
    </ul>


    </ul>


        
        
    <li><A href="#docstrings_sqlalchemy.pool">module sqlalchemy.pool</a></li>

    <ul class="small_toc_list">
        
        
    <li><A href="#docstrings_sqlalchemy.pool_modfunc">Module Functions</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#docstrings_sqlalchemy.pool_AssertionPool">class AssertionPool(Pool)</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#docstrings_sqlalchemy.pool_NullPool">class NullPool(Pool)</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#docstrings_sqlalchemy.pool_Pool">class Pool(object)</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#docstrings_sqlalchemy.pool_QueuePool">class QueuePool(Pool)</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#docstrings_sqlalchemy.pool_SingletonThreadPool">class SingletonThreadPool(Pool)</a></li>

    <ul class="small_toc_list">
    </ul>


    </ul>


        
        
    <li><A href="#docstrings_sqlalchemy.ext.sessioncontext">module sqlalchemy.ext.sessioncontext</a></li>

    <ul class="small_toc_list">
        
        
    <li><A href="#docstrings_sqlalchemy.ext.sessioncontext_SessionContext">class SessionContext(object)</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#docstrings_sqlalchemy.ext.sessioncontext_SessionContextExt">class SessionContextExt(MapperExtension)</a></li>

    <ul class="small_toc_list">
    </ul>


    </ul>


        
        
    <li><A href="#docstrings_sqlalchemy.mods.threadlocal">module sqlalchemy.mods.threadlocal</a></li>

    <ul class="small_toc_list">
        
        
    <li><A href="#docstrings_sqlalchemy.mods.threadlocal_modfunc">Module Functions</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#docstrings_sqlalchemy.mods.threadlocal_Objectstore">class Objectstore(object)</a></li>

    <ul class="small_toc_list">
    </ul>


    </ul>


        
        
    <li><A href="#docstrings_sqlalchemy.ext.selectresults">module sqlalchemy.ext.selectresults</a></li>

    <ul class="small_toc_list">
        
        
    <li><A href="#docstrings_sqlalchemy.ext.selectresults_SelectResults">class SelectResults(object)</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#docstrings_sqlalchemy.ext.selectresults_SelectResultsExt">class SelectResultsExt(MapperExtension)</a></li>

    <ul class="small_toc_list">
    </ul>


    </ul>


        
        
    <li><A href="#docstrings_sqlalchemy.exceptions">module sqlalchemy.exceptions</a></li>

    <ul class="small_toc_list">
        
        
    <li><A href="#docstrings_sqlalchemy.exceptions_ArgumentError">class ArgumentError()</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#docstrings_sqlalchemy.exceptions_AssertionError">class AssertionError()</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#docstrings_sqlalchemy.exceptions_ConcurrentModificationError">class ConcurrentModificationError()</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#docstrings_sqlalchemy.exceptions_DBAPIError">class DBAPIError()</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#docstrings_sqlalchemy.exceptions_FlushError">class FlushError()</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#docstrings_sqlalchemy.exceptions_InvalidRequestError">class InvalidRequestError()</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#docstrings_sqlalchemy.exceptions_NoSuchColumnError">class NoSuchColumnError()</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#docstrings_sqlalchemy.exceptions_NoSuchTableError">class NoSuchTableError()</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#docstrings_sqlalchemy.exceptions_SQLAlchemyError">class SQLAlchemyError()</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#docstrings_sqlalchemy.exceptions_SQLError">class SQLError()</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#docstrings_sqlalchemy.exceptions_TimeoutError">class TimeoutError()</a></li>

    <ul class="small_toc_list">
    </ul>


    </ul>


        
        
    <li><A href="#docstrings_sqlalchemy.ext.proxy">module sqlalchemy.ext.proxy</a></li>

    <ul class="small_toc_list">
        
        
    <li><A href="#docstrings_sqlalchemy.ext.proxy_AutoConnectEngine">class AutoConnectEngine(BaseProxyEngine)</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#docstrings_sqlalchemy.ext.proxy_BaseProxyEngine">class BaseProxyEngine(Executor)</a></li>

    <ul class="small_toc_list">
    </ul>


        
        
    <li><A href="#docstrings_sqlalchemy.ext.proxy_ProxyEngine">class ProxyEngine(BaseProxyEngine)</a></li>

    <ul class="small_toc_list">
    </ul>


    </ul>


    </ul>

</ul>

	</div>

	</div>


<A name="tutorial"></a>

<div class="sectionnavblock">
<div class="sectionnav">



        Next: <a href="#dbengine">Database Engines</a>

</div>
</div>

<div class="topnavmain">
	<div class="topnavheader">Tutorial</div>
</div>
<div class="sectioncontent">
<html>



<A name="tutorial"></a>

<div class="subsection" style="margin-left:10px;">



    <div class="sectiontext">
    

<p>This tutorial provides a relatively simple walking tour through the basic concepts of SQLAlchemy.  You may wish to skip it and dive into the <a href="metadata.html#metadata">main manual</a> which is more reference-oriented.  The examples in this tutorial comprise a fully working interactive Python session, and are guaranteed to be functioning courtesy of <a href='http://www.python.org/doc/lib/module-doctest.html'>doctest</a>.
</p>



<A name="tutorial_installation"></a>

<div class="subsection" style="margin-left:20px;">


<h3>Installation</h3>

    <div class="sectiontext">
    




<A name="tutorial_installation_sqlalchemy"></a>

<div class="subsection" style="margin-left:30px;">


<h3>Installing SQLAlchemy</h3>

    <div class="sectiontext">
    

<p>Installing SQLAlchemy from scratch is most easily achieved with <a href='http://peak.telecommunity.com/DevCenter/setuptools'>setuptools</a>.  (<a href='http://peak.telecommunity.com/DevCenter/EasyInstall#installation-instructions'>setuptools installation</a>). Just run this from the command-line:
</p>
<pre><code># easy_install SQLAlchemy
</code></pre><p>This command will download the latest version of SQLAlchemy from the <a href='http://cheeseshop.python.org/pypi'>Python Cheese Shop</a> and install it to your system.
</p>
<p>Otherwise, you can install from the distribution using the <code>setup.py</code> script:
</p>
<pre><code># python setup.py install
</code></pre>

    </div>

    <a href="#tutorial" class="toclink">back to section top</a>
</div>




<A name="tutorial_installation_dbms"></a>

<div class="subsection" style="margin-left:30px;">


<h3>Installing a Database API</h3>

    <div class="sectiontext">
    

<p>SQLAlchemy is designed to operate with a <a href='http://www.python.org/doc/peps/pep-0249/'>DBAPI</a> implementation built for a particular database, and includes support for the most popular databases. If you have one of the <a href="dbengine.html#dbengine_establishing">supported DBAPI implementations</a>, you can proceed to the following section. Otherwise <a href='http://sqlite.org/'>SQLite</a> is an easy-to-use database to get started with, which works with plain files or in-memory databases.
</p>
<p>To work with SQLite, you'll need:
</p>
<ul>
 <li>
     <a href='http://pysqlite.org/'>pysqlite</a> - Python interface for SQLite
 </li>

 <li>
     SQLite library 
 </li>
</ul>
<p>Note that the SQLite library download is not required with Windows, as the Windows Pysqlite library already includes it linked in.  Pysqlite and SQLite can also be installed on Linux or FreeBSD via pre-made <a href='http://initd.org/tracker/pysqlite/wiki/PysqlitePackages'>packages</a> or <a href='http://pysqlite.org/'>from sources</a>.
</p>


    </div>

</div>



    </div>

    <a href="#tutorial" class="toclink">back to section top</a>
</div>




<A name="tutorial_gettingstarted"></a>

<div class="subsection" style="margin-left:20px;">


<h3>Getting Started</h3>

    <div class="sectiontext">
    




<A name="tutorial_gettingstarted_imports"></a>

<div class="subsection" style="margin-left:30px;">


<h3>Imports</h3>

    <div class="sectiontext">
    

<p>SQLAlchemy provides the entire namespace of everything you'll need under the module name <code>sqlalchemy</code>.  For the purposes of this tutorial, we will import its full list of symbols into our own local namespace.  <br></br>
</p>


<div class="sliding_code">
<pre><span class="python_literal">>>> </span><span class="python_keyword">from </span><span class="python_name">sqlalchemy </span><span class="python_keyword">import </span><span class="python_operator">*</span></pre></div>


    </div>

    <a href="#tutorial" class="toclink">back to section top</a>
</div>




<A name="tutorial_gettingstarted_connecting"></a>

<div class="subsection" style="margin-left:30px;">


<h3>Connecting to the Database</h3>

    <div class="sectiontext">
    

<p>After our imports, the next thing we need is a handle to the desired database, represented by an <code>Engine</code> object.  This object handles the business of managing connections and dealing with the specifics of a particular database.  Below, we will make a SQLite connection to a file-based database called "tutorial.db".
</p>


<div class="sliding_code">
<pre><span class="python_literal">>>> </span><span class="python_name">db </span><span class="python_operator">= </span><span class="python_name">create_engine</span><span class="python_enclosure">(</span><span class="python_literal">'sqlite:///tutorial.db'</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre></div>
<p>For full information on creating database engines, including those for SQLite and others, see <a href="dbengine.html#dbengine">Database Engines</a>.
</p>


    </div>

</div>



    </div>

    <a href="#tutorial" class="toclink">back to section top</a>
</div>




<A name="tutorial_schemasql"></a>

<div class="subsection" style="margin-left:20px;">


<h3>Working with Database Objects</h3>

    <div class="sectiontext">
    

<p>A core philosophy of SQLAlchemy is that tables and domain classes are different beasts.  For this reason, SQLAlchemy provides constructs that represent tables by themselves (known as <em>table metadata</em>).  So we will begin by constructing table metadata objects and performing SQL operations with them directly.  Later, we will look into SQLAlchemy's Object Relational Mapper (ORM), which provides an additional layer of abstraction onto table metadata, allowing us to load and save objects of any arbitrary Python class.
</p>



<A name="tutorial_schemasql_metadata"></a>

<div class="subsection" style="margin-left:30px;">


<h3>Defining Metadata, Binding to Engines</h3>

    <div class="sectiontext">
    

<p>Firstly, your Tables have to belong to a collection called <code>MetaData</code>.  We will create a handy form of <code>MetaData</code> that automatically connects to our <code>Engine</code> (connecting a schema object to an Engine is called <em>binding</em>):
</p>


<div class="sliding_code">
<pre><span class="python_literal">>>> </span><span class="python_name">metadata </span><span class="python_operator">= </span><span class="python_name">BoundMetaData</span><span class="python_enclosure">(</span><span class="python_name">db</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre></div>
<p>An equivalent operation is to create the <code>BoundMetaData</code> object directly with an Engine URL, which calls the <code>create_engine</code> call for us:
</p>


<div class="sliding_code">
<pre><span class="python_literal">>>> </span><span class="python_name">metadata </span><span class="python_operator">= </span><span class="python_name">BoundMetaData</span><span class="python_enclosure">(</span><span class="python_literal">'sqlite:///tutorial.db'</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre></div>
<p>Now, when we tell "metadata" about the tables in our database, we can issue CREATE statements for those tables, as well as create and execute SQL statements derived from them, without needing to open or close any connections; that will be all done automatically.  Note that this feature is <strong>entirely optional</strong>.  SQLAlchemy includes full support for explicit Connections used with schema and SQL constructs that are entirely unbound to any Engine.
</p>
<p>For the purposes of this tutorial, we will stick with "bound" objects, as it makes the code simpler and easier to read.  <br></br>
</p>


    </div>

    <a href="#tutorial" class="toclink">back to section top</a>
</div>




<A name="tutorial_schemasql_table_creating"></a>

<div class="subsection" style="margin-left:30px;">


<h3>Creating a Table</h3>

    <div class="sectiontext">
    

<p>With <code>metadata</code> as our established home for tables, lets make a Table for it:
</p>


<div class="sliding_code">
<pre><span class="python_literal">>>> </span><span class="python_name">users_table </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'users'</span><span class="python_operator">, </span><span class="python_name">metadata</span><span class="python_operator">,</span>
<span class="python_operator">...     </span><span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'user_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
<span class="python_operator">...     </span><span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'user_name'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">40</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
<span class="python_operator">...     </span><span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'password'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">10</span><span class="python_enclosure">))</span>
<span class="python_operator">... </span><span class="python_enclosure">)</span><span class="python_operator"></span></pre></div>
<p>As you might have guessed, we have just defined a table named <code>users</code> which has three columns: <code>user_id</code> (which is a primary key column), <code>user_name</code> and <code>password</code>. Currently it is just an object that doesn't necessarily correspond to an existing table in our database.  To actually create the table, we use the <code>create()</code> method.  To make it interesting, we will have SQLAlchemy echo the SQL statements it sends to the database, by setting the <code>echo</code> flag on the <code>Engine</code> associated with our <code>BoundMetaData</code>:
</p>


<div class="sliding_code">
<pre><span class="python_literal">>>> </span><span class="python_name">metadata</span><span class="python_operator">.</span><span class="python_name">engine</span><span class="python_operator">.</span><span class="python_name">echo </span><span class="python_operator">= </span><span class="python_name">True</span><span class="python_operator">
</span><span class="python_literal">>>> </span><span class="python_name">users_table</span><span class="python_operator">.</span><span class="python_name">create</span><span class="python_enclosure">() </span><span class="python_operator">
</span><span class="python_name">CREATE TABLE users </span><span class="python_enclosure">(</span>
    <span class="python_name">user_id INTEGER NOT NULL</span><span class="python_operator">,</span>
    <span class="python_name">user_name VARCHAR</span><span class="python_enclosure">(</span><span class="python_number">40</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">password VARCHAR</span><span class="python_enclosure">(</span><span class="python_number">10</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">PRIMARY KEY </span><span class="python_enclosure">(</span><span class="python_name">user_id</span><span class="python_enclosure">)</span>
<span class="python_enclosure">)</span><span class="python_operator">
...</span></pre></div>
<p>Alternatively, the <code>users</code> table might already exist (such as, if you're running examples from this tutorial for the second time), in which case you can just skip the <code>create()</code> method call. You can even skip defining the individual columns in the <code>users</code> table and ask SQLAlchemy to load its definition from the database:
</p>


<div class="sliding_code">
<pre><span class="python_literal">>>> </span><span class="python_name">users_table </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'users'</span><span class="python_operator">, </span><span class="python_name">metadata</span><span class="python_operator">, </span><span class="python_name">autoload</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_literal">>>> </span><span class="python_name">list</span><span class="python_enclosure">(</span><span class="python_name">users_table</span><span class="python_operator">.</span><span class="python_name">columns</span><span class="python_enclosure">)[</span><span class="python_number">0</span><span class="python_enclosure">]</span><span class="python_operator">.</span><span class="python_name">name</span><span class="python_operator">
</span><span class="python_literal">'user_id'</span><span class="python_operator"></span></pre></div>
<p>Documentation on table metadata is available in <a href="metadata.html#metadata">Database Meta Data</a>.
</p>


    </div>

    <a href="#tutorial" class="toclink">back to section top</a>
</div>




<A name="tutorial_schemasql_inserting"></a>

<div class="subsection" style="margin-left:30px;">


<h3>Inserting Rows</h3>

    <div class="sectiontext">
    

<p>Inserting is achieved via the <code>insert()</code> method, which defines a <em>clause object</em> (known as a <code>ClauseElement</code>) representing an INSERT statement:
</p>


<div class="sliding_code">
<pre><span class="python_literal">>>> </span><span class="python_name">i </span><span class="python_operator">= </span><span class="python_name">users_table</span><span class="python_operator">.</span><span class="python_name">insert</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_literal">>>> </span><span class="python_name">i </span><span class="python_operator">
<</span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">sql</span><span class="python_operator">.</span><span class="python_name">_Insert object at </span><span class="python_number">0x</span><span class="python_operator">...>
</span><span class="python_literal">>>> </span><span class="python_keyword">print </span><span class="python_name">i</span><span class="python_operator">
</span><span class="python_name">INSERT INTO users </span><span class="python_enclosure">(</span><span class="python_name">user_id</span><span class="python_operator">, </span><span class="python_name">user_name</span><span class="python_operator">, </span><span class="python_name">password</span><span class="python_enclosure">) </span><span class="python_name">VALUES </span><span class="python_enclosure">(</span><span class="python_operator">?, ?, ?</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre></div>
<p>Since we created this insert statement object from the <code>users</code> table which is bound to our <code>Engine</code>, the statement itself is also bound to the <code>Engine</code>, and supports executing itself.  The <code>execute()</code> method of the clause object will <em>compile</em> the object into a string according to the underlying <em>dialect</em> of the Engine to which the statement is bound, and will then execute the resulting statement.  <br></br>
</p>


<div class="sliding_code">
<pre><span class="python_literal">>>> </span><span class="python_name">i</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_name">user_name</span><span class="python_operator">=</span><span class="python_literal">'Mary'</span><span class="python_operator">, </span><span class="python_name">password</span><span class="python_operator">=</span><span class="python_literal">'secure'</span><span class="python_enclosure">) </span><span class="python_operator">
</span><span class="python_name">INSERT INTO users </span><span class="python_enclosure">(</span><span class="python_name">user_name</span><span class="python_operator">, </span><span class="python_name">password</span><span class="python_enclosure">) </span><span class="python_name">VALUES </span><span class="python_enclosure">(</span><span class="python_operator">?, ?</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_enclosure">[</span><span class="python_literal">'Mary'</span><span class="python_operator">, </span><span class="python_literal">'secure'</span><span class="python_enclosure">]</span><span class="python_operator">
</span><span class="python_name">COMMIT</span><span class="python_operator">
<</span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">engine</span><span class="python_operator">.</span><span class="python_name">base</span><span class="python_operator">.</span><span class="python_name">ResultProxy object at </span><span class="python_number">0x</span><span class="python_operator">...>
</span>
<span class="python_literal">>>> </span><span class="python_name">i</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">({</span><span class="python_literal">'user_name'</span><span class="python_operator">:</span><span class="python_literal">'Tom'</span><span class="python_enclosure">}</span><span class="python_operator">, </span><span class="python_enclosure">{</span><span class="python_literal">'user_name'</span><span class="python_operator">:</span><span class="python_literal">'Fred'</span><span class="python_enclosure">}</span><span class="python_operator">, </span><span class="python_enclosure">{</span><span class="python_literal">'user_name'</span><span class="python_operator">:</span><span class="python_literal">'Harry'</span><span class="python_enclosure">}) </span><span class="python_operator">
</span><span class="python_name">INSERT INTO users </span><span class="python_enclosure">(</span><span class="python_name">user_name</span><span class="python_enclosure">) </span><span class="python_name">VALUES </span><span class="python_enclosure">(</span><span class="python_operator">?</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_enclosure">[[</span><span class="python_literal">'Tom'</span><span class="python_enclosure">]</span><span class="python_operator">, </span><span class="python_enclosure">[</span><span class="python_literal">'Fred'</span><span class="python_enclosure">]</span><span class="python_operator">, </span><span class="python_enclosure">[</span><span class="python_literal">'Harry'</span><span class="python_enclosure">]]</span><span class="python_operator">
</span><span class="python_name">COMMIT</span><span class="python_operator">
<</span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">engine</span><span class="python_operator">.</span><span class="python_name">base</span><span class="python_operator">.</span><span class="python_name">ResultProxy object at </span><span class="python_number">0x</span><span class="python_operator">...></span></pre></div>
<p>Note that the <code>VALUES</code> clause of each <code>INSERT</code> statement was automatically adjusted to correspond to the parameters sent to the <code>execute()</code> method.  This is because the compilation step of a <code>ClauseElement</code> takes into account not just the constructed SQL object and the specifics of the type of database being used, but the execution parameters sent along as well.  <br></br>
</p>
<p>When constructing clause objects, SQLAlchemy will bind all literal values into bind parameters.  On the construction side, bind parameters are always treated as named parameters.  At compilation time, SQLAlchemy will convert them into their proper format, based on the paramstyle of the underlying DBAPI.  This works equally well for all named and positional bind parameter formats described in the DBAPI specification.
</p>
<p>Documentation on inserting: <a href="sqlconstruction.html#sql_insert">Inserts</a>.
</p>


    </div>

    <a href="#tutorial" class="toclink">back to section top</a>
</div>




<A name="tutorial_schemasql_selecting"></a>

<div class="subsection" style="margin-left:30px;">


<h3>Selecting</h3>

    <div class="sectiontext">
    

<p>Let's check that the data we have put into <code>users</code> table is actually there. The procedure is analogous to the insert example above, except you now call the <code>select()</code> method off the <code>users</code> table:
</p>


<div class="sliding_code">
<pre><span class="python_literal">>>> </span><span class="python_name">s </span><span class="python_operator">= </span><span class="python_name">users_table</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_literal">>>> </span><span class="python_keyword">print </span><span class="python_name">s</span><span class="python_operator">
</span><span class="python_name">SELECT users</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">password </span><span class="python_operator">
</span><span class="python_name">FROM users</span><span class="python_operator">
</span><span class="python_literal">>>> </span><span class="python_name">r </span><span class="python_operator">= </span><span class="python_name">s</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_name">SELECT users</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">password </span><span class="python_operator">
</span><span class="python_name">FROM users</span><span class="python_operator">
</span><span class="python_enclosure">[]</span><span class="python_operator"></span></pre></div>
<p>This time, we won't ignore the return value of <code>execute()</code>.  Its an instance of <code>ResultProxy</code>, which is a result-holding object that behaves very similarly to the <code>cursor</code> object one deals with directly with a database API:
</p>


<div class="sliding_code">
<pre><span class="python_literal">>>> </span><span class="python_name">r </span><span class="python_operator">
<</span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">engine</span><span class="python_operator">.</span><span class="python_name">base</span><span class="python_operator">.</span><span class="python_name">ResultProxy object at </span><span class="python_number">0x</span><span class="python_operator">...>
</span><span class="python_literal">>>> </span><span class="python_name">r</span><span class="python_operator">.</span><span class="python_name">fetchone</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_enclosure">(</span><span class="python_number">1</span><span class="python_operator">, </span><span class="python_literal">u'Mary'</span><span class="python_operator">, </span><span class="python_literal">u'secure'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_literal">>>> </span><span class="python_name">r</span><span class="python_operator">.</span><span class="python_name">fetchall</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_enclosure">[(</span><span class="python_number">2</span><span class="python_operator">, </span><span class="python_literal">u'Tom'</span><span class="python_operator">, </span><span class="python_name">None</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_enclosure">(</span><span class="python_number">3</span><span class="python_operator">, </span><span class="python_literal">u'Fred'</span><span class="python_operator">, </span><span class="python_name">None</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_enclosure">(</span><span class="python_number">4</span><span class="python_operator">, </span><span class="python_literal">u'Harry'</span><span class="python_operator">, </span><span class="python_name">None</span><span class="python_enclosure">)]</span><span class="python_operator"></span></pre></div>
<p>Query criterion for the select is specified using Python expressions, using the <code>Column</code> objects in the <code>Table</code> as a base.  All expressions constructed from <code>Column</code> objects are themselves instances of <code>ClauseElements</code>, just like the <code>Select</code>, <code>Insert</code>, and <code>Table</code> objects themselves.
</p>


<div class="sliding_code">
<pre><span class="python_literal">>>> </span><span class="python_name">r </span><span class="python_operator">= </span><span class="python_name">users_table</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">users_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator">==</span><span class="python_literal">'Harry'</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_name">SELECT users</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">password </span><span class="python_operator">
</span><span class="python_name">FROM users </span><span class="python_operator">
</span><span class="python_name">WHERE users</span><span class="python_operator">.</span><span class="python_name">user_name </span><span class="python_operator">= ?
</span><span class="python_enclosure">[</span><span class="python_literal">'Harry'</span><span class="python_enclosure">]</span><span class="python_operator">
</span><span class="python_literal">>>> </span><span class="python_name">row </span><span class="python_operator">= </span><span class="python_name">r</span><span class="python_operator">.</span><span class="python_name">fetchone</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_literal">>>> </span><span class="python_keyword">print </span><span class="python_name">row</span><span class="python_operator">
</span><span class="python_enclosure">(</span><span class="python_number">4</span><span class="python_operator">, </span><span class="python_literal">u'Harry'</span><span class="python_operator">, </span><span class="python_name">None</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre></div>
<p>Pretty much the full range of standard SQL operations are supported as constructed Python expressions, including joins, ordering, grouping, functions, correlated subqueries, unions, etc. Documentation on selecting: <a href="sqlconstruction.html#sql_select">Simple Select</a>.
</p>


    </div>

    <a href="#tutorial" class="toclink">back to section top</a>
</div>




<A name="tutorial_schemasql_working"></a>

<div class="subsection" style="margin-left:30px;">


<h3>Working with Rows</h3>

    <div class="sectiontext">
    

<p>You can see that when we print out the rows returned by an execution result, it prints the rows as tuples.  These rows in fact support both the list and dictionary interfaces.  The dictionary interface allows the addressing of columns by string column name, or even the original <code>Column</code> object:
</p>


<div class="sliding_code">
<pre><span class="python_literal">>>> </span><span class="python_name">row</span><span class="python_operator">.</span><span class="python_name">keys</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_enclosure">[</span><span class="python_literal">'user_id'</span><span class="python_operator">, </span><span class="python_literal">'user_name'</span><span class="python_operator">, </span><span class="python_literal">'password'</span><span class="python_enclosure">]</span><span class="python_operator">
</span><span class="python_literal">>>> </span><span class="python_name">row</span><span class="python_enclosure">[</span><span class="python_literal">'user_id'</span><span class="python_enclosure">]</span><span class="python_operator">, </span><span class="python_name">row</span><span class="python_enclosure">[</span><span class="python_number">1</span><span class="python_enclosure">]</span><span class="python_operator">, </span><span class="python_name">row</span><span class="python_enclosure">[</span><span class="python_name">users_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">password</span><span class="python_enclosure">] </span><span class="python_operator">
</span><span class="python_enclosure">(</span><span class="python_number">4</span><span class="python_operator">, </span><span class="python_literal">u'Harry'</span><span class="python_operator">, </span><span class="python_name">None</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre></div>
<p>Addressing the columns in a row based on the original <code>Column</code> object is especially handy, as it eliminates the need to work with literal column names altogether.
</p>
<p>Result sets also support iteration.  We'll show this with a slightly different form of <code>select</code> that allows you to specify the specific columns to be selected:
</p>


<div class="sliding_code">
<pre><span class="python_literal">>>> </span><span class="python_keyword">for </span><span class="python_name">row </span><span class="python_keyword">in </span><span class="python_name">select</span><span class="python_enclosure">([</span><span class="python_name">users_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">, </span><span class="python_name">users_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_enclosure">])</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator">: 
...     </span><span class="python_keyword">print </span><span class="python_name">row</span><span class="python_operator">
</span><span class="python_name">SELECT users</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator">
</span><span class="python_name">FROM users</span><span class="python_operator">
</span><span class="python_enclosure">[]</span><span class="python_operator">
</span><span class="python_enclosure">(</span><span class="python_number">1</span><span class="python_operator">, </span><span class="python_literal">u'Mary'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_enclosure">(</span><span class="python_number">2</span><span class="python_operator">, </span><span class="python_literal">u'Tom'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_enclosure">(</span><span class="python_number">3</span><span class="python_operator">, </span><span class="python_literal">u'Fred'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_enclosure">(</span><span class="python_number">4</span><span class="python_operator">, </span><span class="python_literal">u'Harry'</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre></div>


    </div>

    <a href="#tutorial" class="toclink">back to section top</a>
</div>




<A name="tutorial_schemasql_table_relationships"></a>

<div class="subsection" style="margin-left:30px;">


<h3>Table Relationships</h3>

    <div class="sectiontext">
    

<p>Lets create a second table, <code>email_addresses</code>, which references the <code>users</code> table.  To define the relationship between the two tables, we will use the <code>ForeignKey</code> construct.  We will also issue the <code>CREATE</code> statement for the table:
</p>


<div class="sliding_code">
<pre><span class="python_literal">>>> </span><span class="python_name">email_addresses_table </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'email_addresses'</span><span class="python_operator">, </span><span class="python_name">metadata</span><span class="python_operator">,</span>
<span class="python_operator">...     </span><span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'address_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
<span class="python_operator">...     </span><span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'email_address'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">100</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">nullable</span><span class="python_operator">=</span><span class="python_name">False</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
<span class="python_operator">...     </span><span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'user_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">ForeignKey</span><span class="python_enclosure">(</span><span class="python_literal">'users.user_id'</span><span class="python_enclosure">)))</span><span class="python_operator">
</span><span class="python_literal">>>> </span><span class="python_name">email_addresses_table</span><span class="python_operator">.</span><span class="python_name">create</span><span class="python_enclosure">() </span><span class="python_operator">
</span><span class="python_name">CREATE TABLE email_addresses </span><span class="python_enclosure">(</span>
    <span class="python_name">address_id INTEGER NOT NULL</span><span class="python_operator">,</span>
    <span class="python_name">email_address VARCHAR</span><span class="python_enclosure">(</span><span class="python_number">100</span><span class="python_enclosure">) </span><span class="python_name">NOT NULL</span><span class="python_operator">,</span>
    <span class="python_name">user_id INTEGER</span><span class="python_operator">,</span>
    <span class="python_name">PRIMARY KEY </span><span class="python_enclosure">(</span><span class="python_name">address_id</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">FOREIGN KEY</span><span class="python_enclosure">(</span><span class="python_name">user_id</span><span class="python_enclosure">) </span><span class="python_name">REFERENCES users </span><span class="python_enclosure">(</span><span class="python_name">user_id</span><span class="python_enclosure">)</span>
<span class="python_enclosure">)</span><span class="python_operator">
...</span></pre></div>
<p>Above, the <code>email_addresses</code> table is related to the <code>users</code> table via the <code>ForeignKey('users.user_id')</code>.  The <code>ForeignKey</code> constructor can take a <code>Column</code> object or a string representing the table and column name.  When using the string argument, the referenced table must exist within the same <code>MetaData</code> object; thats where it looks for the other table!
</p>
<p>Next, lets put a few rows in:
</p>


<div class="sliding_code">
<pre><span class="python_literal">>>> </span><span class="python_name">email_addresses_table</span><span class="python_operator">.</span><span class="python_name">insert</span><span class="python_enclosure">()</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span>
<span class="python_operator">...     </span><span class="python_enclosure">{</span><span class="python_literal">'email_address'</span><span class="python_operator">:</span><span class="python_literal">'tom@tom.com'</span><span class="python_operator">, </span><span class="python_literal">'user_id'</span><span class="python_operator">:</span><span class="python_number">2</span><span class="python_enclosure">}</span><span class="python_operator">,</span>
<span class="python_operator">...     </span><span class="python_enclosure">{</span><span class="python_literal">'email_address'</span><span class="python_operator">:</span><span class="python_literal">'mary@mary.com'</span><span class="python_operator">, </span><span class="python_literal">'user_id'</span><span class="python_operator">:</span><span class="python_number">1</span><span class="python_enclosure">}) </span><span class="python_operator">
</span><span class="python_name">INSERT INTO email_addresses </span><span class="python_enclosure">(</span><span class="python_name">email_address</span><span class="python_operator">, </span><span class="python_name">user_id</span><span class="python_enclosure">) </span><span class="python_name">VALUES </span><span class="python_enclosure">(</span><span class="python_operator">?, ?</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_enclosure">[[</span><span class="python_literal">'tom@tom.com'</span><span class="python_operator">, </span><span class="python_number">2</span><span class="python_enclosure">]</span><span class="python_operator">, </span><span class="python_enclosure">[</span><span class="python_literal">'mary@mary.com'</span><span class="python_operator">, </span><span class="python_number">1</span><span class="python_enclosure">]]</span><span class="python_operator">
</span><span class="python_name">COMMIT</span><span class="python_operator">
<</span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">engine</span><span class="python_operator">.</span><span class="python_name">base</span><span class="python_operator">.</span><span class="python_name">ResultProxy object at </span><span class="python_number">0x</span><span class="python_operator">...></span></pre></div>
<p>With two related tables, we can now construct a join amongst them using the <code>join</code> method:
</p>


<div class="sliding_code">
<pre><span class="python_literal">>>> </span><span class="python_name">r </span><span class="python_operator">= </span><span class="python_name">users_table</span><span class="python_operator">.</span><span class="python_name">join</span><span class="python_enclosure">(</span><span class="python_name">email_addresses_table</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">()</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_name">SELECT users</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">password</span><span class="python_operator">, </span><span class="python_name">email_addresses</span><span class="python_operator">.</span><span class="python_name">address_id</span><span class="python_operator">, </span><span class="python_name">email_addresses</span><span class="python_operator">.</span><span class="python_name">email_address</span><span class="python_operator">, </span><span class="python_name">email_addresses</span><span class="python_operator">.</span><span class="python_name">user_id </span><span class="python_operator">
</span><span class="python_name">FROM users JOIN email_addresses ON users</span><span class="python_operator">.</span><span class="python_name">user_id </span><span class="python_operator">= </span><span class="python_name">email_addresses</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">
</span><span class="python_enclosure">[]</span><span class="python_operator">
</span><span class="python_literal">>>> </span><span class="python_keyword">print </span><span class="python_enclosure">[</span><span class="python_name">row </span><span class="python_keyword">for </span><span class="python_name">row </span><span class="python_keyword">in </span><span class="python_name">r</span><span class="python_enclosure">]</span><span class="python_operator">
</span><span class="python_enclosure">[(</span><span class="python_number">1</span><span class="python_operator">, </span><span class="python_literal">u'Mary'</span><span class="python_operator">, </span><span class="python_literal">u'secure'</span><span class="python_operator">, </span><span class="python_number">2</span><span class="python_operator">, </span><span class="python_literal">u'mary@mary.com'</span><span class="python_operator">, </span><span class="python_number">1</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_enclosure">(</span><span class="python_number">2</span><span class="python_operator">, </span><span class="python_literal">u'Tom'</span><span class="python_operator">, </span><span class="python_name">None</span><span class="python_operator">, </span><span class="python_number">1</span><span class="python_operator">, </span><span class="python_literal">u'tom@tom.com'</span><span class="python_operator">, </span><span class="python_number">2</span><span class="python_enclosure">)]</span><span class="python_operator"></span></pre></div>
<p>The <code>join</code> method is also a standalone function in the <code>sqlalchemy</code> namespace.  The join condition is figured out from the foreign keys of the Table objects given.  The condition (also called the "ON clause") can be specified explicitly, such as in this example where we locate all users that used their email address as their password:
</p>


<div class="sliding_code">
<pre><span class="python_literal">>>> </span><span class="python_keyword">print </span><span class="python_name">join</span><span class="python_enclosure">(</span><span class="python_name">users_table</span><span class="python_operator">, </span><span class="python_name">email_addresses_table</span><span class="python_operator">, </span>
<span class="python_operator">...     </span><span class="python_name">and_</span><span class="python_enclosure">(</span><span class="python_name">users_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">==</span><span class="python_name">email_addresses_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">, </span>
<span class="python_operator">...     </span><span class="python_name">users_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">password</span><span class="python_operator">==</span><span class="python_name">email_addresses_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">email_address</span><span class="python_enclosure">)</span>
<span class="python_operator">...     </span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">users JOIN email_addresses ON users</span><span class="python_operator">.</span><span class="python_name">user_id </span><span class="python_operator">= </span><span class="python_name">email_addresses</span><span class="python_operator">.</span><span class="python_name">user_id AND users</span><span class="python_operator">.</span><span class="python_name">password </span><span class="python_operator">= </span><span class="python_name">email_addresses</span><span class="python_operator">.</span><span class="python_name">email_address</span><span class="python_operator"></span></pre></div>


    </div>

</div>



    </div>

    <a href="#tutorial" class="toclink">back to section top</a>
</div>




<A name="tutorial_orm"></a>

<div class="subsection" style="margin-left:20px;">


<h3>Working with Object Mappers</h3>

    <div class="sectiontext">
    

<p>Now that we have a little bit of Table and SQL operations covered, lets look into SQLAlchemy's ORM (object relational mapper).  With the ORM, you associate Tables (and other <em>Selectable</em> units, like queries and table aliases) with Python classes, into units called <em>Mappers</em>.  Then you can execute queries that return lists of object instances, instead of result sets.  The object instances themselves are associated with an object called a <em>Session</em>, which automatically tracks changes on each object and supports a "save all at once" operation called a <em>flush</em>.
</p>



<A name="tutorial_orm_mapper"></a>

<div class="subsection" style="margin-left:30px;">


<h3>Creating a Mapper</h3>

    <div class="sectiontext">
    

<p>A Mapper is usually created once per Python class, and at its core primarily means to say, "objects of this class are to be stored as rows in this table".  Lets create a class called <code>User</code>, which will represent a user object that is stored in our <code>users</code> table:
</p>


<div class="sliding_code">
<pre><span class="python_literal">>>> </span><span class="python_keyword">class </span><span class="python_name">User</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
...     </span><span class="python_keyword">def </span><span class="python_name">__repr__</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_enclosure">)</span><span class="python_operator">:
...        </span><span class="python_keyword">return </span><span class="python_literal">"%s(%r,%r)" </span><span class="python_operator">% </span><span class="python_enclosure">(</span>
<span class="python_operator">...            </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">__class__</span><span class="python_operator">.</span><span class="python_name">__name__</span><span class="python_operator">, </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator">, </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">password</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre></div>
<p>The class is a new style class (i.e. it extends <code>object</code>) and does not require a constructor (although one may be provided if desired).  We just have one <code>__repr__</code> method on it which will display basic information about the User.  Note that the <code>__repr__</code> method references the instance variables <code>user_name</code> and <code>password</code> which otherwise aren't defined.  While we are free to explicitly define these attributes and treat them normally, this is optional; as SQLAlchemy's <code>Mapper</code> construct will manage them for us, since their names correspond to the names of columns in the <code>users</code> table.  Lets create a mapper, and observe that these attributes are now defined:
</p>


<div class="sliding_code">
<pre><span class="python_literal">>>> </span><span class="python_name">usermapper </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">users_table</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_literal">>>> </span><span class="python_name">u1 </span><span class="python_operator">= </span><span class="python_name">User</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_literal">>>> </span><span class="python_keyword">print </span><span class="python_name">u1</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator">
</span><span class="python_name">None</span><span class="python_operator">
</span><span class="python_literal">>>> </span><span class="python_keyword">print </span><span class="python_name">u1</span><span class="python_operator">.</span><span class="python_name">password</span><span class="python_operator">
</span><span class="python_name">None</span><span class="python_operator"></span></pre></div>
<p>The <code>mapper</code> function returns a new instance of <code>Mapper</code>.  As it is the first Mapper we have created for the <code>User</code> class, it is known as the classes' <em>primary mapper</em>.  We generally don't need to hold onto the <code>usermapper</code> instance variable; SA's ORM can automatically locate this Mapper when it deals with the class, or instances of that class.  <br></br>
</p>


    </div>

    <a href="#tutorial" class="toclink">back to section top</a>
</div>




<A name="tutorial_orm_session"></a>

<div class="subsection" style="margin-left:30px;">


<h3>Obtaining a Session</h3>

    <div class="sectiontext">
    

<p>After you create a Mapper, all operations with that Mapper require the usage of an important object called a <code>Session</code>.  All objects loaded or saved by the Mapper must be <em>attached</em> to a <code>Session</code> object, which represents a kind of "workspace" of objects that are loaded into memory.  A particular object instance can only be attached to one <code>Session</code> at a time.
</p>
<p>By default, you have to create a <code>Session</code> object explicitly before you can load or save objects.  Theres several ways to manage sessions, but the most straightforward is to just create one, which we will do by saying, <code>create_session()</code>:
</p>


<div class="sliding_code">
<pre><span class="python_literal">>>> </span><span class="python_name">session </span><span class="python_operator">= </span><span class="python_name">create_session</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_literal">>>> </span><span class="python_name">session </span><span class="python_operator">
<</span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">orm</span><span class="python_operator">.</span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">Session object at </span><span class="python_number">0x</span><span class="python_operator">...></span></pre></div>


    </div>

    <a href="#tutorial" class="toclink">back to section top</a>
</div>




<A name="tutorial_orm_query"></a>

<div class="subsection" style="margin-left:30px;">


<h3>The Query Object</h3>

    <div class="sectiontext">
    

<pre><code>
</code></pre><p>The Session has all kinds of methods on it to retrieve and store objects, and also to view their current status.  The Session also provides an easy interface which can be used to query the database, by giving you an instance to a <code>Query</code> object corresponding to a particular Python class:
</p>


<div class="sliding_code">
<pre><span class="python_literal">>>> </span><span class="python_name">query </span><span class="python_operator">= </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_literal">>>> </span><span class="python_keyword">print </span><span class="python_name">query</span><span class="python_operator">.</span><span class="python_name">select_by</span><span class="python_enclosure">(</span><span class="python_name">user_name</span><span class="python_operator">=</span><span class="python_literal">'Harry'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">SELECT users</span><span class="python_operator">.</span><span class="python_name">user_name AS users_user_name</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">password AS users_password</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">user_id AS users_user_id </span><span class="python_operator">
</span><span class="python_name">FROM users </span><span class="python_operator">
</span><span class="python_name">WHERE users</span><span class="python_operator">.</span><span class="python_name">user_name </span><span class="python_operator">= ? </span><span class="python_name">ORDER BY users</span><span class="python_operator">.</span><span class="python_name">oid</span><span class="python_operator">
</span><span class="python_enclosure">[</span><span class="python_literal">'Harry'</span><span class="python_enclosure">]</span><span class="python_operator">
</span><span class="python_enclosure">[</span><span class="python_name">User</span><span class="python_enclosure">(</span><span class="python_literal">u'Harry'</span><span class="python_operator">,</span><span class="python_name">None</span><span class="python_enclosure">)]</span><span class="python_operator"></span></pre></div>
<p>All querying for objects is performed via an instance of <code>Query</code>.  The various <code>select</code> methods on an instance of <code>Mapper</code> also use an underlying <code>Query</code> object to perform the operation.  A <code>Query</code> is always bound to a specific <code>Session</code>.  <br></br>
</p>
<p>Lets turn off the database echoing for a moment, and try out a few methods on <code>Query</code>.  Methods that end with the suffix <code>_by</code> primarily take keyword arguments which correspond to properties on the object.  Other methods take <code>ClauseElement</code> objects, which are constructed by using <code>Column</code> objects inside of Python expressions, in the same way as we did with our SQL select example in the previous section of this tutorial.  Using <code>ClauseElement</code> structures to query objects is more verbose but more flexible:
</p>


<div class="sliding_code">
<pre><span class="python_literal">>>> </span><span class="python_name">metadata</span><span class="python_operator">.</span><span class="python_name">engine</span><span class="python_operator">.</span><span class="python_name">echo </span><span class="python_operator">= </span><span class="python_name">False</span><span class="python_operator">
</span><span class="python_literal">>>> </span><span class="python_keyword">print </span><span class="python_name">query</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">==</span><span class="python_number">3</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_enclosure">[</span><span class="python_name">User</span><span class="python_enclosure">(</span><span class="python_literal">u'Fred'</span><span class="python_operator">,</span><span class="python_name">None</span><span class="python_enclosure">)]</span><span class="python_operator">
</span><span class="python_literal">>>> </span><span class="python_keyword">print </span><span class="python_name">query</span><span class="python_operator">.</span><span class="python_name">get</span><span class="python_enclosure">(</span><span class="python_number">2</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">User</span><span class="python_enclosure">(</span><span class="python_literal">u'Tom'</span><span class="python_operator">,</span><span class="python_name">None</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_literal">>>> </span><span class="python_keyword">print </span><span class="python_name">query</span><span class="python_operator">.</span><span class="python_name">get_by</span><span class="python_enclosure">(</span><span class="python_name">user_name</span><span class="python_operator">=</span><span class="python_literal">'Mary'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">User</span><span class="python_enclosure">(</span><span class="python_literal">u'Mary'</span><span class="python_operator">,</span><span class="python_literal">u'secure'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_literal">>>> </span><span class="python_keyword">print </span><span class="python_name">query</span><span class="python_operator">.</span><span class="python_name">selectfirst</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">password</span><span class="python_operator">==</span><span class="python_name">None</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">User</span><span class="python_enclosure">(</span><span class="python_literal">u'Tom'</span><span class="python_operator">,</span><span class="python_name">None</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_literal">>>> </span><span class="python_keyword">print </span><span class="python_name">query</span><span class="python_operator">.</span><span class="python_name">count</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_number">4</span><span class="python_operator"></span></pre></div>
<p>Notice that our <code>User</code> class has a special attribute <code>c</code> attached to it.  This 'c' represents the columns on the User's mapper's Table object.  Saying <code>User.c.user_name</code> is synonymous with saying <code>users_table.c.user_name</code>, recalling that <code>User</code> is the Python class and <code>users</code> is our <code>Table</code> object.
</p>


    </div>

    <a href="#tutorial" class="toclink">back to section top</a>
</div>




<A name="tutorial_orm_changes"></a>

<div class="subsection" style="margin-left:30px;">


<h3>Making Changes</h3>

    <div class="sectiontext">
    

<p>With a little experience in loading objects, lets see what its like to make changes.  First, lets create a new user "Ed".  We do this by just constructing the new object.  Then, we just add it to the session:
</p>


<div class="sliding_code">
<pre><span class="python_literal">>>> </span><span class="python_name">ed </span><span class="python_operator">= </span><span class="python_name">User</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_literal">>>> </span><span class="python_name">ed</span><span class="python_operator">.</span><span class="python_name">user_name </span><span class="python_operator">= </span><span class="python_literal">'Ed'</span><span class="python_operator">
</span><span class="python_literal">>>> </span><span class="python_name">ed</span><span class="python_operator">.</span><span class="python_name">password </span><span class="python_operator">= </span><span class="python_literal">'edspassword'</span><span class="python_operator">
</span><span class="python_literal">>>> </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">save</span><span class="python_enclosure">(</span><span class="python_name">ed</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_literal">>>> </span><span class="python_name">ed </span><span class="python_keyword">in </span><span class="python_name">session</span><span class="python_operator">
</span><span class="python_name">True</span><span class="python_operator"></span></pre></div>
<p>Lets also make a few changes on some of the objects in the database.  We will load them with our <code>Query</code> object, and then change some things.
</p>


<div class="sliding_code">
<pre><span class="python_literal">>>> </span><span class="python_name">mary </span><span class="python_operator">= </span><span class="python_name">query</span><span class="python_operator">.</span><span class="python_name">get_by</span><span class="python_enclosure">(</span><span class="python_name">user_name</span><span class="python_operator">=</span><span class="python_literal">'Mary'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_literal">>>> </span><span class="python_name">harry </span><span class="python_operator">= </span><span class="python_name">query</span><span class="python_operator">.</span><span class="python_name">get_by</span><span class="python_enclosure">(</span><span class="python_name">user_name</span><span class="python_operator">=</span><span class="python_literal">'Harry'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_literal">>>> </span><span class="python_name">mary</span><span class="python_operator">.</span><span class="python_name">password </span><span class="python_operator">= </span><span class="python_literal">'marysnewpassword'</span><span class="python_operator">
</span><span class="python_literal">>>> </span><span class="python_name">harry</span><span class="python_operator">.</span><span class="python_name">password </span><span class="python_operator">= </span><span class="python_literal">'harrysnewpassword'</span><span class="python_operator"></span></pre></div>
<p>At the moment, nothing has been saved to the database; all of our changes are in memory only.  What happens if some other part of the application also tries to load 'Mary' from the database and make some changes before we had a chance to save it ?  Assuming that the same <code>Session</code> is used, loading 'Mary' from the database a second time will issue a second query in order locate the primary key of 'Mary', but will <em>return the same object instance as the one already loaded</em>.  This behavior is due to an important property of the <code>Session</code> known as the <strong>identity map</strong>:
</p>


<div class="sliding_code">
<pre><span class="python_literal">>>> </span><span class="python_name">mary2 </span><span class="python_operator">= </span><span class="python_name">query</span><span class="python_operator">.</span><span class="python_name">get_by</span><span class="python_enclosure">(</span><span class="python_name">user_name</span><span class="python_operator">=</span><span class="python_literal">'Mary'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_literal">>>> </span><span class="python_name">mary </span><span class="python_keyword">is </span><span class="python_name">mary2</span><span class="python_operator">
</span><span class="python_name">True</span><span class="python_operator"></span></pre></div>
<p>With the identity map, a single <code>Session</code> can be relied upon to keep all loaded instances straight.
</p>
<p>As far as the issue of the same object being modified in two different Sessions, that's an issue of concurrency detection; SQLAlchemy does some basic concurrency checks when saving objects, with the option for a stronger check using version ids.  See <a href="adv_datamapping.html#advdatamapping_arguments">Mapper Arguments</a> for more details.
</p>


    </div>

    <a href="#tutorial" class="toclink">back to section top</a>
</div>




<A name="tutorial_orm_saving"></a>

<div class="subsection" style="margin-left:30px;">


<h3>Saving</h3>

    <div class="sectiontext">
    

<p>With a new user "ed" and some changes made on "Mary" and "Harry", lets also mark "Fred" as deleted:
</p>


<div class="sliding_code">
<pre><span class="python_literal">>>> </span><span class="python_name">fred </span><span class="python_operator">= </span><span class="python_name">query</span><span class="python_operator">.</span><span class="python_name">get_by</span><span class="python_enclosure">(</span><span class="python_name">user_name</span><span class="python_operator">=</span><span class="python_literal">'Fred'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_literal">>>> </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">delete</span><span class="python_enclosure">(</span><span class="python_name">fred</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre></div>
<p>Then to send all of our changes to the database, we <code>flush()</code> the Session.  Lets turn echo back on to see this happen!:
</p>


<div class="sliding_code">
<pre><span class="python_literal">>>> </span><span class="python_name">metadata</span><span class="python_operator">.</span><span class="python_name">engine</span><span class="python_operator">.</span><span class="python_name">echo </span><span class="python_operator">= </span><span class="python_name">True</span><span class="python_operator">
</span><span class="python_literal">>>> </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">flush</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_name">BEGIN</span><span class="python_operator">
</span><span class="python_name">UPDATE users SET password</span><span class="python_operator">=? </span><span class="python_name">WHERE users</span><span class="python_operator">.</span><span class="python_name">user_id </span><span class="python_operator">= ?
</span><span class="python_enclosure">[</span><span class="python_literal">'marysnewpassword'</span><span class="python_operator">, </span><span class="python_number">1</span><span class="python_enclosure">]</span><span class="python_operator">
</span><span class="python_name">UPDATE users SET password</span><span class="python_operator">=? </span><span class="python_name">WHERE users</span><span class="python_operator">.</span><span class="python_name">user_id </span><span class="python_operator">= ?
</span><span class="python_enclosure">[</span><span class="python_literal">'harrysnewpassword'</span><span class="python_operator">, </span><span class="python_number">4</span><span class="python_enclosure">]</span><span class="python_operator">
</span><span class="python_name">INSERT INTO users </span><span class="python_enclosure">(</span><span class="python_name">user_name</span><span class="python_operator">, </span><span class="python_name">password</span><span class="python_enclosure">) </span><span class="python_name">VALUES </span><span class="python_enclosure">(</span><span class="python_operator">?, ?</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_enclosure">[</span><span class="python_literal">'Ed'</span><span class="python_operator">, </span><span class="python_literal">'edspassword'</span><span class="python_enclosure">]</span><span class="python_operator">
</span><span class="python_name">DELETE FROM users WHERE users</span><span class="python_operator">.</span><span class="python_name">user_id </span><span class="python_operator">= ?
</span><span class="python_enclosure">[</span><span class="python_number">3</span><span class="python_enclosure">]</span><span class="python_operator">
</span><span class="python_name">COMMIT</span><span class="python_operator"></span></pre></div>


    </div>

    <a href="#tutorial" class="toclink">back to section top</a>
</div>




<A name="tutorial_orm_relationships"></a>

<div class="subsection" style="margin-left:30px;">


<h3>Relationships</h3>

    <div class="sectiontext">
    

<p>When our User object contains relationships to other kinds of information, such as a list of email addresses, we can indicate this by using a function when creating the <code>Mapper</code> called <code>relation()</code>.  While there is a lot you can do with relations, we'll cover a simple one here.  First, recall that our <code>users</code> table has a foreign key relationship to another table called <code>email_addresses</code>.   A single row in <code>email_addresses</code> has a column <code>user_id</code> that references a row in the <code>users</code> table; since many rows in the <code>email_addresses</code> table can reference a single row in <code>users</code>, this is called a <em>one to many</em> relationship.
</p>
<p>First, deal with the <code>email_addresses</code> table by itself.  We will create a new class <code>Address</code> which represents a single row in the <code>email_addresses</code> table, and a corresponding <code>Mapper</code> which will associate the <code>Address</code> class with the <code>email_addresses</code> table:
</p>


<div class="sliding_code">
<pre><span class="python_literal">>>> </span><span class="python_keyword">class </span><span class="python_name">Address</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
...     </span><span class="python_keyword">def </span><span class="python_name">__init__</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">email_address</span><span class="python_enclosure">)</span><span class="python_operator">:
...         </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">email_address </span><span class="python_operator">= </span><span class="python_name">email_address</span><span class="python_operator">
...     </span><span class="python_keyword">def </span><span class="python_name">__repr__</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_enclosure">)</span><span class="python_operator">:
...         </span><span class="python_keyword">return </span><span class="python_literal">"%s(%r)" </span><span class="python_operator">% </span><span class="python_enclosure">(</span>
<span class="python_operator">...            </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">__class__</span><span class="python_operator">.</span><span class="python_name">__name__</span><span class="python_operator">, </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">email_address</span><span class="python_enclosure">)    </span><span class="python_operator">
</span><span class="python_literal">>>> </span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_operator">, </span><span class="python_name">email_addresses_table</span><span class="python_enclosure">) </span><span class="python_operator">
<</span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">orm</span><span class="python_operator">.</span><span class="python_name">mapper</span><span class="python_operator">.</span><span class="python_name">Mapper object at </span><span class="python_number">0x</span><span class="python_operator">...></span></pre></div>
<p>Next, we associate the <code>User</code> and <code>Address</code> classes together by creating a relation using <code>relation()</code>, and then adding that relation to the <code>User</code> mapper, using the <code>add_property</code> function:
</p>


<div class="sliding_code">
<pre><span class="python_literal">>>> </span><span class="python_name">usermapper</span><span class="python_operator">.</span><span class="python_name">add_property</span><span class="python_enclosure">(</span><span class="python_literal">'addresses'</span><span class="python_operator">, </span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_enclosure">))</span><span class="python_operator"></span></pre></div>
<p>The <code>relation()</code> function takes either a class or a Mapper as its first argument, and has many options to further control its behavior.  The 'User' mapper has now placed additional property on each <code>User</code> instance called <code>addresses</code>.  SQLAlchemy will automatically determine that this relationship is a one-to-many relationship, and will subsequently create <code>addresses</code> as a list.  When a new <code>User</code> is created, this list will begin as empty.
</p>
<p>Lets see what we get for the email addresses already in the database.  Since we have made a change to the mapper's configuration, its best that we clear out our <code>Session</code>, which is currently holding onto every <code>User</code> object we have already loaded:
</p>


<div class="sliding_code">
<pre><span class="python_literal">>>> </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">clear</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre></div>
<p>We can then treat the <code>addresses</code> attribute on each <code>User</code> object like a regular list:
</p>


<div class="sliding_code">
<pre><span class="python_literal">>>> </span><span class="python_name">mary </span><span class="python_operator">= </span><span class="python_name">query</span><span class="python_operator">.</span><span class="python_name">get_by</span><span class="python_enclosure">(</span><span class="python_name">user_name</span><span class="python_operator">=</span><span class="python_literal">'Mary'</span><span class="python_enclosure">) </span><span class="python_operator">
</span><span class="python_name">SELECT users</span><span class="python_operator">.</span><span class="python_name">user_name AS users_user_name</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">password AS users_password</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">user_id AS users_user_id </span><span class="python_operator">
</span><span class="python_name">FROM users </span><span class="python_operator">
</span><span class="python_name">WHERE users</span><span class="python_operator">.</span><span class="python_name">user_name </span><span class="python_operator">= ? </span><span class="python_name">ORDER BY users</span><span class="python_operator">.</span><span class="python_name">oid </span><span class="python_operator">
</span><span class="python_name">LIMIT </span><span class="python_number">1 </span><span class="python_name">OFFSET </span><span class="python_number">0</span><span class="python_operator">
</span><span class="python_enclosure">[</span><span class="python_literal">'Mary'</span><span class="python_enclosure">]</span><span class="python_operator">
</span><span class="python_literal">>>> </span><span class="python_keyword">print </span><span class="python_enclosure">[</span><span class="python_name">a </span><span class="python_keyword">for </span><span class="python_name">a </span><span class="python_keyword">in </span><span class="python_name">mary</span><span class="python_operator">.</span><span class="python_name">addresses</span><span class="python_enclosure">]</span><span class="python_operator">
</span><span class="python_name">SELECT email_addresses</span><span class="python_operator">.</span><span class="python_name">user_id AS email_addresses_user_id</span><span class="python_operator">, </span><span class="python_name">email_addresses</span><span class="python_operator">.</span><span class="python_name">address_id AS email_addresses_address_id</span><span class="python_operator">, </span><span class="python_name">email_addresses</span><span class="python_operator">.</span><span class="python_name">email_address AS email_addresses_email_address </span><span class="python_operator">
</span><span class="python_name">FROM email_addresses </span><span class="python_operator">
</span><span class="python_name">WHERE</span><span class="python_operator"> ? = </span><span class="python_name">email_addresses</span><span class="python_operator">.</span><span class="python_name">user_id ORDER BY email_addresses</span><span class="python_operator">.</span><span class="python_name">oid</span><span class="python_operator">
</span><span class="python_enclosure">[</span><span class="python_number">1</span><span class="python_enclosure">]</span><span class="python_operator">
</span><span class="python_enclosure">[</span><span class="python_name">Address</span><span class="python_enclosure">(</span><span class="python_literal">u'mary@mary.com'</span><span class="python_enclosure">)]</span><span class="python_operator"></span></pre></div>
<p>Adding to the list is just as easy.  New <code>Address</code> objects will be detected and saved when we <code>flush</code> the Session:
</p>


<div class="sliding_code">
<pre><span class="python_literal">>>> </span><span class="python_name">mary</span><span class="python_operator">.</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">append</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_enclosure">(</span><span class="python_literal">'mary2@gmail.com'</span><span class="python_enclosure">))</span><span class="python_operator">
</span><span class="python_literal">>>> </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">flush</span><span class="python_enclosure">() </span><span class="python_operator">
</span><span class="python_name">BEGIN</span><span class="python_operator">
</span><span class="python_name">INSERT INTO email_addresses </span><span class="python_enclosure">(</span><span class="python_name">email_address</span><span class="python_operator">, </span><span class="python_name">user_id</span><span class="python_enclosure">) </span><span class="python_name">VALUES </span><span class="python_enclosure">(</span><span class="python_operator">?, ?</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_enclosure">[</span><span class="python_literal">'mary2@gmail.com'</span><span class="python_operator">, </span><span class="python_number">1</span><span class="python_enclosure">]</span><span class="python_operator">
</span><span class="python_name">COMMIT</span><span class="python_operator"></span></pre></div>
<p>Main documentation for using mappers:  <a href="datamapping.html#datamapping">Data Mapping</a>
</p>


    </div>

    <a href="#tutorial" class="toclink">back to section top</a>
</div>




<A name="tutorial_orm_transactions"></a>

<div class="subsection" style="margin-left:30px;">


<h3>Transactions</h3>

    <div class="sectiontext">
    

<p>You may have noticed from the example above that when we say <code>session.flush()</code>, SQLAlchemy indicates the names <code>BEGIN</code> and <code>COMMIT</code> to indicate a transaction with the database.  The <code>flush()</code> method, since it may execute many statements in a row, will automatically use a transaction in order to execute these instructions.  But what if we want to use <code>flush()</code> inside of a larger transaction?  This is performed via the <code>SessionTransaction</code> object, which we can establish using <code>session.create_transaction()</code>.  Below, we will perform a more complicated <code>SELECT</code> statement, make several changes to our collection of users and email addresess, and then create a new user with two email addresses, within the context of a transaction.  We will perform a <code>flush()</code> in the middle of it to write the changes we have so far, and then allow the remaining changes to be written when we finally <code>commit()</code> the transaction.  We enclose our operations within a <code>try/except</code> block to insure that resources are properly freed:
</p>


<div class="sliding_code">
<pre><span class="python_literal">>>> </span><span class="python_name">transaction </span><span class="python_operator">= </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">create_transaction</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_literal">>>> </span><span class="python_keyword">try</span><span class="python_operator">: 
...     </span><span class="python_enclosure">(</span><span class="python_name">ed</span><span class="python_operator">, </span><span class="python_name">harry</span><span class="python_operator">, </span><span class="python_name">mary</span><span class="python_enclosure">) </span><span class="python_operator">= </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span>
<span class="python_operator">...         </span><span class="python_name">User</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator">.</span><span class="python_name">in_</span><span class="python_enclosure">(</span><span class="python_literal">'Ed'</span><span class="python_operator">, </span><span class="python_literal">'Harry'</span><span class="python_operator">, </span><span class="python_literal">'Mary'</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">order_by</span><span class="python_operator">=</span><span class="python_name">User</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name</span>
<span class="python_operator">...     </span><span class="python_enclosure">)</span><span class="python_operator">
...     </span><span class="python_keyword">del </span><span class="python_name">mary</span><span class="python_operator">.</span><span class="python_name">addresses</span><span class="python_enclosure">[</span><span class="python_number">1</span><span class="python_enclosure">]</span><span class="python_operator">
...     </span><span class="python_name">harry</span><span class="python_operator">.</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">append</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_enclosure">(</span><span class="python_literal">'harry2@gmail.com'</span><span class="python_enclosure">))</span><span class="python_operator">
...     </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">flush</span><span class="python_enclosure">()</span><span class="python_operator">
...     </span><span class="python_keyword">print </span><span class="python_literal">"***flushed the session***"</span><span class="python_operator">
...     </span><span class="python_name">fred </span><span class="python_operator">= </span><span class="python_name">User</span><span class="python_enclosure">()</span><span class="python_operator">
...     </span><span class="python_name">fred</span><span class="python_operator">.</span><span class="python_name">user_name </span><span class="python_operator">= </span><span class="python_literal">'fred_again'</span><span class="python_operator">
...     </span><span class="python_name">fred</span><span class="python_operator">.</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">append</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_enclosure">(</span><span class="python_literal">'fred@fred.com'</span><span class="python_enclosure">))</span><span class="python_operator">
...     </span><span class="python_name">fred</span><span class="python_operator">.</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">append</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_enclosure">(</span><span class="python_literal">'fredsnewemail@fred.com'</span><span class="python_enclosure">))</span><span class="python_operator">
...     </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">save</span><span class="python_enclosure">(</span><span class="python_name">fred</span><span class="python_enclosure">)</span><span class="python_operator">
...     </span><span class="python_name">transaction</span><span class="python_operator">.</span><span class="python_name">commit</span><span class="python_enclosure">()</span><span class="python_operator">
... </span><span class="python_keyword">except</span><span class="python_operator">:
...     </span><span class="python_name">transaction</span><span class="python_operator">.</span><span class="python_name">rollback</span><span class="python_enclosure">()</span><span class="python_operator">
...     </span><span class="python_keyword">raise</span><span class="python_operator">
</span><span class="python_name">BEGIN</span><span class="python_operator">
</span><span class="python_name">SELECT users</span><span class="python_operator">.</span><span class="python_name">user_name AS users_user_name</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">password AS users_password</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">user_id AS users_user_id </span><span class="python_operator">
</span><span class="python_name">FROM users </span><span class="python_operator">
</span><span class="python_name">WHERE users</span><span class="python_operator">.</span><span class="python_name">user_name IN </span><span class="python_enclosure">(</span><span class="python_operator">?, ?, ?</span><span class="python_enclosure">) </span><span class="python_name">ORDER BY users</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator">
</span><span class="python_enclosure">[</span><span class="python_literal">'Ed'</span><span class="python_operator">, </span><span class="python_literal">'Harry'</span><span class="python_operator">, </span><span class="python_literal">'Mary'</span><span class="python_enclosure">]</span><span class="python_operator">
</span><span class="python_name">SELECT email_addresses</span><span class="python_operator">.</span><span class="python_name">user_id AS email_addresses_user_id</span><span class="python_operator">, </span><span class="python_name">email_addresses</span><span class="python_operator">.</span><span class="python_name">address_id AS email_addresses_address_id</span><span class="python_operator">, </span><span class="python_name">email_addresses</span><span class="python_operator">.</span><span class="python_name">email_address AS email_addresses_email_address </span><span class="python_operator">
</span><span class="python_name">FROM email_addresses </span><span class="python_operator">
</span><span class="python_name">WHERE</span><span class="python_operator"> ? = </span><span class="python_name">email_addresses</span><span class="python_operator">.</span><span class="python_name">user_id ORDER BY email_addresses</span><span class="python_operator">.</span><span class="python_name">oid</span><span class="python_operator">
</span><span class="python_enclosure">[</span><span class="python_number">4</span><span class="python_enclosure">]</span><span class="python_operator">
</span><span class="python_name">UPDATE email_addresses SET user_id</span><span class="python_operator">=? </span><span class="python_name">WHERE email_addresses</span><span class="python_operator">.</span><span class="python_name">address_id </span><span class="python_operator">= ?
</span><span class="python_enclosure">[</span><span class="python_name">None</span><span class="python_operator">, </span><span class="python_number">3</span><span class="python_enclosure">]</span><span class="python_operator">
</span><span class="python_name">INSERT INTO email_addresses </span><span class="python_enclosure">(</span><span class="python_name">email_address</span><span class="python_operator">, </span><span class="python_name">user_id</span><span class="python_enclosure">) </span><span class="python_name">VALUES </span><span class="python_enclosure">(</span><span class="python_operator">?, ?</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_enclosure">[</span><span class="python_literal">'harry2@gmail.com'</span><span class="python_operator">, </span><span class="python_number">4</span><span class="python_enclosure">]</span><span class="python_operator">
***</span><span class="python_name">flushed the session</span><span class="python_operator">***    
</span><span class="python_name">INSERT INTO users </span><span class="python_enclosure">(</span><span class="python_name">user_name</span><span class="python_operator">, </span><span class="python_name">password</span><span class="python_enclosure">) </span><span class="python_name">VALUES </span><span class="python_enclosure">(</span><span class="python_operator">?, ?</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_enclosure">[</span><span class="python_literal">'fred_again'</span><span class="python_operator">, </span><span class="python_name">None</span><span class="python_enclosure">]</span><span class="python_operator">
</span><span class="python_name">INSERT INTO email_addresses </span><span class="python_enclosure">(</span><span class="python_name">email_address</span><span class="python_operator">, </span><span class="python_name">user_id</span><span class="python_enclosure">) </span><span class="python_name">VALUES </span><span class="python_enclosure">(</span><span class="python_operator">?, ?</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_enclosure">[</span><span class="python_literal">'fred@fred.com'</span><span class="python_operator">, </span><span class="python_number">6</span><span class="python_enclosure">]</span><span class="python_operator">
</span><span class="python_name">INSERT INTO email_addresses </span><span class="python_enclosure">(</span><span class="python_name">email_address</span><span class="python_operator">, </span><span class="python_name">user_id</span><span class="python_enclosure">) </span><span class="python_name">VALUES </span><span class="python_enclosure">(</span><span class="python_operator">?, ?</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_enclosure">[</span><span class="python_literal">'fredsnewemail@fred.com'</span><span class="python_operator">, </span><span class="python_number">6</span><span class="python_enclosure">]</span><span class="python_operator">
</span><span class="python_name">COMMIT</span><span class="python_operator"></span></pre></div>
<p>Main documentation:  <a href="unitofwork.html#unitofwork">Session / Unit of Work</a>
</p>


    </div>

</div>



    </div>

    <a href="#tutorial" class="toclink">back to section top</a>
</div>




<A name="tutorial_next"></a>

<div class="subsection" style="margin-left:20px;">


<h3>Next Steps</h3>

    <div class="sectiontext">
    

<p>That covers a quick tour through the basic idea of SQLAlchemy, in its simplest form.  Beyond that, one should familiarize oneself with the basics of Sessions, the various patterns that can be used to define different kinds of Mappers and relations among them, the rudimentary SQL types that are available when constructing Tables, and the basics of Engines, SQL statements, and database Connections.
</p>



    </div>

</div>



    </div>

    <a href="#tutorial" class="toclink">back to section top</a>
</div>


</html></div>
<A name="dbengine"></a>

<div class="sectionnavblock">
<div class="sectionnav">

        Previous: <a href="#tutorial">Tutorial</a>

                |

        Next: <a href="#metadata">Database Meta Data</a>

</div>
</div>

<div class="topnavmain">
	<div class="topnavheader">Database Engines</div>
</div>
<div class="sectioncontent">
<html>



<A name="dbengine"></a>

<div class="subsection" style="margin-left:10px;">



    <div class="sectiontext">
    

<p>A database engine is a subclass of <code>sqlalchemy.sql.Engine</code>, and is the starting point for where SQLAlchemy provides a layer of abstraction on top of the various DBAPI2 database modules.  For all databases supported by SA, there is a specific "implementation" module, found in the <code>sqlalchemy.databases</code> package, that provides all the objects an <code>Engine</code> needs in order to perform its job.  A typical user of SQLAlchemy never needs to deal with these modules directly.  For many purposes, the only knowledge that's needed is how to create an Engine for a particular connection URL.  When dealing with direct execution of SQL statements, one would also be aware of Result, Connection, and Transaction objects.  The primary public facing objects are:
</p>
<ul>
 <li>
     <strong><a href="docstrings.html#docstrings_sqlalchemy.engine.url_URL">URL</a></strong> - represents the identifier for a particular database.  URL objects are usually created automatically based on a given connect string passed to the <code>create_engine()</code> function.
 </li>

 <li>
     <strong><a href="docstrings.html#docstrings_sqlalchemy.engine_Engine">Engine</a></strong> - Combines a connection-providing resource with implementation-provided objects that know how to generate, execute, and gather information about SQL statements.  It also provides the primary interface by which Connections are obtained, as well as a context for constructed SQL objects and schema constructs to "implicitly execute" themselves, which is an optional feature of SQLAlchemy.  <br></br>
 </li>

 <li>
     <strong><a href="docstrings.html#docstrings_sqlalchemy.engine_Connection">Connection</a></strong> - represents a connection to the database.  The underlying connection object returned by a DBAPI's connect() method is referenced internally by the Connection object.  Connection provides methods that handle the execution of SQLAlchemy's own SQL constructs, as well as literal string-based statements.  <br></br>
 </li>

 <li>
     <strong><a href="docstrings.html#docstrings_sqlalchemy.engine_Transaction">Transaction</a></strong> - represents a transaction on a single Connection.  Includes <code>begin()</code>, <code>commit()</code> and <code>rollback()</code> methods that support basic "nestable" behavior, meaning an outermost transaction is maintained against multiple nested calls to begin/commit.
 </li>

 <li>
     <strong><a href="docstrings.html#docstrings_sqlalchemy.engine_ResultProxy">ResultProxy</a></strong> - Represents the results of an execution, and is most analgous to the cursor object in DBAPI.  It primarily allows iteration over result sets, but also provides an interface to information about inserts/updates/deletes, such as the count of rows affected, last inserted IDs, etc.
 </li>

 <li>
     <strong><a href="docstrings.html#docstrings_sqlalchemy.engine_RowProxy">RowProxy</a></strong> -  Represents a single row returned by the fetchone() method on ResultProxy.
 </li>
</ul>
<p>Underneath the public-facing API of <code>Engine</code>, several components are provided by database implementations to provide the full behavior, including:
</p>
<ul>
 <li>
     <strong><a href="docstrings.html#docstrings_sqlalchemy.engine_Dialect">Dialect</a></strong> - this object is provided by database implementations to describe the behavior of a particular database.  It acts as a repository for metadata about a database's characteristics, and provides factory methods for other objects that deal with generating SQL strings and objects that handle some of the details of statement execution.  <br></br>
 </li>

 <li>
     <strong><a href="docstrings.html#docstrings_sqlalchemy.engine_ConnectionProvider">ConnectionProvider</a></strong> - this object knows how to return a DBAPI connection object.  It typically talks to a connection pool which maintains one or more connections in memory for quick re-use.
 </li>

 <li>
     <strong><a href="docstrings.html#docstrings_sqlalchemy.engine_ExecutionContext">ExecutionContext</a></strong> - this object is created for each execution of a single SQL statement, and tracks information about its execution such as primary keys inserted, the total count of rows affected, etc.  It also may implement any special logic that various DBAPI implementations may require before or after a statement execution.
 </li>

 <li>
     <strong><a href="docstrings.html#docstrings_sqlalchemy.sql_Compiled">Compiled</a></strong> - represents a "compiled" SQL expression object.  Includes a <code>compile()</code> method which receives SQL expression objects and assembles them into strings that are suitable for direct execution.  Also collects default bind parameters into a datastructure that will be converted at execution time into a dictionary or list, depending on the dialect's paramstyle.
 </li>
</ul>



<A name="dbengine_supported"></a>

<div class="subsection" style="margin-left:20px;">


<h3>Supported Databases</h3>

    <div class="sectiontext">
    

<p>Engines exist for SQLite, Postgres, MySQL, and Oracle, using the Pysqlite, Psycopg2 (Psycopg1 will work to some degree but its typing model is not supported...install Psycopg2!), MySQLDB, and cx_Oracle modules.  There is also preliminary support for MS-SQL using adodbapi or pymssql, as well as Firebird.   For each engine, a distinct Python module exists in the <code>sqlalchemy.databases</code> package, which provides implementations of some of the objects mentioned in the previous section.
</p>
<p>Downloads for each DBAPI at the time of this writing are as follows:
</p>
<ul>
 <li>
     Postgres:  <a href='http://www.initd.org/tracker/psycopg'>psycopg2</a>
 </li>

 <li>
     SQLite:  <a href='http://initd.org/tracker/pysqlite'>pysqlite</a>
 </li>

 <li>
     MySQL:   <a href='http://sourceforge.net/projects/mysql-python'>MySQLDB</a>
 </li>

 <li>
     Oracle:  <a href='http://www.cxtools.net/default.aspx?nav=home'>cx_Oracle</a>
 </li>

 <li>
     MS-SQL:  <a href='http://adodbapi.sourceforge.net/'>adodbapi</a>  <a href='http://pymssql.sourceforge.net/'>pymssql</a>
 </li>

 <li>
     Firebird:  <a href='http://kinterbasdb.sourceforge.net/'>kinterbasdb</a>
 </li>
</ul>
<p>The SQLAlchemy Wiki contains a page of database notes, describing whatever quirks and behaviors have been observed.  Its a good place to check for issues with specific databases.  <a href='http://www.sqlalchemy.org/trac/wiki/DatabaseNotes'>Database Notes</a>
</p>


    </div>

    <a href="#dbengine" class="toclink">back to section top</a>
</div>




<A name="dbengine_establishing"></a>

<div class="subsection" style="margin-left:20px;">


<h3>Establishing a Database Engine</h3>

    <div class="sectiontext">
    

<p>SQLAlchemy indicates the source of an Engine strictly via <a href='http://rfc.net/rfc1738.html'>RFC-1738</a> style URLs, combined with optional keyword arguments to specify options for the Engine.  The form of the URL is:
</p>
<pre><code>$ driver://username:password@host:port/database
</code></pre><p>Available drivernames are <code>sqlite</code>, <code>mysql</code>, <code>postgres</code>, <code>oracle</code>, <code>mssql</code>, and <code>firebird</code>.  For sqlite, the database name is the filename to connect to, or the special name ":memory:" which indicates an in-memory database.  The URL is typically sent as a string to the <code>create_engine()</code> function:
</p>


<div class="sliding_code">
<pre><span class="python_comment"># postgres
</span><span class="python_name">pg_db </span><span class="python_operator">= </span><span class="python_name">create_engine</span><span class="python_enclosure">(</span><span class="python_literal">'postgres://scott:tiger@localhost:5432/mydatabase'</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># sqlite (note the four slashes for an absolute path)
</span><span class="python_name">sqlite_db </span><span class="python_operator">= </span><span class="python_name">create_engine</span><span class="python_enclosure">(</span><span class="python_literal">'sqlite:////absolute/path/to/database.txt'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">sqlite_db </span><span class="python_operator">= </span><span class="python_name">create_engine</span><span class="python_enclosure">(</span><span class="python_literal">'sqlite:///relative/path/to/database.txt'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">sqlite_db </span><span class="python_operator">= </span><span class="python_name">create_engine</span><span class="python_enclosure">(</span><span class="python_literal">'sqlite://'</span><span class="python_enclosure">)  </span><span class="python_comment"># in-memory database</span><span class="python_operator">
</span>
<span class="python_comment"># mysql
</span><span class="python_name">mysql_db </span><span class="python_operator">= </span><span class="python_name">create_engine</span><span class="python_enclosure">(</span><span class="python_literal">'mysql://localhost/foo'</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># oracle via TNS name
</span><span class="python_name">oracle_db </span><span class="python_operator">= </span><span class="python_name">create_engine</span><span class="python_enclosure">(</span><span class="python_literal">'oracle://scott:tiger@dsn'</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># oracle will feed host/port/SID into cx_oracle.makedsn
</span><span class="python_name">oracle_db </span><span class="python_operator">= </span><span class="python_name">create_engine</span><span class="python_enclosure">(</span><span class="python_literal">'oracle://scott:tiger@127.0.0.1:1521/sidname'</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre></div>
<p>The <code>Engine</code> will create its first connection to the database when a SQL statement is executed.  As concurrent statements are executed, the underlying connection pool will grow to a default size of five connections, and will allow a default "overflow" of ten.   Since the <code>Engine</code> is essentially "home base" for the connection pool, it follows that you should keep a single <code>Engine</code> per database established within an application, rather than creating a new one for each connection.
</p>



<A name="dbengine_establishing_custom"></a>

<div class="subsection" style="margin-left:30px;">


<h3>Custom DBAPI keyword arguments</h3>

    <div class="sectiontext">
    

<p>Custom arguments can be passed to the underlying DBAPI in three ways.  String-based arguments can be passed directly from the URL string as query arguments:
</p>


<div class="sliding_code">
<pre><span class="python_name">db </span><span class="python_operator">= </span><span class="python_name">create_engine</span><span class="python_enclosure">(</span><span class="python_literal">'postgres://scott:tiger@localhost/test?argument1=foo&argument2=bar'</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre></div>
<p>If SQLAlchemy's database connector is aware of a particular query argument, it may convert its type from string to its proper type.
</p>
<p><code>create_engine</code> also takes an argument <code>connect_args</code> which is an additional dictionary that will be passed to <code>connect()</code>.  This can be used when arguments of a type other than string are required, and SQLAlchemy's database connector has no type conversion logic present for that parameter:
</p>


<div class="sliding_code">
<pre><span class="python_name">db </span><span class="python_operator">= </span><span class="python_name">create_engine</span><span class="python_enclosure">(</span><span class="python_literal">'postgres://scott:tiger@localhost/test'</span><span class="python_operator">, </span><span class="python_name">connect_args </span><span class="python_operator">= </span><span class="python_enclosure">{</span><span class="python_literal">'argument1'</span><span class="python_operator">:</span><span class="python_number">17</span><span class="python_operator">, </span><span class="python_literal">'argument2'</span><span class="python_operator">:</span><span class="python_literal">'bar'</span><span class="python_enclosure">})</span><span class="python_operator"></span></pre></div>
<p>The most customizable connection method of all is to pass a <code>creator</code> argument, which specifies a callable that returns a DBAPI connection:
</p>


<div class="sliding_code">
<pre><span class="python_keyword">def </span><span class="python_name">connect</span><span class="python_enclosure">()</span><span class="python_operator">:
    </span><span class="python_keyword">return </span><span class="python_name">psycopg</span><span class="python_operator">.</span><span class="python_name">connect</span><span class="python_enclosure">(</span><span class="python_name">user</span><span class="python_operator">=</span><span class="python_literal">'scott'</span><span class="python_operator">, </span><span class="python_name">host</span><span class="python_operator">=</span><span class="python_literal">'localhost'</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_operator"></span><span class="python_name">db </span><span class="python_operator">= </span><span class="python_name">create_engine</span><span class="python_enclosure">(</span><span class="python_literal">'postgres://'</span><span class="python_operator">, </span><span class="python_name">creator</span><span class="python_operator">=</span><span class="python_name">connect</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre></div>


    </div>

</div>



    </div>

    <a href="#dbengine" class="toclink">back to section top</a>
</div>




<A name="dbengine_options"></a>

<div class="subsection" style="margin-left:20px;">


<h3>Database Engine Options</h3>

    <div class="sectiontext">
    

<p>Keyword options can also be specified to <code>create_engine()</code>, following the string URL as follows:
</p>


<div class="sliding_code">
<pre><span class="python_name">db </span><span class="python_operator">= </span><span class="python_name">create_engine</span><span class="python_enclosure">(</span><span class="python_literal">'postgres://...'</span><span class="python_operator">, </span><span class="python_name">encoding</span><span class="python_operator">=</span><span class="python_literal">'latin1'</span><span class="python_operator">, </span><span class="python_name">echo</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_operator">, </span><span class="python_name">module</span><span class="python_operator">=</span><span class="python_name">psycopg1</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre></div>
<p>Options that can be specified include the following:
</p>
<ul>
 <li>
     poolclass=None : a <code>sqlalchemy.pool.Pool</code> subclass (or duck-typed equivalent) that will be instantated in place of the default connection pool.
 </li>

 <li>
     pool=None : an actual pool instance.  Note that an already-constructed pool should already know how to create database connections, so this option supercedes any other connect options specified.  Typically, it is an instance of <code>sqlalchemy.pool.Pool</code> to be used as the underlying source for connections.  For more on connection pooling, see <a href="pooling.html#pooling">Connection Pooling</a>.
 </li>
</ul>
<p>Example of a manual invocation of <code>pool.QueuePool</code> (which is the pool instance used for all databases except sqlite):
</p>


<div class="sliding_code">
<pre><span class="python_keyword">from </span><span class="python_name">sqlalchemy </span><span class="python_keyword">import </span><span class="python_operator">*
</span><span class="python_keyword">import </span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">pool as pool</span><span class="python_operator">
</span><span class="python_keyword">import </span><span class="python_name">MySQLdb</span><span class="python_operator">
</span>
<span class="python_keyword">def </span><span class="python_name">getconn</span><span class="python_enclosure">()</span><span class="python_operator">:
    </span><span class="python_keyword">return </span><span class="python_name">MySQLdb</span><span class="python_operator">.</span><span class="python_name">connect</span><span class="python_enclosure">(</span><span class="python_name">user</span><span class="python_operator">=</span><span class="python_literal">'ed'</span><span class="python_operator">, </span><span class="python_name">dbname</span><span class="python_operator">=</span><span class="python_literal">'mydb'</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_operator"></span><span class="python_name">engine </span><span class="python_operator">= </span><span class="python_name">create_engine</span><span class="python_enclosure">(</span><span class="python_literal">'mysql://'</span><span class="python_operator">, </span><span class="python_name">pool</span><span class="python_operator">=</span><span class="python_name">pool</span><span class="python_operator">.</span><span class="python_name">QueuePool</span><span class="python_enclosure">(</span><span class="python_name">getconn</span><span class="python_operator">, </span><span class="python_name">pool_size</span><span class="python_operator">=</span><span class="python_number">20</span><span class="python_operator">, </span><span class="python_name">max_overflow</span><span class="python_operator">=</span><span class="python_number">40</span><span class="python_enclosure">))</span><span class="python_operator"></span></pre></div>
<ul>
 <li>
     pool_size=5 : the number of connections to keep open inside the connection pool.  This used with <code>QueuePool</code> as well as <code>SingletonThreadPool</code>.
 </li>

 <li>
     max_overflow=10 : the number of connections to allow in "overflow", that is connections that can be opened above and beyond the initial five.  this is only used with <code>QueuePool</code>.
 </li>

 <li>
     pool_timeout=30 : number of seconds to wait before giving up on getting a connection from the pool.  This is only used with <code>QueuePool</code>.
 </li>

 <li>
     pool_recycle=-1 : this setting causes the pool to recycle connections after the given number of seconds has passed.  It defaults to -1, or no timeout.  For example, setting to 3600 means connections will be recycled after one hour.  Note that MySQL in particular will disconnect automatically if no activity is detected on a connection for eight hours (although this is configurable with the MySQLDB connection itself and the  server configuration as well).
 </li>

 <li>
     echo=False : if True, the Engine will log all statements as well as a repr() of their parameter lists to the engines logger, which defaults to sys.stdout.  The <code>echo</code> attribute of <code>Engine</code> can be modified at any time to turn logging on and off.  If set to the string <code>"debug"</code>, result rows will be printed to the standard output as well.
 </li>

 <li>
     logger=None : a file-like object where logging output can be sent, if echo is set to True.  Newlines will not be sent with log messages.  This defaults to an internal logging object which references <code>sys.stdout</code>.
 </li>

 <li>
     module=None : used by database implementations which support multiple DBAPI modules, this is a reference to a DBAPI2 module to be used instead of the engine's default module.  For Postgres, the default is psycopg2, or psycopg1 if 2 cannot be found.  For Oracle, its cx_Oracle.
 </li>

 <li>
     use_ansi=True : used only by Oracle;  when False, the Oracle driver attempts to support a particular "quirk" of Oracle versions 8 and previous, that the LEFT OUTER JOIN SQL syntax is not supported, and the "Oracle join" syntax of using <code>&lt;column1&gt;(+)=&lt;column2&gt;</code> must be used in order to achieve a LEFT OUTER JOIN.  <br></br>
 </li>

 <li>
     threaded=True : used by cx_Oracle; sets the <code>threaded</code> parameter of the connection indicating thread-safe usage.  cx_Oracle docs indicate setting this flag to <code>False</code> will speed performance by 10-15%.  While this defaults to <code>False</code> in cx_Oracle, SQLAlchemy defaults it to <code>True</code>, preferring stability over early optimization.
 </li>

 <li>
     strategy='plain' : the Strategy argument is used to select alternate implementations of the underlying Engine object, which coordinates operations between dialects, compilers, connections, and so on.  Currently, the only alternate strategy besides the default value of "plain" is the "threadlocal" strategy, which selects the usage of the <code>TLEngine</code> class that provides a modified connection scope for implicit executions.  Implicit execution as well as further detail on this setting are described in <a href="dbengine.html#dbengine_implicit">Implicit Execution</a>.
 </li>

 <li>
     use_oids=False : used only by Postgres, will enable the column name "oid" as the object ID column, which is also used for the default sort order of tables.  Postgres as of 8.1 has object IDs disabled by default.
 </li>

 <li>
     convert_unicode=False : if set to True, all String/character based types will convert Unicode values to raw byte values going into the database, and all raw byte values to Python Unicode coming out in result sets.  This is an engine-wide method to provide unicode across the board.  For unicode conversion on a column-by-column level, use the <code>Unicode</code> column type instead.
 </li>

 <li>
     encoding='utf-8' : the encoding to use for all Unicode translations, both by engine-wide unicode conversion as well as the <code>Unicode</code> type object.
 </li>
</ul>


    </div>

    <a href="#dbengine" class="toclink">back to section top</a>
</div>




<A name="dbengine_connections"></a>

<div class="subsection" style="margin-left:20px;">


<h3>Using Connections</h3>

    <div class="sectiontext">
    

<p>In this section we describe the SQL execution interface available from an <code>Engine</code> instance.  Note that when using the Object Relational Mapper (ORM) as well as when dealing with with "bound" metadata objects, SQLAlchemy deals with the Engine and Connections for you and you generally don't need to know much about it; in those cases, you can skip this section and go to <a href="metadata.html#metadata">Database Meta Data</a>.  "Bound" metadata is described in <a href="metadata.html#metadata_tables_binding">Binding MetaData to an Engine</a>.
</p>
<p>The Engine provides a <code>connect()</code> method which returns a <code>Connection</code> object.  <code>Connection</code> is a <em>proxy</em> object which maintains a reference to a DBAPI connection instance.  This object provides methods by which literal SQL text as well as SQL clause constructs can be compiled and executed.  <br></br>
</p>


<div class="sliding_code">
<pre><span class="python_name">engine </span><span class="python_operator">= </span><span class="python_name">create_engine</span><span class="python_enclosure">(</span><span class="python_literal">'sqlite:///:memory:'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">connection </span><span class="python_operator">= </span><span class="python_name">engine</span><span class="python_operator">.</span><span class="python_name">connect</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_name">result </span><span class="python_operator">= </span><span class="python_name">connection</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_literal">"select * from mytable where col1=:col1"</span><span class="python_operator">, </span><span class="python_name">col1</span><span class="python_operator">=</span><span class="python_number">5</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_keyword">for </span><span class="python_name">row </span><span class="python_keyword">in </span><span class="python_name">result</span><span class="python_operator">:
    </span><span class="python_keyword">print </span><span class="python_name">row</span><span class="python_enclosure">[</span><span class="python_literal">'col1'</span><span class="python_enclosure">]</span><span class="python_operator">, </span><span class="python_name">row</span><span class="python_enclosure">[</span><span class="python_literal">'col2'</span><span class="python_enclosure">]</span><span class="python_operator">
</span><span class="python_name">connection</span><span class="python_operator">.</span><span class="python_name">close</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre></div>
<p>The <code>close</code> method on <code>Connection</code> does not actually remove the underlying connection to the database, but rather indicates that the underlying resources can be returned to the connection pool.  When using the <code>connect()</code> method, the DBAPI connection referenced by the <code>Connection</code> object is not referenced anywhere else. 
</p>
<p>In both execution styles above, the <code>Connection</code> object will also automatically return its resources to the connection pool when the object is garbage collected, i.e. its <code>__del__()</code> method is called.  When using the standard C implementation of Python, this method is usually called immediately as soon as the object is dereferenced.  With other Python implementations such as Jython, this is not so guaranteed.  <br></br>
</p>
<p>The execute method on <code>Engine</code> and <code>Connection</code> can also receive SQL clause constructs as well, which are described in <a href="sqlconstruction.html#sql">Constructing SQL Queries via Python Expressions</a>:
</p>


<div class="sliding_code">
<pre><span class="python_name">connection </span><span class="python_operator">= </span><span class="python_name">engine</span><span class="python_operator">.</span><span class="python_name">connect</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_name">result </span><span class="python_operator">= </span><span class="python_name">connection</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_name">select</span><span class="python_enclosure">([</span><span class="python_name">table1</span><span class="python_enclosure">]</span><span class="python_operator">, </span><span class="python_name">table1</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">col1</span><span class="python_operator">==</span><span class="python_number">5</span><span class="python_enclosure">))</span><span class="python_operator">
</span><span class="python_keyword">for </span><span class="python_name">row </span><span class="python_keyword">in </span><span class="python_name">result</span><span class="python_operator">:
    </span><span class="python_keyword">print </span><span class="python_name">row</span><span class="python_enclosure">[</span><span class="python_literal">'col1'</span><span class="python_enclosure">]</span><span class="python_operator">, </span><span class="python_name">row</span><span class="python_enclosure">[</span><span class="python_literal">'col2'</span><span class="python_enclosure">]</span><span class="python_operator">
</span><span class="python_name">connection</span><span class="python_operator">.</span><span class="python_name">close</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre></div>
<p>Both <code>Connection</code> and <code>Engine</code> fulfill an interface known as <code>Connectable</code> which specifies common functionality between the two objects, such as getting a <code>Connection</code> and executing queries.  Therefore, most SQLAlchemy functions which take an <code>Engine</code> as a parameter with which to execute SQL will also accept a <code>Connection</code> (and the name of the argument is typically called <code>connectable</code>):
</p>


<div class="sliding_code">
    <div class="codetitle">Specify Engine or Connection</div>
<pre><span class="python_name">engine </span><span class="python_operator">= </span><span class="python_name">create_engine</span><span class="python_enclosure">(</span><span class="python_literal">'sqlite:///:memory:'</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># specify some Table metadata
</span><span class="python_name">metadata </span><span class="python_operator">= </span><span class="python_name">MetaData</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_name">table </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'sometable'</span><span class="python_operator">, </span><span class="python_name">metadata</span><span class="python_operator">, </span><span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'col1'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_enclosure">))</span><span class="python_operator">
</span>
<span class="python_comment"># create the table with the Engine
</span><span class="python_name">table</span><span class="python_operator">.</span><span class="python_name">create</span><span class="python_enclosure">(</span><span class="python_name">connectable</span><span class="python_operator">=</span><span class="python_name">engine</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># drop the table with a Connection off the Engine
</span><span class="python_name">connection </span><span class="python_operator">= </span><span class="python_name">engine</span><span class="python_operator">.</span><span class="python_name">connect</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_name">table</span><span class="python_operator">.</span><span class="python_name">drop</span><span class="python_enclosure">(</span><span class="python_name">connectable</span><span class="python_operator">=</span><span class="python_name">connection</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre></div>
<p>Connection facts:
</p>
<ul>
 <li>
     the Connection object is <strong>not threadsafe</strong>.  While a Connection can be shared among threads using properly synchronized access, this is also not recommended as many DBAPIs have issues with, if not outright disallow, sharing of connection state between threads.
 </li>

 <li>
     The Connection object represents a single dbapi connection checked out from the connection pool.  In this state, the connection pool has no affect upon the connection, including its expiration or timeout state.  For the connection pool to properly manage connections, <strong>connections should be returned to the connection pool (i.e. Connection.close()) whenever the connection is not in use</strong>.  If your application has a need for management of multiple connections or is otherwise long running (this includes all web applications, threaded or not), don't hold a single connection open at the module level.
 </li>
</ul>


    </div>

    <a href="#dbengine" class="toclink">back to section top</a>
</div>




<A name="dbengine_transactions"></a>

<div class="subsection" style="margin-left:20px;">


<h3>Transactions</h3>

    <div class="sectiontext">
    

<p>The <code>Connection</code> object provides a <code>begin()</code> method which returns a <code>Transaction</code> object.  This object is usually used within a try/except clause so that it is guaranteed to <code>rollback()</code> or <code>commit()</code>:
</p>


<div class="sliding_code">
<pre><span class="python_name">trans </span><span class="python_operator">= </span><span class="python_name">connection</span><span class="python_operator">.</span><span class="python_name">begin</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_keyword">try</span><span class="python_operator">:
    </span><span class="python_name">r1 </span><span class="python_operator">= </span><span class="python_name">connection</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_name">table1</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">())</span><span class="python_operator">
    </span><span class="python_name">connection</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_name">table1</span><span class="python_operator">.</span><span class="python_name">insert</span><span class="python_enclosure">()</span><span class="python_operator">, </span><span class="python_name">col1</span><span class="python_operator">=</span><span class="python_number">7</span><span class="python_operator">, </span><span class="python_name">col2</span><span class="python_operator">=</span><span class="python_literal">'this is some data'</span><span class="python_enclosure">)</span><span class="python_operator">
    </span><span class="python_name">trans</span><span class="python_operator">.</span><span class="python_name">commit</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_keyword">except</span><span class="python_operator">:
    </span><span class="python_name">trans</span><span class="python_operator">.</span><span class="python_name">rollback</span><span class="python_enclosure">()</span><span class="python_operator">
    </span><span class="python_keyword">raise</span><span class="python_operator"></span></pre></div>
<p>The <code>Transaction</code> object also handles "nested" behavior by keeping track of the outermost begin/commit pair.  In this example, two functions both issue a transaction on a Connection, but only the outermost Transaction object actually takes effect when it is committed.
</p>


<div class="sliding_code">
<pre><span class="python_comment"># method_a starts a transaction and calls method_b
</span><span class="python_keyword">def </span><span class="python_name">method_a</span><span class="python_enclosure">(</span><span class="python_name">connection</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_name">trans </span><span class="python_operator">= </span><span class="python_name">connection</span><span class="python_operator">.</span><span class="python_name">begin</span><span class="python_enclosure">() </span><span class="python_comment"># open a transaction</span><span class="python_operator">
    </span><span class="python_keyword">try</span><span class="python_operator">:
        </span><span class="python_name">method_b</span><span class="python_enclosure">(</span><span class="python_name">connection</span><span class="python_enclosure">)</span><span class="python_operator">
        </span><span class="python_name">trans</span><span class="python_operator">.</span><span class="python_name">commit</span><span class="python_enclosure">()  </span><span class="python_comment"># transaction is committed here</span><span class="python_operator">
    </span><span class="python_keyword">except</span><span class="python_operator">:
        </span><span class="python_name">trans</span><span class="python_operator">.</span><span class="python_name">rollback</span><span class="python_enclosure">() </span><span class="python_comment"># this rolls back the transaction unconditionally</span><span class="python_operator">
        </span><span class="python_keyword">raise</span><span class="python_operator">
</span>
<span class="python_comment"># method_b also starts a transaction
</span><span class="python_operator"></span><span class="python_keyword">def </span><span class="python_name">method_b</span><span class="python_enclosure">(</span><span class="python_name">connection</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_name">trans </span><span class="python_operator">= </span><span class="python_name">connection</span><span class="python_operator">.</span><span class="python_name">begin</span><span class="python_enclosure">() </span><span class="python_comment"># open a transaction - this runs in the context of method_a's transaction</span><span class="python_operator">
    </span><span class="python_keyword">try</span><span class="python_operator">:
        </span><span class="python_name">connection</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_literal">"insert into mytable values ('bat', 'lala')"</span><span class="python_enclosure">)</span><span class="python_operator">
        </span><span class="python_name">connection</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_name">mytable</span><span class="python_operator">.</span><span class="python_name">insert</span><span class="python_enclosure">()</span><span class="python_operator">, </span><span class="python_name">col1</span><span class="python_operator">=</span><span class="python_literal">'bat'</span><span class="python_operator">, </span><span class="python_name">col2</span><span class="python_operator">=</span><span class="python_literal">'lala'</span><span class="python_enclosure">)</span><span class="python_operator">
        </span><span class="python_name">trans</span><span class="python_operator">.</span><span class="python_name">commit</span><span class="python_enclosure">()  </span><span class="python_comment"># transaction is not committed yet</span><span class="python_operator">
    </span><span class="python_keyword">except</span><span class="python_operator">:
        </span><span class="python_name">trans</span><span class="python_operator">.</span><span class="python_name">rollback</span><span class="python_enclosure">() </span><span class="python_comment"># this rolls back the transaction unconditionally</span><span class="python_operator">
        </span><span class="python_keyword">raise</span><span class="python_operator">
</span>
<span class="python_comment"># open a Connection and call method_a
</span><span class="python_operator"></span><span class="python_name">conn </span><span class="python_operator">= </span><span class="python_name">engine</span><span class="python_operator">.</span><span class="python_name">connect</span><span class="python_enclosure">()                </span><span class="python_operator">
</span><span class="python_name">method_a</span><span class="python_enclosure">(</span><span class="python_name">conn</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">conn</span><span class="python_operator">.</span><span class="python_name">close</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre></div>
<p>Above, <code>method_a</code> is called first, which calls <code>connection.begin()</code>.  Then it calls <code>method_b</code>. When <code>method_b</code> calls <code>connection.begin()</code>, it just increments a counter that is decremented when it calls <code>commit()</code>.  If either <code>method_a</code> or <code>method_b</code> calls <code>rollback()</code>, the whole transaction is rolled back.  The transaction is not committed until <code>method_a</code> calls the <code>commit()</code> method.
</p>
<p>Note that SQLAlchemy's Object Relational Mapper also provides a way to control transaction scope at a higher level; this is described in <a href="unitofwork.html#unitofwork_transaction">SessionTransaction</a>.
</p>
<p>Transaction Facts:
</p>
<ul>
 <li>
     the Transaction object, just like its parent Connection, is <strong>not threadsafe</strong>.
 </li>
</ul>


    </div>

    <a href="#dbengine" class="toclink">back to section top</a>
</div>




<A name="dbengine_implicit"></a>

<div class="subsection" style="margin-left:20px;">


<h3>Implicit Execution</h3>

    <div class="sectiontext">
    

<p><strong>Implicit execution</strong> refers to the execution of SQL without the explicit usage of a <code>Connection</code> object.  This occurs when you call the <code>execute()</code> method off of an <code>Engine</code> object or off of a SQL expression or table that is associated with "bound" metadata.
</p>


<div class="sliding_code">
    <div class="codetitle">Implicit Execution Using Engine</div>
<pre><span class="python_name">engine </span><span class="python_operator">= </span><span class="python_name">create_engine</span><span class="python_enclosure">(</span><span class="python_literal">'sqlite:///:memory:'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">result </span><span class="python_operator">= </span><span class="python_name">engine</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_literal">"select * from mytable where col1=:col1"</span><span class="python_operator">, </span><span class="python_name">col1</span><span class="python_operator">=</span><span class="python_number">5</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_keyword">for </span><span class="python_name">row </span><span class="python_keyword">in </span><span class="python_name">result</span><span class="python_operator">:
    </span><span class="python_keyword">print </span><span class="python_name">row</span><span class="python_enclosure">[</span><span class="python_literal">'col1'</span><span class="python_enclosure">]</span><span class="python_operator">, </span><span class="python_name">row</span><span class="python_enclosure">[</span><span class="python_literal">'col2'</span><span class="python_enclosure">]</span><span class="python_operator">
</span><span class="python_name">result</span><span class="python_operator">.</span><span class="python_name">close</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre></div>
<p>Using "bound" metadata:
</p>


<div class="sliding_code">
    <div class="codetitle">Implicit Execution Using Engine-Bound SQL Construct</div>
<pre><span class="python_name">engine </span><span class="python_operator">= </span><span class="python_name">create_engine</span><span class="python_enclosure">(</span><span class="python_literal">'sqlite:///:memory:'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">meta </span><span class="python_operator">= </span><span class="python_name">BoundMetaData</span><span class="python_enclosure">(</span><span class="python_name">engine</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">table </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'mytable'</span><span class="python_operator">, </span><span class="python_name">meta</span><span class="python_operator">, </span><span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'col1'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'col2'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">20</span><span class="python_enclosure">)))</span><span class="python_operator">
</span><span class="python_name">r </span><span class="python_operator">= </span><span class="python_name">table</span><span class="python_operator">.</span><span class="python_name">insert</span><span class="python_enclosure">()</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_name">col1</span><span class="python_operator">=</span><span class="python_number">5</span><span class="python_operator">, </span><span class="python_name">col2</span><span class="python_operator">=</span><span class="python_literal">'some record'</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre></div>
<p>Notice in the above two examples, no <code>connect()</code> method is ever called nor do we ever see a <code>Connection</code> anywhere; the <code>Connection</code> is created for you automatically via the <code>execute()</code> method, and a handle to the execution's cursor remains open in the returned result set.  When the result set is closed via the <code>close()</code> method, or if the result set object falls out of scope and is garbage collected, the underlying cursor is closed, the <code>Connection</code> is discarded and the underlying DBAPI connection is returned to the connection pool.
</p>
<p>The purpose of the "implicit" connection is strictly one of convenience; while in SQLAlchemy 0.1 it was the only style of operation, it is now optional.
</p>



<A name="dbengine_implicit_strategies"></a>

<div class="subsection" style="margin-left:30px;">


<h3>Implicit Execution Strategies</h3>

    <div class="sectiontext">
    

<p>The internal behavior of engine during implicit execution can be affected by the <code>strategy</code> keyword argument to <code>create_engine()</code>.  Generally this setting can be left at its default value of <code>plain</code>.  However, for the advanced user, the <code>threadlocal</code> option can provide the service of managing connections against the current thread in which they were pulled from the connection pool, where the same underlying DBAPI connection as well as a single database-level transaction can then be shared by many operations without explicitly passing a <code>Connection</code> or <code>Transaction</code> object around.  It also may reduce the number of connections checked out from the connection pool at a given time.
</p>
<p>Note that this setting does <strong>not</strong> affect the fact that <strong>Connection and Transaction objects are not threadsafe.</strong>  The "threadlocal" strategy affects the selection of DBAPI connections which are pulled from the connection pool when a <code>Connection</code> object is created, but does not synchronize method access to the <code>Connection</code> or <code>Transaction</code> instances themselves, which are only proxy objects.  It is instead intended that many <code>Connection</code> instances would share access to a single "connection" object that is referenced in relation to the current thread.
</p>
<p>When <code>strategy</code> is set to <code>plain</code>, each implicit execution requests a unique connection from the connection pool, which is returned to the pool when the resulting <code>ResultProxy</code> falls out of scope (i.e. <code>__del__()</code> is called) or its <code>close()</code> method is called.  If a second implicit execution occurs while the <code>ResultProxy</code> from the previous execution is still open, then a second connection is pulled from the pool.
</p>
<p>When <code>strategy</code> is set to <code>threadlocal</code>, the <code>Engine</code> still checks out a connection which is closeable in the same manner via the <code>ResultProxy</code>, except the connection it checks out will be the <strong>same</strong> connection as one which is already checked out, assuming the operation is in the same thread.  When all <code>ResultProxy</code> objects are closed in a particular thread, the connection is returned to the pool normally.
</p>
<p>An additional feature of the <code>threadlocal</code> selection is that <code>Transaction</code> objects can be managed implicitly as well, by calling the <code>begin()</code>,<code>commit()</code> and <code>rollback()</code> methods off of the <code>Engine</code>, or by using <code>Transaction</code> objects from the thread-local connection.
</p>
<p>It is crucial to note that the <code>plain</code> and <code>threadlocal</code> contexts <strong>do not impact the connect() method on the Engine.</strong>  <code>connect()</code> always returns a unique connection.  Implicit connections use a different method off of <code>Engine</code> for their operations called <code>contextual_connect()</code>.
</p>
<p>By default, every call to <code>execute</code> pulls a dedicated DBAPI connection from the connection pool:
</p>


<div class="sliding_code">
    <div class="codetitle">Plain Strategy</div>
<pre><span class="python_name">db </span><span class="python_operator">= </span><span class="python_name">create_engine</span><span class="python_enclosure">(</span><span class="python_literal">'mysql://localhost/test'</span><span class="python_operator">, </span><span class="python_name">strategy</span><span class="python_operator">=</span><span class="python_literal">'plain'</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># execute one statement and receive results.  r1 now references a DBAPI connection resource.
</span><span class="python_name">r1 </span><span class="python_operator">= </span><span class="python_name">db</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_literal">"select * from table1"</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># execute a second statement and receive results.  r2 now references a *second* DBAPI connection resource.
</span><span class="python_name">r2 </span><span class="python_operator">= </span><span class="python_name">db</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_literal">"select * from table2"</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_keyword">for </span><span class="python_name">row </span><span class="python_keyword">in </span><span class="python_name">r1</span><span class="python_operator">:
    ...
</span><span class="python_keyword">for </span><span class="python_name">row </span><span class="python_keyword">in </span><span class="python_name">r2</span><span class="python_operator">:
    ...
</span><span class="python_comment"># release connection 1
</span><span class="python_operator"></span><span class="python_name">r1</span><span class="python_operator">.</span><span class="python_name">close</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_comment"># release connection 2
</span><span class="python_name">r2</span><span class="python_operator">.</span><span class="python_name">close</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre></div>
<p>Using the "threadlocal" strategy, all calls to <code>execute</code> within the same thread will be guaranteed to use the same underlying DBAPI connection, which is only returned to the connection pool when all <code>ResultProxy</code> instances have been closed.
</p>


<div class="sliding_code">
    <div class="codetitle">Threadlocal Strategy</div>
<pre><span class="python_name">db </span><span class="python_operator">= </span><span class="python_name">create_engine</span><span class="python_enclosure">(</span><span class="python_literal">'mysql://localhost/test'</span><span class="python_operator">, </span><span class="python_name">strategy</span><span class="python_operator">=</span><span class="python_literal">'threadlocal'</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># execute one statement and receive results.  r1 now references a DBAPI connection resource.
</span><span class="python_name">r1 </span><span class="python_operator">= </span><span class="python_name">db</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_literal">"select * from table1"</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># execute a second statement and receive results.  r2 now references the *same* resource as r1
</span><span class="python_name">r2 </span><span class="python_operator">= </span><span class="python_name">db</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_literal">"select * from table2"</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_keyword">for </span><span class="python_name">row </span><span class="python_keyword">in </span><span class="python_name">r1</span><span class="python_operator">:
    ...
</span><span class="python_keyword">for </span><span class="python_name">row </span><span class="python_keyword">in </span><span class="python_name">r2</span><span class="python_operator">:
    ...
</span><span class="python_comment"># dereference r1.  the connection is still held by r2.
</span><span class="python_operator"></span><span class="python_name">r1 </span><span class="python_operator">= </span><span class="python_name">None</span><span class="python_operator">
</span>
<span class="python_comment"># dereference r2.  with no more references to the underlying connection resources, they
# are returned to the pool.
</span><span class="python_name">r2 </span><span class="python_operator">= </span><span class="python_name">None</span><span class="python_operator"></span></pre></div>
<p>To get at the actual <code>Connection</code> object which is used by implicit executions, call the <code>contextual_connection()</code> method on <code>Engine</code>:
</p>


<div class="sliding_code">
    <div class="codetitle">Contextual Connection</div>
<pre><span class="python_comment"># threadlocal strategy
</span><span class="python_name">db </span><span class="python_operator">= </span><span class="python_name">create_engine</span><span class="python_enclosure">(</span><span class="python_literal">'mysql://localhost/test'</span><span class="python_operator">, </span><span class="python_name">strategy</span><span class="python_operator">=</span><span class="python_literal">'threadlocal'</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_name">conn1 </span><span class="python_operator">= </span><span class="python_name">db</span><span class="python_operator">.</span><span class="python_name">contextual_connection</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_name">conn2 </span><span class="python_operator">= </span><span class="python_name">db</span><span class="python_operator">.</span><span class="python_name">contextual_connection</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_literal">>>> </span><span class="python_name">conn1</span><span class="python_operator">.</span><span class="python_name">connection </span><span class="python_keyword">is </span><span class="python_name">conn2</span><span class="python_operator">.</span><span class="python_name">connection</span><span class="python_operator">
</span><span class="python_name">True</span><span class="python_operator"></span></pre></div>
<p>When the <code>plain</code> strategy is used, the <code>contextual_connection()</code> method is synonymous with the <code>connect()</code> method; both return a distinct connection from the pool.
</p>
<p>One programming pattern that the <code>threadlocal</code> strategy supports is transparent connection and transaction sharing.
</p>


<div class="sliding_code">
    <div class="codetitle">threadlocal connection sharing</div>
<pre><span class="python_name">db </span><span class="python_operator">= </span><span class="python_name">create_engine</span><span class="python_enclosure">(</span><span class="python_literal">'mysql://localhost/test'</span><span class="python_operator">, </span><span class="python_name">strategy</span><span class="python_operator">=</span><span class="python_literal">'threadlocal'</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_keyword">def </span><span class="python_name">dosomethingimplicit</span><span class="python_enclosure">()</span><span class="python_operator">:
    </span><span class="python_name">table1</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_literal">"some sql"</span><span class="python_enclosure">)</span><span class="python_operator">
    </span><span class="python_name">table1</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_literal">"some other sql"</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_operator"></span><span class="python_keyword">def </span><span class="python_name">dosomethingelse</span><span class="python_enclosure">()</span><span class="python_operator">:
    </span><span class="python_name">table2</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_literal">"some sql"</span><span class="python_enclosure">)</span><span class="python_operator">
    </span><span class="python_name">conn </span><span class="python_operator">= </span><span class="python_name">db</span><span class="python_operator">.</span><span class="python_name">contextual_connection</span><span class="python_enclosure">()</span><span class="python_operator">
    </span><span class="python_comment"># do stuff with conn
    </span><span class="python_name">conn</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_literal">"some other sql"</span><span class="python_enclosure">)</span><span class="python_operator">
    </span><span class="python_name">conn</span><span class="python_operator">.</span><span class="python_name">close</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_operator"></span><span class="python_keyword">def </span><span class="python_name">dosomethingtransactional</span><span class="python_enclosure">()</span><span class="python_operator">:
    </span><span class="python_name">conn </span><span class="python_operator">= </span><span class="python_name">db</span><span class="python_operator">.</span><span class="python_name">contextual_connection</span><span class="python_enclosure">()</span><span class="python_operator">
    </span><span class="python_name">trans </span><span class="python_operator">= </span><span class="python_name">conn</span><span class="python_operator">.</span><span class="python_name">begin</span><span class="python_enclosure">()</span><span class="python_operator">
     </span><span class="python_comment"># do stuff
    </span><span class="python_name">trans</span><span class="python_operator">.</span><span class="python_name">commit</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_operator"></span><span class="python_name">db</span><span class="python_operator">.</span><span class="python_name">create_transaction</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_keyword">try</span><span class="python_operator">:
    </span><span class="python_name">dosomethingimplicit</span><span class="python_enclosure">()</span><span class="python_operator">
    </span><span class="python_name">dosomethingelse</span><span class="python_enclosure">()</span><span class="python_operator">
    </span><span class="python_name">dosomethingtransactional</span><span class="python_enclosure">()</span><span class="python_operator">
    </span><span class="python_name">db</span><span class="python_operator">.</span><span class="python_name">commit</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_keyword">except</span><span class="python_operator">:
    </span><span class="python_name">db</span><span class="python_operator">.</span><span class="python_name">rollback</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre></div>
<p>In the above example, the program calls three functions <code>dosomethingimplicit()</code>, <code>dosomethingelse()</code> and <code>dosomethingtransactional()</code>.  In all three functions, either implicit execution is used, <strong>or</strong> an explicit <code>Connection</code> is used via the <code>contextual_connection()</code> method.  This indicates that they all will share the same underlying dbapi connection as well as the same parent <code>Transaction</code> instance, which is created in the main body of the program via the call to <code>db.create_transaction()</code>.  So while there are several calls that return "new" <code>Transaction</code> or <code>Connection</code> objects, in reality only one "real" connection is ever used, and there is only one transaction (i.e. one begin/commit pair) executed.
</p>



    </div>

</div>



    </div>

</div>



    </div>

    <a href="#dbengine" class="toclink">back to section top</a>
</div>


</html></div>
<A name="metadata"></a>

<div class="sectionnavblock">
<div class="sectionnav">

        Previous: <a href="#dbengine">Database Engines</a>

                |

        Next: <a href="#sql">Constructing SQL Queries via Python Expressions</a>

</div>
</div>

<div class="topnavmain">
	<div class="topnavheader">Database Meta Data</div>
</div>
<div class="sectioncontent">
<html>



<A name="metadata"></a>

<div class="subsection" style="margin-left:10px;">



    <div class="sectiontext">
    




<A name="metadata_tables"></a>

<div class="subsection" style="margin-left:20px;">


<h3>Describing Databases with MetaData</h3>

    <div class="sectiontext">
    

<p>The core of SQLAlchemy's query and object mapping operations is database metadata, which are Python objects that describe tables and other schema-level objects.  Metadata objects can be created by explicitly naming the various components and their properties, using the Table, Column, ForeignKey, Index, and Sequence objects imported from <code>sqlalchemy.schema</code>.  There is also support for <em>reflection</em>, which means you only specify the <em>name</em> of the entities and they are recreated from the database automatically.
</p>
<p>A collection of metadata entities is stored in an object aptly named <code>MetaData</code>.  This object takes an optional <code>name</code> parameter:
</p>


<div class="sliding_code">
<pre><span class="python_keyword">from </span><span class="python_name">sqlalchemy </span><span class="python_keyword">import </span><span class="python_operator">*
</span>
<span class="python_name">metadata </span><span class="python_operator">= </span><span class="python_name">MetaData</span><span class="python_enclosure">(</span><span class="python_name">name</span><span class="python_operator">=</span><span class="python_literal">'my metadata'</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre></div>
<p>Then to construct a Table, use the <code>Table</code> class:
</p>


<div class="sliding_code">
<pre><span class="python_name">users </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'users'</span><span class="python_operator">, </span><span class="python_name">metadata</span><span class="python_operator">, </span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'user_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key </span><span class="python_operator">= </span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'user_name'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">16</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">nullable </span><span class="python_operator">= </span><span class="python_name">False</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'email_address'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">60</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">key</span><span class="python_operator">=</span><span class="python_literal">'email'</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'password'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">20</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">nullable </span><span class="python_operator">= </span><span class="python_name">False</span><span class="python_enclosure">)</span>
<span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_name">user_prefs </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'user_prefs'</span><span class="python_operator">, </span><span class="python_name">metadata</span><span class="python_operator">, </span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'pref_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'user_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">ForeignKey</span><span class="python_enclosure">(</span><span class="python_literal">"users.user_id"</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">nullable</span><span class="python_operator">=</span><span class="python_name">False</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'pref_name'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">40</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">nullable</span><span class="python_operator">=</span><span class="python_name">False</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'pref_value'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">100</span><span class="python_enclosure">))</span>
<span class="python_enclosure">)</span><span class="python_operator"></span></pre></div>
<p>The specific datatypes for each Column, such as Integer, String, etc. are described in <a href="types.html#types">The Types System</a>, and exist within the module <code>sqlalchemy.types</code> as well as the global <code>sqlalchemy</code> namespace.
</p>
<p>Foreign keys are most easily specified by the <code>ForeignKey</code> object within a <code>Column</code> object.  For a composite foreign key, i.e. a foreign key that contains multiple columns referencing multiple columns to a composite primary key, an explicit syntax is provided which allows the correct table CREATE statements to be generated:
</p>


<div class="sliding_code">
<pre><span class="python_comment"># a table with a composite primary key
</span><span class="python_name">invoices </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'invoices'</span><span class="python_operator">, </span><span class="python_name">metadata</span><span class="python_operator">, </span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'invoice_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'ref_num'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'description'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">60</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">nullable</span><span class="python_operator">=</span><span class="python_name">False</span><span class="python_enclosure">)</span>
<span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># a table with a composite foreign key referencing the parent table
</span><span class="python_name">invoice_items </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'invoice_items'</span><span class="python_operator">, </span><span class="python_name">metadata</span><span class="python_operator">, </span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'item_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'item_name'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">60</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">nullable</span><span class="python_operator">=</span><span class="python_name">False</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'invoice_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">nullable</span><span class="python_operator">=</span><span class="python_name">False</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'ref_num'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">nullable</span><span class="python_operator">=</span><span class="python_name">False</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">ForeignKeyConstraint</span><span class="python_enclosure">([</span><span class="python_literal">'invoice_id'</span><span class="python_operator">, </span><span class="python_literal">'ref_num'</span><span class="python_enclosure">]</span><span class="python_operator">, </span><span class="python_enclosure">[</span><span class="python_literal">'invoices.invoice_id'</span><span class="python_operator">, </span><span class="python_literal">'invoices.ref_num'</span><span class="python_enclosure">])</span>
<span class="python_enclosure">)</span><span class="python_operator"></span></pre></div>
<p>Above, the <code>invoice_items</code> table will have <code>ForeignKey</code> objects automatically added to the <code>invoice_id</code> and <code>ref_num</code> <code>Column</code> objects as a result of the additional <code>ForeignKeyConstraint</code> object.
</p>
<p>The <code>MetaData</code> object supports some handy methods, such as getting a list of Tables in the order (or reverse) of their dependency:
</p>


<div class="sliding_code">
<pre><span class="python_literal">>>> </span><span class="python_keyword">for </span><span class="python_name">t </span><span class="python_keyword">in </span><span class="python_name">metadata</span><span class="python_operator">.</span><span class="python_name">table_iterator</span><span class="python_enclosure">(</span><span class="python_name">reverse</span><span class="python_operator">=</span><span class="python_name">False</span><span class="python_enclosure">)</span><span class="python_operator">:
...    </span><span class="python_keyword">print </span><span class="python_name">t</span><span class="python_operator">.</span><span class="python_name">name</span><span class="python_operator">
</span><span class="python_name">users</span><span class="python_operator">
</span><span class="python_name">user_prefs</span><span class="python_operator"></span></pre></div>
<p>And <code>Table</code> provides an interface to the table's properties as well as that of its columns:
</p>


<div class="sliding_code">
<pre><span class="python_name">employees </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'employees'</span><span class="python_operator">, </span><span class="python_name">metadata</span><span class="python_operator">, </span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'employee_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'employee_name'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">60</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">nullable</span><span class="python_operator">=</span><span class="python_name">False</span><span class="python_operator">, </span><span class="python_name">key</span><span class="python_operator">=</span><span class="python_literal">'name'</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'employee_dept'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">ForeignKey</span><span class="python_enclosure">(</span><span class="python_literal">"departments.department_id"</span><span class="python_enclosure">))</span>
<span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># access the column "EMPLOYEE_ID":
</span><span class="python_name">employees</span><span class="python_operator">.</span><span class="python_name">columns</span><span class="python_operator">.</span><span class="python_name">employee_id</span><span class="python_operator">
</span>
<span class="python_comment"># or just
</span><span class="python_name">employees</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">employee_id</span><span class="python_operator">
</span>
<span class="python_comment"># via string
</span><span class="python_name">employees</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_enclosure">[</span><span class="python_literal">'employee_id'</span><span class="python_enclosure">]</span><span class="python_operator">
</span>
<span class="python_comment"># iterate through all columns
</span><span class="python_keyword">for </span><span class="python_name">c </span><span class="python_keyword">in </span><span class="python_name">employees</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">:
    </span><span class="python_comment"># ...
</span>
<span class="python_comment"># get the table's primary key columns
</span><span class="python_keyword">for </span><span class="python_name">primary_key </span><span class="python_keyword">in </span><span class="python_name">employees</span><span class="python_operator">.</span><span class="python_name">primary_key</span><span class="python_operator">:
    </span><span class="python_comment"># ...
</span>
<span class="python_comment"># get the table's foreign key objects:
</span><span class="python_keyword">for </span><span class="python_name">fkey </span><span class="python_keyword">in </span><span class="python_name">employees</span><span class="python_operator">.</span><span class="python_name">foreign_keys</span><span class="python_operator">:
    </span><span class="python_comment"># ...
</span>
<span class="python_comment"># access the table's MetaData:
</span><span class="python_name">employees</span><span class="python_operator">.</span><span class="python_name">metadata</span><span class="python_operator">
</span>
<span class="python_comment"># access the table's Engine, if its MetaData is bound:
</span><span class="python_name">employees</span><span class="python_operator">.</span><span class="python_name">engine</span><span class="python_operator">
</span>
<span class="python_comment"># access a column's name, type, nullable, primary key, foreign key
</span><span class="python_name">employees</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">employee_id</span><span class="python_operator">.</span><span class="python_name">name</span><span class="python_operator">
</span><span class="python_name">employees</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">employee_id</span><span class="python_operator">.</span><span class="python_name">type</span><span class="python_operator">
</span><span class="python_name">employees</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">employee_id</span><span class="python_operator">.</span><span class="python_name">nullable</span><span class="python_operator">
</span><span class="python_name">employees</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">employee_id</span><span class="python_operator">.</span><span class="python_name">primary_key</span><span class="python_operator">
</span><span class="python_name">employees</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">employee_dept</span><span class="python_operator">.</span><span class="python_name">foreign_key</span><span class="python_operator">
</span>
<span class="python_comment"># get the "key" of a column, which defaults to its name, but can 
# be any user-defined string:
</span><span class="python_name">employees</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">name</span><span class="python_operator">.</span><span class="python_name">key</span><span class="python_operator">
</span>
<span class="python_comment"># access a column's table:
</span><span class="python_name">employees</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">employee_id</span><span class="python_operator">.</span><span class="python_name">table </span><span class="python_keyword">is </span><span class="python_name">employees</span><span class="python_operator">
</span><span class="python_literal">>>> </span><span class="python_name">True</span><span class="python_operator">
</span>
<span class="python_comment"># get the table related by a foreign key
</span><span class="python_name">fcolumn </span><span class="python_operator">= </span><span class="python_name">employees</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">employee_dept</span><span class="python_operator">.</span><span class="python_name">foreign_key</span><span class="python_operator">.</span><span class="python_name">column</span><span class="python_operator">.</span><span class="python_name">table</span><span class="python_operator"></span></pre></div>



<A name="metadata_tables_binding"></a>

<div class="subsection" style="margin-left:30px;">


<h3>Binding MetaData to an Engine</h3>

    <div class="sectiontext">
    

<p>A MetaData object can be associated with one or more Engine instances.  This allows the MetaData and the elements within it to perform operations automatically, using the connection resources of that Engine.  This includes being able to "reflect" the columns of tables, as well as to perform create and drop operations without needing to pass an <code>Engine</code> or <code>Connection</code> around.  It also allows SQL constructs to be created which know how to execute themselves (called "implicit execution").
</p>
<p>To bind <code>MetaData</code> to a single <code>Engine</code>, use <code>BoundMetaData</code>:
</p>


<div class="sliding_code">
<pre><span class="python_name">engine </span><span class="python_operator">= </span><span class="python_name">create_engine</span><span class="python_enclosure">(</span><span class="python_literal">'sqlite://'</span><span class="python_operator">, **</span><span class="python_name">kwargs</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># create BoundMetaData from an Engine
</span><span class="python_name">meta </span><span class="python_operator">= </span><span class="python_name">BoundMetaData</span><span class="python_enclosure">(</span><span class="python_name">engine</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># create the Engine and MetaData in one step
</span><span class="python_name">meta </span><span class="python_operator">= </span><span class="python_name">BoundMetaData</span><span class="python_enclosure">(</span><span class="python_literal">'postgres://db/'</span><span class="python_operator">, **</span><span class="python_name">kwargs</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre></div>
<p>Another form of <code>MetaData</code> exists which allows connecting to any number of engines, within the context of the current thread.  This is <code>DynamicMetaData</code>:
</p>


<div class="sliding_code">
<pre><span class="python_name">meta </span><span class="python_operator">= </span><span class="python_name">DynamicMetaData</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_name">meta</span><span class="python_operator">.</span><span class="python_name">connect</span><span class="python_enclosure">(</span><span class="python_name">engine</span><span class="python_enclosure">)    </span><span class="python_comment"># connect to an existing Engine</span><span class="python_operator">
</span>
<span class="python_name">meta</span><span class="python_operator">.</span><span class="python_name">connect</span><span class="python_enclosure">(</span><span class="python_literal">'mysql://user@host/dsn'</span><span class="python_enclosure">)   </span><span class="python_comment"># create a new Engine and connect</span><span class="python_operator"></span></pre></div>
<p><code>DynamicMetaData</code> is ideal for applications that need to use the same set of <code>Tables</code> for many different database connections in the same process, such as a CherryPy web application which handles multiple application instances in one process.
</p>


    </div>

    <a href="#metadata" class="toclink">back to section top</a>
</div>




<A name="metadata_tables_using"></a>

<div class="subsection" style="margin-left:30px;">


<h3>Using the global Metadata object</h3>

    <div class="sectiontext">
    

<p>Some users prefer to create <code>Table</code> objects without specifying a <code>MetaData</code> object, having Tables scoped on an application-wide basis.  For them the <code>default_metadata</code> object and the <code>global_connect()</code> function is supplied.  <code>default_metadata</code> is simply an instance of <code>DynamicMetaData</code> that exists within the <code>sqlalchemy</code> namespace, and <code>global_connect()</code> is a synonym for <code>default_metadata.connect()</code>.  Defining a <code>Table</code> that has no <code>MetaData</code> argument will automatically use this default metadata as follows:
</p>


<div class="sliding_code">
<pre><span class="python_keyword">from </span><span class="python_name">sqlalchemy </span><span class="python_keyword">import </span><span class="python_operator">*
</span>
<span class="python_comment"># a Table with just a name and its Columns
</span><span class="python_name">mytable </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'mytable'</span><span class="python_operator">, </span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'col1'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'col2'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">40</span><span class="python_enclosure">))</span>
    <span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># connect all the "anonymous" tables to a postgres uri in the current thread    
</span><span class="python_name">global_connect</span><span class="python_enclosure">(</span><span class="python_literal">'postgres://foo:bar@lala/test'</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># create all tables in the default metadata
</span><span class="python_name">default_metadata</span><span class="python_operator">.</span><span class="python_name">create_all</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_comment"># the table is bound
</span><span class="python_name">mytable</span><span class="python_operator">.</span><span class="python_name">insert</span><span class="python_enclosure">()</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_name">col1</span><span class="python_operator">=</span><span class="python_number">5</span><span class="python_operator">, </span><span class="python_name">col2</span><span class="python_operator">=</span><span class="python_literal">'some value'</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre></div>


    </div>

    <a href="#metadata" class="toclink">back to section top</a>
</div>




<A name="metadata_tables_reflecting"></a>

<div class="subsection" style="margin-left:30px;">


<h3>Reflecting Tables</h3>

    <div class="sectiontext">
    

<p>Once you have a <code>BoundMetaData</code> or a connected <code>DynamicMetaData</code>, you can create <code>Table</code> objects without specifying their columns, just their names, using <code>autoload=True</code>:
</p>


<div class="sliding_code">
<pre><span class="python_literal">>>> </span><span class="python_name">messages </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'messages'</span><span class="python_operator">, </span><span class="python_name">meta</span><span class="python_operator">, </span><span class="python_name">autoload </span><span class="python_operator">= </span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_literal">>>> </span><span class="python_enclosure">[</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">name </span><span class="python_keyword">for </span><span class="python_name">c </span><span class="python_keyword">in </span><span class="python_name">messages</span><span class="python_operator">.</span><span class="python_name">columns</span><span class="python_enclosure">]</span><span class="python_operator">
</span><span class="python_enclosure">[</span><span class="python_literal">'message_id'</span><span class="python_operator">, </span><span class="python_literal">'message_name'</span><span class="python_operator">, </span><span class="python_literal">'date'</span><span class="python_enclosure">]</span><span class="python_operator"></span></pre></div>
<p>At the moment the Table is constructed, it will query the database for the columns and constraints of the <code>messages</code> table.
</p>
<p>Note that if a reflected table has a foreign key referencing another table, then the metadata for the related table will be loaded as well, even if it has not been defined by the application:              <br></br>
</p>


<div class="sliding_code">
<pre><span class="python_literal">>>> </span><span class="python_name">shopping_cart_items </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'shopping_cart_items'</span><span class="python_operator">, </span><span class="python_name">meta</span><span class="python_operator">, </span><span class="python_name">autoload </span><span class="python_operator">= </span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_literal">>>> </span><span class="python_keyword">print </span><span class="python_name">shopping_cart_items</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">cart_id</span><span class="python_operator">.</span><span class="python_name">table</span><span class="python_operator">.</span><span class="python_name">name</span><span class="python_operator">
</span><span class="python_name">shopping_carts</span><span class="python_operator"></span></pre></div>
<p>To get direct access to 'shopping_carts', simply instantiate it via the Table constructor.  You'll get the same instance of the shopping cart Table as the one that is attached to shopping_cart_items:
</p>


<div class="sliding_code">
<pre><span class="python_literal">>>> </span><span class="python_name">shopping_carts </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'shopping_carts'</span><span class="python_operator">, </span><span class="python_name">meta</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_literal">>>> </span><span class="python_name">shopping_carts </span><span class="python_keyword">is </span><span class="python_name">shopping_cart_items</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">cart_id</span><span class="python_operator">.</span><span class="python_name">table</span><span class="python_operator">
</span><span class="python_name">True</span><span class="python_operator"></span></pre></div>
<p>This works because when the Table constructor is called for a particular name and <code>MetaData</code> object, if the table has already been created then the instance returned will be the same as the original.  This is a <b>singleton</b> constructor:
</p>


<div class="sliding_code">
<pre><span class="python_literal">>>> </span><span class="python_name">news_articles </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'news'</span><span class="python_operator">, </span><span class="python_name">meta</span><span class="python_operator">, </span>
<span class="python_operator">... </span><span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'article_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key </span><span class="python_operator">= </span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
<span class="python_operator">... </span><span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'url'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">250</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">nullable </span><span class="python_operator">= </span><span class="python_name">False</span><span class="python_enclosure">)</span>
<span class="python_operator">... </span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_literal">>>> </span><span class="python_name">othertable </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'news'</span><span class="python_operator">, </span><span class="python_name">meta</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_literal">>>> </span><span class="python_name">othertable </span><span class="python_keyword">is </span><span class="python_name">news_articles</span><span class="python_operator">
</span><span class="python_name">True</span><span class="python_operator"></span></pre></div>


<A name="metadata_tables_reflecting_overriding"></a>

<div class="subsection" style="margin-left:40px;">


<h3>Overriding Reflected Columns</h3>

    <div class="sectiontext">
    
<p>Individual columns can be overridden with explicit values when reflecting tables; this is handy for specifying custom datatypes, constraints such as primary keys that may not be configured within the database, etc.
</p>


<div class="sliding_code">
<pre><span class="python_literal">>>> </span><span class="python_name">mytable </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'mytable'</span><span class="python_operator">, </span><span class="python_name">meta</span><span class="python_operator">,</span>
<span class="python_operator">... </span><span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,   </span><span class="python_comment"># override reflected 'id' to have primary key</span>
<span class="python_operator">... </span><span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'mydata'</span><span class="python_operator">, </span><span class="python_name">Unicode</span><span class="python_enclosure">(</span><span class="python_number">50</span><span class="python_enclosure">))</span><span class="python_operator">,    </span><span class="python_comment"># override reflected 'mydata' to be Unicode</span>
<span class="python_operator">... </span><span class="python_name">autoload</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre></div>


    </div>

</div>



    </div>

    <a href="#metadata" class="toclink">back to section top</a>
</div>




<A name="metadata_tables_schema"></a>

<div class="subsection" style="margin-left:30px;">


<h3>Specifying the Schema Name</h3>

    <div class="sectiontext">
    

<p>Some databases support the concept of multiple schemas.  A <code>Table</code> can reference this by specifying the <code>schema</code> keyword argument:
</p>


<div class="sliding_code">
<pre><span class="python_name">financial_info </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'financial_info'</span><span class="python_operator">, </span><span class="python_name">meta</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'value'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">100</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">nullable</span><span class="python_operator">=</span><span class="python_name">False</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">schema</span><span class="python_operator">=</span><span class="python_literal">'remote_banks'</span>
<span class="python_enclosure">)</span><span class="python_operator"></span></pre></div>
<p>Within the <code>MetaData</code> collection, this table will be identified by the combination of <code>financial_info</code> and <code>remote_banks</code>.  If another table called <code>financial_info</code> is referenced without the <code>remote_banks</code> schema, it will refer to a different <code>Table</code>.  <code>ForeignKey</code> objects can reference columns in this table using the form <code>remote_banks.financial_info.id</code>.
</p>


    </div>

    <a href="#metadata" class="toclink">back to section top</a>
</div>




<A name="metadata_tables_onupdate"></a>

<div class="subsection" style="margin-left:30px;">


<h3>ON UPDATE and ON DELETE</h3>

    <div class="sectiontext">
    

<p><code>ON UPDATE</code> and <code>ON DELETE</code> clauses to a table create are specified within the <code>ForeignKeyConstraint</code> object, using the <code>onupdate</code> and <code>ondelete</code> keyword arguments:
</p>


<div class="sliding_code">
<pre><span class="python_name">foobar </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'foobar'</span><span class="python_operator">, </span><span class="python_name">meta</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'lala'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">40</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
    <span class="python_name">ForeignKeyConstraint</span><span class="python_enclosure">([</span><span class="python_literal">'lala'</span><span class="python_enclosure">]</span><span class="python_operator">,</span><span class="python_enclosure">[</span><span class="python_literal">'hoho.lala'</span><span class="python_enclosure">]</span><span class="python_operator">, </span><span class="python_name">onupdate</span><span class="python_operator">=</span><span class="python_literal">"CASCADE"</span><span class="python_operator">, </span><span class="python_name">ondelete</span><span class="python_operator">=</span><span class="python_literal">"CASCADE"</span><span class="python_enclosure">))</span><span class="python_operator"></span></pre></div>


    </div>

    <a href="#metadata" class="toclink">back to section top</a>
</div>




<A name="metadata_tables_quoting"></a>

<div class="subsection" style="margin-left:30px;">


<h3>Enabling Table / Column Quoting</h3>

    <div class="sectiontext">
    

<p>Feature Status: <a href='javascript:alphaImplementation()'>Alpha Implementation</a> 
</p>
<p>Many table, schema, or column names require quoting to be enabled.  Reasons for this include names that are the same as a database reserved word, or for identifiers that use MixedCase, where the database would normally "fold" the case convention into lower or uppercase (such as Postgres).  SQLAlchemy will attempt to automatically determine when quoting should be used.  It will determine a value for every identifier name called <code>case_sensitive</code>, which defaults to <code>False</code> if the identifer name uses no uppercase letters, or <code>True</code> otherwise.  This flag may be explicitly set on any schema item as well (schema items include <code>Table</code>, <code>Column</code>, <code>MetaData</code>, <code>Sequence</code>, etc.) to override this default setting, where objects will inherit the setting from an enclosing object if not explicitly overridden.
</p>
<p>When <code>case_sensitive</code> is <code>True</code>, the dialect will do what it has to in order for the database to recognize the casing.  For Postgres and Oracle, this means using quoted identifiers.
</p>
<p>Identifiers that match known SQL reserved words (such as "asc", "union", etc.) will also be quoted according to the dialect's quoting convention regardless of the <code>case_sensitive</code> setting.
</p>
<p>To force quoting for an identifier, set the "quote=True" flag on <code>Column</code> or <code>Table</code>, as well as the <code>quote_schema=True</code> flag for <code>Table</code>. 
</p>


<div class="sliding_code">
<pre><span class="python_name">table2 </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'WorstCase2'</span><span class="python_operator">, </span><span class="python_name">metadata</span><span class="python_operator">,</span>
    <span class="python_comment"># desc is a reserved word, which will be quoted.</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'desc'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>

    <span class="python_comment"># if using a reserved word which SQLAlchemy doesn't know about,</span>
    <span class="python_comment"># specify quote=True</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'some_reserved_word'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">quote</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>

    <span class="python_comment"># MixedCase uses a mixed case convention. </span>
    <span class="python_comment"># it will be automatically quoted since it is case sensitive</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'MixedCase'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_enclosure">)</span><span class="python_operator">,</span>

    <span class="python_comment"># Union is both a reserved word and mixed case</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'Union'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_enclosure">)</span><span class="python_operator">,</span>

    <span class="python_comment"># normal_column doesnt require quoting</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'normal_column'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">30</span><span class="python_enclosure">)))</span><span class="python_operator">
</span>
<span class="python_comment"># to use tables where case_sensitive is False by default regardless
# of idenfifier casings, set "case_sensitive" to false at any level
# (or true to force case sensitive for lowercase identifiers as well)
</span><span class="python_name">lowercase_metadata </span><span class="python_operator">= </span><span class="python_name">MetaData</span><span class="python_enclosure">(</span><span class="python_name">case_sensitive</span><span class="python_operator">=</span><span class="python_name">False</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre></div>


    </div>

    <a href="#metadata" class="toclink">back to section top</a>
</div>




<A name="metadata_tables_options"></a>

<div class="subsection" style="margin-left:30px;">


<h3>Other Options</h3>

    <div class="sectiontext">
    

<p><code>Tables</code> may support database-specific options, such as MySQL's <code>engine</code> option that can specify "MyISAM", "InnoDB", and other backends for the table:
</p>


<div class="sliding_code">
<pre><span class="python_name">addresses </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'engine_email_addresses'</span><span class="python_operator">, </span><span class="python_name">meta</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'address_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key </span><span class="python_operator">= </span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'remote_user_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">ForeignKey</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'email_address'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">20</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
    <span class="python_name">mysql_engine</span><span class="python_operator">=</span><span class="python_literal">'InnoDB'</span>
<span class="python_enclosure">)</span><span class="python_operator"></span></pre></div>


    </div>

</div>



    </div>

    <a href="#metadata" class="toclink">back to section top</a>
</div>




<A name="metadata_creating"></a>

<div class="subsection" style="margin-left:20px;">


<h3>Creating and Dropping Database Tables</h3>

    <div class="sectiontext">
    

<p>Creating and dropping individual tables can be done via the <code>create()</code> and <code>drop()</code> methods of <code>Table</code>; these methods take an optional <code>connectable</code> parameter which references an <code>Engine</code> or a <code>Connection</code>.  If not supplied, the <code>Engine</code> bound to the <code>MetaData</code> will be used, else an error is raised:
</p>


<div class="code">
<pre><span class="python_name">meta </span><span class="python_operator">= </span><span class="python_name">BoundMetaData</span><span class="python_enclosure">(</span><span class="python_literal">'sqlite:///:memory:'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">employees </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'employees'</span><span class="python_operator">, </span><span class="python_name">meta</span><span class="python_operator">, </span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'employee_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'employee_name'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">60</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">nullable</span><span class="python_operator">=</span><span class="python_name">False</span><span class="python_operator">, </span><span class="python_name">key</span><span class="python_operator">=</span><span class="python_literal">'name'</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'employee_dept'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">ForeignKey</span><span class="python_enclosure">(</span><span class="python_literal">"departments.department_id"</span><span class="python_enclosure">))</span>
<span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_1', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">employees</span><span class="python_operator">.</span><span class="python_name">create</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_1_div" class="codepop" style="display:none;">CREATE TABLE employees(<br/>
  employee_id SERIAL NOT NULL PRIMARY KEY,<br/>
  employee_name VARCHAR(60) NOT NULL,<br/>
  employee_dept INTEGER REFERENCES departments(department_id)<br/>
  )<br/>
  {}</div><pre><span class="python_operator"></span></pre></div>
<p><code>drop()</code> method:
</p>


<div class="code">
<pre><span class="python_literal"><a href="javascript:togglePopbox('popbox_2', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">employees</span><span class="python_operator">.</span><span class="python_name">drop</span><span class="python_enclosure">(</span><span class="python_name">connectable</span><span class="python_operator">=</span><span class="python_name">e</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre><div id="popbox_2_div" class="codepop" style="display:none;">DROP TABLE employees<br/>
  {}</div><pre><span class="python_operator"></span></pre></div>
<p>The <code>create()</code> and <code>drop()</code> methods also support an optional keyword argument <code>checkfirst</code> which will issue the database's appropriate pragma statements to check if the table exists before creating or dropping:
</p>


<div class="sliding_code">
<pre><span class="python_name">employees</span><span class="python_operator">.</span><span class="python_name">create</span><span class="python_enclosure">(</span><span class="python_name">connectable</span><span class="python_operator">=</span><span class="python_name">e</span><span class="python_operator">, </span><span class="python_name">checkfirst</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">employees</span><span class="python_operator">.</span><span class="python_name">drop</span><span class="python_enclosure">(</span><span class="python_name">checkfirst</span><span class="python_operator">=</span><span class="python_name">False</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre></div>
<p>Entire groups of Tables can be created and dropped directly from the <code>MetaData</code> object with <code>create_all()</code> and <code>drop_all()</code>.  These methods always check for the existence of each table before creating or dropping.  Each method takes an optional <code>connectable</code> keyword argument which can reference an <code>Engine</code> or a <code>Connection</code>.  If no engine is specified, the underlying bound <code>Engine</code>,  if any, is used:
</p>


<div class="code">
<pre><span class="python_name">engine </span><span class="python_operator">= </span><span class="python_name">create_engine</span><span class="python_enclosure">(</span><span class="python_literal">'sqlite:///:memory:'</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_name">metadata </span><span class="python_operator">= </span><span class="python_name">MetaData</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_name">users </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'users'</span><span class="python_operator">, </span><span class="python_name">metadata</span><span class="python_operator">, </span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'user_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key </span><span class="python_operator">= </span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'user_name'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">16</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">nullable </span><span class="python_operator">= </span><span class="python_name">False</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'email_address'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">60</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">key</span><span class="python_operator">=</span><span class="python_literal">'email'</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'password'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">20</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">nullable </span><span class="python_operator">= </span><span class="python_name">False</span><span class="python_enclosure">)</span>
<span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_name">user_prefs </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'user_prefs'</span><span class="python_operator">, </span><span class="python_name">metadata</span><span class="python_operator">, </span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'pref_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'user_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">ForeignKey</span><span class="python_enclosure">(</span><span class="python_literal">"users.user_id"</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">nullable</span><span class="python_operator">=</span><span class="python_name">False</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'pref_name'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">40</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">nullable</span><span class="python_operator">=</span><span class="python_name">False</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'pref_value'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">100</span><span class="python_enclosure">))</span>
<span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_literal"><a href="javascript:togglePopbox('popbox_3', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">metadata</span><span class="python_operator">.</span><span class="python_name">create_all</span><span class="python_enclosure">(</span><span class="python_name">connectable</span><span class="python_operator">=</span><span class="python_name">engine</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre><div id="popbox_3_div" class="codepop" style="display:none;">PRAGMA table_info(users){}<br/>
  CREATE TABLE users(<br/>
          user_id INTEGER NOT NULL PRIMARY KEY, <br/>
          user_name VARCHAR(16) NOT NULL, <br/>
          email_address VARCHAR(60), <br/>
          password VARCHAR(20) NOT NULL<br/>
  )<br/>
  PRAGMA table_info(user_prefs){}<br/>
  CREATE TABLE user_prefs(<br/>
          pref_id INTEGER NOT NULL PRIMARY KEY, <br/>
          user_id INTEGER NOT NULL REFERENCES users(user_id), <br/>
          pref_name VARCHAR(40) NOT NULL, <br/>
          pref_value VARCHAR(100)<br/>
  )</div><pre><span class="python_operator"></span></pre></div>


    </div>

    <a href="#metadata" class="toclink">back to section top</a>
</div>




<A name="metadata_defaults"></a>

<div class="subsection" style="margin-left:20px;">


<h3>Column Defaults and OnUpdates</h3>

    <div class="sectiontext">
    

<p>SQLAlchemy includes flexible constructs in which to create default values for columns upon the insertion of rows, as well as upon update.  These defaults can take several forms: a constant, a Python callable to be pre-executed before the SQL is executed, a SQL expression or function to be pre-executed before the SQL is executed, a pre-executed Sequence (for databases that support sequences), or a "passive" default, which is a default function triggered by the database itself upon insert, the value of which can then be post-fetched by the engine, provided the row provides a primary key in which to call upon.
</p>



<A name="metadata_defaults_oninsert"></a>

<div class="subsection" style="margin-left:30px;">


<h3>Pre-Executed Insert Defaults</h3>

    <div class="sectiontext">
    

<p>A basic default is most easily specified by the "default" keyword argument to Column.  This defines a value, function, or SQL expression that will be pre-executed to produce the new value, before the row is inserted:
</p>


<div class="sliding_code">
<pre><span class="python_comment"># a function to create primary key ids
</span><span class="python_name">i </span><span class="python_operator">= </span><span class="python_number">0</span><span class="python_operator">
</span><span class="python_keyword">def </span><span class="python_name">mydefault</span><span class="python_enclosure">()</span><span class="python_operator">:
    </span><span class="python_keyword">global </span><span class="python_name">i</span><span class="python_operator">
    </span><span class="python_name">i </span><span class="python_operator">+= </span><span class="python_number">1</span><span class="python_operator">
    </span><span class="python_keyword">return </span><span class="python_name">i</span><span class="python_operator">
</span>
<span class="python_operator"></span><span class="python_name">t </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">"mytable"</span><span class="python_operator">, </span><span class="python_name">meta</span><span class="python_operator">, </span>
    <span class="python_comment"># function-based default</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_operator">, </span><span class="python_name">default</span><span class="python_operator">=</span><span class="python_name">mydefault</span><span class="python_enclosure">)</span><span class="python_operator">,</span>

    <span class="python_comment"># a scalar default</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'key'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">10</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">default</span><span class="python_operator">=</span><span class="python_literal">"default"</span><span class="python_enclosure">)</span>
<span class="python_enclosure">)</span><span class="python_operator"></span></pre></div>
<p>The "default" keyword can also take SQL expressions, including select statements or direct function calls:
</p>


<div class="sliding_code">
<pre><span class="python_name">t </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">"mytable"</span><span class="python_operator">, </span><span class="python_name">meta</span><span class="python_operator">, </span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>

    <span class="python_comment"># define 'create_date' to default to now()</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'create_date'</span><span class="python_operator">, </span><span class="python_name">DateTime</span><span class="python_operator">, </span><span class="python_name">default</span><span class="python_operator">=</span><span class="python_name">func</span><span class="python_operator">.</span><span class="python_name">now</span><span class="python_enclosure">())</span><span class="python_operator">,</span>

    <span class="python_comment"># define 'key' to pull its default from the 'keyvalues' table</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'key'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">20</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">default</span><span class="python_operator">=</span><span class="python_name">keyvalues</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">keyvalues</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">type</span><span class="python_operator">=</span><span class="python_literal">'type1'</span><span class="python_operator">, </span><span class="python_name">limit</span><span class="python_operator">=</span><span class="python_number">1</span><span class="python_enclosure">))</span>
    <span class="python_enclosure">)</span><span class="python_operator"></span></pre></div>
<p>The "default" keyword argument is shorthand for using a ColumnDefault object in a column definition.  This syntax is optional, but is required for other types of defaults, futher described below:
</p>


<div class="sliding_code">
<pre><span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'mycolumn'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">30</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">ColumnDefault</span><span class="python_enclosure">(</span><span class="python_name">func</span><span class="python_operator">.</span><span class="python_name">get_data</span><span class="python_enclosure">()))</span><span class="python_operator"></span></pre></div>


    </div>

    <a href="#metadata" class="toclink">back to section top</a>
</div>




<A name="metadata_defaults_onupdate"></a>

<div class="subsection" style="margin-left:30px;">


<h3>Pre-Executed OnUpdate Defaults</h3>

    <div class="sectiontext">
    

<p>Similar to an on-insert default is an on-update default, which is most easily specified by the "onupdate" keyword to Column, which also can be a constant, plain Python function or SQL expression:
</p>


<div class="sliding_code">
<pre><span class="python_name">t </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">"mytable"</span><span class="python_operator">, </span><span class="python_name">meta</span><span class="python_operator">, </span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>

    <span class="python_comment"># define 'last_updated' to be populated with current_timestamp (the ANSI-SQL version of now())</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'last_updated'</span><span class="python_operator">, </span><span class="python_name">DateTime</span><span class="python_operator">, </span><span class="python_name">onupdate</span><span class="python_operator">=</span><span class="python_name">func</span><span class="python_operator">.</span><span class="python_name">current_timestamp</span><span class="python_enclosure">())</span><span class="python_operator">,</span>
<span class="python_enclosure">)</span><span class="python_operator"></span></pre></div>
<p>To use an explicit ColumnDefault object to specify an on-update, use the "for_update" keyword argument:
</p>


<div class="sliding_code">
<pre><span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'mycolumn'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">30</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">ColumnDefault</span><span class="python_enclosure">(</span><span class="python_name">func</span><span class="python_operator">.</span><span class="python_name">get_data</span><span class="python_enclosure">()</span><span class="python_operator">, </span><span class="python_name">for_update</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">))</span><span class="python_operator"></span></pre></div>


    </div>

    <a href="#metadata" class="toclink">back to section top</a>
</div>




<A name="metadata_defaults_passive"></a>

<div class="subsection" style="margin-left:30px;">


<h3>Inline Default Execution: PassiveDefault</h3>

    <div class="sectiontext">
    

<p>A PassiveDefault indicates an column default that is executed upon INSERT by the database.  This construct is used to specify a SQL function that will be specified as "DEFAULT" when creating tables.
</p>


<div class="sliding_code">
<pre><span class="python_name">t </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'test'</span><span class="python_operator">, </span><span class="python_name">meta</span><span class="python_operator">, </span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'mycolumn'</span><span class="python_operator">, </span><span class="python_name">DateTime</span><span class="python_operator">, </span><span class="python_name">PassiveDefault</span><span class="python_enclosure">(</span><span class="python_literal">"sysdate"</span><span class="python_enclosure">))</span>
<span class="python_enclosure">)</span><span class="python_operator"></span></pre></div>
<p>A create call for the above table will produce:
</p>


<div class="sliding_code">
<pre>CREATE TABLE test (
    mycolumn datetime default sysdate
)</pre></div>
<p>PassiveDefault also sends a message to the <code>Engine</code> that data is available after an insert.  The object-relational mapper system uses this information to post-fetch rows after the insert, so that instances can be refreshed with the new data.  Below is a simplified version:
</p>


<div class="sliding_code">
<pre><span class="python_comment"># table with passive defaults
</span><span class="python_name">mytable </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'mytable'</span><span class="python_operator">, </span><span class="python_name">engine</span><span class="python_operator">, </span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'my_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>

    <span class="python_comment"># an on-insert database-side default</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'data1'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">PassiveDefault</span><span class="python_enclosure">(</span><span class="python_literal">"d1_func"</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
<span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_comment"># insert a row
</span><span class="python_name">r </span><span class="python_operator">= </span><span class="python_name">mytable</span><span class="python_operator">.</span><span class="python_name">insert</span><span class="python_enclosure">()</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_name">name</span><span class="python_operator">=</span><span class="python_literal">'fred'</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># check the result: were there defaults fired off on that row ?
</span><span class="python_keyword">if </span><span class="python_name">r</span><span class="python_operator">.</span><span class="python_name">lastrow_has_defaults</span><span class="python_enclosure">()</span><span class="python_operator">:
    </span><span class="python_comment"># postfetch the row based on primary key.
    # this only works for a table with primary key columns defined
</span><span class="python_operator">    </span><span class="python_name">primary_key </span><span class="python_operator">= </span><span class="python_name">r</span><span class="python_operator">.</span><span class="python_name">last_inserted_ids</span><span class="python_enclosure">()</span><span class="python_operator">
    </span><span class="python_name">row </span><span class="python_operator">= </span><span class="python_name">table</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">id </span><span class="python_operator">== </span><span class="python_name">primary_key</span><span class="python_enclosure">[</span><span class="python_number">0</span><span class="python_enclosure">])</span><span class="python_operator"></span></pre></div>
<p>When Tables are reflected from the database using <code>autoload=True</code>, any DEFAULT values set on the columns will be reflected in the Table object as PassiveDefault instances.
</p>


<A name="metadata_defaults_passive_postgres"></a>

<div class="subsection" style="margin-left:40px;">


<h3>The Catch: Postgres Primary Key Defaults always Pre-Execute</h3>

    <div class="sectiontext">
    
<p>Current Postgres support does not rely upon OID's to determine the identity of a row.  This is because the usage of OIDs has been deprecated with Postgres and they are disabled by default for table creates as of PG version 8.  Pyscopg2's "cursor.lastrowid" function only returns OIDs.  Therefore, when inserting a new row which has passive defaults set on the primary key columns, the default function is <b>still pre-executed</b> since SQLAlchemy would otherwise have no way of retrieving the row just inserted.
</p>


    </div>

</div>



    </div>

    <a href="#metadata" class="toclink">back to section top</a>
</div>




<A name="metadata_defaults_sequences"></a>

<div class="subsection" style="margin-left:30px;">


<h3>Defining Sequences</h3>

    <div class="sectiontext">
    

<p>A table with a sequence looks like:
</p>


<div class="sliding_code">
<pre><span class="python_name">table </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">"cartitems"</span><span class="python_operator">, </span><span class="python_name">meta</span><span class="python_operator">, </span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">"cart_id"</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">Sequence</span><span class="python_enclosure">(</span><span class="python_literal">'cart_id_seq'</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">"description"</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">40</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">"createdate"</span><span class="python_operator">, </span><span class="python_name">DateTime</span><span class="python_enclosure">())</span>
<span class="python_enclosure">)</span><span class="python_operator"></span></pre></div>
<p>The Sequence is used with Postgres or Oracle to indicate the name of a database sequence that will be used to create default values for a column.  When a table with a Sequence on a column is created in the database by SQLAlchemy, the database sequence object is also created.   Similarly, the database sequence is dropped when the table is dropped.  Sequences are typically used with primary key columns.  When using Postgres, if an integer primary key column defines no explicit Sequence or other default method, SQLAlchemy will create the column with the SERIAL keyword, and will pre-execute a sequence named "tablename_columnname_seq" in order to retrieve new primary key values, if they were not otherwise explicitly stated.   Oracle, which has no "auto-increment" keyword, requires that a Sequence be created for a table if automatic primary key generation is desired.
</p>
<p>A Sequence object can be defined on a Table that is then used for a non-sequence-supporting database.  In that case, the Sequence object is simply ignored.  Note that a Sequence object is <strong>entirely optional for all databases except Oracle</strong>, as other databases offer options for auto-creating primary key values, such as AUTOINCREMENT, SERIAL, etc.  SQLAlchemy will use these default methods for creating primary key values if no Sequence is present on the table metadata.
</p>
<p>A sequence can also be specified with <code>optional=True</code> which indicates the Sequence should only be used on a database that requires an explicit sequence, and not those that supply some other method of providing integer values.  At the moment, it essentially means "use this sequence only with Oracle and not Postgres".
</p>


    </div>

</div>



    </div>

    <a href="#metadata" class="toclink">back to section top</a>
</div>




<A name="metadata_constraints"></a>

<div class="subsection" style="margin-left:20px;">


<h3>Defining Constraints and Indexes</h3>

    <div class="sectiontext">
    




<A name="metadata_constraints_unique"></a>

<div class="subsection" style="margin-left:30px;">


<h3>UNIQUE Constraint</h3>

    <div class="sectiontext">
    

<p>Unique constraints can be created anonymously on a single column using the <code>unique</code> keyword on <code>Column</code>.  Explicitly named unique constraints and/or those with multiple columns are created via the <code>UniqueConstraint</code> table-level construct.
</p>


<div class="sliding_code">
<pre><span class="python_name">meta </span><span class="python_operator">= </span><span class="python_name">MetaData</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_name">mytable </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'mytable'</span><span class="python_operator">, </span><span class="python_name">meta</span><span class="python_operator">,</span>

    <span class="python_comment"># per-column anonymous unique constraint</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'col1'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">unique</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>

    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'col2'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'col3'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_enclosure">)</span><span class="python_operator">,</span>

    <span class="python_comment"># explicit/composite unique constraint.  'name' is optional.</span>
    <span class="python_name">UniqueConstraint</span><span class="python_enclosure">(</span><span class="python_literal">'col2'</span><span class="python_operator">, </span><span class="python_literal">'col3'</span><span class="python_operator">, </span><span class="python_name">name</span><span class="python_operator">=</span><span class="python_literal">'uix_1'</span><span class="python_enclosure">)</span>
    <span class="python_enclosure">)</span><span class="python_operator"></span></pre></div>


    </div>

    <a href="#metadata" class="toclink">back to section top</a>
</div>




<A name="metadata_constraints_check"></a>

<div class="subsection" style="margin-left:30px;">


<h3>CHECK Constraint</h3>

    <div class="sectiontext">
    

<p>Check constraints can be named or unnamed and can be created at the Column or Table level, using the <code>CheckConstraint</code> construct.  The text of the check constraint is passed directly through to the database, so there is limited "database independent" behavior.  Column level check constraints generally should only refer to the column to which they are placed, while table level constraints can refer to any columns in the table.
</p>
<p>Note that some databases do not actively support check constraints such as MySQL and sqlite.
</p>


<div class="sliding_code">
<pre><span class="python_name">meta </span><span class="python_operator">= </span><span class="python_name">MetaData</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_name">mytable </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'mytable'</span><span class="python_operator">, </span><span class="python_name">meta</span><span class="python_operator">,</span>

    <span class="python_comment"># per-column CHECK constraint</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'col1'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">CheckConstraint</span><span class="python_enclosure">(</span><span class="python_literal">'col1&gt;5'</span><span class="python_enclosure">))</span><span class="python_operator">,</span>

    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'col2'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'col3'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_enclosure">)</span><span class="python_operator">,</span>

    <span class="python_comment"># table level CHECK constraint.  'name' is optional.</span>
    <span class="python_name">CheckConstraint</span><span class="python_enclosure">(</span><span class="python_literal">'col2 &gt; col3 + 5'</span><span class="python_operator">, </span><span class="python_name">name</span><span class="python_operator">=</span><span class="python_literal">'check1'</span><span class="python_enclosure">)</span>
    <span class="python_enclosure">)</span><span class="python_operator"></span></pre></div>


    </div>

    <a href="#metadata" class="toclink">back to section top</a>
</div>




<A name="metadata_constraints_indexes"></a>

<div class="subsection" style="margin-left:30px;">


<h3>Indexes</h3>

    <div class="sectiontext">
    

<p>Indexes can be created anonymously (using an auto-generated name "ix_<column label>") for a single column using the inline <code>index</code> keyword on <code>Column</code>, which also modifies the usage of <code>unique</code> to apply the uniqueness to the index itself, instead of adding a separate UNIQUE constraint.  For indexes with specific names or which encompass more than one column, use the <code>Index</code> construct, which requires a name.  <br></br>
</p>
<p>Note that the <code>Index</code> construct is created <strong>externally</strong> to the table which it corresponds, using <code>Column</code> objects and not strings.
</p>


<div class="sliding_code">
<pre><span class="python_name">meta </span><span class="python_operator">= </span><span class="python_name">MetaData</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_name">mytable </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'mytable'</span><span class="python_operator">, </span><span class="python_name">meta</span><span class="python_operator">,</span>
    <span class="python_comment"># an indexed column, with index "ix_mytable_col1"</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'col1'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">index</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>

    <span class="python_comment"># a uniquely indexed column with index "ix_mytable_col2"</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'col2'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">index</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_operator">, </span><span class="python_name">unique</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>

    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'col3'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'col4'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_enclosure">)</span><span class="python_operator">,</span>

    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'col5'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'col6'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># place an index on col3, col4
</span><span class="python_name">Index</span><span class="python_enclosure">(</span><span class="python_literal">'idx_col34'</span><span class="python_operator">, </span><span class="python_name">mytable</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">col3</span><span class="python_operator">, </span><span class="python_name">mytable</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">col4</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># place a unique index on col5, col6
</span><span class="python_name">Index</span><span class="python_enclosure">(</span><span class="python_literal">'myindex'</span><span class="python_operator">, </span><span class="python_name">mytable</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">col5</span><span class="python_operator">, </span><span class="python_name">mytable</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">col6</span><span class="python_operator">, </span><span class="python_name">unique</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre></div>
<p>The <code>Index</code> objects will be created along with the CREATE statements for the table itself.  An index can also be created on its own independently of the table:
</p>


<div class="sliding_code">
<pre><span class="python_comment"># create a table
</span><span class="python_name">sometable</span><span class="python_operator">.</span><span class="python_name">create</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_comment"># define an index
</span><span class="python_name">i </span><span class="python_operator">= </span><span class="python_name">Index</span><span class="python_enclosure">(</span><span class="python_literal">'someindex'</span><span class="python_operator">, </span><span class="python_name">sometable</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">col5</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># create the index, will use the table's connectable, or specify the connectable keyword argument
</span><span class="python_name">i</span><span class="python_operator">.</span><span class="python_name">create</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre></div>


    </div>

</div>



    </div>

    <a href="#metadata" class="toclink">back to section top</a>
</div>




<A name="metadata_adapting"></a>

<div class="subsection" style="margin-left:20px;">


<h3>Adapting Tables to Alternate Metadata</h3>

    <div class="sectiontext">
    

<p>A <code>Table</code> object created against a specific <code>MetaData</code> object can be re-created against a new MetaData using the <code>tometadata</code> method:
</p>


<div class="sliding_code">
<pre><span class="python_comment"># create two metadata
</span><span class="python_name">meta1 </span><span class="python_operator">= </span><span class="python_name">BoundMetaData</span><span class="python_enclosure">(</span><span class="python_literal">'sqlite:///querytest.db'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">meta2 </span><span class="python_operator">= </span><span class="python_name">MetaData</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_comment"># load 'users' from the sqlite engine
</span><span class="python_name">users_table </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'users'</span><span class="python_operator">, </span><span class="python_name">meta1</span><span class="python_operator">, </span><span class="python_name">autoload</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># create the same Table object for the plain metadata
</span><span class="python_name">users_table_2 </span><span class="python_operator">= </span><span class="python_name">users_table</span><span class="python_operator">.</span><span class="python_name">tometadata</span><span class="python_enclosure">(</span><span class="python_name">meta2</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre></div>



    </div>

</div>



    </div>

    <a href="#metadata" class="toclink">back to section top</a>
</div>


</html></div>
<A name="sql"></a>

<div class="sectionnavblock">
<div class="sectionnav">

        Previous: <a href="#metadata">Database Meta Data</a>

                |

        Next: <a href="#datamapping">Data Mapping</a>

</div>
</div>

<div class="topnavmain">
	<div class="topnavheader">Constructing SQL Queries via Python Expressions</div>
</div>
<div class="sectioncontent">
<html>



<A name="sql"></a>

<div class="subsection" style="margin-left:10px;">



    <div class="sectiontext">
    

<p><em>Note:</em> This section describes how to use SQLAlchemy to construct SQL queries and receive result sets.  It does <em>not</em> cover the object relational mapping capabilities of SQLAlchemy; that is covered later on in <a href="datamapping.html#datamapping">Data Mapping</a>.  However, both areas of functionality work similarly in how selection criterion is constructed, so if you are interested just in ORM, you should probably skim through basic <a href="sqlconstruction.html#sql_whereclause">WHERE Clause</a> construction before moving on.
</p>
<p>Once you have used the <code>sqlalchemy.schema</code> module to construct your tables and/or reflect them from the database, performing SQL queries using those table meta data objects is done via the <code>sqlalchemy.sql</code> package.  This package defines a large set of classes, each of which represents a particular kind of lexical construct within a SQL query; all are descendants of the common base class <code>sqlalchemy.sql.ClauseElement</code>.  A full query is represented via a structure of <code>ClauseElement</code>s.  A set of reasonably intuitive creation functions is provided by the <code>sqlalchemy.sql</code> package to create these structures; these functions are described in the rest of this section. 
</p>
<p>Executing a <code>ClauseElement</code> structure can be performed in two general ways.  You can use an <code>Engine</code> or a <code>Connection</code> object's <code>execute()</code> method to which you pass the query structure; this is known as <strong>explicit style</strong>.  Or, if the <code>ClauseElement</code> structure is built upon Table metadata which is bound to an <code>Engine</code> directly, you can simply call <code>execute()</code> on the structure itself, known as <strong>implicit style</strong>.  In both cases, the execution returns a cursor-like object (more on that later).  The same clause structure can be executed repeatedly.  The <code>ClauseElement</code> is compiled into a string representation by an underlying <code>Compiler</code> object which is associated with the <code>Engine</code> via its <code>Dialect</code>.
</p>
<p>The examples below all include a dump of the generated SQL corresponding to the query object, as well as a dump of the statement's bind parameters.  In all cases, bind parameters are shown as named parameters using the colon format (i.e. ':name').  When the statement is compiled into a database-specific version, the named-parameter statement and its bind values are converted to the proper paramstyle for that database automatically.
</p>
<p>For this section, we will mostly use the implcit style of execution, meaning the <code>Table</code> objects are associated with an instance of <code>BoundMetaData</code>, and constructed <code>ClauseElement</code> objects support self-execution.  Assume the following configuration:
</p>


<div class="sliding_code">
<pre><span class="python_keyword">from </span><span class="python_name">sqlalchemy </span><span class="python_keyword">import </span><span class="python_operator">*
</span><span class="python_name">metadata </span><span class="python_operator">= </span><span class="python_name">BoundMetaData</span><span class="python_enclosure">(</span><span class="python_literal">'sqlite:///mydb.db'</span><span class="python_operator">, </span><span class="python_name">strategy</span><span class="python_operator">=</span><span class="python_literal">'threadlocal'</span><span class="python_operator">, </span><span class="python_name">echo</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># a table to store users
</span><span class="python_name">users </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'users'</span><span class="python_operator">, </span><span class="python_name">metadata</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'user_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key </span><span class="python_operator">= </span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'user_name'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">40</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'password'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">80</span><span class="python_enclosure">))</span>
<span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># a table that stores mailing addresses associated with a specific user
</span><span class="python_name">addresses </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'addresses'</span><span class="python_operator">, </span><span class="python_name">metadata</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'address_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key </span><span class="python_operator">= </span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'user_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">ForeignKey</span><span class="python_enclosure">(</span><span class="python_literal">"users.user_id"</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'street'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">100</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'city'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">80</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'state'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">2</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'zip'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">10</span><span class="python_enclosure">))</span>
<span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># a table that stores keywords
</span><span class="python_name">keywords </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'keywords'</span><span class="python_operator">, </span><span class="python_name">metadata</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'keyword_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key </span><span class="python_operator">= </span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'name'</span><span class="python_operator">, </span><span class="python_name">VARCHAR</span><span class="python_enclosure">(</span><span class="python_number">50</span><span class="python_enclosure">))</span>
<span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># a table that associates keywords with users
</span><span class="python_name">userkeywords </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'userkeywords'</span><span class="python_operator">, </span><span class="python_name">metadata</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'user_id'</span><span class="python_operator">, </span><span class="python_name">INT</span><span class="python_operator">, </span><span class="python_name">ForeignKey</span><span class="python_enclosure">(</span><span class="python_literal">"users"</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'keyword_id'</span><span class="python_operator">, </span><span class="python_name">INT</span><span class="python_operator">, </span><span class="python_name">ForeignKey</span><span class="python_enclosure">(</span><span class="python_literal">"keywords"</span><span class="python_enclosure">))</span>
<span class="python_enclosure">)</span><span class="python_operator"></span></pre></div>



<A name="sql_select"></a>

<div class="subsection" style="margin-left:20px;">


<h3>Simple Select</h3>

    <div class="sectiontext">
    

<p>A select is done by constructing a <code>Select</code> object with the proper arguments, adding any extra arguments if desired, then calling its <code>execute()</code> method.
</p>


<div class="code">
    <div class="codetitle">Basic Select</div>
<pre><span class="python_keyword">from </span><span class="python_name">sqlalchemy </span><span class="python_keyword">import </span><span class="python_operator">*
</span>
<span class="python_comment"># use the select() function defined in the sql package
</span><span class="python_name">s </span><span class="python_operator">= </span><span class="python_name">select</span><span class="python_enclosure">([</span><span class="python_name">users</span><span class="python_enclosure">])</span><span class="python_operator">
</span>
<span class="python_comment"># or, call the select() method off of a Table object
</span><span class="python_name">s </span><span class="python_operator">= </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_comment"># then, call execute on the Select object:
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_4', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">result </span><span class="python_operator">= </span><span class="python_name">s</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_4_div" class="codepop" style="display:none;">SELECT users.user_id, users.user_name, users.password FROM users<br/>
  {}</div><pre><span class="python_comment"># the SQL text of any clause object can also be viewed via the str() call:
</span><span class="python_literal">>>> </span><span class="python_name">str</span><span class="python_enclosure">(</span><span class="python_name">s</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">SELECT users</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">password FROM users</span><span class="python_operator"></span></pre></div>



<A name="sql_select_explicit"></a>

<div class="subsection" style="margin-left:30px;">


<h3>Explicit Execution</h3>

    <div class="sectiontext">
    

<p>As mentioned above, <code>ClauseElement</code> structures can also be executed with a <code>Connection</code> object explicitly:
</p>


<div class="code">
<pre><span class="python_name">engine </span><span class="python_operator">= </span><span class="python_name">create_engine</span><span class="python_enclosure">(</span><span class="python_literal">'sqlite:///myfile.db'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">conn </span><span class="python_operator">= </span><span class="python_name">engine</span><span class="python_operator">.</span><span class="python_name">connect</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_name">s </span><span class="python_operator">= </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_5', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">result </span><span class="python_operator">= </span><span class="python_name">conn</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_name">s</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre><div id="popbox_5_div" class="codepop" style="display:none;">SELECT users.user_id, users.user_name, users.password FROM users<br/>
  {}</div><pre><span class="python_name">conn</span><span class="python_operator">.</span><span class="python_name">close</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre></div>


    </div>

    <a href="#sql" class="toclink">back to section top</a>
</div>




<A name="sql_select_binding"></a>

<div class="subsection" style="margin-left:30px;">


<h3>Binding ClauseElements to Engines</h3>

    <div class="sectiontext">
    

<p>For queries that don't contain any tables, <code>ClauseElement</code>s that represent a fully executeable statement support an <code>engine</code> keyword parameter which can bind the object to an <code>Engine</code>, thereby allowing implicit execution:
</p>


<div class="code">
<pre><span class="python_comment"># select a literal
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_6', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">select</span><span class="python_enclosure">([</span><span class="python_literal">"current_time"</span><span class="python_enclosure">]</span><span class="python_operator">, </span><span class="python_name">engine</span><span class="python_operator">=</span><span class="python_name">myengine</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_6_div" class="codepop" style="display:none;">SELECT current_time<br/>
  {}</div><pre><span class="python_comment"># select a function
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_7', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">select</span><span class="python_enclosure">([</span><span class="python_name">func</span><span class="python_operator">.</span><span class="python_name">now</span><span class="python_enclosure">()]</span><span class="python_operator">, </span><span class="python_name">engine</span><span class="python_operator">=</span><span class="python_name">db</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_7_div" class="codepop" style="display:none;">SELECT now()<br/>
  {}</div><pre><span class="python_operator"></span></pre></div>


    </div>

    <a href="#sql" class="toclink">back to section top</a>
</div>




<A name="sql_select_resultproxy"></a>

<div class="subsection" style="margin-left:30px;">


<h3>Getting Results</h3>

    <div class="sectiontext">
    

<p>The object returned by <code>execute()</code> is a <code>sqlalchemy.engine.ResultProxy</code> object, which acts much like a DBAPI <code>cursor</code> object in the context of a result set, except that the rows returned can address their columns by ordinal position, column name, or even column object:
</p>


<div class="code">
    <div class="codetitle">Using the ResultProxy</div>
<pre><span class="python_comment"># select rows, get resulting ResultProxy object
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_8', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">result </span><span class="python_operator">= </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">()</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_8_div" class="codepop" style="display:none;">SELECT users.user_id, users.user_name, users.password FROM users<br/>
  {}</div><pre><span class="python_comment"># get one row
</span><span class="python_name">row </span><span class="python_operator">= </span><span class="python_name">result</span><span class="python_operator">.</span><span class="python_name">fetchone</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_comment"># get the 'user_id' column via integer index:
</span><span class="python_name">user_id </span><span class="python_operator">= </span><span class="python_name">row</span><span class="python_enclosure">[</span><span class="python_number">0</span><span class="python_enclosure">]</span><span class="python_operator">
</span>
<span class="python_comment"># or column name
</span><span class="python_name">user_name </span><span class="python_operator">= </span><span class="python_name">row</span><span class="python_enclosure">[</span><span class="python_literal">'user_name'</span><span class="python_enclosure">]</span><span class="python_operator">
</span>
<span class="python_comment"># or column object
</span><span class="python_name">password </span><span class="python_operator">= </span><span class="python_name">row</span><span class="python_enclosure">[</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">password</span><span class="python_enclosure">]</span><span class="python_operator">
</span>
<span class="python_comment"># or column accessor
</span><span class="python_name">password </span><span class="python_operator">= </span><span class="python_name">row</span><span class="python_operator">.</span><span class="python_name">password</span><span class="python_operator">
</span>
<span class="python_comment"># ResultProxy object also supports fetchall()
</span><span class="python_name">rows </span><span class="python_operator">= </span><span class="python_name">result</span><span class="python_operator">.</span><span class="python_name">fetchall</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_comment"># or get the underlying DBAPI cursor object
</span><span class="python_name">cursor </span><span class="python_operator">= </span><span class="python_name">result</span><span class="python_operator">.</span><span class="python_name">cursor</span><span class="python_operator">
</span>
<span class="python_comment"># close the result.  If the statement was implicitly executed 
# (i.e. without an explicit Connection), this will
# return the underlying connection resources back to 
# the connection pool.  de-referencing the result
# will also have the same effect.  if an explicit Connection was 
# used, then close() just closes the underlying cursor object.
</span><span class="python_name">result</span><span class="python_operator">.</span><span class="python_name">close</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre></div>


    </div>

    <a href="#sql" class="toclink">back to section top</a>
</div>




<A name="sql_select_labels"></a>

<div class="subsection" style="margin-left:30px;">


<h3>Using Column Labels</h3>

    <div class="sectiontext">
    

<p>A common need when writing statements that reference multiple tables is to create labels for columns, thereby separating columns from different tables with the same name.  The Select construct supports automatic generation of column labels via the <code>use_labels=True</code> parameter:
</p>


<div class="code">
    <div class="codetitle">use_labels Flag</div>
<pre><span class="python_literal"><a href="javascript:togglePopbox('popbox_9', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">c </span><span class="python_operator">= </span><span class="python_name">select</span><span class="python_enclosure">([</span><span class="python_name">users</span><span class="python_operator">, </span><span class="python_name">addresses</span><span class="python_enclosure">]</span><span class="python_operator">, </span>
<span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">==</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">address_id</span><span class="python_operator">, </span>
<span class="python_name">use_labels</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_9_div" class="codepop" style="display:none;">SELECT users.user_id AS users_user_id, users.user_name AS users_user_name, <br/>
  users.password AS users_password, addresses.address_id AS addresses_address_id, <br/>
  addresses.user_id AS addresses_user_id, addresses.street AS addresses_street, <br/>
  addresses.city AS addresses_city, addresses.state AS addresses_state, <br/>
  addresses.zip AS addresses_zip<br/>
  FROM users, addresses<br/>
  WHERE users.user_id = addresses.address_id<br/>
  {}</div><pre><span class="python_operator"></span></pre></div>
<p>The table name part of the label is affected if you use a construct such as a table alias:
</p>


<div class="code">
    <div class="codetitle">use_labels with an Alias</div>
<pre><span class="python_name">person </span><span class="python_operator">= </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">alias</span><span class="python_enclosure">(</span><span class="python_literal">'person'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_10', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">c </span><span class="python_operator">= </span><span class="python_name">select</span><span class="python_enclosure">([</span><span class="python_name">person</span><span class="python_operator">, </span><span class="python_name">addresses</span><span class="python_enclosure">]</span><span class="python_operator">, </span>
    <span class="python_name">person</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">==</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">address_id</span><span class="python_operator">, </span>
    <span class="python_name">use_labels</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_10_div" class="codepop" style="display:none;">SELECT person.user_id AS person_user_id, person.user_name AS person_user_name, <br/>
  person.password AS person_password, addresses.address_id AS addresses_address_id,<br/>
   addresses.user_id AS addresses_user_id, addresses.street AS addresses_street, <br/>
   addresses.city AS addresses_city, addresses.state AS addresses_state, <br/>
   addresses.zip AS addresses_zip FROM users AS person, addresses<br/>
  WHERE person.user_id = addresses.address_id</div><pre><span class="python_operator"></span></pre></div>
<p>Labels are also generated in such a way as to never go beyond 30 characters.  Most databases support a limit on the length of symbols, such as Postgres, and particularly Oracle which has a rather short limit of 30:
</p>


<div class="code">
    <div class="codetitle">use_labels Generates Abbreviated Labels</div>
<pre><span class="python_name">long_named_table </span><span class="python_operator">= </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">alias</span><span class="python_enclosure">(</span><span class="python_literal">'this_is_the_person_table'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_11', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">c </span><span class="python_operator">= </span><span class="python_name">select</span><span class="python_enclosure">([</span><span class="python_name">person</span><span class="python_enclosure">]</span><span class="python_operator">, </span><span class="python_name">use_labels</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_11_div" class="codepop" style="display:none;">SELECT this_is_the_person_table.user_id AS this_is_the_person_table_b36c, <br/>
  this_is_the_person_table.user_name AS this_is_the_person_table_f76a, <br/>
  this_is_the_person_table.password AS this_is_the_person_table_1e7c<br/>
  FROM users AS this_is_the_person_table<br/>
  {}</div><pre><span class="python_operator"></span></pre></div>
<p>You can also specify custom labels on a per-column basis using the <code>label()</code> function:
</p>


<div class="code">
    <div class="codetitle">label() Function on Column</div>
<pre><span class="python_literal"><a href="javascript:togglePopbox('popbox_12', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">c </span><span class="python_operator">= </span><span class="python_name">select</span><span class="python_enclosure">([</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">.</span><span class="python_name">label</span><span class="python_enclosure">(</span><span class="python_literal">'id'</span><span class="python_enclosure">)</span><span class="python_operator">, </span>
           <span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator">.</span><span class="python_name">label</span><span class="python_enclosure">(</span><span class="python_literal">'name'</span><span class="python_enclosure">)])</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_12_div" class="codepop" style="display:none;">SELECT users.user_id AS id, users.user_name AS name<br/>
  FROM users<br/>
  {}</div><pre><span class="python_operator"></span></pre></div>


    </div>

    <a href="#sql" class="toclink">back to section top</a>
</div>




<A name="sql_select_columns"></a>

<div class="subsection" style="margin-left:30px;">


<h3>Table/Column Specification</h3>

    <div class="sectiontext">
    

<p>Calling <code>select</code> off a table automatically generates a column clause which includes all the table's columns, in the order they are specified in the source Table object.
</p>
<p>But in addition to selecting all the columns off a single table, any set of columns can be specified, as well as full tables, and any combination of the two:
</p>


<div class="code">
    <div class="codetitle">Specify Columns to Select</div>
<pre><span class="python_comment"># individual columns
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_13', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">c </span><span class="python_operator">= </span><span class="python_name">select</span><span class="python_enclosure">([</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_enclosure">])</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_13_div" class="codepop" style="display:none;">SELECT users.user_id, users.user_name FROM users<br/>
  {}</div><pre><span class="python_comment"># full tables
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_14', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">c </span><span class="python_operator">= </span><span class="python_name">select</span><span class="python_enclosure">([</span><span class="python_name">users</span><span class="python_operator">, </span><span class="python_name">addresses</span><span class="python_enclosure">])</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_14_div" class="codepop" style="display:none;">SELECT users.user_id, users.user_name, users.password, <br/>
  addresses.address_id, addresses.user_id, <br/>
  addresses.street, addresses.city, addresses.state, addresses.zip<br/>
  FROM users, addresses<br/>
  {}</div><pre><span class="python_comment"># combinations
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_15', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">c </span><span class="python_operator">= </span><span class="python_name">select</span><span class="python_enclosure">([</span><span class="python_name">users</span><span class="python_operator">, </span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">zip</span><span class="python_enclosure">])</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_15_div" class="codepop" style="display:none;">SELECT users.user_id, users.user_name, users.password, <br/>
  addresses.zip FROM users, addresses<br/>
  {}</div><pre><span class="python_operator"></span></pre></div>


    </div>

</div>



    </div>

    <a href="#sql" class="toclink">back to section top</a>
</div>




<A name="sql_whereclause"></a>

<div class="subsection" style="margin-left:20px;">


<h3>WHERE Clause</h3>

    <div class="sectiontext">
    

<pre><code>
</code></pre><p>The WHERE condition is the named keyword argument <code>whereclause</code>, or the second positional argument to the <code>select()</code> constructor and the first positional argument to the <code>select()</code> method of <code>Table</code>.
</p>
<p>WHERE conditions are constructed using column objects, literal values, and functions defined in the <code>sqlalchemy.sql</code> module.  Column objects override the standard Python operators to provide clause compositional objects, which compile down to SQL operations:
</p>


<div class="code">
    <div class="codetitle">Basic WHERE Clause</div>
<pre><span class="python_literal"><a href="javascript:togglePopbox('popbox_16', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">c </span><span class="python_operator">= </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id </span><span class="python_operator">== </span><span class="python_number">7</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_16_div" class="codepop" style="display:none;">SELECT users.user_id, users.user_name, users.password, <br/>
  FROM users WHERE users.user_id = :users_user_id<br/>
  {'users_user_id': 7}</div><pre><span class="python_operator"></span></pre></div>
<p>Notice that the literal value "7" was broken out of the query and placed into a bind parameter.  Databases such as Oracle must parse incoming SQL and create a "plan" when new queries are received, which is an expensive process.  By using bind parameters, the same query with various literal values can have its plan compiled only once, and used repeatedly with less overhead.
</p>
<p>More where clauses:
</p>


<div class="code">
<pre><span class="python_comment"># another comparison operator
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_17', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">c </span><span class="python_operator">= </span><span class="python_name">select</span><span class="python_enclosure">([</span><span class="python_name">users</span><span class="python_enclosure">]</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">></span><span class="python_number">7</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_17_div" class="codepop" style="display:none;">SELECT users.user_id, users.user_name, users.password, <br/>
  FROM users WHERE users.user_id > :users_user_id<br/>
  {'users_user_id': 7}</div><pre><span class="python_comment"># OR keyword
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_18', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">c </span><span class="python_operator">= </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">or_</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator">==</span><span class="python_literal">'jack'</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator">==</span><span class="python_literal">'ed'</span><span class="python_enclosure">))</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_18_div" class="codepop" style="display:none;">SELECT users.user_id, users.user_name, users.password <br/>
  FROM users WHERE users.user_name = :users_user_name <br/>
  OR users.user_name = :users_user_name_1<br/>
  {'users_user_name_1': 'ed', 'users_user_name': 'jack'}</div><pre><span class="python_comment"># AND keyword
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_19', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">c </span><span class="python_operator">= </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">and_</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator">==</span><span class="python_literal">'jack'</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">password</span><span class="python_operator">==</span><span class="python_literal">'dog'</span><span class="python_enclosure">))</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_19_div" class="codepop" style="display:none;">SELECT users.user_id, users.user_name, users.password<br/>
  FROM users WHERE users.user_name = :users_user_name <br/>
  AND users.password = :users_password<br/>
  {'users_user_name': 'jack', 'users_password': 'dog'}</div><pre><span class="python_comment"># NOT keyword
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_20', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">c </span><span class="python_operator">= </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">not_</span><span class="python_enclosure">(</span>
        <span class="python_name">or_</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator">==</span><span class="python_literal">'jack'</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">password</span><span class="python_operator">==</span><span class="python_literal">'dog'</span><span class="python_enclosure">)</span>
    <span class="python_enclosure">))</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_20_div" class="codepop" style="display:none;">SELECT users.user_id, users.user_name, users.password <br/>
  FROM users <br/>
  WHERE NOT (users.user_name = :users_user_name <br/>
      OR users.password = :users_password)<br/>
  {'users_user_name': 'jack', 'users_password': 'dog'}</div><pre><span class="python_comment"># IN clause
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_21', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">c </span><span class="python_operator">= </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator">.</span><span class="python_name">in_</span><span class="python_enclosure">(</span><span class="python_literal">'jack'</span><span class="python_operator">, </span><span class="python_literal">'ed'</span><span class="python_operator">, </span><span class="python_literal">'fred'</span><span class="python_enclosure">))</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_21_div" class="codepop" style="display:none;">SELECT users.user_id, users.user_name, users.password<br/>
  FROM users WHERE users.user_name <br/>
  IN (:users_user_name, :users_user_name_1, :users_user_name_2)<br/>
  {'users_user_name': 'jack', 'users_user_name_1': 'ed', <br/>
  'users_user_name_2': 'fred'}</div><pre><span class="python_comment"># join users and addresses together
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_22', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">c </span><span class="python_operator">= </span><span class="python_name">select</span><span class="python_enclosure">([</span><span class="python_name">users</span><span class="python_operator">, </span><span class="python_name">addresses</span><span class="python_enclosure">]</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">==</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">address_id</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_22_div" class="codepop" style="display:none;">SELECT users.user_id, users.user_name, users.password,  <br/>
  addresses.address_id, addresses.user_id, addresses.street, addresses.city, <br/>
  addresses.state, addresses.zip<br/>
  FROM users, addresses<br/>
  WHERE users.user_id = addresses.address_id<br/>
  {}</div><pre><span class="python_comment"># join users and addresses together, but dont specify "addresses" in the 
# selection criterion.  The WHERE criterion adds it to the FROM list 
# automatically.
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_23', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">c </span><span class="python_operator">= </span><span class="python_name">select</span><span class="python_enclosure">([</span><span class="python_name">users</span><span class="python_enclosure">]</span><span class="python_operator">, </span><span class="python_name">and_</span><span class="python_enclosure">(</span>
                <span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">==</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">,</span>
                <span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator">==</span><span class="python_literal">'fred'</span>
            <span class="python_enclosure">))</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_23_div" class="codepop" style="display:none;">SELECT users.user_id, users.user_name, users.password<br/>
  FROM users, addresses WHERE users.user_id = addresses.user_id <br/>
  AND users.user_name = :users_user_name<br/>
  {'users_user_name': 'fred'}</div><pre><span class="python_operator"></span></pre></div>
<p>Select statements can also generate a WHERE clause based on the parameters you give it.  If a given parameter, which matches the name of a column or its "label" (the combined tablename + "_" + column name), and does not already correspond to a bind parameter in the select object, it will be added as a comparison against that column.  This is a shortcut to creating a full WHERE clause:
</p>


<div class="code">
<pre><span class="python_comment"># specify a match for the "user_name" column
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_24', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">c </span><span class="python_operator">= </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">()</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_name">user_name</span><span class="python_operator">=</span><span class="python_literal">'ed'</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre><div id="popbox_24_div" class="codepop" style="display:none;">SELECT users.user_id, users.user_name, users.password<br/>
  FROM users WHERE users.user_name = :users_user_name<br/>
  {'users_user_name': 'ed'}</div><pre><span class="python_comment"># specify a full where clause for the "user_name" column, as well as a
# comparison for the "user_id" column
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_25', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">c </span><span class="python_operator">= </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator">==</span><span class="python_literal">'ed'</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_name">user_id</span><span class="python_operator">=</span><span class="python_number">10</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre><div id="popbox_25_div" class="codepop" style="display:none;">SELECT users.user_id, users.user_name, users.password<br/>
  FROM users WHERE users.user_name = :users_user_name AND users.user_id = :users_user_id<br/>
  {'users_user_name': 'ed', 'users_user_id': 10}</div><pre><span class="python_operator"></span></pre></div>



<A name="sql_whereclause_operators"></a>

<div class="subsection" style="margin-left:30px;">


<h3>Operators</h3>

    <div class="sectiontext">
    

<p>Supported column operators so far are all the numerical comparison operators, i.e. '==', '>', '>=', etc., as well as <code>like()</code>, <code>startswith()</code>, <code>endswith()</code>, <code>between()</code>, and <code>in()</code>.  Boolean operators include <code>not_()</code>, <code>and_()</code> and <code>or_()</code>, which also can be used inline via '~', '&', and '|'.  Math operators are '+', '-', '*', '/'.  Any custom operator can be specified via the <code>op()</code> function shown below.
</p>


<div class="code">
<pre><span class="python_comment"># "like" operator
</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator">.</span><span class="python_name">like</span><span class="python_enclosure">(</span><span class="python_literal">'%ter'</span><span class="python_enclosure">))</span><span class="python_operator">
</span>
<span class="python_comment"># equality operator
</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name </span><span class="python_operator">== </span><span class="python_literal">'jane'</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># in opertator
</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">.</span><span class="python_name">in_</span><span class="python_enclosure">(</span><span class="python_number">1</span><span class="python_operator">,</span><span class="python_number">2</span><span class="python_operator">,</span><span class="python_number">3</span><span class="python_enclosure">))</span><span class="python_operator">
</span>
<span class="python_comment"># and_, endswith, equality operators
</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">and_</span><span class="python_enclosure">(</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">street</span><span class="python_operator">.</span><span class="python_name">endswith</span><span class="python_enclosure">(</span><span class="python_literal">'green street'</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
                <span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">zip</span><span class="python_operator">==</span><span class="python_literal">'11234'</span><span class="python_enclosure">))</span><span class="python_operator">
</span>
<span class="python_comment"># & operator subsituting for 'and_'
</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">street</span><span class="python_operator">.</span><span class="python_name">endswith</span><span class="python_enclosure">(</span><span class="python_literal">'green street'</span><span class="python_enclosure">) </span><span class="python_operator">& </span><span class="python_enclosure">(</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">zip</span><span class="python_operator">==</span><span class="python_literal">'11234'</span><span class="python_enclosure">))</span><span class="python_operator">
</span>
<span class="python_comment"># + concatenation operator
</span><span class="python_name">select</span><span class="python_enclosure">([</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name </span><span class="python_operator">+ </span><span class="python_literal">'_name'</span><span class="python_enclosure">])</span><span class="python_operator">
</span>
<span class="python_comment"># NOT operator
</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_operator">~</span><span class="python_enclosure">(</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">street </span><span class="python_operator">== </span><span class="python_literal">'Green Street'</span><span class="python_enclosure">))</span><span class="python_operator">
</span>
<span class="python_comment"># any custom operator
</span><span class="python_name">select</span><span class="python_enclosure">([</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator">.</span><span class="python_name">op</span><span class="python_enclosure">(</span><span class="python_literal">'||'</span><span class="python_enclosure">)(</span><span class="python_literal">'_category'</span><span class="python_enclosure">)])</span><span class="python_operator">
</span>
<span class="python_comment"># "null" comparison via == (converts to IS)
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_26', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator">==</span><span class="python_name">None</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_26_div" class="codepop" style="display:none;">SELECT users.user_id, users.user_name, users.password <br/>
  FROM users <br/>
  WHERE users.user_name IS NULL</div><pre><span class="python_comment"># or via explicit null() construct
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_27', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator">==</span><span class="python_name">null</span><span class="python_enclosure">())</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_27_div" class="codepop" style="display:none;">SELECT users.user_id, users.user_name, users.password <br/>
  FROM users <br/>
  WHERE users.user_name IS NULL</div><pre><span class="python_operator"></span></pre></div>


    </div>

    <a href="#sql" class="toclink">back to section top</a>
</div>




<A name="sql_whereclause_functions"></a>

<div class="subsection" style="margin-left:30px;">


<h3>Functions</h3>

    <div class="sectiontext">
    

<p>Functions can be specified using the <code>func</code> keyword:
</p>


<div class="code">
<pre><span class="python_literal"><a href="javascript:togglePopbox('popbox_28', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">select</span><span class="python_enclosure">([</span><span class="python_name">func</span><span class="python_operator">.</span><span class="python_name">count</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_enclosure">)])</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_28_div" class="codepop" style="display:none;">SELECT count(users.user_id) FROM users</div><pre><span class="python_literal"><a href="javascript:togglePopbox('popbox_29', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">func</span><span class="python_operator">.</span><span class="python_name">substr</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator">, </span><span class="python_number">1</span><span class="python_enclosure">) </span><span class="python_operator">== </span><span class="python_literal">'J'</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_29_div" class="codepop" style="display:none;">SELECT users.user_id, users.user_name, users.password FROM users <br/>
  WHERE substr(users.user_name, :substr) = :substr_1<br/>
  {'substr_1': 'J', 'substr': 1}</div><pre><span class="python_operator"></span></pre></div>
<p>Functions also are callable as standalone values:
</p>


<div class="sliding_code">
<pre><span class="python_comment"># call the "now()" function
</span><span class="python_name">time </span><span class="python_operator">= </span><span class="python_name">func</span><span class="python_operator">.</span><span class="python_name">now</span><span class="python_enclosure">(</span><span class="python_name">engine</span><span class="python_operator">=</span><span class="python_name">myengine</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">scalar</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_comment"># call myfunc(1,2,3)
</span><span class="python_name">myvalue </span><span class="python_operator">= </span><span class="python_name">func</span><span class="python_operator">.</span><span class="python_name">myfunc</span><span class="python_enclosure">(</span><span class="python_number">1</span><span class="python_operator">, </span><span class="python_number">2</span><span class="python_operator">, </span><span class="python_number">3</span><span class="python_operator">, </span><span class="python_name">engine</span><span class="python_operator">=</span><span class="python_name">db</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_comment"># or call them off the engine
</span><span class="python_name">db</span><span class="python_operator">.</span><span class="python_name">func</span><span class="python_operator">.</span><span class="python_name">now</span><span class="python_enclosure">()</span><span class="python_operator">.</span><span class="python_name">scalar</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre></div>


    </div>

    <a href="#sql" class="toclink">back to section top</a>
</div>




<A name="sql_whereclause_literals"></a>

<div class="subsection" style="margin-left:30px;">


<h3>Literals</h3>

    <div class="sectiontext">
    

<p>You can drop in a literal value anywhere there isnt a column to attach to via the <code>literal</code> keyword:
</p>


<div class="code">
<pre><span class="python_literal"><a href="javascript:togglePopbox('popbox_30', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">select</span><span class="python_enclosure">([</span><span class="python_name">literal</span><span class="python_enclosure">(</span><span class="python_literal">'foo'</span><span class="python_enclosure">) </span><span class="python_operator">+ </span><span class="python_name">literal</span><span class="python_enclosure">(</span><span class="python_literal">'bar'</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_enclosure">])</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_30_div" class="codepop" style="display:none;">SELECT :literal + :literal_1, users.user_name <br/>
  FROM users<br/>
  {'literal_1': 'bar', 'literal': 'foo'}</div><pre><span class="python_comment"># literals have all the same comparison functions as columns
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_31', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">select</span><span class="python_enclosure">([</span><span class="python_name">literal</span><span class="python_enclosure">(</span><span class="python_literal">'foo'</span><span class="python_enclosure">) </span><span class="python_operator">== </span><span class="python_name">literal</span><span class="python_enclosure">(</span><span class="python_literal">'bar'</span><span class="python_enclosure">)]</span><span class="python_operator">, </span><span class="python_name">engine</span><span class="python_operator">=</span><span class="python_name">myengine</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">scalar</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_31_div" class="codepop" style="display:none;">SELECT :literal = :literal_1<br/>
  {'literal_1': 'bar', 'literal': 'foo'}</div><pre><span class="python_operator"></span></pre></div>
<p>Literals also take an optional <code>type</code> parameter to give literals a type.  This can sometimes be significant, for example when using the "+" operator with SQLite, the String type is detected and the operator is converted to "||":
</p>


<div class="code">
<pre><span class="python_literal"><a href="javascript:togglePopbox('popbox_32', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">select</span><span class="python_enclosure">([</span><span class="python_name">literal</span><span class="python_enclosure">(</span><span class="python_literal">'foo'</span><span class="python_operator">, </span><span class="python_name">type</span><span class="python_operator">=</span><span class="python_name">String</span><span class="python_enclosure">) </span><span class="python_operator">+ </span><span class="python_literal">'bar'</span><span class="python_enclosure">]</span><span class="python_operator">, </span><span class="python_name">engine</span><span class="python_operator">=</span><span class="python_name">e</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_32_div" class="codepop" style="display:none;">SELECT ? || ?<br/>
  ['foo', 'bar']</div><pre><span class="python_operator"></span></pre></div>


    </div>

    <a href="#sql" class="toclink">back to section top</a>
</div>




<A name="sql_whereclause_orderby"></a>

<div class="subsection" style="margin-left:30px;">


<h3>Order By</h3>

    <div class="sectiontext">
    

<p>The ORDER BY clause of a select statement can be specified as individual columns to order by within an array specified via the <code>order_by</code> parameter, and optional usage of the asc() and desc() functions:
</p>


<div class="code">
<pre><span class="python_comment"># straight order by
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_33', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">c </span><span class="python_operator">= </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">order_by</span><span class="python_operator">=</span><span class="python_enclosure">[</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_enclosure">])</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_33_div" class="codepop" style="display:none;">SELECT users.user_id, users.user_name, users.password<br/>
  FROM users ORDER BY users.user_name</div><pre><span class="python_comment"># descending/ascending order by on multiple columns
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_34', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">c </span><span class="python_operator">= </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span>
    <span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator">></span><span class="python_literal">'J'</span><span class="python_operator">, </span>
    <span class="python_name">order_by</span><span class="python_operator">=</span><span class="python_enclosure">[</span><span class="python_name">desc</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">asc</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_enclosure">)])</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_34_div" class="codepop" style="display:none;">SELECT users.user_id, users.user_name, users.password<br/>
  FROM users WHERE users.user_name > :users_user_name <br/>
  ORDER BY users.user_id DESC, users.user_name ASC<br/>
  {'users_user_name':'J'}</div><pre><span class="python_operator"></span></pre></div>


    </div>

    <a href="#sql" class="toclink">back to section top</a>
</div>




<A name="sql_whereclause_options"></a>

<div class="subsection" style="margin-left:30px;">


<h3>DISTINCT, LIMIT and OFFSET</h3>

    <div class="sectiontext">
    

<p>These are specified as keyword arguments:
</p>


<div class="code">
<pre><span class="python_literal"><a href="javascript:togglePopbox('popbox_35', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">c </span><span class="python_operator">= </span><span class="python_name">select</span><span class="python_enclosure">([</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_enclosure">]</span><span class="python_operator">, </span><span class="python_name">distinct</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_35_div" class="codepop" style="display:none;">SELECT DISTINCT users.user_name FROM users</div><pre><span class="python_literal"><a href="javascript:togglePopbox('popbox_36', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">c </span><span class="python_operator">= </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">limit</span><span class="python_operator">=</span><span class="python_number">10</span><span class="python_operator">, </span><span class="python_name">offset</span><span class="python_operator">=</span><span class="python_number">20</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_36_div" class="codepop" style="display:none;">SELECT users.user_id, users.user_name, users.password FROM users LIMIT 10 OFFSET 20</div><pre><span class="python_operator"></span></pre></div>
<p>The Oracle driver does not support LIMIT and OFFSET directly, but instead wraps the generated query into a subquery and uses the "rownum" variable to control the rows selected (this is somewhat experimental).
</p>


    </div>

</div>



    </div>

    <a href="#sql" class="toclink">back to section top</a>
</div>




<A name="sql_join"></a>

<div class="subsection" style="margin-left:20px;">


<h3>Inner and Outer Joins</h3>

    <div class="sectiontext">
    

<p>As some of the examples indicated above, a regular inner join can be implicitly stated, just like in a SQL expression, by just specifying the tables to be joined as well as their join conditions:
</p>


<div class="code">
<pre><span class="python_literal"><a href="javascript:togglePopbox('popbox_37', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">==</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_37_div" class="codepop" style="display:none;">SELECT addresses.address_id, addresses.user_id, addresses.street, <br/>
  addresses.city, addresses.state, addresses.zip FROM addresses, users<br/>
  WHERE addresses.user_id = users.user_id<br/>
  {}</div><pre><span class="python_operator"></span></pre></div>
<p>There is also an explicit join constructor, which can be embedded into a select query via the <code>from_obj</code> parameter of the select statement:
</p>


<div class="code">
<pre><span class="python_literal"><a href="javascript:togglePopbox('popbox_38', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">from_obj</span><span class="python_operator">=</span><span class="python_enclosure">[</span>
    <span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">join</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">, </span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">==</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_enclosure">)</span>
<span class="python_enclosure">])</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_38_div" class="codepop" style="display:none;">SELECT addresses.address_id, addresses.user_id, addresses.street, addresses.city, <br/>
  addresses.state, addresses.zip <br/>
  FROM addresses JOIN users ON addresses.user_id = users.user_id<br/>
  {}</div><pre><span class="python_operator"></span></pre></div>
<p>The join constructor can also be used by itself:
</p>


<div class="code">
<pre><span class="python_literal"><a href="javascript:togglePopbox('popbox_39', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">join</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">, </span><span class="python_name">addresses</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">==</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">()</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_39_div" class="codepop" style="display:none;">SELECT users.user_id, users.user_name, users.password, <br/>
  addresses.address_id, addresses.user_id, addresses.street, addresses.city, <br/>
  addresses.state, addresses.zip <br/>
  FROM addresses JOIN users ON addresses.user_id = users.user_id<br/>
  {}</div><pre><span class="python_operator"></span></pre></div>
<p>The join criterion in a join() call is optional.  If not specified, the condition will be derived from the foreign key relationships of the two tables.  If no criterion can be constructed, an exception will be raised.
</p>


<div class="code">
<pre><span class="python_literal"><a href="javascript:togglePopbox('popbox_40', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">join</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">, </span><span class="python_name">addresses</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">()</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_40_div" class="codepop" style="display:none;">SELECT users.user_id, users.user_name, users.password, <br/>
  addresses.address_id, addresses.user_id, addresses.street, addresses.city, <br/>
  addresses.state, addresses.zip <br/>
  FROM addresses JOIN users ON addresses.user_id = users.user_id<br/>
  {}</div><pre><span class="python_operator"></span></pre></div>
<p>Notice that this is the first example where the FROM criterion of the select statement is explicitly specified.  In most cases, the FROM criterion is automatically determined from the columns requested as well as the WHERE clause.  The <code>from_obj</code> keyword argument indicates a list of explicit FROM clauses to be used in the statement.
</p>
<p>A join can be created on its own using the <code>join</code> or <code>outerjoin</code> functions, or can be created off of an existing Table or other selectable unit via the <code>join</code> or <code>outerjoin</code> methods:
</p>


<div class="code">
<pre><span class="python_literal"><a href="javascript:togglePopbox('popbox_41', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">outerjoin</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">, </span><span class="python_name">addresses</span><span class="python_operator">, </span>
           <span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">==</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">address_id</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">()</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_41_div" class="codepop" style="display:none;">SELECT users.user_id, users.user_name, users.password, addresses.address_id, <br/>
  addresses.user_id, addresses.street, addresses.city, addresses.state, addresses.zip<br/>
  FROM users LEFT OUTER JOIN addresses ON users.user_id = addresses.address_id<br/>
  {}</div><pre><span class="python_literal"><a href="javascript:togglePopbox('popbox_42', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">keywords</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">name</span><span class="python_operator">==</span><span class="python_literal">'running'</span><span class="python_operator">, </span><span class="python_name">from_obj</span><span class="python_operator">=</span><span class="python_enclosure">[</span>
        <span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">join</span><span class="python_enclosure">(</span>
            <span class="python_name">userkeywords</span><span class="python_operator">, </span><span class="python_name">userkeywords</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">==</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">join</span><span class="python_enclosure">(</span>
                <span class="python_name">keywords</span><span class="python_operator">, </span><span class="python_name">keywords</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">keyword_id</span><span class="python_operator">==</span><span class="python_name">userkeywords</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">keyword_id</span><span class="python_enclosure">)</span>
        <span class="python_enclosure">])</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_42_div" class="codepop" style="display:none;">SELECT users.user_id, users.user_name, users.password FROM users <br/>
  JOIN userkeywords ON userkeywords.user_id = users.user_id <br/>
  JOIN keywords ON keywords.keyword_id = userkeywords.keyword_id<br/>
  WHERE keywords.name = :keywords_name<br/>
  {'keywords_name': 'running'}</div><pre><span class="python_operator"></span></pre></div>


    </div>

    <a href="#sql" class="toclink">back to section top</a>
</div>




<A name="sql_alias"></a>

<div class="subsection" style="margin-left:20px;">


<h3>Table Aliases</h3>

    <div class="sectiontext">
    

<p>Aliases are used primarily when you want to use the same table more than once as a FROM expression in a statement:
</p>


<div class="code">
<pre><span class="python_name">address_b </span><span class="python_operator">= </span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">alias</span><span class="python_enclosure">(</span><span class="python_literal">'addressb'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_43', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_comment"># select users who have an address on Green street as well as Orange street</span><span class="python_operator">
</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">and_</span><span class="python_enclosure">(</span>
    <span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">==</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">,</span>
    <span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">street</span><span class="python_operator">.</span><span class="python_name">like</span><span class="python_enclosure">(</span><span class="python_literal">'%Green%'</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">==</span><span class="python_name">address_b</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">,</span>
    <span class="python_name">address_b</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">street</span><span class="python_operator">.</span><span class="python_name">like</span><span class="python_enclosure">(</span><span class="python_literal">'%Orange%'</span><span class="python_enclosure">)</span>
<span class="python_enclosure">))</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_43_div" class="codepop" style="display:none;">SELECT users.user_id, users.user_name, users.password<br/>
  FROM users, addresses, addresses AS addressb<br/>
  WHERE users.user_id = addresses.user_id <br/>
  AND addresses.street LIKE :addresses_street <br/>
  AND users.user_id = addressb.user_id <br/>
  AND addressb.street LIKE :addressb_street<br/>
  {'addressb_street': '%Orange%', 'addresses_street': '%Green%'}</div><pre><span class="python_operator"></span></pre></div>


    </div>

    <a href="#sql" class="toclink">back to section top</a>
</div>




<A name="sql_subqueries"></a>

<div class="subsection" style="margin-left:20px;">


<h3>Subqueries</h3>

    <div class="sectiontext">
    

<p>SQLAlchemy allows the creation of select statements from not just Table objects, but from a whole class of objects that implement the <code>Selectable</code> interface.  This includes Tables, Aliases, Joins and Selects.  Therefore, if you have a Select, you can select from the Select:
</p>


<div class="sliding_code">
<pre><span class="python_literal">>>> </span><span class="python_name">s </span><span class="python_operator">= </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_literal">>>> </span><span class="python_name">str</span><span class="python_enclosure">(</span><span class="python_name">s</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">SELECT users</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">password FROM users</span><span class="python_operator">
</span>
<span class="python_literal">>>> </span><span class="python_name">s </span><span class="python_operator">= </span><span class="python_name">s</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_literal">>>> </span><span class="python_name">str</span><span class="python_enclosure">(</span><span class="python_name">s</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">SELECT user_id</span><span class="python_operator">, </span><span class="python_name">user_name</span><span class="python_operator">, </span><span class="python_name">password</span><span class="python_operator">
</span><span class="python_name">FROM </span><span class="python_enclosure">(</span><span class="python_name">SELECT users</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">password FROM users</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre></div>
<p>Any Select, Join, or Alias object supports the same column accessors as a Table:
</p>


<div class="sliding_code">
<pre><span class="python_literal">>>> </span><span class="python_name">s </span><span class="python_operator">= </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_literal">>>> </span><span class="python_enclosure">[</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">key </span><span class="python_keyword">for </span><span class="python_name">c </span><span class="python_keyword">in </span><span class="python_name">s</span><span class="python_operator">.</span><span class="python_name">columns</span><span class="python_enclosure">]</span><span class="python_operator">
</span><span class="python_enclosure">[</span><span class="python_literal">'user_id'</span><span class="python_operator">, </span><span class="python_literal">'user_name'</span><span class="python_operator">, </span><span class="python_literal">'password'</span><span class="python_enclosure">]</span><span class="python_operator"></span></pre></div>
<p>When you use <code>use_labels=True</code> in a Select object, the label version of the column names become the keys of the accessible columns.  In effect you can create your own "view objects":
</p>


<div class="code">
<pre><span class="python_name">s </span><span class="python_operator">= </span><span class="python_name">select</span><span class="python_enclosure">([</span><span class="python_name">users</span><span class="python_operator">, </span><span class="python_name">addresses</span><span class="python_enclosure">]</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">==</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">, </span><span class="python_name">use_labels</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_44', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">select</span><span class="python_enclosure">([</span>
    <span class="python_name">s</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">users_user_name</span><span class="python_operator">, </span><span class="python_name">s</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">addresses_street</span><span class="python_operator">, </span><span class="python_name">s</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">addresses_zip</span>
<span class="python_enclosure">]</span><span class="python_operator">, </span><span class="python_name">s</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">addresses_city</span><span class="python_operator">==</span><span class="python_literal">'San Francisco'</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_44_div" class="codepop" style="display:none;">SELECT users_user_name, addresses_street, addresses_zip<br/>
  FROM (SELECT users.user_id AS users_user_id, users.user_name AS users_user_name,<br/>
  users.password AS users_password, addresses.address_id AS addresses_address_id,<br/>
  addresses.user_id AS addresses_user_id, addresses.street AS addresses_street, <br/>
  addresses.city AS addresses_city, addresses.state AS addresses_state, <br/>
  addresses.zip AS addresses_zip<br/>
  FROM users, addresses<br/>
  WHERE users.user_id = addresses.user_id)<br/>
  WHERE addresses_city = :addresses_city<br/>
  {'addresses_city': 'San Francisco'}</div><pre><span class="python_operator"></span></pre></div>
<p>To specify a SELECT statement as one of the selectable units in a FROM clause, it usually should be given an alias.
</p>


<div class="code">
<pre><span class="python_literal"><a href="javascript:togglePopbox('popbox_45', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">s </span><span class="python_operator">= </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">()</span><span class="python_operator">.</span><span class="python_name">alias</span><span class="python_enclosure">(</span><span class="python_literal">'u'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">select</span><span class="python_enclosure">([</span><span class="python_name">addresses</span><span class="python_operator">, </span><span class="python_name">s</span><span class="python_enclosure">])</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_45_div" class="codepop" style="display:none;">SELECT addresses.address_id, addresses.user_id, addresses.street, addresses.city, <br/>
  addresses.state, addresses.zip, u.user_id, u.user_name, u.password <br/>
  FROM addresses, <br/>
  (SELECT users.user_id, users.user_name, users.password FROM users) AS u<br/>
  {}</div><pre><span class="python_operator"></span></pre></div>
<p>Select objects can be used in a WHERE condition, in operators such as IN:
</p>


<div class="code">
<pre><span class="python_comment"># select user ids for all users whos name starts with a "p"
</span><span class="python_name">s </span><span class="python_operator">= </span><span class="python_name">select</span><span class="python_enclosure">([</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_enclosure">]</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator">.</span><span class="python_name">like</span><span class="python_enclosure">(</span><span class="python_literal">'p%'</span><span class="python_enclosure">))</span><span class="python_operator">
</span>
<span class="python_comment"># now select all addresses for those users
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_46', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">.</span><span class="python_name">in_</span><span class="python_enclosure">(</span><span class="python_name">s</span><span class="python_enclosure">))</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_46_div" class="codepop" style="display:none;">SELECT addresses.address_id, addresses.user_id, addresses.street, <br/>
  addresses.city, addresses.state, addresses.zip<br/>
  FROM addresses WHERE addresses.address_id IN <br/>
  (SELECT users.user_id FROM users WHERE users.user_name LIKE :users_user_name)<br/>
  {'users_user_name': 'p%'}</div><pre><span class="python_operator"></span></pre></div>
<p>The sql package supports embedding select statements into other select statements as the criterion in a WHERE condition, or as one of the "selectable" objects in the FROM list of the query.  It does not at the moment directly support embedding a SELECT statement as one of the column criterion for a statement, although this can be achieved via direct text insertion, described later.
</p>



<A name="sql_subqueries_scalar"></a>

<div class="subsection" style="margin-left:30px;">


<h3>Scalar Column Subqueries</h3>

    <div class="sectiontext">
    

<p>Subqueries can be used in the column clause of a select statement by specifying the <code>scalar=True</code> flag:
</p>


<div class="code">
<pre><span class="python_literal"><a href="javascript:togglePopbox('popbox_47', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">select</span><span class="python_enclosure">([</span><span class="python_name">table2</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">col1</span><span class="python_operator">, </span><span class="python_name">table2</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">col2</span><span class="python_operator">, </span>
                <span class="python_name">select</span><span class="python_enclosure">([</span><span class="python_name">table1</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">col1</span><span class="python_enclosure">]</span><span class="python_operator">, </span><span class="python_name">table1</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">col2</span><span class="python_operator">==</span><span class="python_number">7</span><span class="python_operator">, </span><span class="python_name">scalar</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)])</span><span class="python_operator"></span></pre><div id="popbox_47_div" class="codepop" style="display:none;">SELECT table2.col1, table2.col2, <br/>
  (SELECT table1.col1 AS col1 FROM table1 WHERE col2=:table1_col2) <br/>
  FROM table2<br/>
  {'table1_col2': 7}</div><pre><span class="python_operator"></span></pre></div>


    </div>

</div>



    </div>

    <a href="#sql" class="toclink">back to section top</a>
</div>




<A name="sql_correlated"></a>

<div class="subsection" style="margin-left:20px;">


<h3>Correlated Subqueries</h3>

    <div class="sectiontext">
    

<p>When a select object is embedded inside of another select object, and both objects reference the same table, SQLAlchemy makes the assumption that the table should be correlated from the child query to the parent query.  To disable this behavior, specify the flag <code>correlate=False</code> to the Select statement.
</p>


<div class="sliding_code">
<pre><span class="python_comment"># make an alias of a regular select.   
</span><span class="python_name">s </span><span class="python_operator">= </span><span class="python_name">select</span><span class="python_enclosure">([</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">street</span><span class="python_enclosure">]</span><span class="python_operator">, </span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">==</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">alias</span><span class="python_enclosure">(</span><span class="python_literal">'s'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_literal">>>> </span><span class="python_name">str</span><span class="python_enclosure">(</span><span class="python_name">s</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">SELECT addresses</span><span class="python_operator">.</span><span class="python_name">street FROM addresses</span><span class="python_operator">, </span><span class="python_name">users </span><span class="python_operator">
</span><span class="python_name">WHERE addresses</span><span class="python_operator">.</span><span class="python_name">user_id </span><span class="python_operator">= </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">
</span>
<span class="python_comment"># now embed that select into another one.  the "users" table is removed from
# the embedded query's FROM list and is instead correlated to the parent query
</span><span class="python_name">s2 </span><span class="python_operator">= </span><span class="python_name">select</span><span class="python_enclosure">([</span><span class="python_name">users</span><span class="python_operator">, </span><span class="python_name">s</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">street</span><span class="python_enclosure">])</span><span class="python_operator">
</span><span class="python_literal">>>> </span><span class="python_name">str</span><span class="python_enclosure">(</span><span class="python_name">s2</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">SELECT users</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">password</span><span class="python_operator">, </span><span class="python_name">s</span><span class="python_operator">.</span><span class="python_name">street</span><span class="python_operator">
</span><span class="python_name">FROM users</span><span class="python_operator">, </span><span class="python_enclosure">(</span><span class="python_name">SELECT addresses</span><span class="python_operator">.</span><span class="python_name">street FROM addresses</span>
<span class="python_name">WHERE addresses</span><span class="python_operator">.</span><span class="python_name">user_id </span><span class="python_operator">= </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_enclosure">) </span><span class="python_name">s</span><span class="python_operator"></span></pre></div>



<A name="sql_correlated_exists"></a>

<div class="subsection" style="margin-left:30px;">


<h3>EXISTS Clauses</h3>

    <div class="sectiontext">
    

<p>An EXISTS clause can function as a higher-scaling version of an IN clause, and is usually used in a correlated fashion:
</p>


<div class="code">
<pre><span class="python_comment"># find all users who have an address on Green street:
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_48', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span>
    <span class="python_name">exists</span><span class="python_enclosure">(</span>
        <span class="python_enclosure">[</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">address_id</span><span class="python_enclosure">]</span><span class="python_operator">, </span>
        <span class="python_name">and_</span><span class="python_enclosure">(</span>
            <span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">==</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">, </span>
            <span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">street</span><span class="python_operator">.</span><span class="python_name">like</span><span class="python_enclosure">(</span><span class="python_literal">'%Green%'</span><span class="python_enclosure">)</span>
        <span class="python_enclosure">)</span>
    <span class="python_enclosure">)</span>
<span class="python_enclosure">)</span><span class="python_operator"></span></pre><div id="popbox_48_div" class="codepop" style="display:none;">SELECT users.user_id, users.user_name, users.password <br/>
  FROM users WHERE EXISTS (SELECT addresses.address_id <br/>
  FROM addresses WHERE addresses.user_id = users.user_id <br/>
  AND addresses.street LIKE :addresses_street)<br/>
  {'addresses_street': '%Green%'}</div><pre><span class="python_operator"></span></pre></div>


    </div>

</div>



    </div>

    <a href="#sql" class="toclink">back to section top</a>
</div>




<A name="sql_unions"></a>

<div class="subsection" style="margin-left:20px;">


<h3>Unions</h3>

    <div class="sectiontext">
    

<p>Unions come in two flavors, UNION and UNION ALL, which are available via module level functions or methods off a Selectable:
</p>


<div class="code">
<pre><span class="python_literal"><a href="javascript:togglePopbox('popbox_49', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">union</span><span class="python_enclosure">(</span>
    <span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">street</span><span class="python_operator">==</span><span class="python_literal">'123 Green Street'</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">street</span><span class="python_operator">==</span><span class="python_literal">'44 Park Ave.'</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">street</span><span class="python_operator">==</span><span class="python_literal">'3 Mill Road'</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">order_by</span><span class="python_operator">=</span><span class="python_enclosure">[</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">street</span><span class="python_enclosure">]</span>
<span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_49_div" class="codepop" style="display:none;">SELECT addresses.address_id, addresses.user_id, addresses.street, <br/>
  addresses.city, addresses.state, addresses.zip <br/>
  FROM addresses WHERE addresses.street = :addresses_street <br/>
  UNION <br/>
  SELECT addresses.address_id, addresses.user_id, addresses.street, <br/>
  addresses.city, addresses.state, addresses.zip <br/>
  FROM addresses WHERE addresses.street = :addresses_street_1 <br/>
  UNION <br/>
  SELECT addresses.address_id, addresses.user_id, addresses.street, <br/>
  addresses.city, addresses.state, addresses.zip <br/>
  FROM addresses WHERE addresses.street = :addresses_street_2 <br/>
  ORDER BY addresses.street<br/>
  {'addresses_street_1': '44 Park Ave.', <br/>
  'addresses_street': '123 Green Street', <br/>
  'addresses_street_2': '3 Mill Road'}</div><pre><span class="python_literal"><a href="javascript:togglePopbox('popbox_50', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span>
    <span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">==</span><span class="python_number">7</span>
  <span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">union_all</span><span class="python_enclosure">(</span>
      <span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span>
          <span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">==</span><span class="python_number">9</span>
      <span class="python_enclosure">)</span><span class="python_operator">, </span>
      <span class="python_name">order_by</span><span class="python_operator">=</span><span class="python_enclosure">[</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_enclosure">]   </span><span class="python_comment"># order_by is an argument to union_all()</span>
  <span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_50_div" class="codepop" style="display:none;">SELECT users.user_id, users.user_name, users.password <br/>
  FROM users WHERE users.user_id = :users_user_id <br/>
  UNION ALL <br/>
  SELECT users.user_id, users.user_name, users.password <br/>
  FROM users WHERE users.user_id = :users_user_id_1 <br/>
  ORDER BY users.user_id<br/>
  {'users_user_id_1': 9, 'users_user_id': 7}</div><pre><span class="python_operator"></span></pre></div>


    </div>

    <a href="#sql" class="toclink">back to section top</a>
</div>




<A name="sql_bindparams"></a>

<div class="subsection" style="margin-left:20px;">


<h3>Custom Bind Parameters</h3>

    <div class="sectiontext">
    

<p>Throughout all these examples, SQLAlchemy is busy creating bind parameters wherever literal expressions occur.  You can also specify your own bind parameters with your own names, and use the same statement repeatedly.  The bind parameters, shown here in the "named" format, will be converted to the appropriate named or positional style according to the database implementation being used.
</p>


<div class="code">
    <div class="codetitle">Custom Bind Params</div>
<pre><span class="python_name">s </span><span class="python_operator">= </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator">==</span><span class="python_name">bindparam</span><span class="python_enclosure">(</span><span class="python_literal">'username'</span><span class="python_enclosure">))</span><span class="python_operator">
</span>
<span class="python_comment"># execute implicitly
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_51', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">s</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_name">username</span><span class="python_operator">=</span><span class="python_literal">'fred'</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre><div id="popbox_51_div" class="codepop" style="display:none;">SELECT users.user_id, users.user_name, users.password <br/>
  FROM users WHERE users.user_name = :username<br/>
  {'username': 'fred'}</div><pre><span class="python_comment"># execute explicitly
</span><span class="python_name">conn </span><span class="python_operator">= </span><span class="python_name">engine</span><span class="python_operator">.</span><span class="python_name">connect</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_52', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">conn</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_name">s</span><span class="python_operator">, </span><span class="python_name">username</span><span class="python_operator">=</span><span class="python_literal">'fred'</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre><div id="popbox_52_div" class="codepop" style="display:none;">SELECT users.user_id, users.user_name, users.password <br/>
  FROM users WHERE users.user_name = :username<br/>
  {'username': 'fred'}</div><pre><span class="python_operator"></span></pre></div>
<p><code>executemany()</code> is also available by supplying multiple dictionary arguments instead of keyword arguments to the <code>execute()</code> method of <code>ClauseElement</code> or <code>Connection</code>.  Examples can be found later in the sections on INSERT/UPDATE/DELETE.
</p>



<A name="sql_bindparams_precompiling"></a>

<div class="subsection" style="margin-left:30px;">


<h3>Precompiling a Query</h3>

    <div class="sectiontext">
    

<p>By throwing the <code>compile()</code> method onto the end of any query object, the query can be "compiled" by the SQLEngine into a <code>sqlalchemy.sql.Compiled</code> object just once, and the resulting compiled object reused, which eliminates repeated internal compilation of the SQL string:
</p>


<div class="sliding_code">
<pre><span class="python_name">s </span><span class="python_operator">= </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator">==</span><span class="python_name">bindparam</span><span class="python_enclosure">(</span><span class="python_literal">'username'</span><span class="python_enclosure">))</span><span class="python_operator">.</span><span class="python_name">compile</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_name">s</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_name">username</span><span class="python_operator">=</span><span class="python_literal">'fred'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">s</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_name">username</span><span class="python_operator">=</span><span class="python_literal">'jane'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">s</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_name">username</span><span class="python_operator">=</span><span class="python_literal">'mary'</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre></div>


    </div>

</div>



    </div>

    <a href="#sql" class="toclink">back to section top</a>
</div>




<A name="sql_textual"></a>

<div class="subsection" style="margin-left:20px;">


<h3>Literal Text Blocks</h3>

    <div class="sectiontext">
    

<p>The sql package tries to allow free textual placement in as many ways as possible.  In the examples below, note that the from_obj parameter is used only when no other information exists within the select object with which to determine table metadata.  Also note that in a query where there isnt even table metadata used, the SQLEngine to be used for the query has to be explicitly specified:
</p>


<div class="code">
<pre><span class="python_comment"># strings as column clauses
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_53', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">select</span><span class="python_enclosure">([</span><span class="python_literal">"user_id"</span><span class="python_operator">, </span><span class="python_literal">"user_name"</span><span class="python_enclosure">]</span><span class="python_operator">, </span><span class="python_name">from_obj</span><span class="python_operator">=</span><span class="python_enclosure">[</span><span class="python_name">users</span><span class="python_enclosure">])</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_53_div" class="codepop" style="display:none;">SELECT user_id, user_name FROM users<br/>
  {}</div><pre><span class="python_comment"># strings for full column lists
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_54', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">select</span><span class="python_enclosure">(</span>
        <span class="python_enclosure">[</span><span class="python_literal">"user_id, user_name, password, addresses.*"</span><span class="python_enclosure">]</span><span class="python_operator">, </span>
        <span class="python_name">from_obj</span><span class="python_operator">=</span><span class="python_enclosure">[</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">alias</span><span class="python_enclosure">(</span><span class="python_literal">'u'</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">addresses</span><span class="python_enclosure">])</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_54_div" class="codepop" style="display:none;">SELECT u.user_id, u.user_name, u.password, addresses.* <br/>
  FROM users AS u, addresses<br/>
  {}</div><pre><span class="python_comment"># functions, etc.
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_55', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">select</span><span class="python_enclosure">([</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">, </span><span class="python_literal">"process_string(user_name)"</span><span class="python_enclosure">])</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_55_div" class="codepop" style="display:none;">SELECT users.user_id, process_string(user_name) FROM users<br/>
  {}</div><pre><span class="python_comment"># where clauses
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_56', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">and_</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">==</span><span class="python_number">7</span><span class="python_operator">, </span><span class="python_literal">"process_string(user_name)=27"</span><span class="python_enclosure">))</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_56_div" class="codepop" style="display:none;">SELECT users.user_id, users.user_name, users.password FROM users <br/>
  WHERE users.user_id = :users_user_id AND process_string(user_name)=27<br/>
  {'users_user_id': 7}</div><pre><span class="python_comment"># subqueries
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_57', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span>
    <span class="python_literal">"exists (select 1 from addresses where addresses.user_id=users.user_id)"</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_57_div" class="codepop" style="display:none;">SELECT users.user_id, users.user_name, users.password FROM users <br/>
  WHERE exists (select 1 from addresses where addresses.user_id=users.user_id)<br/>
  {}</div><pre><span class="python_comment"># custom FROM objects
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_58', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">select</span><span class="python_enclosure">(</span>
        <span class="python_enclosure">[</span><span class="python_literal">"*"</span><span class="python_enclosure">]</span><span class="python_operator">, </span>
        <span class="python_name">from_obj</span><span class="python_operator">=</span><span class="python_enclosure">[</span><span class="python_literal">"(select user_id, user_name from users)"</span><span class="python_enclosure">]</span><span class="python_operator">, </span>
        <span class="python_name">engine</span><span class="python_operator">=</span><span class="python_name">db</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_58_div" class="codepop" style="display:none;">SELECT * FROM (select user_id, user_name from users)<br/>
  {}</div><pre><span class="python_comment"># a full query
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_59', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">text</span><span class="python_enclosure">(</span><span class="python_literal">"select user_name from users"</span><span class="python_operator">, </span><span class="python_name">engine</span><span class="python_operator">=</span><span class="python_name">db</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_59_div" class="codepop" style="display:none;">SELECT user_name FROM users<br/>
  {}</div><pre><span class="python_operator"></span></pre></div>



<A name="sql_textual_textual_binds"></a>

<div class="subsection" style="margin-left:30px;">


<h3>Using Bind Parameters in Text Blocks</h3>

    <div class="sectiontext">
    

<p>Use the format <code>':paramname'</code> to define bind parameters inside of a text block.  They will be converted to the appropriate format upon compilation:
</p>


<div class="sliding_code">
<pre><span class="python_name">t </span><span class="python_operator">= </span><span class="python_name">engine</span><span class="python_operator">.</span><span class="python_name">text</span><span class="python_enclosure">(</span><span class="python_literal">"select foo from mytable where lala=:hoho"</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">r </span><span class="python_operator">= </span><span class="python_name">t</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_name">hoho</span><span class="python_operator">=</span><span class="python_number">7</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre></div>
<p>Bind parameters can also be explicit, which allows typing information to be added.  Just specify them as a list with keys that match those inside the textual statement:
</p>


<div class="sliding_code">
<pre><span class="python_name">t </span><span class="python_operator">= </span><span class="python_name">engine</span><span class="python_operator">.</span><span class="python_name">text</span><span class="python_enclosure">(</span><span class="python_literal">"select foo from mytable where lala=:hoho"</span><span class="python_operator">, </span>
                <span class="python_name">bindparams</span><span class="python_operator">=</span><span class="python_enclosure">[</span><span class="python_name">bindparam</span><span class="python_enclosure">(</span><span class="python_literal">'hoho'</span><span class="python_operator">, </span><span class="python_name">type</span><span class="python_operator">=</span><span class="python_name">types</span><span class="python_operator">.</span><span class="python_name">String</span><span class="python_enclosure">)])</span><span class="python_operator">
    </span><span class="python_name">r </span><span class="python_operator">= </span><span class="python_name">t</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_name">hoho</span><span class="python_operator">=</span><span class="python_literal">"im hoho"</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre></div>
<p>Result-row type processing can be added via the <code>typemap</code> argument, which is a dictionary of return columns mapped to types:
</p>


<div class="sliding_code">
<pre><span class="python_comment"># specify DateTime type for the 'foo' column in the result set
# sqlite, for example, uses result-row post-processing to construct dates
</span><span class="python_name">t </span><span class="python_operator">= </span><span class="python_name">engine</span><span class="python_operator">.</span><span class="python_name">text</span><span class="python_enclosure">(</span><span class="python_literal">"select foo from mytable where lala=:hoho"</span><span class="python_operator">, </span>
        <span class="python_name">bindparams</span><span class="python_operator">=</span><span class="python_enclosure">[</span><span class="python_name">bindparam</span><span class="python_enclosure">(</span><span class="python_literal">'hoho'</span><span class="python_operator">, </span><span class="python_name">type</span><span class="python_operator">=</span><span class="python_name">types</span><span class="python_operator">.</span><span class="python_name">String</span><span class="python_enclosure">)]</span><span class="python_operator">,</span>
        <span class="python_name">typemap</span><span class="python_operator">=</span><span class="python_enclosure">{</span><span class="python_literal">'foo'</span><span class="python_operator">:</span><span class="python_name">types</span><span class="python_operator">.</span><span class="python_name">DateTime</span><span class="python_enclosure">}</span>
        <span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">r </span><span class="python_operator">= </span><span class="python_name">t</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_name">hoho</span><span class="python_operator">=</span><span class="python_literal">"im hoho"</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># 'foo' is a datetime
</span><span class="python_name">year </span><span class="python_operator">= </span><span class="python_name">r</span><span class="python_operator">.</span><span class="python_name">fetchone</span><span class="python_enclosure">()[</span><span class="python_literal">'foo'</span><span class="python_enclosure">]</span><span class="python_operator">.</span><span class="python_name">year</span><span class="python_operator"></span></pre></div>


    </div>

</div>



    </div>

    <a href="#sql" class="toclink">back to section top</a>
</div>




<A name="sql_building"></a>

<div class="subsection" style="margin-left:20px;">


<h3>Building Select Objects</h3>

    <div class="sectiontext">
    

<p>One of the primary motivations for a programmatic SQL library is to allow the piecemeal construction of a SQL statement based on program variables.  All the above examples typically show Select objects being created all at once.  The Select object also includes "builder" methods to allow building up an object.  The below example is a "user search" function, where users can be selected based on primary key, user name, street address, keywords, or any combination:
</p>


<div class="code">
<pre><span class="python_keyword">def </span><span class="python_name">find_users</span><span class="python_enclosure">(</span><span class="python_name">id</span><span class="python_operator">=</span><span class="python_name">None</span><span class="python_operator">, </span><span class="python_name">name</span><span class="python_operator">=</span><span class="python_name">None</span><span class="python_operator">, </span><span class="python_name">street</span><span class="python_operator">=</span><span class="python_name">None</span><span class="python_operator">, </span><span class="python_name">keywords</span><span class="python_operator">=</span><span class="python_name">None</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_name">statement </span><span class="python_operator">= </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">()</span><span class="python_operator">
    </span><span class="python_keyword">if </span><span class="python_name">id </span><span class="python_keyword">is not </span><span class="python_name">None</span><span class="python_operator">:
        </span><span class="python_name">statement</span><span class="python_operator">.</span><span class="python_name">append_whereclause</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">==</span><span class="python_name">id</span><span class="python_enclosure">)</span><span class="python_operator">
    </span><span class="python_keyword">if </span><span class="python_name">name </span><span class="python_keyword">is not </span><span class="python_name">None</span><span class="python_operator">:
        </span><span class="python_name">statement</span><span class="python_operator">.</span><span class="python_name">append_whereclause</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator">==</span><span class="python_name">name</span><span class="python_enclosure">)</span><span class="python_operator">
    </span><span class="python_keyword">if </span><span class="python_name">street </span><span class="python_keyword">is not </span><span class="python_name">None</span><span class="python_operator">:
        </span><span class="python_comment"># append_whereclause joins "WHERE" conditions together with AND
</span><span class="python_operator">        </span><span class="python_name">statement</span><span class="python_operator">.</span><span class="python_name">append_whereclause</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">==</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_enclosure">)</span><span class="python_operator">
        </span><span class="python_name">statement</span><span class="python_operator">.</span><span class="python_name">append_whereclause</span><span class="python_enclosure">(</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">street</span><span class="python_operator">==</span><span class="python_name">street</span><span class="python_enclosure">)</span><span class="python_operator">
    </span><span class="python_keyword">if </span><span class="python_name">keywords </span><span class="python_keyword">is not </span><span class="python_name">None</span><span class="python_operator">:
        </span><span class="python_name">statement</span><span class="python_operator">.</span><span class="python_name">append_from</span><span class="python_enclosure">(</span>
                <span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">join</span><span class="python_enclosure">(</span><span class="python_name">userkeywords</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">==</span><span class="python_name">userkeywords</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">join</span><span class="python_enclosure">(</span>
                        <span class="python_name">keywords</span><span class="python_operator">, </span><span class="python_name">userkeywords</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">keyword_id</span><span class="python_operator">==</span><span class="python_name">keywords</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">keyword_id</span><span class="python_enclosure">))</span><span class="python_operator">
        </span><span class="python_name">statement</span><span class="python_operator">.</span><span class="python_name">append_whereclause</span><span class="python_enclosure">(</span><span class="python_name">keywords</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">name</span><span class="python_operator">.</span><span class="python_name">in_</span><span class="python_enclosure">(</span><span class="python_name">keywords</span><span class="python_enclosure">))</span><span class="python_operator">
        </span><span class="python_comment"># to avoid multiple repeats, set query to be DISTINCT:
        </span><span class="python_name">statement</span><span class="python_operator">.</span><span class="python_name">distinct</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_operator">
    </span><span class="python_keyword">return </span><span class="python_name">statement</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_operator"></span><span class="python_literal"><a href="javascript:togglePopbox('popbox_60', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">find_users</span><span class="python_enclosure">(</span><span class="python_name">id</span><span class="python_operator">=</span><span class="python_number">7</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre><div id="popbox_60_div" class="codepop" style="display:none;">SELECT users.user_id, users.user_name, users.password <br/>
  FROM users <br/>
  WHERE users.user_id = :users_user_id<br/>
  {'users_user_id': 7}</div><pre><span class="python_literal"><a href="javascript:togglePopbox('popbox_61', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">find_users</span><span class="python_enclosure">(</span><span class="python_name">street</span><span class="python_operator">=</span><span class="python_literal">'123 Green Street'</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre><div id="popbox_61_div" class="codepop" style="display:none;">SELECT users.user_id, users.user_name, users.password <br/>
  FROM users, addresses <br/>
  WHERE users.user_id = addresses.user_id AND addresses.street = :addresses_street<br/>
  {'addresses_street': '123 Green Street'}</div><pre><span class="python_literal"><a href="javascript:togglePopbox('popbox_62', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">find_users</span><span class="python_enclosure">(</span><span class="python_name">name</span><span class="python_operator">=</span><span class="python_literal">'Jack'</span><span class="python_operator">, </span><span class="python_name">keywords</span><span class="python_operator">=</span><span class="python_enclosure">[</span><span class="python_literal">'jack'</span><span class="python_operator">,</span><span class="python_literal">'foo'</span><span class="python_enclosure">])</span><span class="python_operator"></span></pre><div id="popbox_62_div" class="codepop" style="display:none;">SELECT DISTINCT users.user_id, users.user_name, users.password <br/>
  FROM users JOIN userkeywords ON users.user_id = userkeywords.user_id <br/>
  JOIN keywords ON userkeywords.keyword_id = keywords.keyword_id <br/>
  WHERE users.user_name = :users_user_name AND keywords.name IN ('jack', 'foo')<br/>
  {'users_user_name': 'Jack'}</div><pre><span class="python_operator"></span></pre></div>


    </div>

    <a href="#sql" class="toclink">back to section top</a>
</div>




<A name="sql_insert"></a>

<div class="subsection" style="margin-left:20px;">


<h3>Inserts</h3>

    <div class="sectiontext">
    

<p>An INSERT involves just one table.  The Insert object is used via the insert() function, and the specified columns determine what columns show up in the generated SQL.  If primary key columns are left out of the criterion, the SQL generator will try to populate them as specified by the particular database engine and sequences, i.e. relying upon an auto-incremented column or explicitly calling a sequence beforehand.  Insert statements, as well as updates and deletes, can also execute multiple parameters in one pass via specifying an array of dictionaries as parameters.
</p>
<p>The values to be populated for an INSERT or an UPDATE can be specified to the insert()/update() functions as the <code>values</code> named argument, or the query will be compiled based on the values of the parameters sent to the execute() method.
</p>


<div class="code">
    <div class="codetitle">Using insert()</div>
<pre><span class="python_comment"># basic insert
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_63', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">insert</span><span class="python_enclosure">()</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_name">user_id</span><span class="python_operator">=</span><span class="python_number">1</span><span class="python_operator">, </span><span class="python_name">user_name</span><span class="python_operator">=</span><span class="python_literal">'jack'</span><span class="python_operator">, </span><span class="python_name">password</span><span class="python_operator">=</span><span class="python_literal">'asdfdaf'</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre><div id="popbox_63_div" class="codepop" style="display:none;">INSERT INTO users (user_id, user_name, password) <br/>
  VALUES (:user_id, :user_name, :password)<br/>
  {'user_name': 'jack', 'password': 'asdfdaf', 'user_id': 1}</div><pre><span class="python_comment"># insert just user_name, NULL for others
# will auto-populate primary key columns if they are configured
# to do so
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_64', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">insert</span><span class="python_enclosure">()</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_name">user_name</span><span class="python_operator">=</span><span class="python_literal">'ed'</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre><div id="popbox_64_div" class="codepop" style="display:none;">INSERT INTO users (user_name) VALUES (:user_name)<br/>
  {'user_name': 'ed'}</div><pre><span class="python_comment"># INSERT with a list:
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_65', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">insert</span><span class="python_enclosure">(</span><span class="python_name">values</span><span class="python_operator">=</span><span class="python_enclosure">(</span><span class="python_number">3</span><span class="python_operator">, </span><span class="python_literal">'jane'</span><span class="python_operator">, </span><span class="python_literal">'sdfadfas'</span><span class="python_enclosure">))</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_65_div" class="codepop" style="display:none;">INSERT INTO users (user_id, user_name, password) <br/>
  VALUES (:user_id, :user_name, :password)<br/>
  {'user_id': 3, 'password': 'sdfadfas', 'user_name': 'jane'}</div><pre><span class="python_comment"># INSERT with user-defined bind parameters
</span><span class="python_name">i </span><span class="python_operator">= </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">insert</span><span class="python_enclosure">(</span>
    <span class="python_name">values</span><span class="python_operator">=</span><span class="python_enclosure">{</span><span class="python_literal">'user_name'</span><span class="python_operator">:</span><span class="python_name">bindparam</span><span class="python_enclosure">(</span><span class="python_literal">'name'</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_literal">'password'</span><span class="python_operator">:</span><span class="python_name">bindparam</span><span class="python_enclosure">(</span><span class="python_literal">'pw'</span><span class="python_enclosure">)}</span>
    <span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_66', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">i</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_name">name</span><span class="python_operator">=</span><span class="python_literal">'mary'</span><span class="python_operator">, </span><span class="python_name">pw</span><span class="python_operator">=</span><span class="python_literal">'adas5fs'</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre><div id="popbox_66_div" class="codepop" style="display:none;">INSERT INTO users (user_name, password) VALUES (:name, :pw)<br/>
  {'name': 'mary', 'pw': 'adas5fs'}</div><pre><span class="python_comment"># INSERT many - if no explicit 'values' parameter is sent,
# the first parameter list in the list determines
# the generated SQL of the insert (i.e. what columns are present)
# executemany() is used at the DBAPI level
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_67', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">insert</span><span class="python_enclosure">()</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span>
    <span class="python_enclosure">{</span><span class="python_literal">'user_id'</span><span class="python_operator">:</span><span class="python_number">7</span><span class="python_operator">, </span><span class="python_literal">'user_name'</span><span class="python_operator">:</span><span class="python_literal">'jack'</span><span class="python_operator">, </span><span class="python_literal">'password'</span><span class="python_operator">:</span><span class="python_literal">'asdfasdf'</span><span class="python_enclosure">}</span><span class="python_operator">,</span>
    <span class="python_enclosure">{</span><span class="python_literal">'user_id'</span><span class="python_operator">:</span><span class="python_number">8</span><span class="python_operator">, </span><span class="python_literal">'user_name'</span><span class="python_operator">:</span><span class="python_literal">'ed'</span><span class="python_operator">, </span><span class="python_literal">'password'</span><span class="python_operator">:</span><span class="python_literal">'asdffcadf'</span><span class="python_enclosure">}</span><span class="python_operator">,</span>
    <span class="python_enclosure">{</span><span class="python_literal">'user_id'</span><span class="python_operator">:</span><span class="python_number">9</span><span class="python_operator">, </span><span class="python_literal">'user_name'</span><span class="python_operator">:</span><span class="python_literal">'fred'</span><span class="python_operator">, </span><span class="python_literal">'password'</span><span class="python_operator">:</span><span class="python_literal">'asttf'</span><span class="python_enclosure">}</span><span class="python_operator">,</span>
<span class="python_enclosure">)</span><span class="python_operator"></span></pre><div id="popbox_67_div" class="codepop" style="display:none;">INSERT INTO users (user_id, user_name, password) <br/>
  VALUES (:user_id, :user_name, :password)<br/>
  [{'user_name': 'jack', 'password': 'asdfasdf', 'user_id': 7}, <br/>
  {'user_name': 'ed', 'password': 'asdffcadf', 'user_id': 8}, <br/>
  {'user_name': 'fred', 'password': 'asttf', 'user_id': 9}]</div><pre><span class="python_operator"></span></pre></div>


    </div>

    <a href="#sql" class="toclink">back to section top</a>
</div>




<A name="sql_update"></a>

<div class="subsection" style="margin-left:20px;">


<h3>Updates</h3>

    <div class="sectiontext">
    

<p>Updates work a lot like INSERTS, except there is an additional WHERE clause that can be specified.
</p>


<div class="code">
    <div class="codetitle">Using update()</div>
<pre><span class="python_comment"># change 'jack' to 'ed'
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_68', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">update</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator">==</span><span class="python_literal">'jack'</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_name">user_name</span><span class="python_operator">=</span><span class="python_literal">'ed'</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre><div id="popbox_68_div" class="codepop" style="display:none;">UPDATE users SET user_name=:user_name WHERE users.user_name = :users_user_name<br/>
  {'users_user_name': 'jack', 'user_name': 'ed'}</div><pre><span class="python_comment"># use bind parameters
</span><span class="python_name">u </span><span class="python_operator">= </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">update</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator">==</span><span class="python_name">bindparam</span><span class="python_enclosure">(</span><span class="python_literal">'name'</span><span class="python_enclosure">)</span><span class="python_operator">, </span>
                <span class="python_name">values</span><span class="python_operator">=</span><span class="python_enclosure">{</span><span class="python_literal">'user_name'</span><span class="python_operator">:</span><span class="python_name">bindparam</span><span class="python_enclosure">(</span><span class="python_literal">'newname'</span><span class="python_enclosure">)})</span><span class="python_operator">
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_69', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">u</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_name">name</span><span class="python_operator">=</span><span class="python_literal">'jack'</span><span class="python_operator">, </span><span class="python_name">newname</span><span class="python_operator">=</span><span class="python_literal">'ed'</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre><div id="popbox_69_div" class="codepop" style="display:none;">UPDATE users SET user_name=:newname WHERE users.user_name = :name<br/>
  {'newname': 'ed', 'name': 'jack'}</div><pre><span class="python_comment"># update a column to another column
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_70', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">update</span><span class="python_enclosure">(</span><span class="python_name">values</span><span class="python_operator">=</span><span class="python_enclosure">{</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">password</span><span class="python_operator">:</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_enclosure">})</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_70_div" class="codepop" style="display:none;">UPDATE users SET password=users.user_name<br/>
  {}</div><pre><span class="python_comment"># multi-update
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_71', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">update</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">==</span><span class="python_name">bindparam</span><span class="python_enclosure">(</span><span class="python_literal">'id'</span><span class="python_enclosure">))</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span>
        <span class="python_enclosure">{</span><span class="python_literal">'id'</span><span class="python_operator">:</span><span class="python_number">7</span><span class="python_operator">, </span><span class="python_literal">'user_name'</span><span class="python_operator">:</span><span class="python_literal">'jack'</span><span class="python_operator">, </span><span class="python_literal">'password'</span><span class="python_operator">:</span><span class="python_literal">'fh5jks'</span><span class="python_enclosure">}</span><span class="python_operator">,</span>
        <span class="python_enclosure">{</span><span class="python_literal">'id'</span><span class="python_operator">:</span><span class="python_number">8</span><span class="python_operator">, </span><span class="python_literal">'user_name'</span><span class="python_operator">:</span><span class="python_literal">'ed'</span><span class="python_operator">, </span><span class="python_literal">'password'</span><span class="python_operator">:</span><span class="python_literal">'fsr234ks'</span><span class="python_enclosure">}</span><span class="python_operator">,</span>
        <span class="python_enclosure">{</span><span class="python_literal">'id'</span><span class="python_operator">:</span><span class="python_number">9</span><span class="python_operator">, </span><span class="python_literal">'user_name'</span><span class="python_operator">:</span><span class="python_literal">'mary'</span><span class="python_operator">, </span><span class="python_literal">'password'</span><span class="python_operator">:</span><span class="python_literal">'7h5jse'</span><span class="python_enclosure">}</span><span class="python_operator">,</span>
    <span class="python_enclosure">)</span><span class="python_operator"></span></pre><div id="popbox_71_div" class="codepop" style="display:none;">UPDATE users SET user_name=:user_name, password=:password WHERE users.user_id = :id<br/>
  [{'password': 'fh5jks', 'user_name': 'jack', 'id': 7}, <br/>
  {'password': 'fsr234ks', 'user_name': 'ed', 'id': 8}, <br/>
  {'password': '7h5jse', 'user_name': 'mary', 'id': 9}]</div><pre><span class="python_operator"></span></pre></div>



<A name="sql_update_correlated"></a>

<div class="subsection" style="margin-left:30px;">


<h3>Correlated Updates</h3>

    <div class="sectiontext">
    

<p>A correlated update lets you update a table using selection from another table, or the same table:
</p>


<div class="code">
<pre><span class="python_name">s </span><span class="python_operator">= </span><span class="python_name">select</span><span class="python_enclosure">([</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">city</span><span class="python_enclosure">]</span><span class="python_operator">, </span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">==</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_72', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">update</span><span class="python_enclosure">(</span>
    <span class="python_name">and_</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">></span><span class="python_number">10</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator"><</span><span class="python_number">20</span><span class="python_enclosure">)</span><span class="python_operator">, </span>
    <span class="python_name">values</span><span class="python_operator">=</span><span class="python_enclosure">{</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator">:</span><span class="python_name">s</span><span class="python_enclosure">}</span>
<span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_72_div" class="codepop" style="display:none;">UPDATE users SET user_name=(SELECT addresses.city <br/>
  FROM addresses <br/>
  WHERE addresses.user_id = users.user_id) <br/>
  WHERE users.user_id > :users_user_id AND users.user_id < :users_user_id_1<br/>
  {'users_user_id_1': 20, 'users_user_id': 10}</div><pre><span class="python_operator"></span></pre></div>


    </div>

</div>



    </div>

    <a href="#sql" class="toclink">back to section top</a>
</div>




<A name="sql_delete"></a>

<div class="subsection" style="margin-left:20px;">


<h3>Deletes</h3>

    <div class="sectiontext">
    

<p>A delete is formulated like an update, except theres no values:
</p>


<div class="sliding_code">
<pre><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">delete</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">==</span><span class="python_number">7</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">delete</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator">.</span><span class="python_name">like</span><span class="python_enclosure">(</span><span class="python_name">bindparam</span><span class="python_enclosure">(</span><span class="python_literal">'name'</span><span class="python_enclosure">)))</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span>
        <span class="python_enclosure">{</span><span class="python_literal">'name'</span><span class="python_operator">:</span><span class="python_literal">'%Jack%'</span><span class="python_enclosure">}</span><span class="python_operator">,</span>
        <span class="python_enclosure">{</span><span class="python_literal">'name'</span><span class="python_operator">:</span><span class="python_literal">'%Ed%'</span><span class="python_enclosure">}</span><span class="python_operator">,</span>
        <span class="python_enclosure">{</span><span class="python_literal">'name'</span><span class="python_operator">:</span><span class="python_literal">'%Jane%'</span><span class="python_enclosure">}</span><span class="python_operator">,</span>
    <span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">delete</span><span class="python_enclosure">(</span><span class="python_name">exists</span><span class="python_enclosure">())</span><span class="python_operator"></span></pre></div>



    </div>

</div>



    </div>

    <a href="#sql" class="toclink">back to section top</a>
</div>


</html></div>
<A name="datamapping"></a>

<div class="sectionnavblock">
<div class="sectionnav">

        Previous: <a href="#sql">Constructing SQL Queries via Python Expressions</a>

                |

        Next: <a href="#unitofwork">Session / Unit of Work</a>

</div>
</div>

<div class="topnavmain">
	<div class="topnavheader">Data Mapping</div>
</div>
<div class="sectioncontent">
<html>



<A name="datamapping"></a>

<div class="subsection" style="margin-left:10px;">



    <div class="sectiontext">
    




<A name="datamapping_datamapping"></a>

<div class="subsection" style="margin-left:20px;">


<h3>Basic Data Mapping</h3>

    <div class="sectiontext">
    

<p>Data mapping describes the process of defining <em>Mapper</em> objects, which associate table metadata with user-defined classes.  <br></br>
</p>
<p>The <code>Mapper</code>'s role is to perform SQL operations upon the database, associating individual table rows with instances of those classes, and individual database columns with properties upon those instances, to transparently associate in-memory objects with a persistent database representation. 
</p>
<p>When a <code>Mapper</code> is created to associate a <code>Table</code> object with a class, all of the columns defined in the <code>Table</code> object are associated with the class via property accessors, which add overriding functionality to the normal process of setting and getting object attributes.  These property accessors keep track of changes to object attributes; these changes will be stored to the database when the application "flushes" the current state of objects (known as a <em>Unit of Work</em>).
</p>
<p>Two objects provide the primary interface for interacting with Mappers and the "unit of work", which are the <code>Query</code> object and the <code>Session</code> object.  <code>Query</code> deals with selecting objects from the database, whereas <code>Session</code> provides a context for loaded objects and the ability to communicate changes on those objects back to the database.
</p>
<p>The primary method on <code>Query</code> for loading objects is its <code>select()</code> method, which has similar arguments to a <code>sqlalchemy.sql.Select</code> object.  But this select method executes automatically and returns results, instead of awaiting an execute() call.  Instead of returning a cursor-like object, it returns an array of objects.
</p>
<p>The three configurational elements to be defined, i.e. the <code>Table</code> metadata, the user-defined class, and the <code>Mapper</code>, are typically defined as module-level variables, and may be defined in any fashion suitable to the application, with the only requirement being that the class and table metadata are described before the mapper.  For the sake of example, we will be defining these elements close together, but this should not be construed as a requirement; since SQLAlchemy is not a framework, those decisions are left to the developer or an external framework.
</p>
<p>Also, keep in mind that the examples in this section deal with explicit <code>Session</code> objects mapped directly to <code>Engine</code> objects, which represents the most explicit style of using the ORM.  Options exist for how this is configured, including binding <code>Table</code> objects directly to <code>Engines</code> (described in <a href="metadata.html#metadata_tables_binding">Binding MetaData to an Engine</a>), as well as using the "Threadlocal" plugin which provides various code shortcuts by using an implicit Session associated to the current thread (described in <a href="plugins.html#plugins_threadlocal">threadlocal</a>).
</p>


    </div>

    <a href="#datamapping" class="toclink">back to section top</a>
</div>




<A name="datamapping_synopsis"></a>

<div class="subsection" style="margin-left:20px;">


<h3>Synopsis</h3>

    <div class="sectiontext">
    

<p>First, the metadata/mapper configuration code:
</p>


<div class="sliding_code">
<pre><span class="python_keyword">from </span><span class="python_name">sqlalchemy </span><span class="python_keyword">import </span><span class="python_operator">*
</span>
<span class="python_comment"># metadata
</span><span class="python_name">meta </span><span class="python_operator">= </span><span class="python_name">MetaData</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_comment"># table object
</span><span class="python_name">users_table </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'users'</span><span class="python_operator">, </span><span class="python_name">meta</span><span class="python_operator">, </span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'user_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'user_name'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">16</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'password'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">20</span><span class="python_enclosure">))</span>
<span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># class definition 
</span><span class="python_keyword">class </span><span class="python_name">User</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">pass</span><span class="python_operator">
</span>
<span class="python_comment"># create a mapper and associate it with the User class.
# technically we dont really need the 'usermapper' variable.
</span><span class="python_operator"></span><span class="python_name">usermapper </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">users_table</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre></div>
<p>Note that no database definitions are required.  Next we will define an <code>Engine</code> and connect a <code>Session</code> to it, and perform a simple select:
</p>


<div class="code">
<pre><span class="python_comment"># engine
</span><span class="python_name">engine </span><span class="python_operator">= </span><span class="python_name">create_engine</span><span class="python_enclosure">(</span><span class="python_literal">"sqlite://mydb.db"</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># session
</span><span class="python_name">session </span><span class="python_operator">= </span><span class="python_name">create_session</span><span class="python_enclosure">(</span><span class="python_name">bind_to</span><span class="python_operator">=</span><span class="python_name">engine</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># select
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_73', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">user </span><span class="python_operator">= </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">select_by</span><span class="python_enclosure">(</span><span class="python_name">user_name</span><span class="python_operator">=</span><span class="python_literal">'fred'</span><span class="python_enclosure">)[</span><span class="python_number">0</span><span class="python_enclosure">]</span><span class="python_operator"></span></pre><div id="popbox_73_div" class="codepop" style="display:none;">SELECT users.user_id AS users_user_id, users.user_name AS users_user_name, <br/>
  users.password AS users_password <br/>
  FROM users <br/>
  WHERE users.user_name = :users_user_name ORDER BY users.oid<br/>
  {'users_user_name': 'fred'}</div><pre><span class="python_comment"># modify
</span><span class="python_name">user</span><span class="python_operator">.</span><span class="python_name">user_name </span><span class="python_operator">= </span><span class="python_literal">'fred jones'</span><span class="python_operator">
</span>
<span class="python_comment"># flush - saves everything that changed
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_74', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">flush</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_74_div" class="codepop" style="display:none;">UPDATE users SET user_name=:user_name <br/>
   WHERE users.user_id = :user_id<br/>
  [{'user_name': 'fred jones', 'user_id': 1}]</div><pre><span class="python_operator"></span></pre></div>


    </div>

    <a href="#datamapping" class="toclink">back to section top</a>
</div>




<A name="datamapping_query"></a>

<div class="subsection" style="margin-left:20px;">


<h3>The Query Object</h3>

    <div class="sectiontext">
    

<p>The method <code>session.query(class_or_mapper)</code> returns a <code>Query</code> object.  Below is a synopsis of things you can do with <code>Query</code>:
</p>


<div class="sliding_code">
<pre><span class="python_comment"># get a query from a Session based on class:
</span><span class="python_name">query </span><span class="python_operator">= </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># get a query from a Session given a Mapper:
</span><span class="python_name">query </span><span class="python_operator">= </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">usermapper</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># select_by, which takes keyword arguments.  the
# keyword arguments represent property names and the values
# represent values which will be compared via the = operator.
# the comparisons are joined together via "AND".
</span><span class="python_name">result </span><span class="python_operator">= </span><span class="python_name">query</span><span class="python_operator">.</span><span class="python_name">select_by</span><span class="python_enclosure">(</span><span class="python_name">name</span><span class="python_operator">=</span><span class="python_literal">'john'</span><span class="python_operator">, </span><span class="python_name">street</span><span class="python_operator">=</span><span class="python_literal">'123 green street'</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># select_by can also combine ClauseElements with key/value properties.
# all ClauseElements and keyword-based criterion are combined together
# via "AND". 
</span><span class="python_name">result </span><span class="python_operator">= </span><span class="python_name">query</span><span class="python_operator">.</span><span class="python_name">select_by</span><span class="python_enclosure">(</span><span class="python_name">users_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator">==</span><span class="python_literal">'john'</span><span class="python_operator">, </span>
        <span class="python_name">addresses_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">zip_code</span><span class="python_operator">==</span><span class="python_literal">'12345'</span><span class="python_operator">, </span><span class="python_name">street</span><span class="python_operator">=</span><span class="python_literal">'123 green street'</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># get_by, which takes the same arguments as select_by
# returns a single scalar result or None if no results
</span><span class="python_name">user </span><span class="python_operator">= </span><span class="python_name">query</span><span class="python_operator">.</span><span class="python_name">get_by</span><span class="python_enclosure">(</span><span class="python_name">id</span><span class="python_operator">=</span><span class="python_number">12</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># "dynamic" versions of select_by and get_by - everything past the 
# "select_by_" or "get_by_" is used as the key, and the function argument
# as the value
</span><span class="python_name">result </span><span class="python_operator">= </span><span class="python_name">query</span><span class="python_operator">.</span><span class="python_name">select_by_name</span><span class="python_enclosure">(</span><span class="python_literal">'fred'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">u </span><span class="python_operator">= </span><span class="python_name">query</span><span class="python_operator">.</span><span class="python_name">get_by_name</span><span class="python_enclosure">(</span><span class="python_literal">'fred'</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># get an object directly from its primary key.  this will bypass the SQL
# call if the object has already been loaded
</span><span class="python_name">u </span><span class="python_operator">= </span><span class="python_name">query</span><span class="python_operator">.</span><span class="python_name">get</span><span class="python_enclosure">(</span><span class="python_number">15</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># get an object that has a composite primary key of three columns.
# the order of the arguments matches that of the table meta data.
</span><span class="python_name">myobj </span><span class="python_operator">= </span><span class="python_name">query</span><span class="python_operator">.</span><span class="python_name">get</span><span class="python_enclosure">((</span><span class="python_number">27</span><span class="python_operator">, </span><span class="python_number">3</span><span class="python_operator">, </span><span class="python_literal">'receipts'</span><span class="python_enclosure">))</span><span class="python_operator">
</span>
<span class="python_comment"># using a WHERE criterion
</span><span class="python_name">result </span><span class="python_operator">= </span><span class="python_name">query</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">or_</span><span class="python_enclosure">(</span><span class="python_name">users_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name </span><span class="python_operator">== </span><span class="python_literal">'john'</span><span class="python_operator">, </span><span class="python_name">users_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator">==</span><span class="python_literal">'fred'</span><span class="python_enclosure">))</span><span class="python_operator">
</span>
<span class="python_comment"># using a WHERE criterion to get a scalar
</span><span class="python_name">u </span><span class="python_operator">= </span><span class="python_name">query</span><span class="python_operator">.</span><span class="python_name">selectfirst</span><span class="python_enclosure">(</span><span class="python_name">users_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator">==</span><span class="python_literal">'john'</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># selectone() is a stricter version of selectfirst() which
# will raise an exception if there is not exactly one row
</span><span class="python_name">u </span><span class="python_operator">= </span><span class="python_name">query</span><span class="python_operator">.</span><span class="python_name">selectone</span><span class="python_enclosure">(</span><span class="python_name">users_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator">==</span><span class="python_literal">'john'</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># using a full select object
</span><span class="python_name">result </span><span class="python_operator">= </span><span class="python_name">query</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">users_table</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">users_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator">==</span><span class="python_literal">'john'</span><span class="python_enclosure">))</span><span class="python_operator"></span></pre></div>
<p>Some of the above examples above illustrate the usage of the mapper's Table object to provide the columns for a WHERE Clause.  These columns are also accessible off of the mapped class directly.  When a mapper is assigned to a class, it also attaches a special property accessor <code>c</code> to the class itself, which can be used just like the table metadata to access the columns of the table:
</p>


<div class="sliding_code">
<pre><span class="python_name">userlist </span><span class="python_operator">= </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">==</span><span class="python_number">12</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre></div>


    </div>

    <a href="#datamapping" class="toclink">back to section top</a>
</div>




<A name="datamapping_saving"></a>

<div class="subsection" style="margin-left:20px;">


<h3>Saving Objects</h3>

    <div class="sectiontext">
    

<p>When objects corresponding to mapped classes are created or manipulated, all changes are logged by the <code>Session</code> object.  The changes are then written to the database when an application calls <code>flush()</code>.  This pattern is known as a <em>Unit of Work</em>, and has many advantages over saving individual objects or attributes on those objects with individual method invocations.  Domain models can be built with far greater complexity with no concern over the order of saves and deletes, excessive database round-trips and write operations, or deadlocking issues.  The <code>flush()</code> operation batches its SQL statements into a transaction, and can also perform optimistic concurrency checks (using a version id column) to insure the proper number of rows were in fact affected (not supported with the current MySQL drivers). 
</p>
<p>The Unit of Work is a powerful tool, and has some important concepts that should be understood in order to use it effectively.  See the <a href="unitofwork.html#unitofwork">Session / Unit of Work</a> section for a full description on all its operations.
</p>
<p>When a mapper is created, the target class has its mapped properties decorated by specialized property accessors that track changes.  New objects by default must be explicitly added to the <code>Session</code>, however this can be made automatic by using <a href="plugins.html#plugins_threadlocal">threadlocal</a> or <a href="plugins.html#plugins_sessioncontext">SessionContext</a>.
</p>


<div class="code">
<pre><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">users_table</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># create a new User
</span><span class="python_name">myuser </span><span class="python_operator">= </span><span class="python_name">User</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_name">myuser</span><span class="python_operator">.</span><span class="python_name">user_name </span><span class="python_operator">= </span><span class="python_literal">'jane'</span><span class="python_operator">
</span><span class="python_name">myuser</span><span class="python_operator">.</span><span class="python_name">password </span><span class="python_operator">= </span><span class="python_literal">'hello123'</span><span class="python_operator">
</span>
<span class="python_comment"># create another new User      
</span><span class="python_name">myuser2 </span><span class="python_operator">= </span><span class="python_name">User</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_name">myuser2</span><span class="python_operator">.</span><span class="python_name">user_name </span><span class="python_operator">= </span><span class="python_literal">'ed'</span><span class="python_operator">
</span><span class="python_name">myuser2</span><span class="python_operator">.</span><span class="python_name">password </span><span class="python_operator">= </span><span class="python_literal">'lalalala'</span><span class="python_operator">
</span>
<span class="python_comment"># create a Session and save them
</span><span class="python_name">sess </span><span class="python_operator">= </span><span class="python_name">create_session</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_name">sess</span><span class="python_operator">.</span><span class="python_name">save</span><span class="python_enclosure">(</span><span class="python_name">myuser</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">sess</span><span class="python_operator">.</span><span class="python_name">save</span><span class="python_enclosure">(</span><span class="python_name">myuser2</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># load a third User from the database            
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_75', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">myuser3 </span><span class="python_operator">= </span><span class="python_name">sess</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator">==</span><span class="python_literal">'fred'</span><span class="python_enclosure">)[</span><span class="python_number">0</span><span class="python_enclosure">]</span><span class="python_operator"></span></pre><div id="popbox_75_div" class="codepop" style="display:none;">SELECT users.user_id AS users_user_id, <br/>
  users.user_name AS users_user_name, users.password AS users_password<br/>
  FROM users WHERE users.user_name = :users_user_name<br/>
  {'users_user_name': 'fred'}</div><pre><span class="python_name">myuser3</span><span class="python_operator">.</span><span class="python_name">user_name </span><span class="python_operator">= </span><span class="python_literal">'fredjones'</span><span class="python_operator">
</span>
<span class="python_comment"># save all changes            
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_76', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">flush</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_76_div" class="codepop" style="display:none;">UPDATE users SET user_name=:user_name<br/>
  WHERE users.user_id =:users_user_id<br/>
  [{'users_user_id': 1, 'user_name': 'fredjones'}]<br/>
  INSERT INTO users (user_name, password) VALUES (:user_name, :password)<br/>
  {'password': 'hello123', 'user_name': 'jane'}<br/>
  INSERT INTO users (user_name, password) VALUES (:user_name, :password)<br/>
  {'password': 'lalalala', 'user_name': 'ed'}</div><pre><span class="python_operator"></span></pre></div>
<p>The mapped class can also specify whatever methods and/or constructor it wants:
</p>


<div class="code">
<pre><span class="python_keyword">class </span><span class="python_name">User</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">def </span><span class="python_name">__init__</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">user_name</span><span class="python_operator">, </span><span class="python_name">password</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">user_id </span><span class="python_operator">= </span><span class="python_name">None</span><span class="python_operator">
        </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">user_name </span><span class="python_operator">= </span><span class="python_name">user_name</span><span class="python_operator">
        </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">password </span><span class="python_operator">= </span><span class="python_name">password</span><span class="python_operator">
    </span><span class="python_keyword">def </span><span class="python_name">get_name</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_keyword">return </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator">
    </span><span class="python_keyword">def </span><span class="python_name">__repr__</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_keyword">return </span><span class="python_literal">"User id %s name %s password %s" </span><span class="python_operator">% </span><span class="python_enclosure">(</span><span class="python_name">repr</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_enclosure">)</span><span class="python_operator">, </span>
            <span class="python_name">repr</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">repr</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">password</span><span class="python_enclosure">))</span><span class="python_operator">
</span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">users_table</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_name">sess </span><span class="python_operator">= </span><span class="python_name">create_session</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_name">u </span><span class="python_operator">= </span><span class="python_name">User</span><span class="python_enclosure">(</span><span class="python_literal">'john'</span><span class="python_operator">, </span><span class="python_literal">'foo'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">sess</span><span class="python_operator">.</span><span class="python_name">save</span><span class="python_enclosure">(</span><span class="python_name">u</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_77', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">flush</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_77_div" class="codepop" style="display:none;">INSERT INTO users (user_name, password) VALUES (:user_name, :password)<br/>
  {'password': 'foo', 'user_name': 'john'}</div><pre><span class="python_literal">>>> </span><span class="python_name">u</span><span class="python_operator">
</span><span class="python_name">User id </span><span class="python_number">1 </span><span class="python_name">name </span><span class="python_literal">'john' </span><span class="python_name">password </span><span class="python_literal">'foo'</span><span class="python_operator"></span></pre></div>
<p>SQLAlchemy will only put modified object attributes columns into the UPDATE statements generated upon flush.  This is to conserve database traffic and also to successfully interact with a "deferred" attribute, which is a mapped object attribute against the mapper's primary table that isnt loaded until referenced by the application.
</p>


    </div>

    <a href="#datamapping" class="toclink">back to section top</a>
</div>




<A name="datamapping_relations"></a>

<div class="subsection" style="margin-left:20px;">


<h3>Defining and Using Relationships</h3>

    <div class="sectiontext">
    

<p>So that covers how to map the columns in a table to an object, how to load objects, create new ones, and save changes.  The next step is how to define an object's relationships to other database-persisted objects.  This is done via the <code>relation</code> function provided by the <code>orm</code> module.  <br></br>
</p>



<A name="datamapping_relations_onetomany"></a>

<div class="subsection" style="margin-left:30px;">


<h3>One to Many</h3>

    <div class="sectiontext">
    

<p>So with our User class, lets also define the User has having one or more mailing addresses.  First, the table metadata:
</p>


<div class="sliding_code">
<pre><span class="python_keyword">from </span><span class="python_name">sqlalchemy </span><span class="python_keyword">import </span><span class="python_operator">*
</span>
<span class="python_name">metadata </span><span class="python_operator">= </span><span class="python_name">MetaData</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_comment"># define user table
</span><span class="python_name">users_table </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'users'</span><span class="python_operator">, </span><span class="python_name">metadata</span><span class="python_operator">, </span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'user_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'user_name'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">16</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'password'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">20</span><span class="python_enclosure">))</span>
<span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># define user address table
</span><span class="python_name">addresses_table </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'addresses'</span><span class="python_operator">, </span><span class="python_name">metadata</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'address_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'user_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">ForeignKey</span><span class="python_enclosure">(</span><span class="python_literal">"users.user_id"</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'street'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">100</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'city'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">80</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'state'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">2</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'zip'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">10</span><span class="python_enclosure">))</span>
<span class="python_enclosure">)</span><span class="python_operator"></span></pre></div>
<p>Of importance here is the addresses table's definition of a <em>foreign key</em> relationship to the users table, relating the user_id column into a parent-child relationship.  When a <code>Mapper</code> wants to indicate a relation of one object to another, the <code>ForeignKey</code> relationships are the default method by which the relationship is determined (options also exist to describe the relationships explicitly).   <br></br>
</p>
<p>So then lets define two classes, the familiar <code>User</code> class, as well as an <code>Address</code> class:
</p>


<div class="sliding_code">
<pre><span class="python_keyword">class </span><span class="python_name">User</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">def </span><span class="python_name">__init__</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">user_name</span><span class="python_operator">, </span><span class="python_name">password</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">user_name </span><span class="python_operator">= </span><span class="python_name">user_name</span><span class="python_operator">
        </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">password </span><span class="python_operator">= </span><span class="python_name">password</span><span class="python_operator">
</span>
<span class="python_operator"></span><span class="python_keyword">class </span><span class="python_name">Address</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">def </span><span class="python_name">__init__</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">street</span><span class="python_operator">, </span><span class="python_name">city</span><span class="python_operator">, </span><span class="python_name">state</span><span class="python_operator">, </span><span class="python_name">zip</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">street </span><span class="python_operator">= </span><span class="python_name">street</span><span class="python_operator">
        </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">city </span><span class="python_operator">= </span><span class="python_name">city</span><span class="python_operator">
        </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">state </span><span class="python_operator">= </span><span class="python_name">state</span><span class="python_operator">
        </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">zip </span><span class="python_operator">= </span><span class="python_name">zip</span><span class="python_operator"></span></pre></div>
<p>And then a <code>Mapper</code> that will define a relationship of the <code>User</code> and the <code>Address</code> classes to each other as well as their table metadata.  We will add an additional mapper keyword argument <code>properties</code> which is a dictionary relating the names of class attributes to database relationships, in this case a <code>relation</code> object against a newly defined mapper for the Address class:
</p>


<div class="sliding_code">
<pre><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_operator">, </span><span class="python_name">addresses_table</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">users_table</span><span class="python_operator">, </span><span class="python_name">properties </span><span class="python_operator">= </span><span class="python_enclosure">{</span>
        <span class="python_literal">'addresses' </span><span class="python_operator">: </span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_enclosure">)</span>
    <span class="python_enclosure">}</span>
  <span class="python_enclosure">)</span><span class="python_operator"></span></pre></div>
<p>Lets do some operations with these classes and see what happens:
</p>


<div class="sliding_code">
<pre><span class="python_name">engine </span><span class="python_operator">= </span><span class="python_name">create_engine</span><span class="python_enclosure">(</span><span class="python_literal">'sqlite:///mydb.db'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">metadata</span><span class="python_operator">.</span><span class="python_name">create_all</span><span class="python_enclosure">(</span><span class="python_name">engine</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_name">session </span><span class="python_operator">= </span><span class="python_name">create_session</span><span class="python_enclosure">(</span><span class="python_name">bind_to</span><span class="python_operator">=</span><span class="python_name">engine</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_name">u </span><span class="python_operator">= </span><span class="python_name">User</span><span class="python_enclosure">(</span><span class="python_literal">'jane'</span><span class="python_operator">, </span><span class="python_literal">'hihilala'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">u</span><span class="python_operator">.</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">append</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_enclosure">(</span><span class="python_literal">'123 anywhere street'</span><span class="python_operator">, </span><span class="python_literal">'big city'</span><span class="python_operator">, </span><span class="python_literal">'UT'</span><span class="python_operator">, </span><span class="python_literal">'76543'</span><span class="python_enclosure">))</span><span class="python_operator">
</span><span class="python_name">u</span><span class="python_operator">.</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">append</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_enclosure">(</span><span class="python_literal">'1 Park Place'</span><span class="python_operator">, </span><span class="python_literal">'some other city'</span><span class="python_operator">, </span><span class="python_literal">'OK'</span><span class="python_operator">, </span><span class="python_literal">'83923'</span><span class="python_enclosure">))</span><span class="python_operator">
</span>
<span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">save</span><span class="python_enclosure">(</span><span class="python_name">u</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">flush</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div class="codepop">INSERT INTO users (user_name, password) VALUES (:user_name, :password)<br/>
  {'password': 'hihilala', 'user_name': 'jane'}<br/>
  INSERT INTO addresses (user_id, street, city, state, zip) VALUES (:user_id, :street, :city, :state, :zip)<br/>
  {'city': 'big city', 'state': 'UT', 'street': '123 anywhere street', 'user_id':1, 'zip': '76543'}<br/>
  INSERT INTO addresses (user_id, street, city, state, zip) VALUES (:user_id, :street, :city, :state, :zip)<br/>
  {'city': 'some other city', 'state': 'OK', 'street': '1 Park Place', 'user_id':1, 'zip': '83923'}</div><pre><span class="python_operator"></span></pre></div>
<p>A lot just happened there!  The <code>Mapper</code> figured out how to relate rows in the addresses table to the users table, and also upon flush had to determine the proper order in which to insert rows.  After the insert, all the <code>User</code> and <code>Address</code> objects have their new primary and foreign key attributes populated.
</p>
<p>Also notice that when we created a <code>Mapper</code> on the <code>User</code> class which defined an <code>addresses</code> relation, the newly created <code>User</code> instance magically had an "addresses" attribute which behaved like a list.   This list is in reality a property function which returns an instance of <code>sqlalchemy.util.HistoryArraySet</code>.  This object fulfills the full set of Python list accessors, but maintains a <em>unique</em> set of objects (based on their in-memory identity), and also tracks additions and deletions to the list:
</p>


<div class="sliding_code">
<pre><span class="python_keyword">del </span><span class="python_name">u</span><span class="python_operator">.</span><span class="python_name">addresses</span><span class="python_enclosure">[</span><span class="python_number">1</span><span class="python_enclosure">]</span><span class="python_operator">
</span><span class="python_name">u</span><span class="python_operator">.</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">append</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_enclosure">(</span><span class="python_literal">'27 New Place'</span><span class="python_operator">, </span><span class="python_literal">'Houston'</span><span class="python_operator">, </span><span class="python_literal">'TX'</span><span class="python_operator">, </span><span class="python_literal">'34839'</span><span class="python_enclosure">))</span><span class="python_operator">
</span>
<span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">flush</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div class="codepop">UPDATE addresses SET user_id=:user_id<br/>
   WHERE addresses.address_id = :addresses_address_id<br/>
  [{'user_id': None, 'addresses_address_id': 2}]<br/>
  INSERT INTO addresses (user_id, street, city, state, zip) <br/>
  VALUES (:user_id, :street, :city, :state, :zip)<br/>
  {'city': 'Houston', 'state': 'TX', 'street': '27 New Place', 'user_id': 1, 'zip': '34839'}</div><pre><span class="python_operator"></span></pre></div>
<p>Note that when creating a relation with the <code>relation()</code> function, the target can either be a class, in which case the primary mapper for that class is used as the target, or a <code>Mapper</code> instance itself, as returned by the <code>mapper()</code> function.
</p>


    </div>

    <a href="#datamapping" class="toclink">back to section top</a>
</div>




<A name="datamapping_relations_lifecycle"></a>

<div class="subsection" style="margin-left:30px;">


<h3>Lifecycle Relations</h3>

    <div class="sectiontext">
    

<p>In the previous example, a single address was removed from the <code>addresses</code> attribute of a <code>User</code> object, resulting in the corresponding database row being updated to have a user_id of <code>None</code>.  But now, theres a mailing address with no user_id floating around in the database of no use to anyone.  How can we avoid this ?  This is acheived by using the <code>cascade</code> parameter of <code>relation</code>:
</p>


<div class="sliding_code">
<pre><span class="python_name">clear_mappers</span><span class="python_enclosure">()  </span><span class="python_comment"># clear mappers from the previous example</span><span class="python_operator">
</span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_operator">, </span><span class="python_name">addresses_table</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">users_table</span><span class="python_operator">, </span><span class="python_name">properties </span><span class="python_operator">= </span><span class="python_enclosure">{</span>
        <span class="python_literal">'addresses' </span><span class="python_operator">: </span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_operator">, </span><span class="python_name">cascade</span><span class="python_operator">=</span><span class="python_literal">"all, delete-orphan"</span><span class="python_enclosure">)</span>
    <span class="python_enclosure">}</span>
  <span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_keyword">del </span><span class="python_name">u</span><span class="python_operator">.</span><span class="python_name">addresses</span><span class="python_enclosure">[</span><span class="python_number">1</span><span class="python_enclosure">]</span><span class="python_operator">
</span><span class="python_name">u</span><span class="python_operator">.</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">append</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_enclosure">(</span><span class="python_literal">'27 New Place'</span><span class="python_operator">, </span><span class="python_literal">'Houston'</span><span class="python_operator">, </span><span class="python_literal">'TX'</span><span class="python_operator">, </span><span class="python_literal">'34839'</span><span class="python_enclosure">))</span><span class="python_operator">
</span>
<span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">flush</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div class="codepop">INSERT INTO addresses (user_id, street, city, state, zip) <br/>
  VALUES (:user_id, :street, :city, :state, :zip)<br/>
  {'city': 'Houston', 'state': 'TX', 'street': '27 New Place', 'user_id': 1, 'zip': '34839'}<br/>
  DELETE FROM addresses WHERE addresses.address_id = :address_id<br/>
  [{'address_id': 2}]</div><pre><span class="python_operator"></span></pre></div>
<p>In this case, with the <code>delete-orphan</code> <strong>cascade rule</strong> set, the element that was removed from the addresses list was also removed from the database.  Specifying <code>cascade="all, delete-orphan"</code> means that every persistence operation performed on the parent object will be <em>cascaded</em> to the child object or objects handled by the relation, and additionally that each child object cannot exist without being attached to a parent.  Such a relationship indicates that the <strong>lifecycle</strong> of the <code>Address</code> objects are bounded by that of their parent <code>User</code> object.
</p>
<p>Cascading is described fully in <a href="unitofwork.html#unitofwork_cascade">Cascade rules</a>.
</p>


    </div>

    <a href="#datamapping" class="toclink">back to section top</a>
</div>




<A name="datamapping_relations_backreferences"></a>

<div class="subsection" style="margin-left:30px;">


<h3>Backreferences</h3>

    <div class="sectiontext">
    

<p>By creating relations with the <code>backref</code> keyword, a bi-directional relationship can be created which will keep both ends of the relationship updated automatically, independently of database operations.  Below, the <code>User</code> mapper is created with an <code>addresses</code> property, and the corresponding <code>Address</code> mapper receives a "backreference" to the <code>User</code> object via the property name <code>user</code>:
</p>


<div class="sliding_code">
<pre><span class="python_name">Address </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_operator">, </span><span class="python_name">addresses_table</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">User </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">users_table</span><span class="python_operator">, </span><span class="python_name">properties </span><span class="python_operator">= </span><span class="python_enclosure">{</span>
                <span class="python_literal">'addresses' </span><span class="python_operator">: </span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_operator">, </span><span class="python_name">backref</span><span class="python_operator">=</span><span class="python_literal">'user'</span><span class="python_enclosure">)</span>
            <span class="python_enclosure">}</span>
          <span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_name">u </span><span class="python_operator">= </span><span class="python_name">User</span><span class="python_enclosure">(</span><span class="python_literal">'fred'</span><span class="python_operator">, </span><span class="python_literal">'hi'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">a1 </span><span class="python_operator">= </span><span class="python_name">Address</span><span class="python_enclosure">(</span><span class="python_literal">'123 anywhere street'</span><span class="python_operator">, </span><span class="python_literal">'big city'</span><span class="python_operator">, </span><span class="python_literal">'UT'</span><span class="python_operator">, </span><span class="python_literal">'76543'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">a2 </span><span class="python_operator">= </span><span class="python_name">Address</span><span class="python_enclosure">(</span><span class="python_literal">'1 Park Place'</span><span class="python_operator">, </span><span class="python_literal">'some other city'</span><span class="python_operator">, </span><span class="python_literal">'OK'</span><span class="python_operator">, </span><span class="python_literal">'83923'</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># append a1 to u
</span><span class="python_name">u</span><span class="python_operator">.</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">append</span><span class="python_enclosure">(</span><span class="python_name">a1</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># attach u to a2
</span><span class="python_name">a2</span><span class="python_operator">.</span><span class="python_name">user </span><span class="python_operator">= </span><span class="python_name">u</span><span class="python_operator">
</span>
<span class="python_comment"># the bi-directional relation is maintained
</span><span class="python_literal">>>> </span><span class="python_name">u</span><span class="python_operator">.</span><span class="python_name">addresses </span><span class="python_operator">== </span><span class="python_enclosure">[</span><span class="python_name">a1</span><span class="python_operator">, </span><span class="python_name">a2</span><span class="python_enclosure">]</span><span class="python_operator">
</span><span class="python_name">True</span><span class="python_operator">
</span><span class="python_literal">>>> </span><span class="python_name">a1</span><span class="python_operator">.</span><span class="python_name">user </span><span class="python_keyword">is </span><span class="python_name">user </span><span class="python_keyword">and </span><span class="python_name">a2</span><span class="python_operator">.</span><span class="python_name">user </span><span class="python_keyword">is </span><span class="python_name">user</span><span class="python_operator">
</span><span class="python_name">True</span><span class="python_operator"></span></pre></div>
<p>The backreference feature also works with many-to-many relationships, which are described later.  When creating a backreference, a corresponding property (i.e. a second <code>relation()</code>) is placed on the child mapper.  The default arguments to this property can be overridden using the <code>backref()</code> function:
</p>


<div class="sliding_code">
<pre><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">users_table</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_operator">, </span><span class="python_name">addresses_table</span><span class="python_operator">, </span><span class="python_name">properties</span><span class="python_operator">=</span><span class="python_enclosure">{</span>
    <span class="python_literal">'user'</span><span class="python_operator">:</span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">backref</span><span class="python_operator">=</span><span class="python_name">backref</span><span class="python_enclosure">(</span><span class="python_literal">'addresses'</span><span class="python_operator">, </span><span class="python_name">cascade</span><span class="python_operator">=</span><span class="python_literal">"all, delete-orphan"</span><span class="python_enclosure">))</span>
<span class="python_enclosure">})</span><span class="python_operator"></span></pre></div>
<p>The <code>backref()</code> function is often used to set up a bi-directional one-to-one relationship.  This is because the <code>relation()</code> function by default creates a "one-to-many" relationship when presented with a primary key/foreign key relationship, but the <code>backref()</code> function can redefine the <code>uselist</code> property to make it a scalar:
</p>


<div class="sliding_code">
<pre><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">users_table</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_operator">, </span><span class="python_name">addresses_table</span><span class="python_operator">, </span><span class="python_name">properties</span><span class="python_operator">=</span><span class="python_enclosure">{</span>
    <span class="python_literal">'user' </span><span class="python_operator">: </span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">backref</span><span class="python_operator">=</span><span class="python_name">backref</span><span class="python_enclosure">(</span><span class="python_literal">'address'</span><span class="python_operator">, </span><span class="python_name">uselist</span><span class="python_operator">=</span><span class="python_name">False</span><span class="python_enclosure">))</span>
<span class="python_enclosure">})</span><span class="python_operator"></span></pre></div>


    </div>

</div>



    </div>

    <a href="#datamapping" class="toclink">back to section top</a>
</div>




<A name="datamapping_selectrelations"></a>

<div class="subsection" style="margin-left:20px;">


<h3>Selecting from Relationships</h3>

    <div class="sectiontext">
    

<p>We've seen how the <code>relation</code> specifier affects the saving of an object and its child items, how does it affect selecting them?  By default, the relation keyword indicates that the related property should be attached a <em>lazy loader</em> when instances of the parent object are loaded from the database; this is just a callable function that when accessed will invoke a second SQL query to load the child objects of the parent.
</p>


<div class="code">
<pre><span class="python_comment"># define a mapper
</span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">users_table</span><span class="python_operator">, </span><span class="python_name">properties </span><span class="python_operator">= </span><span class="python_enclosure">{</span>
      <span class="python_literal">'addresses' </span><span class="python_operator">: </span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_operator">, </span><span class="python_name">addresses_table</span><span class="python_enclosure">))</span>
    <span class="python_enclosure">})</span><span class="python_operator">
</span>
<span class="python_comment"># select users where username is 'jane', get the first element of the list
# this will incur a load operation for the parent table
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_78', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">user </span><span class="python_operator">= </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator">==</span><span class="python_literal">'jane'</span><span class="python_enclosure">)[</span><span class="python_number">0</span><span class="python_enclosure">]</span><span class="python_operator"></span></pre><div id="popbox_78_div" class="codepop" style="display:none;">SELECT users.user_id AS users_user_id, <br/>
  users.user_name AS users_user_name, users.password AS users_password<br/>
  FROM users WHERE users.user_name = :users_user_name ORDER BY users.oid<br/>
  {'users_user_name': 'jane'}</div><pre><span class="python_comment"># iterate through the User object's addresses.  this will incur an
# immediate load of those child items
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_79', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_keyword">for </span><span class="python_name">a </span><span class="python_keyword">in </span><span class="python_name">user</span><span class="python_operator">.</span><span class="python_name">addresses</span><span class="python_operator">:</span></pre><div id="popbox_79_div" class="codepop" style="display:none;">SELECT addresses.address_id AS addresses_address_id, <br/>
  addresses.user_id AS addresses_user_id, addresses.street AS addresses_street, <br/>
  addresses.city AS addresses_city, addresses.state AS addresses_state, <br/>
  addresses.zip AS addresses_zip FROM addresses<br/>
  WHERE addresses.user_id = :users_user_id ORDER BY addresses.oid<br/>
  {'users_user_id': 1}</div><pre><span class="python_keyword">print </span><span class="python_name">repr</span><span class="python_enclosure">(</span><span class="python_name">a</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre></div>



<A name="datamapping_selectrelations_queryjoins"></a>

<div class="subsection" style="margin-left:30px;">


<h3>Selecting With Joins</h3>

    <div class="sectiontext">
    

<p>When using mappers that have relationships to other mappers, the need to specify query criterion across multiple tables arises.  SQLAlchemy provides several core techniques which offer this functionality.
</p>
<p>When specifying columns to the <code>select</code> method of <code>Query</code>, if the columns are attached to a table other than the mapped table, that table is automatically added to the "FROM" clause of the query.  This is the same behavior that occurs when creating a non-ORM <code>select</code> object.  Using this feature, joins can be created when querying:
</p>


<div class="code">
<pre><span class="python_literal"><a href="javascript:togglePopbox('popbox_80', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">l </span><span class="python_operator">= </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">and_</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">==</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">, </span>
             <span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">street</span><span class="python_operator">==</span><span class="python_literal">'123 Green Street'</span><span class="python_enclosure">))</span><span class="python_operator"></span></pre><div id="popbox_80_div" class="codepop" style="display:none;">SELECT users.user_id AS users_user_id, <br/>
  users.user_name AS users_user_name, users.password AS users_password<br/>
  FROM users, addresses <br/>
  WHERE users.user_id=addresses.user_id<br/>
  AND addresses.street=:addresses_street<br/>
  ORDER BY users.oid<br/>
  {'addresses_street', '123 Green Street'}</div><pre><span class="python_operator"></span></pre></div>
<p>Above, we specified selection criterion that included columns from both the <code>users</code> and the <code>addresses</code> table.  Note that in this case, we had to specify not just the matching condition to the <code>street</code> column on <code>addresses</code>, but also the join condition between the <code>users</code> and <code>addresses</code> table.  Even though the <code>User</code> mapper has a relationship to the <code>Address</code> mapper where the join condition is known, <strong>the select method does not assume how you want to construct joins</strong>.  If we did not include the join clause, we would get:
</p>


<div class="code">
<pre><span class="python_comment"># this is usually not what you want to do
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_81', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">l </span><span class="python_operator">= </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">street</span><span class="python_operator">==</span><span class="python_literal">'123 Green Street'</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre><div id="popbox_81_div" class="codepop" style="display:none;">SELECT users.user_id AS users_user_id, <br/>
  users.user_name AS users_user_name, users.password AS users_password<br/>
  FROM users, addresses <br/>
  WHERE addresses.street=:addresses_street<br/>
  ORDER BY users.oid<br/>
  {'addresses_street', '123 Green Street'}</div><pre><span class="python_operator"></span></pre></div>
<p>The above join will return all rows of the <code>users</code> table, even those that do not correspond to the <code>addresses</code> table, in a <strong>cartesian product</strong> with the matching rows from the <code>addresses</code> table.
</p>
<p>Another way to specify joins more explicitly is to use the <code>from_obj</code> parameter of <code>select()</code>.  This allows you to explicitly place elements in the FROM clause of the query, which could include lists of tables and/or <code>Join</code> constructs:
</p>


<div class="code">
<pre><span class="python_literal"><a href="javascript:togglePopbox('popbox_82', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">l </span><span class="python_operator">= </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">street</span><span class="python_operator">==</span><span class="python_literal">'123 Green Street'</span><span class="python_operator">, </span>
                <span class="python_name">from_obj</span><span class="python_operator">=</span><span class="python_enclosure">[</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">join</span><span class="python_enclosure">(</span><span class="python_name">addresses</span><span class="python_enclosure">)])</span><span class="python_operator"></span></pre><div id="popbox_82_div" class="codepop" style="display:none;">SELECT users.user_id AS users_user_id, <br/>
  users.user_name AS users_user_name, users.password AS users_password<br/>
  FROM users JOIN addresses ON users.user_id=addresses.user_id<br/>
  WHERE addresses.street=:addresses_street<br/>
  ORDER BY users.oid<br/>
  {'addresses_street', '123 Green Street'}</div><pre><span class="python_operator"></span></pre></div>
<p>In the above example, the <code>join</code> function by default creates a natural join between the two tables, so we were able to avoid having to specify the join condition between <code>users</code> and <code>addresses</code> explicitly.
</p>


    </div>

    <a href="#datamapping" class="toclink">back to section top</a>
</div>




<A name="datamapping_selectrelations_relselectby"></a>

<div class="subsection" style="margin-left:30px;">


<h3>Creating Joins Using selectby()</h3>

    <div class="sectiontext">
    

<p>Another way that joins can be created is by using the <code>select_by</code> method of <code>Query</code>, which has the ability to create joins across relationships automatically.  This method is in many circumstances more convenient than, but not as flexible as, the more SQL-level approach using the <code>select()</code> method described in the previous section.
</p>
<p>To issue a join using <code>select_by</code>, just specify a key in the argument list which is not present in the primary mapper's list of properties or columns, but <em>is</em> present in the property list of some relationship down the line of objects.  The <code>Query</code> object will recursively traverse along the mapped relationships starting with the lead class and descending into child classes, until it finds a property matching the given name.  For each new mapper it encounters along the path to the located property, it constructs a join across that relationship:
</p>


<div class="code">
<pre><span class="python_literal"><a href="javascript:togglePopbox('popbox_83', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">l </span><span class="python_operator">= </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">select_by</span><span class="python_enclosure">(</span><span class="python_name">street</span><span class="python_operator">=</span><span class="python_literal">'123 Green Street'</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre><div id="popbox_83_div" class="codepop" style="display:none;">SELECT users.user_id AS users_user_id, <br/>
  users.user_name AS users_user_name, users.password AS users_password<br/>
  FROM users, addresses <br/>
  WHERE users.user_id=addresses.user_id<br/>
  AND addresses.street=:addresses_street<br/>
  ORDER BY users.oid<br/>
  {'addresses_street', '123 Green Street'}</div><pre><span class="python_operator"></span></pre></div>
<p>The above example is shorthand for:
</p>


<div class="sliding_code">
<pre><span class="python_name">l </span><span class="python_operator">= </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">and_</span><span class="python_enclosure">(</span>
         <span class="python_name">Address</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">==</span><span class="python_name">User</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">, </span>
         <span class="python_name">Address</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">street</span><span class="python_operator">==</span><span class="python_literal">'123 Green Street'</span><span class="python_enclosure">)</span>
   <span class="python_enclosure">)</span><span class="python_operator"></span></pre></div>
<p>All keyword arguments sent to <code>select_by</code> are used to create query criterion.  This means that familiar <code>select</code> keyword options like <code>order_by</code> and <code>limit</code> are not directly available.  To enable these options with <code>select_by</code>, you can try the <a href="plugins.html#plugins_selectresults">SelectResults</a> extension which offers transitive methods off the result of a <code>select</code> or <code>select_by</code> such as <code>order_by()</code>, <code>limit()</code>, etc.  <br></br>
</p>
<p>Note that the <code>select_by</code> method, while it primarily uses keyword arguments, also can accomodate <code>ClauseElement</code> objects positionally; recall that a <code>ClauseElement</code> is genearated when producing a comparison off of a <code>Column</code> expression, such as <code>users.c.name=='ed'</code>.  When using <code>ClauseElements</code> with <code>select_by</code>, these clauses are passed directly to the generated SQL and are <strong>not</strong> used to further locate join criterion.  If criterion is being constructed with these kinds of expressions, consider using the <code>select()</code> method which is better designed to accomodate these expressions.
</p>


    </div>

    <a href="#datamapping" class="toclink">back to section top</a>
</div>




<A name="datamapping_selectrelations_jointo"></a>

<div class="subsection" style="margin-left:30px;">


<h3>Generating Join Criterion Using join_to, join_via</h3>

    <div class="sectiontext">
    

<p>Feature Status: <a href='javascript:alphaApi()'>Alpha API</a> 
</p>
<p>The <code>join_to</code> method of <code>Query</code> is a component of the <code>select_by</code> operation, and is given a keyname in order to return a "join path" from the Query's mapper to the mapper which is referenced by a <code>relation()</code> of the given name:
</p>


<div class="sliding_code">
<pre><span class="python_literal">>>> </span><span class="python_name">q </span><span class="python_operator">= </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_literal">>>> </span><span class="python_name">j </span><span class="python_operator">= </span><span class="python_name">q</span><span class="python_operator">.</span><span class="python_name">join_to</span><span class="python_enclosure">(</span><span class="python_literal">'addresses'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_literal">>>> </span><span class="python_keyword">print </span><span class="python_name">j</span><span class="python_operator">
</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">=</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator"></span></pre></div>
<p><code>join_to</code> can also be given the name of a column-based property, in which case it will locate a path to the nearest mapper which has that property as a column:
</p>


<div class="sliding_code">
<pre><span class="python_literal">>>> </span><span class="python_name">q </span><span class="python_operator">= </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_literal">>>> </span><span class="python_name">j </span><span class="python_operator">= </span><span class="python_name">q</span><span class="python_operator">.</span><span class="python_name">join_to</span><span class="python_enclosure">(</span><span class="python_literal">'street'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_literal">>>> </span><span class="python_keyword">print </span><span class="python_name">j</span><span class="python_operator">
</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">=</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator"></span></pre></div>
<p>Also available is the <code>join_via</code> function, which is similar to <code>join_to</code>, except instead of traversing through all properties to find a path to the given key, its given an explicit path to the target property:
</p>


<div class="sliding_code">
<pre><span class="python_literal">>>> </span><span class="python_name">q </span><span class="python_operator">= </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_literal">>>> </span><span class="python_name">j </span><span class="python_operator">= </span><span class="python_name">q</span><span class="python_operator">.</span><span class="python_name">join_via</span><span class="python_enclosure">([</span><span class="python_literal">'orders'</span><span class="python_operator">, </span><span class="python_literal">'items'</span><span class="python_enclosure">])</span><span class="python_operator">
</span><span class="python_literal">>>> </span><span class="python_keyword">print </span><span class="python_name">j</span><span class="python_operator">
</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">==</span><span class="python_name">orders</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id AND orders</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">item_id</span><span class="python_operator">==</span><span class="python_name">items</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">item_id</span><span class="python_operator"></span></pre></div>
<p>Expressions produced by <code>join_to</code> and <code>join_via</code> can be used with <code>select</code> to create more complicated query criterion across multiple relations:
</p>


<div class="sliding_code">
<pre><span class="python_literal">>>> </span><span class="python_name">l </span><span class="python_operator">= </span><span class="python_name">q</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span>
    <span class="python_enclosure">(</span><span class="python_name">addresses_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">street</span><span class="python_operator">==</span><span class="python_literal">'some address'</span><span class="python_enclosure">) </span><span class="python_operator">&</span>
    <span class="python_enclosure">(</span><span class="python_name">items_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">item_name</span><span class="python_operator">==</span><span class="python_literal">'item #4'</span><span class="python_enclosure">) </span><span class="python_operator">&</span>
    <span class="python_name">q</span><span class="python_operator">.</span><span class="python_name">join_to</span><span class="python_enclosure">(</span><span class="python_literal">'addresses'</span><span class="python_enclosure">) </span><span class="python_operator">&</span>
    <span class="python_name">q</span><span class="python_operator">.</span><span class="python_name">join_via</span><span class="python_enclosure">([</span><span class="python_literal">'orders'</span><span class="python_operator">, </span><span class="python_literal">'items'</span><span class="python_enclosure">])</span>
    <span class="python_enclosure">)</span><span class="python_operator"></span></pre></div>
<p>Note that the <code>from_obj</code> parameter of <code>select()</code>, described previously, allows finer grained control of joins, allowing any combination of inner and outer joins.  <br></br>
</p>


    </div>

    <a href="#datamapping" class="toclink">back to section top</a>
</div>




<A name="datamapping_selectrelations_eagerload"></a>

<div class="subsection" style="margin-left:30px;">


<h3>Eager Loading</h3>

    <div class="sectiontext">
    

<p>Eager Loading describes the loading of parent and child objects across a relation using a single query.  The purpose of eager loading is strictly one of performance enhancement; eager loading has <strong>no impact</strong> on the results of a query, except that when traversing child objects within the results, lazy loaders will not need to issue separate queries to load those child objects.
</p>
<p>Eager Loading is enabled on a per-relationship basis, either as the default
   for a particular relationship, or for a single query using query options,
   described later.
</p>
<p>With just a single parameter <code>lazy=False</code> specified to the relation object, the parent and child SQL queries can be joined together.
</p>


<div class="code">
<pre><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_operator">, </span><span class="python_name">addresses_table</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">users_table</span><span class="python_operator">, </span><span class="python_name">properties </span><span class="python_operator">= </span><span class="python_enclosure">{</span>
        <span class="python_literal">'addresses' </span><span class="python_operator">: </span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_operator">, </span><span class="python_name">lazy</span><span class="python_operator">=</span><span class="python_name">False</span><span class="python_enclosure">)</span>
    <span class="python_enclosure">}</span>
  <span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_literal"><a href="javascript:togglePopbox('popbox_84', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">users </span><span class="python_operator">= </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator">==</span><span class="python_literal">'Jane'</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre><div id="popbox_84_div" class="codepop" style="display:none;">SELECT users.user_name AS users_user_name, users.password AS users_password, <br/>
  users.user_id AS users_user_id, addresses_4fb8.city AS addresses_4fb8_city, <br/>
  addresses_4fb8.address_id AS addresses_4fb8_address_id, addresses_4fb8.user_id AS addresses_4fb8_user_id, <br/>
  addresses_4fb8.zip AS addresses_4fb8_zip, addresses_4fb8.state AS addresses_4fb8_state, <br/>
  addresses_4fb8.street AS addresses_4fb8_street <br/>
  FROM users LEFT OUTER JOIN addresses AS addresses_4fb8 ON users.user_id = addresses_4fb8.user_id <br/>
  WHERE users.user_name = :users_user_name ORDER BY users.oid, addresses_4fb8.oid<br/>
  {'users_user_name': 'jane'}</div><pre><span class="python_keyword">for </span><span class="python_name">u </span><span class="python_keyword">in </span><span class="python_name">users</span><span class="python_operator">:
    </span><span class="python_keyword">print </span><span class="python_name">repr</span><span class="python_enclosure">(</span><span class="python_name">u</span><span class="python_enclosure">)</span><span class="python_operator">
    </span><span class="python_keyword">for </span><span class="python_name">a </span><span class="python_keyword">in </span><span class="python_name">u</span><span class="python_operator">.</span><span class="python_name">addresses</span><span class="python_operator">:
        </span><span class="python_keyword">print </span><span class="python_name">repr</span><span class="python_enclosure">(</span><span class="python_name">a</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre></div>
<p>Above, a pretty ambitious query is generated just by specifying that the User should be loaded with its child Addresses in one query.  When the mapper processes the results, it uses an <em>Identity Map</em> to keep track of objects that were already loaded, based on their primary key identity.  Through this method, the redundant rows produced by the join are organized into the distinct object instances they represent.
</p>
<p>Recall that eager loading has no impact on the results of the query.  What if our query included our own join criterion?  The eager loading query accomodates this using aliases, and is immune to the effects of additional joins being specified in the original query.  To use our select_by example above, joining against the "addresses" table to locate users with a certain street results in this behavior:
</p>


<div class="code">
<pre><span class="python_literal"><a href="javascript:togglePopbox('popbox_85', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">users </span><span class="python_operator">= </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">select_by</span><span class="python_enclosure">(</span><span class="python_name">street</span><span class="python_operator">=</span><span class="python_literal">'123 Green Street'</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre><div id="popbox_85_div" class="codepop" style="display:none;">SELECT users.user_name AS users_user_name, <br/>
  users.password AS users_password, users.user_id AS users_user_id, <br/>
  addresses_6ca7.city AS addresses_6ca7_city, <br/>
  addresses_6ca7.address_id AS addresses_6ca7_address_id, <br/>
  addresses_6ca7.user_id AS addresses_6ca7_user_id, <br/>
  addresses_6ca7.zip AS addresses_6ca7_zip, addresses_6ca7.state AS addresses_6ca7_state, <br/>
  addresses_6ca7.street AS addresses_6ca7_street <br/>
  FROM addresses, users LEFT OUTER JOIN addresses AS addresses_6ca7 ON users.user_id = addresses_6ca7.user_id <br/>
  WHERE addresses.street = :addresses_street AND users.user_id = addresses.user_id ORDER BY users.oid, addresses_6ca7.oid<br/>
  {'addresses_street': '123 Green Street'}</div><pre><span class="python_operator"></span></pre></div>
<p>The join implied by passing the "street" parameter is separate from the join produced by the eager join, which is "aliasized" to prevent conflicts.
</p>


    </div>

    <a href="#datamapping" class="toclink">back to section top</a>
</div>




<A name="datamapping_selectrelations_options"></a>

<div class="subsection" style="margin-left:30px;">


<h3>Using Options to Change the Loading Strategy</h3>

    <div class="sectiontext">
    

<p>The <code>options</code> method on the <code>Query</code> object provides an easy way to get alternate forms of a mapper query from an original one.  The most common use of this feature is to change the "eager/lazy" loading behavior of a particular mapper, via the functions <code>eagerload()</code>, <code>lazyload()</code> and <code>noload()</code>:
</p>


<div class="sliding_code">
<pre><span class="python_comment"># user mapper with lazy addresses
</span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">users_table</span><span class="python_operator">, </span><span class="python_name">properties </span><span class="python_operator">= </span><span class="python_enclosure">{</span>
             <span class="python_literal">'addresses' </span><span class="python_operator">: </span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_operator">, </span><span class="python_name">addresses_table</span><span class="python_enclosure">))</span>
         <span class="python_enclosure">}</span>
<span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># query object
</span><span class="python_name">query </span><span class="python_operator">= </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># make an eager loading query
</span><span class="python_name">eagerquery </span><span class="python_operator">= </span><span class="python_name">query</span><span class="python_operator">.</span><span class="python_name">options</span><span class="python_enclosure">(</span><span class="python_name">eagerload</span><span class="python_enclosure">(</span><span class="python_literal">'addresses'</span><span class="python_enclosure">))</span><span class="python_operator">
</span><span class="python_name">u </span><span class="python_operator">= </span><span class="python_name">eagerquery</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_comment"># make another query that wont load the addresses at all
</span><span class="python_name">plainquery </span><span class="python_operator">= </span><span class="python_name">query</span><span class="python_operator">.</span><span class="python_name">options</span><span class="python_enclosure">(</span><span class="python_name">noload</span><span class="python_enclosure">(</span><span class="python_literal">'addresses'</span><span class="python_enclosure">))</span><span class="python_operator">
</span>
<span class="python_comment"># multiple options can be specified
</span><span class="python_name">myquery </span><span class="python_operator">= </span><span class="python_name">oldquery</span><span class="python_operator">.</span><span class="python_name">options</span><span class="python_enclosure">(</span><span class="python_name">lazyload</span><span class="python_enclosure">(</span><span class="python_literal">'tracker'</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">noload</span><span class="python_enclosure">(</span><span class="python_literal">'streets'</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">eagerload</span><span class="python_enclosure">(</span><span class="python_literal">'members'</span><span class="python_enclosure">))</span><span class="python_operator">
</span>
<span class="python_comment"># to specify a relation on a relation, separate the property names by a "."
</span><span class="python_name">myquery </span><span class="python_operator">= </span><span class="python_name">oldquery</span><span class="python_operator">.</span><span class="python_name">options</span><span class="python_enclosure">(</span><span class="python_name">eagerload</span><span class="python_enclosure">(</span><span class="python_literal">'orders.items'</span><span class="python_enclosure">))</span><span class="python_operator"></span></pre></div>


    </div>

</div>



    </div>

    <a href="#datamapping" class="toclink">back to section top</a>
</div>




<A name="datamapping_onetoone"></a>

<div class="subsection" style="margin-left:20px;">


<h3>One to One/Many to One</h3>

    <div class="sectiontext">
    

<p>The above examples focused on the "one-to-many" relationship.  To do other forms of relationship is easy, as the <code>relation</code> function can usually figure out what you want:
</p>


<div class="code">
<pre><span class="python_name">metadata </span><span class="python_operator">= </span><span class="python_name">MetaData</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_comment"># a table to store a user's preferences for a site
</span><span class="python_name">prefs_table </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'user_prefs'</span><span class="python_operator">, </span><span class="python_name">metadata</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'pref_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key </span><span class="python_operator">= </span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'stylename'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">20</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'save_password'</span><span class="python_operator">, </span><span class="python_name">Boolean</span><span class="python_operator">, </span><span class="python_name">nullable </span><span class="python_operator">= </span><span class="python_name">False</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'timezone'</span><span class="python_operator">, </span><span class="python_name">CHAR</span><span class="python_enclosure">(</span><span class="python_number">3</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">nullable </span><span class="python_operator">= </span><span class="python_name">False</span><span class="python_enclosure">)</span>
<span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># user table with a 'preference_id' column
</span><span class="python_name">users_table </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'users'</span><span class="python_operator">, </span><span class="python_name">metadata</span><span class="python_operator">, </span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'user_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key </span><span class="python_operator">= </span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'user_name'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">16</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">nullable </span><span class="python_operator">= </span><span class="python_name">False</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'password'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">20</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">nullable </span><span class="python_operator">= </span><span class="python_name">False</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'preference_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">ForeignKey</span><span class="python_enclosure">(</span><span class="python_literal">"user_prefs.pref_id"</span><span class="python_enclosure">))</span>
<span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># engine and some test data
</span><span class="python_name">engine </span><span class="python_operator">= </span><span class="python_name">create_engine</span><span class="python_enclosure">(</span><span class="python_literal">'sqlite:///'</span><span class="python_operator">, </span><span class="python_name">echo</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">metadata</span><span class="python_operator">.</span><span class="python_name">create_all</span><span class="python_enclosure">(</span><span class="python_name">engine</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">engine</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_name">prefs_table</span><span class="python_operator">.</span><span class="python_name">insert</span><span class="python_enclosure">()</span><span class="python_operator">, </span><span class="python_name">dict</span><span class="python_enclosure">(</span><span class="python_name">pref_id</span><span class="python_operator">=</span><span class="python_number">1</span><span class="python_operator">, </span><span class="python_name">stylename</span><span class="python_operator">=</span><span class="python_literal">'green'</span><span class="python_operator">, </span><span class="python_name">save_password</span><span class="python_operator">=</span><span class="python_number">1</span><span class="python_operator">, </span><span class="python_name">timezone</span><span class="python_operator">=</span><span class="python_literal">'EST'</span><span class="python_enclosure">))</span><span class="python_operator">
</span><span class="python_name">engine</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_name">users_table</span><span class="python_operator">.</span><span class="python_name">insert</span><span class="python_enclosure">()</span><span class="python_operator">, </span><span class="python_name">dict</span><span class="python_enclosure">(</span><span class="python_name">user_name </span><span class="python_operator">= </span><span class="python_literal">'fred'</span><span class="python_operator">, </span><span class="python_name">password</span><span class="python_operator">=</span><span class="python_literal">'45nfss'</span><span class="python_operator">, </span><span class="python_name">preference_id</span><span class="python_operator">=</span><span class="python_number">1</span><span class="python_enclosure">))</span><span class="python_operator">
</span>
<span class="python_comment"># classes
</span><span class="python_keyword">class </span><span class="python_name">User</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">def </span><span class="python_name">__init__</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">user_name</span><span class="python_operator">, </span><span class="python_name">password</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">user_name </span><span class="python_operator">= </span><span class="python_name">user_name</span><span class="python_operator">
        </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">password </span><span class="python_operator">= </span><span class="python_name">password</span><span class="python_operator">
</span>
<span class="python_operator"></span><span class="python_keyword">class </span><span class="python_name">UserPrefs</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">pass</span><span class="python_operator">
</span>
<span class="python_operator"></span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">UserPrefs</span><span class="python_operator">, </span><span class="python_name">prefs_table</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">users_table</span><span class="python_operator">, </span><span class="python_name">properties </span><span class="python_operator">= </span><span class="python_name">dict</span><span class="python_enclosure">(</span>
    <span class="python_name">preferences </span><span class="python_operator">= </span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">UserPrefs</span><span class="python_operator">, </span><span class="python_name">lazy</span><span class="python_operator">=</span><span class="python_name">False</span><span class="python_operator">, </span><span class="python_name">cascade</span><span class="python_operator">=</span><span class="python_literal">"all, delete-orphan"</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
<span class="python_enclosure">))</span><span class="python_operator">
</span>
<span class="python_comment"># select
</span><span class="python_name">session </span><span class="python_operator">= </span><span class="python_name">create_session</span><span class="python_enclosure">(</span><span class="python_name">bind_to</span><span class="python_operator">=</span><span class="python_name">engine</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_86', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">user </span><span class="python_operator">= </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">get_by</span><span class="python_enclosure">(</span><span class="python_name">user_name</span><span class="python_operator">=</span><span class="python_literal">'fred'</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre><div id="popbox_86_div" class="codepop" style="display:none;">SELECT users.preference_id AS users_preference_id, users.user_name AS users_user_name, <br/>
  users.password AS users_password, users.user_id AS users_user_id, <br/>
  user_prefs_4eb2.timezone AS user_prefs_4eb2_timezone, user_prefs_4eb2.stylename AS user_prefs_4eb2_stylename, <br/>
  user_prefs_4eb2.save_password AS user_prefs_4eb2_save_password, user_prefs_4eb2.pref_id AS user_prefs_4eb2_pref_id <br/>
  FROM (SELECT users.user_id AS users_user_id FROM users WHERE users.user_name = :users_user_name ORDER BY users.oid <br/>
  LIMIT 1 OFFSET 0) AS rowcount, <br/>
  users LEFT OUTER JOIN user_prefs AS user_prefs_4eb2 ON user_prefs_4eb2.pref_id = users.preference_id <br/>
  WHERE rowcount.users_user_id = users.user_id ORDER BY users.oid, user_prefs_4eb2.oid<br/>
  {'users_user_name': 'fred'}</div><pre><span class="python_name">save_password </span><span class="python_operator">= </span><span class="python_name">user</span><span class="python_operator">.</span><span class="python_name">preferences</span><span class="python_operator">.</span><span class="python_name">save_password</span><span class="python_operator">
</span>
<span class="python_comment"># modify
</span><span class="python_name">user</span><span class="python_operator">.</span><span class="python_name">preferences</span><span class="python_operator">.</span><span class="python_name">stylename </span><span class="python_operator">= </span><span class="python_literal">'bluesteel'</span><span class="python_operator">
</span>
<span class="python_comment"># flush
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_87', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">flush</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_87_div" class="codepop" style="display:none;">UPDATE user_prefs SET stylename=:stylename<br/>
  WHERE user_prefs.pref_id = :pref_id<br/>
  [{'stylename': 'bluesteel', 'pref_id': 1}]</div><pre><span class="python_operator"></span></pre></div>


    </div>

    <a href="#datamapping" class="toclink">back to section top</a>
</div>




<A name="datamapping_manytomany"></a>

<div class="subsection" style="margin-left:20px;">


<h3>Many to Many</h3>

    <div class="sectiontext">
    

<p>The <code>relation</code> function handles a basic many-to-many relationship when you specify the association table:
</p>


<div class="code">
<pre><span class="python_name">metadata </span><span class="python_operator">= </span><span class="python_name">MetaData</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_name">articles_table </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'articles'</span><span class="python_operator">, </span><span class="python_name">metadata</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'article_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key </span><span class="python_operator">= </span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'headline'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">150</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">key</span><span class="python_operator">=</span><span class="python_literal">'headline'</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'body'</span><span class="python_operator">, </span><span class="python_name">TEXT</span><span class="python_operator">, </span><span class="python_name">key</span><span class="python_operator">=</span><span class="python_literal">'body'</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
<span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_name">keywords_table </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'keywords'</span><span class="python_operator">, </span><span class="python_name">metadata</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'keyword_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key </span><span class="python_operator">= </span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'keyword_name'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">50</span><span class="python_enclosure">))</span>
<span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_name">itemkeywords_table </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'article_keywords'</span><span class="python_operator">, </span><span class="python_name">metadata</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'article_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">ForeignKey</span><span class="python_enclosure">(</span><span class="python_literal">"articles.article_id"</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'keyword_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">ForeignKey</span><span class="python_enclosure">(</span><span class="python_literal">"keywords.keyword_id"</span><span class="python_enclosure">))</span>
<span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_name">engine </span><span class="python_operator">= </span><span class="python_name">create_engine</span><span class="python_enclosure">(</span><span class="python_literal">'sqlite:///'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">metadata</span><span class="python_operator">.</span><span class="python_name">create_all</span><span class="python_enclosure">(</span><span class="python_name">engine</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># class definitions
</span><span class="python_keyword">class </span><span class="python_name">Keyword</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">def </span><span class="python_name">__init__</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">name</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">keyword_name </span><span class="python_operator">= </span><span class="python_name">name</span><span class="python_operator">
</span>
<span class="python_operator"></span><span class="python_keyword">class </span><span class="python_name">Article</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">pass</span><span class="python_operator">
</span>
<span class="python_operator"></span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Keyword</span><span class="python_operator">, </span><span class="python_name">keywords_table</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># define a mapper that does many-to-many on the 'itemkeywords' association 
# table
</span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Article</span><span class="python_operator">, </span><span class="python_name">articles_table</span><span class="python_operator">, </span><span class="python_name">properties </span><span class="python_operator">= </span><span class="python_name">dict</span><span class="python_enclosure">(</span>
    <span class="python_name">keywords </span><span class="python_operator">= </span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">Keyword</span><span class="python_operator">, </span><span class="python_name">secondary</span><span class="python_operator">=</span><span class="python_name">itemkeywords_table</span><span class="python_operator">, </span><span class="python_name">lazy</span><span class="python_operator">=</span><span class="python_name">False</span><span class="python_enclosure">)</span>
    <span class="python_enclosure">)</span>
<span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_name">session </span><span class="python_operator">= </span><span class="python_name">create_session</span><span class="python_enclosure">(</span><span class="python_name">bind_to</span><span class="python_operator">=</span><span class="python_name">engine</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_name">article </span><span class="python_operator">= </span><span class="python_name">Article</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_name">article</span><span class="python_operator">.</span><span class="python_name">headline </span><span class="python_operator">= </span><span class="python_literal">'a headline'</span><span class="python_operator">
</span><span class="python_name">article</span><span class="python_operator">.</span><span class="python_name">body </span><span class="python_operator">= </span><span class="python_literal">'this is the body'</span><span class="python_operator">
</span><span class="python_name">article</span><span class="python_operator">.</span><span class="python_name">keywords</span><span class="python_operator">.</span><span class="python_name">append</span><span class="python_enclosure">(</span><span class="python_name">Keyword</span><span class="python_enclosure">(</span><span class="python_literal">'politics'</span><span class="python_enclosure">))</span><span class="python_operator">
</span><span class="python_name">article</span><span class="python_operator">.</span><span class="python_name">keywords</span><span class="python_operator">.</span><span class="python_name">append</span><span class="python_enclosure">(</span><span class="python_name">Keyword</span><span class="python_enclosure">(</span><span class="python_literal">'entertainment'</span><span class="python_enclosure">))</span><span class="python_operator">
</span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">save</span><span class="python_enclosure">(</span><span class="python_name">article</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_literal"><a href="javascript:togglePopbox('popbox_88', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">flush</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_88_div" class="codepop" style="display:none;">INSERT INTO keywords (name) VALUES (:name)<br/>
  {'name': 'politics'}<br/>
  INSERT INTO keywords (name) VALUES (:name)<br/>
  {'name': 'entertainment'}<br/>
  INSERT INTO articles (article_headline, article_body) VALUES (:article_headline, :article_body)<br/>
  {'article_body': 'this is the body', 'article_headline': 'a headline'}<br/>
  INSERT INTO article_keywords (article_id, keyword_id) VALUES (:article_id, :keyword_id)<br/>
  [{'keyword_id': 1, 'article_id': 1}, {'keyword_id': 2, 'article_id': 1}]</div><pre><span class="python_comment"># select articles based on a keyword.  select_by will handle the extra joins.
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_89', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">articles </span><span class="python_operator">= </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">Article</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">select_by</span><span class="python_enclosure">(</span><span class="python_name">keyword_name</span><span class="python_operator">=</span><span class="python_literal">'politics'</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre><div id="popbox_89_div" class="codepop" style="display:none;">SELECT keywords_e2f2.keyword_id AS keywords_e2f2_keyword_id, keywords_e2f2.keyword_name AS keywords_e2f2_keyword_name, <br/>
  articles.headline AS articles_headline, articles.body AS articles_body, articles.article_id AS articles_article_id <br/>
  FROM keywords, article_keywords, articles <br/>
  LEFT OUTER JOIN article_keywords AS article_keyword_3da2 ON articles.article_id = article_keyword_3da2.article_id <br/>
  LEFT OUTER JOIN keywords AS keywords_e2f2 ON keywords_e2f2.keyword_id = article_keyword_3da2.keyword_id <br/>
  WHERE (keywords.keyword_name = :keywords_keywords_name AND articles.article_id = article_keywords.article_id) <br/>
  AND keywords.keyword_id = article_keywords.keyword_id ORDER BY articles.oid, article_keyword_3da2.oid<br/>
  {'keywords_keyword_name': 'politics'}</div><pre><span class="python_name">a </span><span class="python_operator">= </span><span class="python_name">articles</span><span class="python_enclosure">[</span><span class="python_number">0</span><span class="python_enclosure">]</span><span class="python_operator">
</span>
<span class="python_comment"># clear out keywords with a new list
</span><span class="python_name">a</span><span class="python_operator">.</span><span class="python_name">keywords </span><span class="python_operator">= </span><span class="python_enclosure">[]</span><span class="python_operator">
</span><span class="python_name">a</span><span class="python_operator">.</span><span class="python_name">keywords</span><span class="python_operator">.</span><span class="python_name">append</span><span class="python_enclosure">(</span><span class="python_name">Keyword</span><span class="python_enclosure">(</span><span class="python_literal">'topstories'</span><span class="python_enclosure">))</span><span class="python_operator">
</span><span class="python_name">a</span><span class="python_operator">.</span><span class="python_name">keywords</span><span class="python_operator">.</span><span class="python_name">append</span><span class="python_enclosure">(</span><span class="python_name">Keyword</span><span class="python_enclosure">(</span><span class="python_literal">'government'</span><span class="python_enclosure">))</span><span class="python_operator">
</span>
<span class="python_comment"># flush
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_90', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">flush</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_90_div" class="codepop" style="display:none;">INSERT INTO keywords (name) VALUES (:name)<br/>
  {'name': 'topstories'}<br/>
  INSERT INTO keywords (name) VALUES (:name)<br/>
  {'name': 'government'}<br/>
  DELETE FROM article_keywords <br/>
  WHERE article_keywords.article_id = :article_id <br/>
  AND article_keywords.keyword_id = :keyword_id<br/>
  [{'keyword_id': 1, 'article_id': 1}, {'keyword_id': 2, 'article_id': 1}]<br/>
  INSERT INTO article_keywords (article_id, keyword_id) VALUES (:article_id, :keyword_id)<br/>
  [{'keyword_id': 3, 'article_id': 1}, {'keyword_id': 4, 'article_id': 1}]</div><pre><span class="python_operator"></span></pre></div>


    </div>

    <a href="#datamapping" class="toclink">back to section top</a>
</div>




<A name="datamapping_association"></a>

<div class="subsection" style="margin-left:20px;">


<h3>Association Object</h3>

    <div class="sectiontext">
    

<p>Many to Many can also be done with an association object, that adds additional information about how two items are related.  In this pattern, the "secondary" option to <code>relation()</code> is no longer used; instead, the association object becomes a mapped entity itself, mapped to the association table.  If the association table has no explicit primary key columns defined, you also have to tell the mapper what columns will compose its "primary key", which are typically the two (or more) columns involved in the association.  Also, the relation between the parent and association mapping is typically set up with a cascade of <code>all, delete-orphan</code>.  This is to insure that when an association object is removed from its parent collection, it is deleted (otherwise, the unit of work tries to null out one of the foreign key columns, which raises an error condition since that column is also part of its "primary key").
</p>


<div class="code">
<pre><span class="python_keyword">from </span><span class="python_name">sqlalchemy </span><span class="python_keyword">import </span><span class="python_operator">*
</span><span class="python_name">metadata </span><span class="python_operator">= </span><span class="python_name">MetaData</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_name">users_table </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'users'</span><span class="python_operator">, </span><span class="python_name">metadata</span><span class="python_operator">, </span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'user_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key </span><span class="python_operator">= </span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'user_name'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">16</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">nullable </span><span class="python_operator">= </span><span class="python_name">False</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
<span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_name">articles_table </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'articles'</span><span class="python_operator">, </span><span class="python_name">metadata</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'article_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key </span><span class="python_operator">= </span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'headline'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">150</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">key</span><span class="python_operator">=</span><span class="python_literal">'headline'</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'body'</span><span class="python_operator">, </span><span class="python_name">TEXT</span><span class="python_operator">, </span><span class="python_name">key</span><span class="python_operator">=</span><span class="python_literal">'body'</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
<span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_name">keywords_table </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'keywords'</span><span class="python_operator">, </span><span class="python_name">metadata</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'keyword_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key </span><span class="python_operator">= </span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'keyword_name'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">50</span><span class="python_enclosure">))</span>
<span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># add "attached_by" column which will reference the user who attached this keyword
</span><span class="python_name">itemkeywords_table </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'article_keywords'</span><span class="python_operator">, </span><span class="python_name">metadata</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'article_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">ForeignKey</span><span class="python_enclosure">(</span><span class="python_literal">"articles.article_id"</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'keyword_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">ForeignKey</span><span class="python_enclosure">(</span><span class="python_literal">"keywords.keyword_id"</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'attached_by'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">ForeignKey</span><span class="python_enclosure">(</span><span class="python_literal">"users.user_id"</span><span class="python_enclosure">))</span>
<span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_name">engine </span><span class="python_operator">= </span><span class="python_name">create_engine</span><span class="python_enclosure">(</span><span class="python_literal">'sqlite:///'</span><span class="python_operator">, </span><span class="python_name">echo</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">metadata</span><span class="python_operator">.</span><span class="python_name">create_all</span><span class="python_enclosure">(</span><span class="python_name">engine</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># class definitions
</span><span class="python_keyword">class </span><span class="python_name">User</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">pass</span><span class="python_operator">
</span><span class="python_keyword">class </span><span class="python_name">Keyword</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">def </span><span class="python_name">__init__</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">name</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">keyword_name </span><span class="python_operator">= </span><span class="python_name">name</span><span class="python_operator">
</span><span class="python_keyword">class </span><span class="python_name">Article</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">pass</span><span class="python_operator">
</span><span class="python_keyword">class </span><span class="python_name">KeywordAssociation</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">pass</span><span class="python_operator">
</span>
<span class="python_comment"># Article mapper, relates to Keyword via KeywordAssociation
</span><span class="python_operator"></span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Article</span><span class="python_operator">, </span><span class="python_name">articles_table</span><span class="python_operator">, </span><span class="python_name">properties</span><span class="python_operator">=</span><span class="python_enclosure">{</span>
    <span class="python_literal">'keywords'</span><span class="python_operator">:</span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">KeywordAssociation</span><span class="python_operator">, </span><span class="python_name">lazy</span><span class="python_operator">=</span><span class="python_name">False</span><span class="python_operator">, </span><span class="python_name">cascade</span><span class="python_operator">=</span><span class="python_literal">"all, delete-orphan"</span><span class="python_enclosure">)</span>
    <span class="python_enclosure">}</span>
<span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># mapper for KeywordAssociation
# specify "primary key" columns manually
</span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">KeywordAssociation</span><span class="python_operator">, </span><span class="python_name">itemkeywords_table</span><span class="python_operator">,</span>
    <span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_enclosure">[</span><span class="python_name">itemkeywords_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">article_id</span><span class="python_operator">, </span><span class="python_name">itemkeywords_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">keyword_id</span><span class="python_enclosure">]</span><span class="python_operator">,</span>
    <span class="python_name">properties</span><span class="python_operator">=</span><span class="python_enclosure">{</span>
        <span class="python_literal">'keyword' </span><span class="python_operator">: </span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">Keyword</span><span class="python_operator">, </span><span class="python_name">lazy</span><span class="python_operator">=</span><span class="python_name">False</span><span class="python_enclosure">)</span><span class="python_operator">, </span>
        <span class="python_literal">'user' </span><span class="python_operator">: </span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">lazy</span><span class="python_operator">=</span><span class="python_name">False</span><span class="python_enclosure">) </span>
    <span class="python_enclosure">}</span>
<span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># user mapper
</span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">users_table</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># keyword mapper
</span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Keyword</span><span class="python_operator">, </span><span class="python_name">keywords_table</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_name">session </span><span class="python_operator">= </span><span class="python_name">create_session</span><span class="python_enclosure">(</span><span class="python_name">bind_to</span><span class="python_operator">=</span><span class="python_name">engine</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_comment"># select by keyword
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_91', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">alist </span><span class="python_operator">= </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">Article</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">select_by</span><span class="python_enclosure">(</span><span class="python_name">keyword_name</span><span class="python_operator">=</span><span class="python_literal">'jacks_stories'</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre><div id="popbox_91_div" class="codepop" style="display:none;">SELECT article_keyword_f9af.keyword_id AS article_keyword_f9af_key_b3e1, <br/>
  article_keyword_f9af.attached_by AS article_keyword_f9af_att_95d4, <br/>
  article_keyword_f9af.article_id AS article_keyword_f9af_art_fd49, <br/>
  users_9c30.user_name AS users_9c30_user_name, users_9c30.user_id AS users_9c30_user_id, <br/>
  keywords_dc54.keyword_id AS keywords_dc54_keyword_id, keywords_dc54.keyword_name AS keywords_dc54_keyword_name, <br/>
  articles.headline AS articles_headline, articles.body AS articles_body, articles.article_id AS articles_article_id <br/>
  FROM keywords, article_keywords, articles <br/>
  LEFT OUTER JOIN article_keywords AS article_keyword_f9af ON articles.article_id = article_keyword_f9af.article_id <br/>
  LEFT OUTER JOIN users AS users_9c30 ON users_9c30.user_id = article_keyword_f9af.attached_by <br/>
  LEFT OUTER JOIN keywords AS keywords_dc54 ON keywords_dc54.keyword_id = article_keyword_f9af.keyword_id <br/>
  WHERE (keywords.keyword_name = :keywords_keywords_name AND keywords.keyword_id = article_keywords.keyword_id) <br/>
  AND articles.article_id = article_keywords.article_id <br/>
  ORDER BY articles.oid, article_keyword_f9af.oid, users_9c30.oid, keywords_dc54.oid<br/>
  {'keywords_keywords_name': 'jacks_stories'}</div><pre><span class="python_comment"># user is available
</span><span class="python_keyword">for </span><span class="python_name">a </span><span class="python_keyword">in </span><span class="python_name">alist</span><span class="python_operator">:
    </span><span class="python_keyword">for </span><span class="python_name">k </span><span class="python_keyword">in </span><span class="python_name">a</span><span class="python_operator">.</span><span class="python_name">keywords</span><span class="python_operator">:
        </span><span class="python_keyword">if </span><span class="python_name">k</span><span class="python_operator">.</span><span class="python_name">keyword</span><span class="python_operator">.</span><span class="python_name">name </span><span class="python_operator">== </span><span class="python_literal">'jacks_stories'</span><span class="python_operator">:
            </span><span class="python_keyword">print </span><span class="python_name">k</span><span class="python_operator">.</span><span class="python_name">user</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator"></span></pre></div>
<p>Keep in mind that the association object works a little differently from a plain many-to-many relationship.  Members have to be added to the list via instances of the association object, which in turn point to the associated object:
</p>


<div class="sliding_code">
<pre><span class="python_name">user </span><span class="python_operator">= </span><span class="python_name">User</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_name">user</span><span class="python_operator">.</span><span class="python_name">user_name </span><span class="python_operator">= </span><span class="python_literal">'some user'</span><span class="python_operator">
</span>
<span class="python_name">article </span><span class="python_operator">= </span><span class="python_name">Article</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_name">assoc </span><span class="python_operator">= </span><span class="python_name">KeywordAssociation</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_name">assoc</span><span class="python_operator">.</span><span class="python_name">keyword </span><span class="python_operator">= </span><span class="python_name">Keyword</span><span class="python_enclosure">(</span><span class="python_literal">'blue'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">assoc</span><span class="python_operator">.</span><span class="python_name">user </span><span class="python_operator">= </span><span class="python_name">user</span><span class="python_operator">
</span>
<span class="python_name">assoc2 </span><span class="python_operator">= </span><span class="python_name">KeywordAssociation</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_name">assoc2</span><span class="python_operator">.</span><span class="python_name">keyword </span><span class="python_operator">= </span><span class="python_name">Keyword</span><span class="python_enclosure">(</span><span class="python_literal">'green'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">assoc2</span><span class="python_operator">.</span><span class="python_name">user </span><span class="python_operator">= </span><span class="python_name">user</span><span class="python_operator">
</span>
<span class="python_name">article</span><span class="python_operator">.</span><span class="python_name">keywords</span><span class="python_operator">.</span><span class="python_name">append</span><span class="python_enclosure">(</span><span class="python_name">assoc</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">article</span><span class="python_operator">.</span><span class="python_name">keywords</span><span class="python_operator">.</span><span class="python_name">append</span><span class="python_enclosure">(</span><span class="python_name">assoc2</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">save</span><span class="python_enclosure">(</span><span class="python_name">article</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">flush</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre></div>
<p>SQLAlchemy includes an extension module which can be used in some cases to decrease the explicitness of the association object pattern; this extension is described in <a href="plugins.html#plugins_associationproxy">associationproxy</a>.
</p>



    </div>

</div>



    </div>

    <a href="#datamapping" class="toclink">back to section top</a>
</div>


</html></div>
<A name="unitofwork"></a>

<div class="sectionnavblock">
<div class="sectionnav">

        Previous: <a href="#datamapping">Data Mapping</a>

                |

        Next: <a href="#advdatamapping">Advanced Data Mapping</a>

</div>
</div>

<div class="topnavmain">
	<div class="topnavheader">Session / Unit of Work</div>
</div>
<div class="sectioncontent">
<html>



<A name="unitofwork"></a>

<div class="subsection" style="margin-left:10px;">



    <div class="sectiontext">
    




<A name="unitofwork_overview"></a>

<div class="subsection" style="margin-left:20px;">


<h3>Overview</h3>

    <div class="sectiontext">
    

<p>The concept behind Unit of Work is to track modifications to a field of objects, and then be able to flush those changes to the database in a single operation.  Theres a lot of advantages to this, including that your application doesn't need to worry about individual save operations on objects, nor about the required order for those operations, nor about excessive repeated calls to save operations that would be more efficiently aggregated into one step.  It also simplifies database transactions, providing a neat package with which to insert into the traditional database begin/commit phase.
</p>
<p>SQLAlchemy's unit of work includes these functions:
</p>
<ul>
 <li>
     The ability to monitor scalar and list attributes on object instances, as well as object creates.  This is handled via the attributes package.
 </li>

 <li>
     The ability to maintain and process a list of modified objects, and based on the relationships set up by the mappers for those objects as well as the foreign key relationships of the underlying tables, figure out the proper order of operations so that referential integrity is maintained, and also so that on-the-fly values such as newly created primary keys can be propigated to dependent objects that need them before they are saved.  The central algorithm for this is the <em>topological sort</em>.
 </li>

 <li>
     The ability to define custom functionality that occurs within the unit-of-work flush phase, such as "before insert", "after insert", etc.  This is accomplished via MapperExtension.
 </li>

 <li>
     an Identity Map, which is a dictionary storing the one and only instance of an object for a particular table/primary key combination.  This allows many parts of an application to get a handle to a particular object without any chance of modifications going to two different places.
 </li>

 <li>
     The sole interface to the unit of work is provided via the <code>Session</code> object.  Transactional capability, which rides on top of the transactions provided by <code>Engine</code> objects, is provided by the <code>SessionTransaction</code> object.
 </li>

 <li>
     Thread-locally scoped Session behavior is available as an option, which allows new objects to be automatically added to the Session corresponding to by the <em>default Session context</em>.  Without a default Session context, an application must explicitly create a Session manually as well as add new objects to it.  The default Session context, disabled by default, can also be plugged in with other user-defined schemes, which may also take into account the specific class being dealt with for a particular operation.
 </li>

 <li>
     The Session object borrows conceptually from that of <a href='http://www.hibernate.org'>Hibernate</a>, a leading ORM for Java that was a great influence on the creation of the <a href='http://jcp.org/aboutJava/communityprocess/pfd/jsr220/index.html'>JSR-220</a> specification.  SQLAlchemy, under no obligation to conform to EJB specifications, is in general very different from Hibernate, providing a different paradigm for producing queries, a SQL API that is useable independently of the ORM, and of course Pythonic configuration as opposed to XML; however, JSR-220/Hibernate makes some pretty good suggestions with regards to the mechanisms of persistence.
 </li>
</ul>


    </div>

    <a href="#unitofwork" class="toclink">back to section top</a>
</div>




<A name="unitofwork_states"></a>

<div class="subsection" style="margin-left:20px;">


<h3>Object States</h3>

    <div class="sectiontext">
    

<p>When dealing with mapped instances with regards to Sessions, an instance may be <em>attached</em> or <em>unattached</em> to a particular Session.  An instance also may or may not correspond to an actual row in the database.  The product of these two binary conditions yields us four general states a particular instance can have within the perspective of the Session:
</p>
<ul>
 <li><p><em>Transient</em> - a transient instance exists within memory only and is not associated with any Session.  It also has no database identity and does not have a corresponding record in the database.  When a new instance of a class is constructed, and no default session context exists with which to automatically attach the new instance, it is a transient instance.  The instance can then be saved to a particular session in which case it becomes a <em>pending</em> instance.  If a default session context exists, new instances are added to that Session by default and therefore become <em>pending</em> instances immediately.
</p>

 </li>

 <li><p><em>Pending</em> - a pending instance is a Session-attached object that has not yet been assigned a database identity.  When the Session is flushed (i.e. changes are persisted to the database), a pending instance becomes persistent.
</p>

 </li>

 <li><p><em>Persistent</em> - a persistent instance has a database identity and a corresponding record in the database, and is also associated with a particular Session.   By "database identity" we mean the object is associated with a table or relational concept in the database combined with a particular primary key in that table.  Objects that are loaded by SQLAlchemy in the context of a particular session are automatically considered persistent, as are formerly pending instances which have been subject to a session <code>flush()</code>.
</p>

 </li>

 <li><p><em>Detached</em> - a detached instance is an instance which has a database identity and corresponding row in the database, but is not attached to any Session.  This occurs when an instance has been removed from a Session, either because the session itself was cleared or closed, or the instance was explicitly removed from the Session.  The object can be re-attached with a session again in which case it becomes Persistent again.  Detached instances are useful when an application needs to represent a long-running operation across multiple Sessions, needs to store an object in a serialized state and then restore it later (such as within an HTTP "session" object), or in some cases where code needs to load instances locally which will later be associated with some other Session.
</p>

 </li>
</ul>


    </div>

    <a href="#unitofwork" class="toclink">back to section top</a>
</div>




<A name="unitofwork_getting"></a>

<div class="subsection" style="margin-left:20px;">


<h3>Acquiring a Session</h3>

    <div class="sectiontext">
    

<p>A new Session object is constructed via the <code>create_session()</code> function:
</p>


<div class="sliding_code">
<pre><span class="python_name">session </span><span class="python_operator">= </span><span class="python_name">create_session</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre></div>
<p>A common option used with <code>create_session()</code> is to specify a specific <code>Engine</code> or <code>Connection</code> to be used for all operations performed by this Session:
</p>


<div class="sliding_code">
<pre><span class="python_comment"># create an engine
</span><span class="python_name">e </span><span class="python_operator">= </span><span class="python_name">create_engine</span><span class="python_enclosure">(</span><span class="python_literal">'postgres://some/url'</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># create a Session that will use this engine for all operations.
# it will open and close Connections as needed.
</span><span class="python_name">session </span><span class="python_operator">= </span><span class="python_name">create_session</span><span class="python_enclosure">(</span><span class="python_name">bind_to</span><span class="python_operator">=</span><span class="python_name">e</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># open a Connection
</span><span class="python_name">conn </span><span class="python_operator">= </span><span class="python_name">e</span><span class="python_operator">.</span><span class="python_name">connect</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_comment"># create a Session that will use this specific Connection for all operations
</span><span class="python_name">session </span><span class="python_operator">= </span><span class="python_name">create_session</span><span class="python_enclosure">(</span><span class="python_name">bind_to</span><span class="python_operator">=</span><span class="python_name">conn</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre></div>
<p>The session to which an object is attached can be acquired via the <code>object_session()</code> function, which returns the appropriate <code>Session</code> if the object is pending or persistent, or <code>None</code> if the object is transient or detached:
</p>


<div class="sliding_code">
<pre><span class="python_name">session </span><span class="python_operator">= </span><span class="python_name">object_session</span><span class="python_enclosure">(</span><span class="python_name">obj</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre></div>
<p>Session Facts:
</p>
<ul>
 <li>
     the Session object is <strong>not threadsafe</strong>.  For thread-local management of Sessions, the recommended approch is to use the <a href="plugins.html#plugins_sessioncontext">SessionContext</a> extension module.
 </li>
</ul>
<p>We will now cover some of the key concepts used by Sessions and its underlying Unit of Work.
</p>


    </div>

    <a href="#unitofwork" class="toclink">back to section top</a>
</div>




<A name="unitofwork_identitymap"></a>

<div class="subsection" style="margin-left:20px;">


<h3>Introduction to the Identity Map</h3>

    <div class="sectiontext">
    

<p>A primary concept of the Session's underlying Unit of Work is that it is keeps track of all persistent instances; recall that a persistent instance has a database identity and is attached to a Session.  In particular, the Unit of Work must insure that only <em>one</em> copy of a particular persistent instance exists within the Session at any given time.   The UOW accomplishes this task using a dictionary known as an <em>Identity Map</em>.
</p>
<p>When a <code>Query</code> is used to issue <code>select</code> or <code>get</code> requests to the database, it will in nearly all cases result in an actual SQL execution to the database, and a corresponding traversal of rows received from that execution.  However, when the underlying mapper actually <em>creates</em> objects corresponding to the result set rows it receives, it will check the session's identity map first before instantating a new object, and return the same instance already present in the identity map if it already exists, essentially <em>ignoring</em> the object state represented by that row.  There are several ways to override this behavior and truly refresh an already-loaded instance which are described later, but the main idea is that once your instance is loaded into a particular Session, it will <em>never change</em> its state without your explicit approval, regardless of what the database says about it.
</p>
<p>For example; below, two separate calls to load an instance with database identity "15" are issued, and the results assigned to two separate variables.   However, since the same <code>Session</code> was used, the two instances are the same instance:
</p>


<div class="sliding_code">
<pre><span class="python_name">mymapper </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">MyClass</span><span class="python_operator">, </span><span class="python_name">mytable</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_name">session </span><span class="python_operator">= </span><span class="python_name">create_session</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_name">obj1 </span><span class="python_operator">= </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">MyClass</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">selectfirst</span><span class="python_enclosure">(</span><span class="python_name">mytable</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">id</span><span class="python_operator">==</span><span class="python_number">15</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">obj2 </span><span class="python_operator">= </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">MyClass</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">selectfirst</span><span class="python_enclosure">(</span><span class="python_name">mytable</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">id</span><span class="python_operator">==</span><span class="python_number">15</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_literal">>>> </span><span class="python_name">obj1 </span><span class="python_keyword">is </span><span class="python_name">obj2</span><span class="python_operator">
</span><span class="python_name">True</span><span class="python_operator"></span></pre></div>
<p>The Identity Map is an instance of <code>dict</code> by default.  (This is new as of version 0.3.2).  As an option, you can specify the flag <code>weak_identity_map=True</code> to the <code>create_session</code> function so that it will use a <code>weakref.WeakValueDictionary</code>, so that when an in-memory object falls out of scope, it will be removed automatically, thereby providing some automatic management of memory.   However, this may not be instant if there are circular references upon the object.  To guarantee that an instance is removed from the identity map before removing references to it, use the <code>expunge()</code> method, described later, to remove it.  Additionally, note that an object that has changes marked on it (i.e. "dirty") can still fall out of scope when using <code>weak_identity_map</code>.
</p>
<p>The Session supports an iterator interface in order to see all objects in the identity map:
</p>


<div class="sliding_code">
<pre><span class="python_keyword">for </span><span class="python_name">obj </span><span class="python_keyword">in </span><span class="python_name">session</span><span class="python_operator">:
    </span><span class="python_keyword">print </span><span class="python_name">obj</span><span class="python_operator"></span></pre></div>
<p>As well as <code>__contains__()</code>:
</p>


<div class="sliding_code">
<pre><span class="python_keyword">if </span><span class="python_name">obj </span><span class="python_keyword">in </span><span class="python_name">session</span><span class="python_operator">:
    </span><span class="python_keyword">print </span><span class="python_literal">"Object is present"</span><span class="python_operator"></span></pre></div>
<p>The identity map itself is accessible via the <code>identity_map</code> accessor:
</p>


<div class="sliding_code">
<pre><span class="python_literal">>>> </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">identity_map</span><span class="python_operator">.</span><span class="python_name">values</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_enclosure">[</span><span class="python_operator"><</span><span class="python_name">__main__</span><span class="python_operator">.</span><span class="python_name">User object at </span><span class="python_number">0x712630</span><span class="python_operator">>, <</span><span class="python_name">__main__</span><span class="python_operator">.</span><span class="python_name">Address object at </span><span class="python_number">0x712a70</span><span class="python_operator">></span><span class="python_enclosure">]</span><span class="python_operator"></span></pre></div>
<p>The identity of each object instance is available via the <code>_instance_key</code> property attached to each object instance, and is a tuple consisting of the object's class and an additional tuple of primary key values, in the order that they appear within the table definition:
</p>


<div class="sliding_code">
<pre><span class="python_literal">>>> </span><span class="python_name">obj</span><span class="python_operator">.</span><span class="python_name">_instance_key </span><span class="python_operator">
</span><span class="python_enclosure">(</span><span class="python_operator"><</span><span class="python_keyword">class </span><span class="python_literal">'test.tables.User'</span><span class="python_operator">>, </span><span class="python_enclosure">(</span><span class="python_number">7</span><span class="python_operator">,</span><span class="python_enclosure">))</span><span class="python_operator"></span></pre></div>
<p>At the moment that an object is assigned this key within a <code>flush()</code> operation, it is also added to the session's identity map.
</p>
<p>The <code>get()</code> method on <code>Query</code>, which retrieves an object based on primary key identity, also checks in the Session's identity map first to save a database round-trip if possible.  In the case of an object lazy-loading a single child object, the <code>get()</code> method is used as well, so scalar-based lazy loads may in some cases not query the database; this is particularly important for backreference relationships as it can save a lot of queries.
</p>


    </div>

    <a href="#unitofwork" class="toclink">back to section top</a>
</div>




<A name="unitofwork_changed"></a>

<div class="subsection" style="margin-left:20px;">


<h3>Whats Changed ?</h3>

    <div class="sectiontext">
    

<p>The next concept is that in addition to the <code>Session</code> storing a record of all objects loaded or saved, it also stores lists of all <em>newly created</em> (i.e. pending) objects and lists of all persistent objects that have been marked as <em>deleted</em>.  These lists are used when a <code>flush()</code> call is issued to save all changes.  During a flush operation, it also scans its list of persistent instances for changes which are marked as dirty.
</p>
<p>These records are all tracked by collection functions that are also viewable off the <code>Session</code> as properties:
</p>


<div class="sliding_code">
<pre><span class="python_comment"># pending objects recently added to the Session
</span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">new</span><span class="python_operator">
</span>
<span class="python_comment"># persistent objects which currently have changes detected
# (this collection is now created on the fly each time the property is called)
</span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">dirty</span><span class="python_operator">
</span>
<span class="python_comment"># persistent objects that have been marked as deleted via session.delete(obj)
</span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">deleted</span><span class="python_operator"></span></pre></div>
<p>Note that if a session is created with the <code>weak_identity_map</code> flag, an item which is marked as "dirty" will be silently removed from the session if the item falls out of scope in the user application.  This is because the unit of work does not look for "dirty" changes except for within a flush operation (or any time the session.dirty collection is accessed). 
</p>
<p>As for objects inside of <code>new</code> and <code>deleted</code>, if you abandon all references to new or modified objects within a session, <em>they are still present</em> in either of those two lists, and will be saved on the next flush operation, unless they are removed from the Session explicitly (more on that later).  <br></br>
</p>


    </div>

    <a href="#unitofwork" class="toclink">back to section top</a>
</div>




<A name="unitofwork_api"></a>

<div class="subsection" style="margin-left:20px;">


<h3>The Session API</h3>

    <div class="sectiontext">
    




<A name="unitofwork_api_query"></a>

<div class="subsection" style="margin-left:30px;">


<h3>query()</h3>

    <div class="sectiontext">
    

<p>The <code>query()</code> function takes a class or <code>Mapper</code> as an argument, along with an optional <code>entity_name</code> parameter, and returns a new <code>Query</code> object which will issue mapper queries within the context of this Session.  If a Mapper is passed, then the Query uses that mapper.  Otherwise, if a class is sent, it will locate the primary mapper for that class which is used to construct the Query.  <br></br>
</p>


<div class="sliding_code">
<pre><span class="python_comment"># query from a class
</span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">select_by</span><span class="python_enclosure">(</span><span class="python_name">name</span><span class="python_operator">=</span><span class="python_literal">'ed'</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># query from a mapper
</span><span class="python_name">query </span><span class="python_operator">= </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">usermapper</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">x </span><span class="python_operator">= </span><span class="python_name">query</span><span class="python_operator">.</span><span class="python_name">get</span><span class="python_enclosure">(</span><span class="python_number">1</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># query from a class mapped with entity name 'alt_users'
</span><span class="python_name">q </span><span class="python_operator">= </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">entity_name</span><span class="python_operator">=</span><span class="python_literal">'alt_users'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">y </span><span class="python_operator">= </span><span class="python_name">q</span><span class="python_operator">.</span><span class="python_name">options</span><span class="python_enclosure">(</span><span class="python_name">eagerload</span><span class="python_enclosure">(</span><span class="python_literal">'orders'</span><span class="python_enclosure">))</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre></div>
<p><code>entity_name</code> is an optional keyword argument sent with a class object, in order to further qualify which primary mapper to be used; this only applies if there was a <code>Mapper</code> created with that particular class/entity name combination, else an exception is raised.  All of the methods on Session which take a class or mapper argument also take the <code>entity_name</code> argument, so that a given class can be properly matched to the desired primary mapper.
</p>
<p>All instances retrieved by the returned <code>Query</code> object will be stored as persistent instances within the originating <code>Session</code>.
</p>


    </div>

    <a href="#unitofwork" class="toclink">back to section top</a>
</div>




<A name="unitofwork_api_get"></a>

<div class="subsection" style="margin-left:30px;">


<h3>get()</h3>

    <div class="sectiontext">
    

<p>Given a class or mapper, a scalar or tuple-based identity, and an optional <code>entity_name</code> keyword argument, creates a <code>Query</code> corresponding to the given mapper or class/entity_name combination, and calls the <code>get()</code> method with the given identity value.  If the object already exists within this Session, it is simply returned, else it is queried from the database.  If the instance is not found, the method returns <code>None</code>.
</p>


<div class="sliding_code">
<pre><span class="python_comment"># get Employer primary key 5
</span><span class="python_name">employer </span><span class="python_operator">= </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">get</span><span class="python_enclosure">(</span><span class="python_name">Employer</span><span class="python_operator">, </span><span class="python_number">5</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># get Report composite primary key 7,12, using mapper 'report_mapper_b'
</span><span class="python_name">report </span><span class="python_operator">= </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">get</span><span class="python_enclosure">(</span><span class="python_name">Report</span><span class="python_operator">, </span><span class="python_enclosure">(</span><span class="python_number">7</span><span class="python_operator">,</span><span class="python_number">12</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">entity_name</span><span class="python_operator">=</span><span class="python_literal">'report_mapper_b'</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre></div>


    </div>

    <a href="#unitofwork" class="toclink">back to section top</a>
</div>




<A name="unitofwork_api_load"></a>

<div class="subsection" style="margin-left:30px;">


<h3>load()</h3>

    <div class="sectiontext">
    

<p>load() is similar to get() except it will raise an exception if the instance does not exist in the database.  It will also load the object's data from the database in all cases, and <strong>overwrite</strong> all changes on the object if it already exists in the session with the latest data from the database.
</p>


<div class="sliding_code">
<pre><span class="python_comment"># load Employer primary key 5
</span><span class="python_name">employer </span><span class="python_operator">= </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">load</span><span class="python_enclosure">(</span><span class="python_name">Employer</span><span class="python_operator">, </span><span class="python_number">5</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># load Report composite primary key 7,12, using mapper 'report_mapper_b'
</span><span class="python_name">report </span><span class="python_operator">= </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">load</span><span class="python_enclosure">(</span><span class="python_name">Report</span><span class="python_operator">, </span><span class="python_enclosure">(</span><span class="python_number">7</span><span class="python_operator">,</span><span class="python_number">12</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">entity_name</span><span class="python_operator">=</span><span class="python_literal">'report_mapper_b'</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre></div>


    </div>

    <a href="#unitofwork" class="toclink">back to section top</a>
</div>




<A name="unitofwork_api_save"></a>

<div class="subsection" style="margin-left:30px;">


<h3>save()</h3>

    <div class="sectiontext">
    

<p>save() is called with a single transient (unsaved, unattached) instance as an argument, which is then added to the Session and becomes pending.  When the session is next <code>flush</code>ed, the instance will be saved to the database uponwhich it becomes persistent (saved, attached).  If the given instance is not transient, meaning it is either attached to an existing Session or it has a database identity, an exception is raised.
</p>


<div class="sliding_code">
<pre><span class="python_name">user1 </span><span class="python_operator">= </span><span class="python_name">User</span><span class="python_enclosure">(</span><span class="python_name">name</span><span class="python_operator">=</span><span class="python_literal">'user1'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">user2 </span><span class="python_operator">= </span><span class="python_name">User</span><span class="python_enclosure">(</span><span class="python_name">name</span><span class="python_operator">=</span><span class="python_literal">'user2'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">save</span><span class="python_enclosure">(</span><span class="python_name">user1</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">save</span><span class="python_enclosure">(</span><span class="python_name">user2</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">flush</span><span class="python_enclosure">()     </span><span class="python_comment"># write changes to the database</span><span class="python_operator"></span></pre></div>
<p>save() is called automatically for new instances by the classes' associated mapper, if a default Session context is in effect (such as a thread-local session), which means that newly created instances automatically become pending.  If there is no default session available, then the instance remains transient (unattached) until it is explicitly added to a Session via the save() method.
</p>
<p>A transient instance also can be automatically <code>save</code>ed if it is associated with a parent object which specifies <code>save-update</code> within its <code>cascade</code> rules, and that parent is already attached or becomes attached to a Session.  For more information on <code>cascade</code>, see the next section.
</p>
<p>The <code>save_or_update()</code> method, covered later, is a convenience method which will call the <code>save()</code> or <code>update()</code> methods appropriately dependening on whether or not the instance has a database identity (but the instance still must be unattached).
</p>


    </div>

    <a href="#unitofwork" class="toclink">back to section top</a>
</div>




<A name="unitofwork_api_flush"></a>

<div class="subsection" style="margin-left:30px;">


<h3>flush()</h3>

    <div class="sectiontext">
    

<p>This is the main gateway to what the Unit of Work does best, which is save everything !  It should be clear by now what a flush looks like:
</p>


<div class="sliding_code">
<pre><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">flush</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre></div>
<p>It also can be called with a list of objects; in this form, the flush operation will be limited only to the objects specified in the list, as well as any child objects within <code>private</code> relationships for a delete operation:
</p>


<div class="sliding_code">
<pre><span class="python_comment"># saves only user1 and address2.  all other modified
# objects remain present in the session.
</span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">flush</span><span class="python_enclosure">([</span><span class="python_name">user1</span><span class="python_operator">, </span><span class="python_name">address2</span><span class="python_enclosure">])</span><span class="python_operator"></span></pre></div>
<p>This second form of flush should be used carefully as it will not necessarily locate other dependent objects within the session, whose database representation may have foreign constraint relationships with the objects being operated upon.
</p>


<A name="unitofwork_api_flush_whatis"></a>

<div class="subsection" style="margin-left:40px;">


<h3>Notes on Flush</h3>

    <div class="sectiontext">
    
<p>A common misconception about the <code>flush()</code> operation is that once performed, the newly persisted instances will automatically have related objects attached to them, based on the values of primary key identities that have been assigned to the instances before they were persisted.  An example would be, you create a new <code>Address</code> object, set <code>address.user_id</code> to 5, and then <code>flush()</code> the session.  The erroneous assumption would be that there is now a <code>User</code> object of identity "5" attached to the <code>Address</code> object, but in fact this is not the case.  If you were to <code>refresh()</code> the <code>Address</code>, invalidating its current state and re-loading, <em>then</em> it would have the appropriate <code>User</code> object present.
</p>
<p>This misunderstanding is related to the observed behavior of backreferences (<a href="datamapping.html#datamapping_relations_backreferences">Backreferences</a>), which automatically associates an instance "A" with another instance "B", in response to the manual association of instance "B" to instance "A" by the user.  The backreference operation occurs completely externally to the <code>flush()</code> operation, and is pretty much the only example of a SQLAlchemy feature that manipulates the relationships of persistent objects.
</p>
<p>The primary guideline for dealing with <code>flush()</code> is, the developer is responsible for maintaining in-memory objects and their relationships to each other, the unit of work is responsible for maintaining the database representation of the in-memory objects.  The typical pattern is that the manipulation of objects <em>is</em> the way that changes get communicated to the unit of work, so that when the flush occurs, the objects are already in their correct in-memory representation and problems dont arise.  The manipulation of identifier attributes like integer key values as well as deletes in particular are a frequent source of confusion.
</p>


    </div>

</div>



    </div>

    <a href="#unitofwork" class="toclink">back to section top</a>
</div>




<A name="unitofwork_api_close"></a>

<div class="subsection" style="margin-left:30px;">


<h3>close()</h3>

    <div class="sectiontext">
    

<p>This method first calls <code>clear()</code>, removing all objects from this <code>Session</code>, and then insures that any transactional resources are closed.
</p>


    </div>

    <a href="#unitofwork" class="toclink">back to section top</a>
</div>




<A name="unitofwork_api_delete"></a>

<div class="subsection" style="margin-left:30px;">


<h3>delete()</h3>

    <div class="sectiontext">
    

<p>The <code>delete</code> method places an instance into the Unit of Work's list of objects to be marked as deleted:
</p>


<div class="sliding_code">
<pre><span class="python_comment"># mark two objects to be deleted
</span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">delete</span><span class="python_enclosure">(</span><span class="python_name">obj1</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">delete</span><span class="python_enclosure">(</span><span class="python_name">obj2</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># flush
</span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">flush</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre></div>
<p>The delete operation will have an effect on instances that are attached to the deleted instance according to the <code>cascade</code> style of the relationship; cascade rules are described further in the following section.  By default, associated instances may need to be updated in the database to reflect that they no longer are associated with the parent object, before the parent is deleted.  If the relationship specifies <code>cascade="delete"</code>, then the associated instance will also be deleted upon flush, assuming it is still attached to the parent.  If the relationship additionally includes the <code>delete-orphan</code> cascade style, the associated instance will be deleted if it is still attached to the parent, or is unattached to any other parent. 
</p>
<p>The <code>delete()</code> operation has no relationship to the in-memory status of the instance, including usage of the <code>del</code> Python statement.  An instance marked as deleted and flushed will still exist within memory until references to it are freed; similarly, removing an instance from memory via the <code>del</code> statement will have no effect, since the persistent instance will still be referenced by its Session.  Obviously, if the instance is removed from the Session and then totally dereferenced, it will no longer exist in memory, but also won't exist in any Session and is therefore not deleted from the database.
</p>


    </div>

    <a href="#unitofwork" class="toclink">back to section top</a>
</div>




<A name="unitofwork_api_clear"></a>

<div class="subsection" style="margin-left:30px;">


<h3>clear()</h3>

    <div class="sectiontext">
    

<p>This method detaches all instances from the Session, sending them to the detached or transient state as applicable, and replaces the underlying UnitOfWork with a new one.
</p>


<div class="sliding_code">
<pre><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">clear</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre></div>
<p>The <code>clear()</code> method is particularly useful with a "default context" session such as a thread-local session, which can stay attached to the current thread to handle a new field of objects without having to re-attach a new Session.
</p>


    </div>

    <a href="#unitofwork" class="toclink">back to section top</a>
</div>




<A name="unitofwork_api_refreshexpire"></a>

<div class="subsection" style="margin-left:30px;">


<h3>refresh() / expire()</h3>

    <div class="sectiontext">
    

<p>To assist with the Unit of Work's "sticky" behavior, individual objects can have all of their attributes immediately re-loaded from the database, or marked as "expired" which will cause a re-load to occur upon the next access of any of the object's mapped attributes.  This includes all relationships, so lazy-loaders will be re-initialized, eager relationships will be repopulated.  Any changes marked on the object are discarded:
</p>


<div class="sliding_code">
<pre><span class="python_comment"># immediately re-load attributes on obj1, obj2
</span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">refresh</span><span class="python_enclosure">(</span><span class="python_name">obj1</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">refresh</span><span class="python_enclosure">(</span><span class="python_name">obj2</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># expire objects obj1, obj2, attributes will be reloaded
# on the next access:
</span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">expire</span><span class="python_enclosure">(</span><span class="python_name">obj1</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">expire</span><span class="python_enclosure">(</span><span class="python_name">obj2</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre></div>


    </div>

    <a href="#unitofwork" class="toclink">back to section top</a>
</div>




<A name="unitofwork_api_expunge"></a>

<div class="subsection" style="margin-left:30px;">


<h3>expunge()</h3>

    <div class="sectiontext">
    

<p>Expunge removes an object from the Session, sending persistent instances to the detached state, and pending instances to the transient state:
</p>


<div class="sliding_code">
<pre><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">expunge</span><span class="python_enclosure">(</span><span class="python_name">obj1</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre></div>
<p>Use <code>expunge</code> when youd like to remove an object altogether from memory, such as before calling <code>del</code> on it, which will prevent any "ghost" operations occuring when the session is flushed.
</p>


    </div>

    <a href="#unitofwork" class="toclink">back to section top</a>
</div>




<A name="unitofwork_api_bind"></a>

<div class="subsection" style="margin-left:30px;">


<h3>bind_mapper() / bind_table()</h3>

    <div class="sectiontext">
    

<p>Both of these methods receive two arguments; in the case of <code>bind_mapper()</code>, it is a <code>Mapper</code> and an <code>Engine</code> or <code>Connection</code> instance; in the case of <code>bind_table()</code>, it is a <code>Table</code> instance or other <code>Selectable</code> (such as an <code>Alias</code>, <code>Select</code>, etc.), and an <code>Engine</code> or <code>Connection</code> instance.
</p>


<div class="sliding_code">
<pre><span class="python_name">engine1 </span><span class="python_operator">= </span><span class="python_name">create_engine</span><span class="python_enclosure">(</span><span class="python_literal">'sqlite:///file1.db'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">engine2 </span><span class="python_operator">= </span><span class="python_name">create_engine</span><span class="python_enclosure">(</span><span class="python_literal">'mysql://localhost'</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_name">sqlite_conneciton </span><span class="python_operator">= </span><span class="python_name">engine1</span><span class="python_operator">.</span><span class="python_name">connect</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_name">sess </span><span class="python_operator">= </span><span class="python_name">create_session</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_name">sess</span><span class="python_operator">.</span><span class="python_name">bind_mapper</span><span class="python_enclosure">(</span><span class="python_name">mymapper</span><span class="python_operator">, </span><span class="python_name">sqlite_connection</span><span class="python_enclosure">)  </span><span class="python_comment"># bind mymapper operations to a single SQLite connection</span><span class="python_operator">
</span><span class="python_name">sess</span><span class="python_operator">.</span><span class="python_name">bind_table</span><span class="python_enclosure">(</span><span class="python_name">email_addresses_table</span><span class="python_operator">, </span><span class="python_name">engine2</span><span class="python_enclosure">) </span><span class="python_comment"># bind operations with the email_addresses_table to mysql</span><span class="python_operator"></span></pre></div>
<p>Normally, when a <code>Session</code> is created via <code>create_session()</code> with no arguments, the Session has no awareness of individual <code>Engines</code>, and when mappers use the <code>Session</code> to retrieve connections, the underlying <code>MetaData</code> each <code>Table</code> is associated with is expected to be "bound" to an <code>Engine</code>, else no engine can be located and an exception is raised.  A second form of <code>create_session()</code> takes the argument <code>bind_to=engine_or_connection</code>, where all SQL operations performed by this <code>Session</code> use the single <code>Engine</code> or <code>Connection</code> (collectively known as a <code>Connectable</code>) passed to the constructor.  With <code>bind_mapper()</code> and <code>bind_table()</code>,  the operations of individual mapper and/or tables are bound to distinct engines or connections, thereby overriding not only the engine which may be "bound" to the underlying <code>MetaData</code>, but also the <code>Engine</code> or <code>Connection</code> which may have been passed to the <code>create_session()</code> function.  Configurations which interact with multiple explicit database connections at one time must use either or both of these methods in order to associate <code>Session</code> operations with the appropriate connection resource.  <br></br>
</p>
<p>Binding a <code>Mapper</code> to a resource takes precedence over a <code>Table</code> bind, meaning if mapper A is associated with table B, and the Session binds mapper A to connection X and table B to connection Y, an operation with mapper A will use connection X, not connection Y.
</p>


    </div>

    <a href="#unitofwork" class="toclink">back to section top</a>
</div>




<A name="unitofwork_api_update"></a>

<div class="subsection" style="margin-left:30px;">


<h3>update()</h3>

    <div class="sectiontext">
    

<p>The update() method is used <em>only</em> with detached instances.  A detached instance only exists if its <code>Session</code> was cleared or closed, or the instance was <code>expunge()</code>d from its session.  <code>update()</code> will re-attach the detached instance with this Session, bringing it back to the persistent state, and allowing any changes on the instance to be saved when the <code>Session</code> is next <code>flush</code>ed.  If the instance is already attached to an existing <code>Session</code>, an exception is raised.
</p>
<p>A detached instance also can be automatically <code>update</code>ed if it is associated with a parent object which specifies <code>save-update</code> within its <code>cascade</code> rules, and that parent is already attached or becomes attached to a Session.  For more information on <code>cascade</code>, see the next section.
</p>
<p>The <code>save_or_update()</code> method is a convenience method which will call the <code>save()</code> or <code>update()</code> methods appropriately dependening on whether or not the instance has a database identity (but the instance still must be unattached).
</p>


    </div>

    <a href="#unitofwork" class="toclink">back to section top</a>
</div>




<A name="unitofwork_api_saveorupdate"></a>

<div class="subsection" style="margin-left:30px;">


<h3>save_or_update()</h3>

    <div class="sectiontext">
    

<p>This method is a combination of the <code>save()</code> and <code>update()</code> methods, which will examine the given instance for a database identity (i.e. if it is transient or detached), and will call the implementation of <code>save()</code> or <code>update()</code> as appropriate.  Use <code>save_or_update()</code> to add unattached instances to a session when you're not sure if they were newly created or not.  Like <code>save()</code> and <code>update()</code>, <code>save_or_update()</code> cascades along the <code>save-update</code> cascade indicator, described in the <code>cascade</code> section below.
</p>


    </div>

    <a href="#unitofwork" class="toclink">back to section top</a>
</div>




<A name="unitofwork_api_merge"></a>

<div class="subsection" style="margin-left:30px;">


<h3>merge()</h3>

    <div class="sectiontext">
    

<p>Feature Status: <a href='javascript:alphaImplementation()'>Alpha Implementation</a> 
</p>
<p><code>merge()</code> is used to return the persistent version of an instance that is not attached to this Session.  When passed an instance, if an instance with its database identity already exists within this Session, it is returned.  If the instance does not exist in this Session, it is loaded from the database and then returned.  <br></br>
</p>
<p>A future version of <code>merge()</code> will also update the Session's instance with the state of the given instance (hence the name "merge").
</p>
<p>This method is useful for bringing in objects which may have been restored from a serialization, such as those stored in an HTTP session:
</p>


<div class="sliding_code">
<pre><span class="python_comment"># deserialize an object
</span><span class="python_name">myobj </span><span class="python_operator">= </span><span class="python_name">pickle</span><span class="python_operator">.</span><span class="python_name">loads</span><span class="python_enclosure">(</span><span class="python_name">mystring</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># "merge" it.  if the session already had this object in the 
# identity map, then you get back the one from the current session.
</span><span class="python_name">myobj </span><span class="python_operator">= </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">merge</span><span class="python_enclosure">(</span><span class="python_name">myobj</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre></div>
<p>Note that <code>merge()</code> <em>does not</em> associate the given instance with the Session; it remains detached (or attached to whatever Session it was already attached to).
</p>


    </div>

</div>



    </div>

    <a href="#unitofwork" class="toclink">back to section top</a>
</div>




<A name="unitofwork_cascade"></a>

<div class="subsection" style="margin-left:20px;">


<h3>Cascade rules</h3>

    <div class="sectiontext">
    

<p>Feature Status: <a href='javascript:alphaImplementation()'>Alpha Implementation</a> 
</p>
<p>Mappers support the concept of configurable <em>cascade</em> behavior on <code>relation()</code>s.  This behavior controls how the Session should treat the instances that have a parent-child relationship with another instance that is operated upon by the Session.  Cascade is indicated as a comma-separated list of string keywords, with the possible values <code>all</code>, <code>delete</code>, <code>save-update</code>, <code>refresh-expire</code>, <code>merge</code>, <code>expunge</code>, and <code>delete-orphan</code>.
</p>
<p>Cascading is configured by setting the <code>cascade</code> keyword argument on a <code>relation()</code>:
</p>


<div class="sliding_code">
<pre><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Order</span><span class="python_operator">, </span><span class="python_name">order_table</span><span class="python_operator">, </span><span class="python_name">properties</span><span class="python_operator">=</span><span class="python_enclosure">{</span>
    <span class="python_literal">'items' </span><span class="python_operator">: </span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">Item</span><span class="python_operator">, </span><span class="python_name">items_table</span><span class="python_operator">, </span><span class="python_name">cascade</span><span class="python_operator">=</span><span class="python_literal">"all, delete-orphan"</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_literal">'customer' </span><span class="python_operator">: </span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">users_table</span><span class="python_operator">, </span><span class="python_name">user_orders_table</span><span class="python_operator">, </span><span class="python_name">cascade</span><span class="python_operator">=</span><span class="python_literal">"save-update"</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
<span class="python_enclosure">})</span><span class="python_operator"></span></pre></div>
<p>The above mapper specifies two relations, <code>items</code> and <code>customer</code>.  The <code>items</code> relationship specifies "all, delete-orphan" as its <code>cascade</code> value, indicating that all  <code>save</code>, <code>update</code>, <code>merge</code>, <code>expunge</code>, <code>refresh</code> <code>delete</code> and <code>expire</code> operations performed on a parent <code>Order</code> instance should also be performed on the child <code>Item</code> instances attached to it (<code>save</code> and <code>update</code> are cascaded using the <code>save_or_update()</code> method, so that the database identity of the instance doesn't matter).  The <code>delete-orphan</code> cascade value additionally indicates that if an <code>Item</code> instance is no longer associated with an <code>Order</code>, it should also be deleted.  The "all, delete-orphan" cascade argument allows a so-called <em>lifecycle</em> relationship between an <code>Order</code> and an <code>Item</code> object.
</p>
<p>The <code>customer</code> relationship specifies only the "save-update" cascade value, indicating most operations will not be cascaded from a parent <code>Order</code> instance to a child <code>User</code> instance, except for if the <code>Order</code> is attached with a particular session, either via the <code>save()</code>, <code>update()</code>, or <code>save-update()</code> method.
</p>
<p>Additionally, when a child item is attached to a parent item that specifies the "save-update" cascade value on the relationship, the child is automatically passed to <code>save_or_update()</code> (and the operation is further cascaded to the child item).
</p>
<p>Note that cascading doesn't do anything that isn't possible by manually calling Session methods on individual instances within a hierarchy, it merely automates common operations on a group of associated instances.
</p>
<p>The default value for <code>cascade</code> on <code>relation()</code>s is <code>save-update</code>, and the <code>private=True</code> keyword argument is a synonym for <code>cascade="all, delete-orphan"</code>.
</p>


    </div>

    <a href="#unitofwork" class="toclink">back to section top</a>
</div>




<A name="unitofwork_transaction"></a>

<div class="subsection" style="margin-left:20px;">


<h3>SessionTransaction</h3>

    <div class="sectiontext">
    

<p>SessionTransaction is a multi-engine transaction manager, which aggregates one or more Engine/Connection pairs and keeps track of a Transaction object for each one.  As the Session receives requests to execute SQL statements, it uses the Connection that is referenced by the SessionTransaction.  At commit time, the underyling Session is flushed, and each Transaction is the committed.
</p>
<p>Example usage is as follows:
</p>


<div class="sliding_code">
<pre><span class="python_name">sess </span><span class="python_operator">= </span><span class="python_name">create_session</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_name">trans </span><span class="python_operator">= </span><span class="python_name">sess</span><span class="python_operator">.</span><span class="python_name">create_transaction</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_keyword">try</span><span class="python_operator">:
    </span><span class="python_name">item1 </span><span class="python_operator">= </span><span class="python_name">sess</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">Item</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">get</span><span class="python_enclosure">(</span><span class="python_number">1</span><span class="python_enclosure">)</span><span class="python_operator">
    </span><span class="python_name">item2 </span><span class="python_operator">= </span><span class="python_name">sess</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">Item</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">get</span><span class="python_enclosure">(</span><span class="python_number">2</span><span class="python_enclosure">)</span><span class="python_operator">
    </span><span class="python_name">item1</span><span class="python_operator">.</span><span class="python_name">foo </span><span class="python_operator">= </span><span class="python_literal">'bar'</span><span class="python_operator">
    </span><span class="python_name">item2</span><span class="python_operator">.</span><span class="python_name">bar </span><span class="python_operator">= </span><span class="python_literal">'foo'</span><span class="python_operator">
</span><span class="python_keyword">except</span><span class="python_operator">:
    </span><span class="python_name">trans</span><span class="python_operator">.</span><span class="python_name">rollback</span><span class="python_enclosure">()</span><span class="python_operator">
    </span><span class="python_keyword">raise</span><span class="python_operator">
</span><span class="python_name">trans</span><span class="python_operator">.</span><span class="python_name">commit</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre></div>
<p>The <code>create_transaction()</code> method creates a new SessionTransaction object but does not declare any connection/transaction resources.  At the point of the first <code>get()</code> call, a connection resource is opened off the engine that corresponds to the Item classes' mapper and is stored within the <code>SessionTransaction</code> with an open <code>Transaction</code>.  When <code>trans.commit()</code> is called, the <code>flush()</code> method is called on the <code>Session</code> and the corresponding update statements are issued to the database within the scope of the transaction already opened; afterwards, the underying Transaction is committed, and connection resources are freed.
</p>
<p><code>SessionTransaction</code>, like the <code>Transaction</code> off of <code>Connection</code> also supports "nested" behavior, and is safe to pass to other functions which then issue their own <code>begin()</code>/<code>commit()</code> pair; only the outermost <code>begin()</code>/<code>commit()</code> pair actually affects the transaction, and any call to <code>rollback()</code> within a particular call stack will issue a rollback.
</p>
<p>Note that while SessionTransaction is capable of tracking multiple transactions across multiple databases, it currently is in no way a fully functioning two-phase commit engine; generally, when dealing with multiple databases simultaneously, there is the distinct possibility that a transaction can succeed on the first database and fail on the second, which for some applications may be an invalid state.  If this is an issue, its best to either refrain from spanning transactions across databases, or to look into some of the available technologies in this area, such as <a href='http://www.zope.org'>Zope</a> which offers a two-phase commit engine; some users have already created their own SQLAlchemy/Zope hybrid implementations to deal with scenarios like these.
</p>
<p>SessionTransaction Facts:
</p>
<ul>
 <li>
     SessionTransaction, like its parent Session object, is <strong>not threadsafe</strong>.
 </li>
</ul>



<A name="unitofwork_transaction_sql"></a>

<div class="subsection" style="margin-left:30px;">


<h3>Using SQL with SessionTransaction</h3>

    <div class="sectiontext">
    

<p>The SessionTransaction can interact with direct SQL queries in two general ways.  Either specific <code>Connection</code> objects can be associated with the <code>SessionTransaction</code>, which are then useable both for direct SQL as well as within <code>flush()</code> operations performed by the <code>SessionTransaction</code>, or via accessing the <code>Connection</code> object automatically referenced within the <code>SessionTransaction</code>.
</p>
<p>To associate a specific <code>Connection</code> with the <code>SessionTransaction</code>, use the <code>add()</code> method:
</p>


<div class="sliding_code">
    <div class="codetitle">Associate a Connection with the SessionTransaction</div>
<pre><span class="python_name">connection </span><span class="python_operator">= </span><span class="python_name">engine</span><span class="python_operator">.</span><span class="python_name">connect</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_name">trans </span><span class="python_operator">= </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">create_transaction</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_keyword">try</span><span class="python_operator">:
    </span><span class="python_name">trans</span><span class="python_operator">.</span><span class="python_name">add</span><span class="python_enclosure">(</span><span class="python_name">connection</span><span class="python_enclosure">)</span><span class="python_operator">
    </span><span class="python_name">connection</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_name">mytable</span><span class="python_operator">.</span><span class="python_name">update</span><span class="python_enclosure">()</span><span class="python_operator">, </span><span class="python_enclosure">{</span><span class="python_literal">'col1'</span><span class="python_operator">:</span><span class="python_number">4</span><span class="python_operator">, </span><span class="python_literal">'col2'</span><span class="python_operator">:</span><span class="python_number">17</span><span class="python_enclosure">})</span><span class="python_operator">
    </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">flush</span><span class="python_enclosure">() </span><span class="python_comment"># flush() operation will use the same connection</span><span class="python_operator">
</span><span class="python_keyword">except</span><span class="python_operator">:
    </span><span class="python_name">trans</span><span class="python_operator">.</span><span class="python_name">rollback</span><span class="python_enclosure">()</span><span class="python_operator">
    </span><span class="python_keyword">raise</span><span class="python_operator">
</span><span class="python_name">trans</span><span class="python_operator">.</span><span class="python_name">commit</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre></div>
<p>The <code>add()</code> method will key the <code>Connection</code>'s underlying <code>Engine</code> to this <code>SessionTransaction</code>.  When mapper operations are performed against this <code>Engine</code>, the <code>Connection</code> explicitly added will be used.  This <strong>overrides</strong> any other <code>Connection</code> objects that the underlying Session was associated with, corresponding to the underlying <code>Engine</code> of that <code>Connection</code>.  However, if the <code>SessionTransaction</code> itself is already associated with a <code>Connection</code>, then an exception is thrown.
</p>
<p>The other way is just to use the <code>Connection</code> referenced by the <code>SessionTransaction</code>.  This is performed via the <code>connection()</code> method, and requires passing in a class or <code>Mapper</code> which indicates which underlying <code>Connection</code> should be returned (recall that different <code>Mappers</code> may use different underlying <code>Engines</code>).  If the <code>class_or_mapper</code> argument is <code>None</code>, then the <code>Session</code> must be globally bound to a specific <code>Engine</code> when it was constructed, else the method returns <code>None</code>.
</p>


<div class="sliding_code">
    <div class="codetitle">Get a Connection from the SessionTransaction</div>
<pre><span class="python_name">trans </span><span class="python_operator">= </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">create_transaction</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_keyword">try</span><span class="python_operator">:
    </span><span class="python_name">connection </span><span class="python_operator">= </span><span class="python_name">trans</span><span class="python_operator">.</span><span class="python_name">connection</span><span class="python_enclosure">(</span><span class="python_name">UserClass</span><span class="python_enclosure">)   </span><span class="python_comment"># get the Connection used by the UserClass' Mapper</span><span class="python_operator">
    </span><span class="python_name">connection</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_name">mytable</span><span class="python_operator">.</span><span class="python_name">update</span><span class="python_enclosure">()</span><span class="python_operator">, </span><span class="python_enclosure">{</span><span class="python_literal">'col1'</span><span class="python_operator">:</span><span class="python_number">4</span><span class="python_operator">, </span><span class="python_literal">'col2'</span><span class="python_operator">:</span><span class="python_number">17</span><span class="python_enclosure">})</span><span class="python_operator">
</span><span class="python_keyword">except</span><span class="python_operator">:
    </span><span class="python_name">trans</span><span class="python_operator">.</span><span class="python_name">rollback</span><span class="python_enclosure">()</span><span class="python_operator">
    </span><span class="python_keyword">raise</span><span class="python_operator">
</span><span class="python_name">trans</span><span class="python_operator">.</span><span class="python_name">commit</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre></div>
<p>The <code>connection()</code> method also exists on the <code>Session</code> object itself, and can be called regardless of whether or not a <code>SessionTransaction</code> is in progress.  If a <code>SessionTransaction</code> is in progress, it will return the connection referenced by the transaction.  If an <code>Engine</code> is being used with <code>threadlocal</code> strategy, the <code>Connection</code> returned will correspond to the connection resources that are bound to the current thread, if any (i.e. it is obtained by calling <code>contextual_connection()</code>).
</p>


    </div>

    <a href="#unitofwork" class="toclink">back to section top</a>
</div>




<A name="unitofwork_transaction_using"></a>

<div class="subsection" style="margin-left:30px;">


<h3>Using Engine-level Transactions with Sessions</h3>

    <div class="sectiontext">
    

<p>The transactions issued by <code>SessionTransaction</code> as well as internally by the <code>Session</code>'s <code>flush()</code> operation use the same <code>Transaction</code> object off of <code>Connection</code> that is publically available.  Recall that this object supports "nestable" behavior, meaning any number of actors can call <code>begin()</code> off a particular <code>Connection</code> object, and they will all be managed within the scope of a single transaction.  Therefore, the <code>flush()</code> operation can similarly take place within the scope of a regular <code>Transaction</code>:
</p>


<div class="sliding_code">
    <div class="codetitle">Transactions with Sessions</div>
<pre><span class="python_name">connection </span><span class="python_operator">= </span><span class="python_name">engine</span><span class="python_operator">.</span><span class="python_name">connect</span><span class="python_enclosure">()   </span><span class="python_comment"># Connection</span><span class="python_operator">
</span><span class="python_name">session </span><span class="python_operator">= </span><span class="python_name">create_session</span><span class="python_enclosure">(</span><span class="python_name">bind_to</span><span class="python_operator">=</span><span class="python_name">connection</span><span class="python_enclosure">) </span><span class="python_comment"># Session bound to the Connection</span><span class="python_operator">
</span><span class="python_name">trans </span><span class="python_operator">= </span><span class="python_name">connection</span><span class="python_operator">.</span><span class="python_name">begin</span><span class="python_enclosure">()      </span><span class="python_comment"># start transaction</span><span class="python_operator">
</span><span class="python_keyword">try</span><span class="python_operator">:
    </span><span class="python_name">stuff </span><span class="python_operator">= </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">MyClass</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">()     </span><span class="python_comment"># Session operation uses connection</span><span class="python_operator">
    </span><span class="python_name">stuff</span><span class="python_enclosure">[</span><span class="python_number">2</span><span class="python_enclosure">]</span><span class="python_operator">.</span><span class="python_name">foo </span><span class="python_operator">= </span><span class="python_literal">'bar'</span><span class="python_operator">
    </span><span class="python_name">connection</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_name">mytable</span><span class="python_operator">.</span><span class="python_name">insert</span><span class="python_enclosure">()</span><span class="python_operator">, </span><span class="python_name">dict</span><span class="python_enclosure">(</span><span class="python_name">id</span><span class="python_operator">=</span><span class="python_number">12</span><span class="python_operator">, </span><span class="python_name">value</span><span class="python_operator">=</span><span class="python_literal">"bar"</span><span class="python_enclosure">))    </span><span class="python_comment"># use connection explicitly</span><span class="python_operator">
    </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">flush</span><span class="python_enclosure">()     </span><span class="python_comment"># Session flushes with "connection", using transaction "trans"</span><span class="python_operator">
</span><span class="python_keyword">except</span><span class="python_operator">:
    </span><span class="python_name">trans</span><span class="python_operator">.</span><span class="python_name">rollback</span><span class="python_enclosure">()    </span><span class="python_comment"># or rollback</span><span class="python_operator">
    </span><span class="python_keyword">raise</span><span class="python_operator">
</span><span class="python_name">trans</span><span class="python_operator">.</span><span class="python_name">commit</span><span class="python_enclosure">()      </span><span class="python_comment"># commit</span><span class="python_operator"></span></pre></div>


    </div>

</div>



    </div>

    <a href="#unitofwork" class="toclink">back to section top</a>
</div>




<A name="unitofwork_logging"></a>

<div class="subsection" style="margin-left:20px;">


<h3>Analyzing Object Flushes</h3>

    <div class="sectiontext">
    

<p>The session module can log an extensive display of its "flush plans", which is a graph of its internal representation of objects before they are written to the database.  To turn this logging on:
</p>


<div class="sliding_code">
<pre><span class="python_comment"># make an Session with echo_uow
</span><span class="python_name">session </span><span class="python_operator">= </span><span class="python_name">create_session</span><span class="python_enclosure">(</span><span class="python_name">echo_uow</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre></div>
<p>The <code>flush()</code> operation will then dump to the standard output displays like the following:
</p>


<div class="sliding_code">
<pre>Task dump:

 UOWTask(6034768, 'User/users/None')
  |
  |- Save User(6016624)
  |       |-Process User(6016624).addresses
  |
  |- UOWTask(6034832, 'Address/email_addresses/None')
  |   |- Save Address(6034384)
  |   |- Save Address(6034256)
  |   |----
  | 
  |----</pre></div>
<p>The above graph can be read straight downwards to determine the order of operations.  It indicates "save User 6016624, process each element in the 'addresses' list on User 6016624, save Address 6034384, Address 6034256".
</p>
<p>Of course, one can also get a good idea of the order of operations just by logging the actual SQL statements executed.
</p>



    </div>

</div>



    </div>

    <a href="#unitofwork" class="toclink">back to section top</a>
</div>


</html></div>
<A name="advdatamapping"></a>

<div class="sectionnavblock">
<div class="sectionnav">

        Previous: <a href="#unitofwork">Session / Unit of Work</a>

                |

        Next: <a href="#types">The Types System</a>

</div>
</div>

<div class="topnavmain">
	<div class="topnavheader">Advanced Data Mapping</div>
</div>
<div class="sectioncontent">
<html>



<A name="advdatamapping"></a>

<div class="subsection" style="margin-left:10px;">



    <div class="sectiontext">
    

<p>This section details all the options available to Mappers, as well as advanced patterns.
</p>
<p>To start, heres the tables we will work with again:
</p>


<div class="sliding_code">
<pre><span class="python_keyword">from </span><span class="python_name">sqlalchemy </span><span class="python_keyword">import </span><span class="python_operator">*
</span>
<span class="python_name">metadata </span><span class="python_operator">= </span><span class="python_name">MetaData</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_comment"># a table to store users
</span><span class="python_name">users_table </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'users'</span><span class="python_operator">, </span><span class="python_name">metadata</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'user_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key </span><span class="python_operator">= </span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'user_name'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">40</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'password'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">80</span><span class="python_enclosure">))</span>
<span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># a table that stores mailing addresses associated with a specific user
</span><span class="python_name">addresses_table </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'addresses'</span><span class="python_operator">, </span><span class="python_name">metadata</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'address_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key </span><span class="python_operator">= </span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'user_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">ForeignKey</span><span class="python_enclosure">(</span><span class="python_literal">"users.user_id"</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'street'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">100</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'city'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">80</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'state'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">2</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'zip'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">10</span><span class="python_enclosure">))</span>
<span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># a table that stores keywords
</span><span class="python_name">keywords_table </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'keywords'</span><span class="python_operator">, </span><span class="python_name">metadata</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'keyword_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key </span><span class="python_operator">= </span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'name'</span><span class="python_operator">, </span><span class="python_name">VARCHAR</span><span class="python_enclosure">(</span><span class="python_number">50</span><span class="python_enclosure">))</span>
<span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># a table that associates keywords with users
</span><span class="python_name">userkeywords_table </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'userkeywords'</span><span class="python_operator">, </span><span class="python_name">metadata</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'user_id'</span><span class="python_operator">, </span><span class="python_name">INT</span><span class="python_operator">, </span><span class="python_name">ForeignKey</span><span class="python_enclosure">(</span><span class="python_literal">"users"</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'keyword_id'</span><span class="python_operator">, </span><span class="python_name">INT</span><span class="python_operator">, </span><span class="python_name">ForeignKey</span><span class="python_enclosure">(</span><span class="python_literal">"keywords"</span><span class="python_enclosure">))</span>
<span class="python_enclosure">)</span><span class="python_operator"></span></pre></div>



<A name="advdatamapping_properties"></a>

<div class="subsection" style="margin-left:20px;">


<h3>More On Mapper Properties</h3>

    <div class="sectiontext">
    




<A name="advdatamapping_properties_colname"></a>

<div class="subsection" style="margin-left:30px;">


<h3>Overriding Column Names</h3>

    <div class="sectiontext">
    

<p>When mappers are constructed, by default the column names in the Table metadata are used as the names of attributes on the mapped class.  This can be customzed within the properties by stating the key/column combinations explicitly:
</p>


<div class="sliding_code">
<pre><span class="python_name">user_mapper </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">users_table</span><span class="python_operator">, </span><span class="python_name">properties</span><span class="python_operator">=</span><span class="python_enclosure">{</span>
    <span class="python_literal">'id' </span><span class="python_operator">: </span><span class="python_name">users_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">,</span>
    <span class="python_literal">'name' </span><span class="python_operator">: </span><span class="python_name">users_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator">,</span>
<span class="python_enclosure">})</span><span class="python_operator"></span></pre></div>
<p>In the situation when column names overlap in a mapper against multiple tables, columns may be referenced together with a list:
</p>


<div class="sliding_code">
<pre><span class="python_comment"># join users and addresses
</span><span class="python_name">usersaddresses </span><span class="python_operator">= </span><span class="python_name">sql</span><span class="python_operator">.</span><span class="python_name">join</span><span class="python_enclosure">(</span><span class="python_name">users_table</span><span class="python_operator">, </span><span class="python_name">addresses_table</span><span class="python_operator">, </span><span class="python_name">users_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id </span><span class="python_operator">== </span><span class="python_name">addresses_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">m </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">usersaddresses</span><span class="python_operator">,   </span>
    <span class="python_name">properties </span><span class="python_operator">= </span><span class="python_enclosure">{</span>
        <span class="python_literal">'id' </span><span class="python_operator">: </span><span class="python_enclosure">[</span><span class="python_name">users_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">, </span><span class="python_name">addresses_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_enclosure">]</span><span class="python_operator">,</span>
    <span class="python_enclosure">}</span>
    <span class="python_enclosure">)</span><span class="python_operator"></span></pre></div>


    </div>

    <a href="#advdatamapping" class="toclink">back to section top</a>
</div>




<A name="advdatamapping_properties_overriding"></a>

<div class="subsection" style="margin-left:30px;">


<h3>Overriding Properties</h3>

    <div class="sectiontext">
    

<p>A common request is the ability to create custom class properties that override the behavior of setting/getting an attribute.  Currently, the easiest way to do this in SQLAlchemy is how it would be done in any Python program; define your attribute with a different name, such as "_attribute", and use a property to get/set its value.  The mapper just needs to be told of the special name:
</p>


<div class="sliding_code">
<pre><span class="python_keyword">class </span><span class="python_name">MyClass</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">def </span><span class="python_name">_set_email</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">email</span><span class="python_enclosure">)</span><span class="python_operator">:
       </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">_email </span><span class="python_operator">= </span><span class="python_name">email</span><span class="python_operator">
    </span><span class="python_keyword">def </span><span class="python_name">_get_email</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">email</span><span class="python_enclosure">)</span><span class="python_operator">:
       </span><span class="python_keyword">return </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">_email</span><span class="python_operator">
    </span><span class="python_name">email </span><span class="python_operator">= </span><span class="python_name">property</span><span class="python_enclosure">(</span><span class="python_name">_get_email</span><span class="python_operator">, </span><span class="python_name">_set_email</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_operator"></span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">MyClass</span><span class="python_operator">, </span><span class="python_name">mytable</span><span class="python_operator">, </span><span class="python_name">properties </span><span class="python_operator">= </span><span class="python_enclosure">{</span>
   <span class="python_comment"># map the '_email' attribute to the "email" column</span>
   <span class="python_comment"># on the table</span>
   <span class="python_literal">'_email'</span><span class="python_operator">: </span><span class="python_name">mytable</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">email</span>
<span class="python_enclosure">})</span><span class="python_operator"></span></pre></div>
<p>It is also possible to route the the <code>select_by</code> and <code>get_by</code> functions on <code>Query</code> using the new property name, by establishing a <code>synonym</code>:
</p>


<div class="sliding_code">
<pre><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">MyClass</span><span class="python_operator">, </span><span class="python_name">mytable</span><span class="python_operator">, </span><span class="python_name">properties </span><span class="python_operator">= </span><span class="python_enclosure">{</span>
    <span class="python_comment"># map the '_email' attribute to the "email" column</span>
    <span class="python_comment"># on the table</span>
    <span class="python_literal">'_email'</span><span class="python_operator">: </span><span class="python_name">mytable</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">email</span>

    <span class="python_comment"># make a synonym 'email'</span>
    <span class="python_literal">'email' </span><span class="python_operator">: </span><span class="python_name">synonym</span><span class="python_enclosure">(</span><span class="python_literal">'_email'</span><span class="python_enclosure">)</span>
<span class="python_enclosure">})</span><span class="python_operator">
</span>
<span class="python_comment"># now you can select_by(email)
</span><span class="python_name">result </span><span class="python_operator">= </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">MyClass</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">select_by</span><span class="python_enclosure">(</span><span class="python_name">email</span><span class="python_operator">=</span><span class="python_literal">'john@smith.com'</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre></div>
<p>Synonym can be established with the flag "proxy=True", to create a class-level proxy to the actual property:
</p>


<div class="sliding_code">
<pre><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">MyClass</span><span class="python_operator">, </span><span class="python_name">mytable</span><span class="python_operator">, </span><span class="python_name">properties </span><span class="python_operator">= </span><span class="python_enclosure">{</span>
    <span class="python_literal">'_email'</span><span class="python_operator">: </span><span class="python_name">mytable</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">email</span>
    <span class="python_literal">'email' </span><span class="python_operator">: </span><span class="python_name">synonym</span><span class="python_enclosure">(</span><span class="python_literal">'_email'</span><span class="python_operator">, </span><span class="python_name">proxy</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span>
<span class="python_enclosure">})</span><span class="python_operator">
</span>
<span class="python_name">x </span><span class="python_operator">= </span><span class="python_name">MyClass</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_name">x</span><span class="python_operator">.</span><span class="python_name">email </span><span class="python_operator">= </span><span class="python_literal">'john@doe.com'</span><span class="python_operator">
</span>
<span class="python_literal">>>> </span><span class="python_name">x</span><span class="python_operator">.</span><span class="python_name">_email</span><span class="python_operator">
</span><span class="python_literal">'john@doe.com'</span><span class="python_operator"></span></pre></div>
<p>The <code>synonym</code> keyword is currently an <a href='javascript:alphaApi()'>Alpha Feature</a>.
</p>


    </div>

    <a href="#advdatamapping" class="toclink">back to section top</a>
</div>




<A name="advdatamapping_properties_customlist"></a>

<div class="subsection" style="margin-left:30px;">


<h3>Custom List Classes</h3>

    <div class="sectiontext">
    

<p>Feature Status: <a href='javascript:alphaApi()'>Alpha API</a> 
</p>
<p>A one-to-many or many-to-many relationship results in a list-holding element being attached to all instances of a class.  The actual list is an "instrumented" list, which transparently maintains a relationship to a plain Python list.  The implementation of the underlying plain list can be changed to be any object that implements a <code>list</code>-style <code>append</code> and <code>__iter__</code> method.  A common need is for a list-based relationship to actually be a dictionary.  This can be achieved by subclassing <code>dict</code> to have <code>list</code>-like behavior.
</p>
<p>In this example, a class <code>MyClass</code> is defined, which is associated with a parent object <code>MyParent</code>.  The collection of <code>MyClass</code> objects on each <code>MyParent</code> object will be a dictionary, storing each <code>MyClass</code> instance keyed to its <code>name</code> attribute.
</p>


<div class="sliding_code">
<pre><span class="python_comment"># a class to be stored in the list
</span><span class="python_keyword">class </span><span class="python_name">MyClass</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">def </span><span class="python_name">__init__</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">name</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">name </span><span class="python_operator">= </span><span class="python_name">name</span><span class="python_operator">
</span>
<span class="python_comment"># create a dictionary that will act like a list, and store
# instances of MyClass
</span><span class="python_operator"></span><span class="python_keyword">class </span><span class="python_name">MyDict</span><span class="python_enclosure">(</span><span class="python_name">dict</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">def </span><span class="python_name">append</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">item</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_name">self</span><span class="python_enclosure">[</span><span class="python_name">item</span><span class="python_operator">.</span><span class="python_name">name</span><span class="python_enclosure">] </span><span class="python_operator">= </span><span class="python_name">item</span><span class="python_operator">
    </span><span class="python_keyword">def </span><span class="python_name">__iter__</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_keyword">return </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">values</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_comment"># parent class
</span><span class="python_operator"></span><span class="python_keyword">class </span><span class="python_name">MyParent</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">pass</span><span class="python_operator">
</span>
<span class="python_comment"># mappers, constructed normally
</span><span class="python_operator"></span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">MyClass</span><span class="python_operator">, </span><span class="python_name">myclass_table</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">MyParent</span><span class="python_operator">, </span><span class="python_name">myparent_table</span><span class="python_operator">, </span><span class="python_name">properties</span><span class="python_operator">=</span><span class="python_enclosure">{</span>
    <span class="python_literal">'myclasses' </span><span class="python_operator">: </span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">MyClass</span><span class="python_operator">, </span><span class="python_name">collection_class</span><span class="python_operator">=</span><span class="python_name">MyDict</span><span class="python_enclosure">)</span>
<span class="python_enclosure">})</span><span class="python_operator">
</span>
<span class="python_comment"># elements on 'myclasses' can be accessed via string keyname
</span><span class="python_name">myparent </span><span class="python_operator">= </span><span class="python_name">MyParent</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_name">myparent</span><span class="python_operator">.</span><span class="python_name">myclasses</span><span class="python_operator">.</span><span class="python_name">append</span><span class="python_enclosure">(</span><span class="python_name">MyClass</span><span class="python_enclosure">(</span><span class="python_literal">'this is myclass'</span><span class="python_enclosure">))</span><span class="python_operator">
</span><span class="python_name">myclass </span><span class="python_operator">= </span><span class="python_name">myparent</span><span class="python_operator">.</span><span class="python_name">myclasses</span><span class="python_enclosure">[</span><span class="python_literal">'this is myclass'</span><span class="python_enclosure">]</span><span class="python_operator"></span></pre></div>


    </div>

    <a href="#advdatamapping" class="toclink">back to section top</a>
</div>




<A name="advdatamapping_properties_customjoin"></a>

<div class="subsection" style="margin-left:30px;">


<h3>Custom Join Conditions</h3>

    <div class="sectiontext">
    

<pre><code>
</code></pre><p>When creating relations on a mapper, most examples so far have illustrated the mapper and relationship joining up based on the foreign keys of the tables they represent.  in fact, this "automatic" inspection can be completely circumvented using the <code>primaryjoin</code> and <code>secondaryjoin</code> arguments to <code>relation</code>, as in this example which creates a User object which has a relationship to all of its Addresses which are in Boston:
</p>


<div class="sliding_code">
<pre><span class="python_keyword">class </span><span class="python_name">User</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">pass</span><span class="python_operator">
</span><span class="python_keyword">class </span><span class="python_name">Address</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">pass</span><span class="python_operator">
</span>
<span class="python_operator"></span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_operator">, </span><span class="python_name">addresses_table</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">users_table</span><span class="python_operator">, </span><span class="python_name">properties</span><span class="python_operator">=</span><span class="python_enclosure">{</span>
    <span class="python_literal">'boston_addresses' </span><span class="python_operator">: </span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_operator">, </span><span class="python_name">primaryjoin</span><span class="python_operator">=</span>
                <span class="python_name">and_</span><span class="python_enclosure">(</span><span class="python_name">users_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">==</span><span class="python_name">Address</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">, </span>
                <span class="python_name">Addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">city</span><span class="python_operator">==</span><span class="python_literal">'Boston'</span><span class="python_enclosure">))</span>
<span class="python_enclosure">})</span><span class="python_operator"></span></pre></div>
<p>Many to many relationships can be customized by one or both of <code>primaryjoin</code> and <code>secondaryjoin</code>, shown below with just the default many-to-many relationship explicitly set:
</p>


<div class="sliding_code">
<pre><span class="python_keyword">class </span><span class="python_name">User</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">pass</span><span class="python_operator">
</span><span class="python_keyword">class </span><span class="python_name">Keyword</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">pass</span><span class="python_operator">
</span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Keyword</span><span class="python_operator">, </span><span class="python_name">keywords_table</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">users_table</span><span class="python_operator">, </span><span class="python_name">properties</span><span class="python_operator">=</span><span class="python_enclosure">{</span>
    <span class="python_literal">'keywords'</span><span class="python_operator">:</span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">Keyword</span><span class="python_operator">, </span><span class="python_name">secondary</span><span class="python_operator">=</span><span class="python_name">userkeywords_table</span><span class="python_operator">,</span>
        <span class="python_name">primaryjoin</span><span class="python_operator">=</span><span class="python_name">users_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">==</span><span class="python_name">userkeywords_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">,</span>
        <span class="python_name">secondaryjoin</span><span class="python_operator">=</span><span class="python_name">userkeywords_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">keyword_id</span><span class="python_operator">==</span><span class="python_name">keywords_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">keyword_id</span>
        <span class="python_enclosure">)</span>
<span class="python_enclosure">})</span><span class="python_operator"></span></pre></div>


    </div>

    <a href="#advdatamapping" class="toclink">back to section top</a>
</div>




<A name="advdatamapping_properties_multiplejoin"></a>

<div class="subsection" style="margin-left:30px;">


<h3>Lazy/Eager Joins Multiple Times to One Table</h3>

    <div class="sectiontext">
    

<p>The previous example leads in to the idea of joining against the same table multiple times.  Below is a User object that has lists of its Boston and New York addresses:
</p>


<div class="sliding_code">
<pre><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">users_table</span><span class="python_operator">, </span><span class="python_name">properties</span><span class="python_operator">=</span><span class="python_enclosure">{</span>
    <span class="python_literal">'boston_addresses' </span><span class="python_operator">: </span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_operator">, </span><span class="python_name">primaryjoin</span><span class="python_operator">=</span>
                <span class="python_name">and_</span><span class="python_enclosure">(</span><span class="python_name">users_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">==</span><span class="python_name">Address</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">, </span>
                <span class="python_name">Addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">city</span><span class="python_operator">==</span><span class="python_literal">'Boston'</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
    <span class="python_literal">'newyork_addresses' </span><span class="python_operator">: </span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_operator">, </span><span class="python_name">primaryjoin</span><span class="python_operator">=</span>
                <span class="python_name">and_</span><span class="python_enclosure">(</span><span class="python_name">users_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">==</span><span class="python_name">Address</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">, </span>
                <span class="python_name">Addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">city</span><span class="python_operator">==</span><span class="python_literal">'New York'</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
<span class="python_enclosure">})</span><span class="python_operator"></span></pre></div>
<p>Both lazy and eager loading support multiple joins equally well.
</p>


    </div>

    <a href="#advdatamapping" class="toclink">back to section top</a>
</div>




<A name="advdatamapping_properties_deferred"></a>

<div class="subsection" style="margin-left:30px;">


<h3>Deferred Column Loading</h3>

    <div class="sectiontext">
    

<p>This feature allows particular columns of a table to not be loaded by default, instead being loaded later on when first referenced.  It is essentailly "column-level lazy loading".   This feature is useful when one wants to avoid loading a large text or binary field into memory when its not needed.  Individual columns can be lazy loaded by themselves or placed into groups that lazy-load together.
</p>


<div class="sliding_code">
<pre><span class="python_name">book_excerpts </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'books'</span><span class="python_operator">, </span><span class="python_name">db</span><span class="python_operator">, </span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'book_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'title'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">200</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">nullable</span><span class="python_operator">=</span><span class="python_name">False</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'summary'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">2000</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'excerpt'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'photo'</span><span class="python_operator">, </span><span class="python_name">Binary</span><span class="python_enclosure">)</span>
<span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_keyword">class </span><span class="python_name">Book</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">pass</span><span class="python_operator">
</span>
<span class="python_comment"># define a mapper that will load each of 'excerpt' and 'photo' in 
# separate, individual-row SELECT statements when each attribute
# is first referenced on the individual object instance
</span><span class="python_operator"></span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Book</span><span class="python_operator">, </span><span class="python_name">book_excerpts</span><span class="python_operator">, </span><span class="python_name">properties </span><span class="python_operator">= </span><span class="python_enclosure">{</span>
    <span class="python_literal">'excerpt' </span><span class="python_operator">: </span><span class="python_name">deferred</span><span class="python_enclosure">(</span><span class="python_name">book_excerpts</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">excerpt</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_literal">'photo' </span><span class="python_operator">: </span><span class="python_name">deferred</span><span class="python_enclosure">(</span><span class="python_name">book_excerpts</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">photo</span><span class="python_enclosure">)</span>
<span class="python_enclosure">})</span><span class="python_operator"></span></pre></div>
<p>Deferred columns can be placed into groups so that they load together:
</p>


<div class="sliding_code">
<pre><span class="python_name">book_excerpts </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'books'</span><span class="python_operator">, </span><span class="python_name">db</span><span class="python_operator">, </span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'book_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'title'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">200</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">nullable</span><span class="python_operator">=</span><span class="python_name">False</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'summary'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">2000</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'excerpt'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'photo1'</span><span class="python_operator">, </span><span class="python_name">Binary</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'photo2'</span><span class="python_operator">, </span><span class="python_name">Binary</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'photo3'</span><span class="python_operator">, </span><span class="python_name">Binary</span><span class="python_enclosure">)</span>
<span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_keyword">class </span><span class="python_name">Book</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">pass</span><span class="python_operator">
</span>
<span class="python_comment"># define a mapper with a 'photos' deferred group.  when one photo is referenced,
# all three photos will be loaded in one SELECT statement.  The 'excerpt' will 
# be loaded separately when it is first referenced.
</span><span class="python_operator"></span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Book</span><span class="python_operator">, </span><span class="python_name">book_excerpts</span><span class="python_operator">, </span><span class="python_name">properties </span><span class="python_operator">= </span><span class="python_enclosure">{</span>
    <span class="python_literal">'excerpt' </span><span class="python_operator">: </span><span class="python_name">deferred</span><span class="python_enclosure">(</span><span class="python_name">book_excerpts</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">excerpt</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_literal">'photo1' </span><span class="python_operator">: </span><span class="python_name">deferred</span><span class="python_enclosure">(</span><span class="python_name">book_excerpts</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">photo1</span><span class="python_operator">, </span><span class="python_name">group</span><span class="python_operator">=</span><span class="python_literal">'photos'</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_literal">'photo2' </span><span class="python_operator">: </span><span class="python_name">deferred</span><span class="python_enclosure">(</span><span class="python_name">book_excerpts</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">photo2</span><span class="python_operator">, </span><span class="python_name">group</span><span class="python_operator">=</span><span class="python_literal">'photos'</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_literal">'photo3' </span><span class="python_operator">: </span><span class="python_name">deferred</span><span class="python_enclosure">(</span><span class="python_name">book_excerpts</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">photo3</span><span class="python_operator">, </span><span class="python_name">group</span><span class="python_operator">=</span><span class="python_literal">'photos'</span><span class="python_enclosure">)</span>
<span class="python_enclosure">})</span><span class="python_operator"></span></pre></div>


    </div>

    <a href="#advdatamapping" class="toclink">back to section top</a>
</div>




<A name="advdatamapping_properties_working"></a>

<div class="subsection" style="margin-left:30px;">


<h3>Working with Large Collections</h3>

    <div class="sectiontext">
    

<p>SQLAlchemy relations are generally simplistic; the lazy loader loads in the full list of child objects when accessed, and the eager load builds a query that loads the full list of child objects.  Additionally, when you are deleting a parent object, SQLAlchemy insures that it has loaded the full list of child objects so that it can mark them as deleted as well (or to update their parent foreign key to NULL).  It does not issue an en-masse "delete from table where parent_id=?" type of statement in such a scenario.  This is because the child objects themselves may also have further dependencies, and additionally may also exist in the current session in which case SA needs to know their identity so that their state can be properly updated.
</p>
<p>So there are several techniques that can be used individually or combined together to address these issues, in the context of a large collection where you normally would not want to load the full list of relationships:
</p>
<ul>
 <li><p>Use <code>lazy=None</code> to disable child object loading (i.e. noload)
</p>


<div class="sliding_code">
<pre><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">MyClass</span><span class="python_operator">, </span><span class="python_name">table</span><span class="python_operator">, </span><span class="python_name">properties</span><span class="python_operator">=</span><span class="python_name">relation</span><span class="python_enclosure">{</span>
    <span class="python_literal">'children'</span><span class="python_operator">:</span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">MyObj</span><span class="python_operator">, </span><span class="python_name">lazy</span><span class="python_operator">=</span><span class="python_name">None</span><span class="python_enclosure">)</span>
<span class="python_enclosure">})</span><span class="python_operator"></span></pre></div>

 </li>

 <li><p>To load child objects, just use a query:
</p>


<div class="sliding_code">
<pre><span class="python_keyword">class </span><span class="python_name">Organization</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">def </span><span class="python_name">__init__</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">name</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">name </span><span class="python_operator">= </span><span class="python_name">name</span><span class="python_operator">
    </span><span class="python_keyword">def </span><span class="python_name">find_members</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">criterion</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_literal">"""locate a subset of the members associated with this Organization"""</span><span class="python_operator">
        </span><span class="python_keyword">return </span><span class="python_name">object_session</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">Member</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">and_</span><span class="python_enclosure">(</span><span class="python_name">member_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">name</span><span class="python_operator">.</span><span class="python_name">like</span><span class="python_enclosure">(</span><span class="python_name">criterion</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">org_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">org_id</span><span class="python_operator">==</span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">org_id</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">from_obj</span><span class="python_operator">=</span><span class="python_enclosure">[</span><span class="python_name">org_table</span><span class="python_operator">.</span><span class="python_name">join</span><span class="python_enclosure">(</span><span class="python_name">member_table</span><span class="python_enclosure">)])</span><span class="python_operator"></span></pre></div>

 </li>

 <li><p>Use <code>passive_updates=True</code> to disable child object loading on a DELETE operation (noload also accomplishes this)
</p>

 </li>

 <li><p>Use "ON DELETE (CASCADE|SET NULL)" on your database to automatically cascade deletes to child objects (this is the best way to do it)
</p>


<div class="sliding_code">
<pre><span class="python_name">mytable </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'sometable'</span><span class="python_operator">, </span><span class="python_name">meta</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'parent_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">ForeignKeyConstraint</span><span class="python_enclosure">([</span><span class="python_literal">'parent_id'</span><span class="python_enclosure">]</span><span class="python_operator">,</span><span class="python_enclosure">[</span><span class="python_literal">'parenttable.id'</span><span class="python_enclosure">]</span><span class="python_operator">, </span><span class="python_name">ondelete</span><span class="python_operator">=</span><span class="python_literal">"CASCADE"</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_enclosure">)</span><span class="python_operator"></span></pre></div>

 </li>

 <li><p>Alternatively, you can create a simple <code>MapperExtension</code> that will issue a DELETE for child objects:
</p>


<div class="sliding_code">
<pre><span class="python_keyword">class </span><span class="python_name">DeleteMemberExt</span><span class="python_enclosure">(</span><span class="python_name">MapperExtension</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">def </span><span class="python_name">before_delete</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">mapper</span><span class="python_operator">, </span><span class="python_name">connection</span><span class="python_operator">, </span><span class="python_name">instance</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_name">connection</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_name">member_table</span><span class="python_operator">.</span><span class="python_name">delete</span><span class="python_enclosure">(</span><span class="python_name">member_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">org_id</span><span class="python_operator">==</span><span class="python_name">instance</span><span class="python_operator">.</span><span class="python_name">org_id</span><span class="python_enclosure">))</span><span class="python_operator">
</span>
<span class="python_operator"></span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Organization</span><span class="python_operator">, </span><span class="python_name">org_table</span><span class="python_operator">, </span><span class="python_name">extension</span><span class="python_operator">=</span><span class="python_name">DeleteMemberExt</span><span class="python_enclosure">()</span><span class="python_operator">, </span><span class="python_name">properties </span><span class="python_operator">= </span><span class="python_enclosure">{</span>
    <span class="python_literal">'members' </span><span class="python_operator">: </span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">Member</span><span class="python_operator">, </span><span class="python_name">lazy</span><span class="python_operator">=</span><span class="python_name">None</span><span class="python_operator">, </span><span class="python_name">passive_deletes</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_operator">, </span><span class="python_name">cascade</span><span class="python_operator">=</span><span class="python_literal">"all, delete-orphan"</span><span class="python_enclosure">)</span>
<span class="python_enclosure">})</span><span class="python_operator"></span></pre></div>

 </li>
</ul>
<p>The latest distribution includes an example <code>examples/collection/large_collection.py</code> which illustrates most of these techniques.    <br></br>
</p>


    </div>

    <a href="#advdatamapping" class="toclink">back to section top</a>
</div>




<A name="advdatamapping_properties_relationoptions"></a>

<div class="subsection" style="margin-left:30px;">


<h3>Relation Options</h3>

    <div class="sectiontext">
    

<p>Keyword options to the <code>relation</code> function include:
</p>
<ul>
 <li>
     lazy=(True|False|None) - specifies how the related items should be loaded.  a value of True indicates they should be loaded when the property is first accessed.  A value of False indicates they should be loaded by joining against the parent object query, so parent and child are loaded in one round trip.  A value of None indicates the related items are not loaded by the mapper in any case; the application will manually insert items into the list in some other way.  A relationship with lazy=None is still important; items added to the list or removed will cause the appropriate updates and deletes upon flush().  Future capabilities for lazy might also include "lazy='extra'", which would allow lazy loading of child elements one at a time, for very large collections.
 </li>

 <li>
     cascade - a string list of <strong>cascade rules</strong> which determines how persistence operations should be "cascaded" from parent to child.  For a description of cascade rules, see <a href="datamapping.html#datamapping_relations_lifecycle">datamapping_relations_cycle</a> and <a href="unitofwork.html#unitofwork_cascade">Cascade rules</a>.
 </li>

 <li>
     secondary - for a many-to-many relationship, specifies the intermediary table.
 </li>

 <li>
     primaryjoin - a ClauseElement that will be used as the primary join of this child object against the parent object, or in a many-to-many relationship the join of the primary object to the association table.  By default, this value is computed based on the foreign key relationships of the parent and child tables (or association table).
 </li>

 <li>
     secondaryjoin - a ClauseElement that will be used as the join of an association table to the child object.  By default, this value is computed based on the foreign key relationships of the association and child tables.
 </li>

 <li>
     remote_side - used for self-referential relationships, indicates the column or list of columns that form the "remote side" of the relationship.
 </li>

 <li>
     foreignkey - deprecated.  As of 0.3.2, use remote_side to indicate the direction of self-referential relationships.  For ForeignKey specification, this field is only partially functional (i.e. does not work for many-to-many relationships).  a new field "foreign_keys" will be added in a future release to implement this functionality.
 </li>

 <li>
     uselist - a boolean that indicates if this property should be loaded as a list or a scalar.  In most cases, this value is determined based on the type and direction of the relationship - one to many forms a list, many to one forms a scalar, many to many is a list.  If a scalar is desired where normally a list would be present, such as a bi-directional one-to-one relationship, set uselist to False.
 </li>

 <li>
     private - setting <code>private=True</code> is the equivalent of setting <code>cascade="all, delete-orphan"</code>, and indicates the lifecycle of child objects should be contained within that of the parent.   See the example in <a href="datamapping.html#datamapping_relations_lifecycle">datamapping_relations_cycle</a>.
 </li>

 <li>
     backref - indicates the name of a property to be placed on the related mapper's class that will handle this relationship in the other direction, including synchronizing the object attributes on both sides of the relation.  Can also point to a <code>backref()</code> construct for more configurability.  See <a href="datamapping.html#datamapping_relations_backreferences">Backreferences</a>.
 </li>

 <li>
     order_by - indicates the ordering that should be applied when loading these items.  See the section <a href="adv_datamapping.html#advdatamapping_orderby">Controlling Ordering</a> for details.
 </li>

 <li>
     association - Deprecated; as of version 0.3.0 the association keyword is synonomous with applying the "all, delete-orphan" cascade to a "one-to-many" relationship.  SA can now automatically reconcile a "delete" and "insert" operation of two objects with the same "identity" in a flush() operation into a single "update" statement, which is the pattern that "association" used to indicate.  See the updated example of association mappings in <a href="datamapping.html#datamapping_association">Association Object</a>.
 </li>

 <li>
     post_update - this indicates that the relationship should be handled by a second UPDATE statement after an INSERT, or before a DELETE.  using this flag essentially means the relationship will not incur any "dependency" between parent and child item, as the particular foreign key relationship between them is handled by a second statement.  use this flag when a particular mapping arrangement will incur two rows that are dependent on each other, such as a table that has a one-to-many relationship to a set of child rows, and also has a column that references a single child row within that list (i.e. both tables contain a foreign key to each other).  If a flush() operation returns an error that a "cyclical dependency" was detected, this is a cue that you might want to use post_update.
 </li>

 <li>
     viewonly=(True|False) - when set to True, the relation is used only for loading objects within the relationship, and has no effect on the unit-of-work flush process.  relations with viewonly can specify any kind of join conditions to provide additional views of related objects onto a parent object.
 </li>

 <li>
     collection_class = None - a class or function that returns a new list-holding object.  will be used in place of a plain list for storing elements.
 </li>

 <li>
     passive_deletes = False - if False, child instances will be loaded from the database into the current session when a parent instance is deleted so that delete cascade can be processed on those child instances, even if they were not loaded already.  When set to True, lazy loaders will not be fired off in order to process a "delete" cascade, which is appropriate if "ON DELETE" rules have been set up on the database tables themselves.
 </li>
</ul>


    </div>

</div>



    </div>

    <a href="#advdatamapping" class="toclink">back to section top</a>
</div>




<A name="advdatamapping_orderby"></a>

<div class="subsection" style="margin-left:20px;">


<h3>Controlling Ordering</h3>

    <div class="sectiontext">
    

<p>By default, mappers will attempt to ORDER BY the "oid" column of a table, or the primary key column, when selecting rows.  This can be modified in several ways.
</p>
<p>The "order_by" parameter can be sent to a mapper, overriding the per-engine ordering if any.  A value of None means that the mapper should not use any ordering.  A non-None value, which can be a column, an <code>asc</code> or <code>desc</code> clause, or an array of either one, indicates the ORDER BY clause that should be added to all select queries:
</p>


<div class="sliding_code">
<pre><span class="python_comment"># disable all ordering
</span><span class="python_name">mapper </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">users_table</span><span class="python_operator">, </span><span class="python_name">order_by</span><span class="python_operator">=</span><span class="python_name">None</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># order by a column
</span><span class="python_name">mapper </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">users_table</span><span class="python_operator">, </span><span class="python_name">order_by</span><span class="python_operator">=</span><span class="python_name">users_tableusers_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># order by multiple items
</span><span class="python_name">mapper </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">users_table</span><span class="python_operator">, </span><span class="python_name">order_by</span><span class="python_operator">=</span><span class="python_enclosure">[</span><span class="python_name">users_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">, </span><span class="python_name">desc</span><span class="python_enclosure">(</span><span class="python_name">users_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_enclosure">)])</span><span class="python_operator"></span></pre></div>
<p>"order_by" can also be specified to an individual <code>select</code> method, overriding all other per-engine/per-mapper orderings:
</p>


<div class="sliding_code">
<pre><span class="python_comment"># order by a column
</span><span class="python_name">l </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">users_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator">==</span><span class="python_literal">'fred'</span><span class="python_operator">, </span><span class="python_name">order_by</span><span class="python_operator">=</span><span class="python_name">users_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># order by multiple criterion
</span><span class="python_name">l </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">users_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator">==</span><span class="python_literal">'fred'</span><span class="python_operator">, </span><span class="python_name">order_by</span><span class="python_operator">=</span><span class="python_enclosure">[</span><span class="python_name">users_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">, </span><span class="python_name">desc</span><span class="python_enclosure">(</span><span class="python_name">users_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_enclosure">)])</span><span class="python_operator"></span></pre></div>
<p>For relations, the "order_by" property can also be specified to all forms of relation:
</p>


<div class="sliding_code">
<pre><span class="python_comment"># order address objects by address id
</span><span class="python_name">mapper </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">users_table</span><span class="python_operator">, </span><span class="python_name">properties </span><span class="python_operator">= </span><span class="python_enclosure">{</span>
    <span class="python_literal">'addresses' </span><span class="python_operator">: </span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_operator">, </span><span class="python_name">addresses_table</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">order_by</span><span class="python_operator">=</span><span class="python_name">addresses_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">address_id</span><span class="python_enclosure">)</span>
<span class="python_enclosure">})</span><span class="python_operator">
</span>
<span class="python_comment"># eager load with ordering - the ORDER BY clauses of parent/child will be organized properly
</span><span class="python_name">mapper </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">users_table</span><span class="python_operator">, </span><span class="python_name">properties </span><span class="python_operator">= </span><span class="python_enclosure">{</span>
    <span class="python_literal">'addresses' </span><span class="python_operator">: </span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_operator">, </span><span class="python_name">addresses_table</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">order_by</span><span class="python_operator">=</span><span class="python_name">desc</span><span class="python_enclosure">(</span><span class="python_name">addresses_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">email_address</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">eager</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span>
<span class="python_enclosure">}</span><span class="python_operator">, </span><span class="python_name">order_by</span><span class="python_operator">=</span><span class="python_name">users_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre></div>


    </div>

    <a href="#advdatamapping" class="toclink">back to section top</a>
</div>




<A name="advdatamapping_limits"></a>

<div class="subsection" style="margin-left:20px;">


<h3>Limiting Rows</h3>

    <div class="sectiontext">
    

<p>You can limit rows in a regular SQL query by specifying <code>limit</code> and <code>offset</code>.  A Mapper can handle the same concepts:
</p>


<div class="code">
<pre><span class="python_keyword">class </span><span class="python_name">User</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">pass</span><span class="python_operator">
</span>
<span class="python_operator"></span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">users_table</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_92', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">r </span><span class="python_operator">= </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">limit</span><span class="python_operator">=</span><span class="python_number">20</span><span class="python_operator">, </span><span class="python_name">offset</span><span class="python_operator">=</span><span class="python_number">10</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre><div id="popbox_92_div" class="codepop" style="display:none;">SELECT users.user_id AS users_user_id, <br/>
  users.user_name AS users_user_name, users.password AS users_password <br/>
  FROM users ORDER BY users.oid <br/>
  LIMIT 20 OFFSET 10<br/>
  {}</div><pre><span class="python_operator"></span></pre></div>
<p>However, things get tricky when dealing with eager relationships, since a straight LIMIT of rows does not represent the count of items when joining against other tables to load related items as well.  So here is what SQLAlchemy will do when you use limit or offset with an eager relationship:
</p>


<div class="sliding_code">
<pre><span class="python_keyword">class </span><span class="python_name">User</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">pass</span><span class="python_operator">
</span><span class="python_keyword">class </span><span class="python_name">Address</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">pass</span><span class="python_operator">
    </span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">users_table</span><span class="python_operator">, </span><span class="python_name">properties</span><span class="python_operator">=</span><span class="python_enclosure">{</span>
    <span class="python_literal">'addresses' </span><span class="python_operator">: </span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_operator">, </span><span class="python_name">addresses_table</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">lazy</span><span class="python_operator">=</span><span class="python_name">False</span><span class="python_enclosure">)</span>
<span class="python_enclosure">})</span><span class="python_operator">
</span><span class="python_name">r </span><span class="python_operator">= </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator">.</span><span class="python_name">like</span><span class="python_enclosure">(</span><span class="python_literal">'F%'</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">limit</span><span class="python_operator">=</span><span class="python_number">20</span><span class="python_operator">, </span><span class="python_name">offset</span><span class="python_operator">=</span><span class="python_number">10</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre><div class="codepop">SELECT users.user_id AS users_user_id, users.user_name AS users_user_name, <br/>
  users.password AS users_password, addresses.address_id AS addresses_address_id, <br/>
  addresses.user_id AS addresses_user_id, addresses.street AS addresses_street, <br/>
  addresses.city AS addresses_city, addresses.state AS addresses_state, <br/>
  addresses.zip AS addresses_zip <br/>
  FROM <br/>
  (SELECT users.user_id FROM users WHERE users.user_name LIKE %(users_user_name)s<br/>
  ORDER BY users.oid LIMIT 20 OFFSET 10) AS rowcount, <br/>
   users LEFT OUTER JOIN addresses ON users.user_id = addresses.user_id <br/>
  WHERE rowcount.user_id = users.user_id ORDER BY users.oid, addresses.oid<br/>
  {'users_user_name': 'F%'}</div><pre><span class="python_operator"></span></pre></div>
<p>The main WHERE clause as well as the limiting clauses are coerced into a subquery; this subquery represents the desired result of objects.  A containing query, which handles the eager relationships, is joined against the subquery to produce the result.
</p>


    </div>

    <a href="#advdatamapping" class="toclink">back to section top</a>
</div>




<A name="advdatamapping_inheritance"></a>

<div class="subsection" style="margin-left:20px;">


<h3>Mapping a Class with Table Inheritance</h3>

    <div class="sectiontext">
    

<p>Feature Status: <a href='javascript:alphaImplementation()'>Alpha Implementation</a> 
</p>
<p>Inheritance in databases comes in three forms:  <em>single table inheritance</em>, where several types of classes are stored in one table, <em>concrete table inheritance</em>, where each type of class is stored in its own table, and <em>multiple table inheritance</em>, where the parent/child classes are stored in their own tables that are joined together in a select.
</p>
<p>There is also a concept of <code>polymorphic</code> loading, which indicates if multiple kinds of classes can be loaded in one pass.
</p>
<p>SQLAlchemy supports all three kinds of inheritance.  Additionally, true <code>polymorphic</code> loading is supported in a straightfoward way for single table inheritance, and has some more manually-configured features that can make it happen for concrete and multiple table inheritance.
</p>
<p>Working examples of polymorphic inheritance come with the distribution in the directory <code>examples/polymorphic</code>.
</p>
<p>Here are the classes we will use to represent an inheritance relationship:
</p>


<div class="sliding_code">
<pre><span class="python_keyword">class </span><span class="python_name">Employee</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">def </span><span class="python_name">__init__</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">name</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">name </span><span class="python_operator">= </span><span class="python_name">name</span><span class="python_operator">
    </span><span class="python_keyword">def </span><span class="python_name">__repr__</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_keyword">return </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">__class__</span><span class="python_operator">.</span><span class="python_name">__name__ </span><span class="python_operator">+ </span><span class="python_literal">" " </span><span class="python_operator">+ </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">name</span><span class="python_operator">
</span>
<span class="python_operator"></span><span class="python_keyword">class </span><span class="python_name">Manager</span><span class="python_enclosure">(</span><span class="python_name">Employee</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">def </span><span class="python_name">__init__</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">name</span><span class="python_operator">, </span><span class="python_name">manager_data</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">name </span><span class="python_operator">= </span><span class="python_name">name</span><span class="python_operator">
        </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">manager_data </span><span class="python_operator">= </span><span class="python_name">manager_data</span><span class="python_operator">
    </span><span class="python_keyword">def </span><span class="python_name">__repr__</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_keyword">return </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">__class__</span><span class="python_operator">.</span><span class="python_name">__name__ </span><span class="python_operator">+ </span><span class="python_literal">" " </span><span class="python_operator">+ </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">name </span><span class="python_operator">+ </span><span class="python_literal">" " </span><span class="python_operator">+  </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">manager_data</span><span class="python_operator">
</span>
<span class="python_operator"></span><span class="python_keyword">class </span><span class="python_name">Engineer</span><span class="python_enclosure">(</span><span class="python_name">Employee</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">def </span><span class="python_name">__init__</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">name</span><span class="python_operator">, </span><span class="python_name">engineer_info</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">name </span><span class="python_operator">= </span><span class="python_name">name</span><span class="python_operator">
        </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">engineer_info </span><span class="python_operator">= </span><span class="python_name">engineer_info</span><span class="python_operator">
    </span><span class="python_keyword">def </span><span class="python_name">__repr__</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_keyword">return </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">__class__</span><span class="python_operator">.</span><span class="python_name">__name__ </span><span class="python_operator">+ </span><span class="python_literal">" " </span><span class="python_operator">+ </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">name </span><span class="python_operator">+ </span><span class="python_literal">" " </span><span class="python_operator">+  </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">engineer_info</span><span class="python_operator"></span></pre></div>
<p>Each class supports a common <code>name</code> attribute, while the <code>Manager</code> class has its own attribute <code>manager_data</code> and the <code>Engineer</code> class has its own attribute <code>engineer_info</code>.
</p>



<A name="advdatamapping_inheritance_single"></a>

<div class="subsection" style="margin-left:30px;">


<h3>Single Table Inheritance</h3>

    <div class="sectiontext">
    

<p>This will support polymorphic loading via the <code>Employee</code> mapper.
</p>


<div class="sliding_code">
<pre><span class="python_name">employees_table </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'employees'</span><span class="python_operator">, </span><span class="python_name">metadata</span><span class="python_operator">, </span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'employee_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'name'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">50</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'manager_data'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">50</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'engineer_info'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">50</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'type'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">20</span><span class="python_enclosure">))</span>
<span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_name">employee_mapper </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Employee</span><span class="python_operator">, </span><span class="python_name">employees_table</span><span class="python_operator">, </span><span class="python_name">polymorphic_on</span><span class="python_operator">=</span><span class="python_name">employees_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">type</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">manager_mapper </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Manager</span><span class="python_operator">, </span><span class="python_name">inherits</span><span class="python_operator">=</span><span class="python_name">employee_mapper</span><span class="python_operator">, </span><span class="python_name">polymorphic_identity</span><span class="python_operator">=</span><span class="python_literal">'manager'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">engineer_mapper </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Engineer</span><span class="python_operator">, </span><span class="python_name">inherits</span><span class="python_operator">=</span><span class="python_name">employee_mapper</span><span class="python_operator">, </span><span class="python_name">polymorphic_identity</span><span class="python_operator">=</span><span class="python_literal">'engineer'</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre></div>


    </div>

    <a href="#advdatamapping" class="toclink">back to section top</a>
</div>




<A name="advdatamapping_inheritance_concrete"></a>

<div class="subsection" style="margin-left:30px;">


<h3>Concrete Table Inheritance</h3>

    <div class="sectiontext">
    

<p>Without polymorphic loading, you just define a separate mapper for each class.
</p>


<div class="sliding_code">
    <div class="codetitle">Concrete Inheritance, Non-polymorphic</div>
<pre><span class="python_name">managers_table </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'managers'</span><span class="python_operator">, </span><span class="python_name">metadata</span><span class="python_operator">, </span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'employee_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'name'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">50</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'manager_data'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">50</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
<span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_name">engineers_table </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'engineers'</span><span class="python_operator">, </span><span class="python_name">metadata</span><span class="python_operator">, </span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'employee_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'name'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">50</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'engineer_info'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">50</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
<span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_name">manager_mapper </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Manager</span><span class="python_operator">, </span><span class="python_name">managers_table</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">engineer_mapper </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Engineer</span><span class="python_operator">, </span><span class="python_name">engineers_table</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre></div>
<p>With polymorphic loading, the SQL query to do the actual polymorphic load must be constructed, usually as a UNION.  There is a helper function to create these UNIONS called <code>polymorphic_union</code>.
</p>


<div class="sliding_code">
    <div class="codetitle">Concrete Inheritance, Polymorphic</div>
<pre><span class="python_name">pjoin </span><span class="python_operator">= </span><span class="python_name">polymorphic_union</span><span class="python_enclosure">({</span>
    <span class="python_literal">'manager'</span><span class="python_operator">:</span><span class="python_name">managers_table</span><span class="python_operator">,</span>
    <span class="python_literal">'engineer'</span><span class="python_operator">:</span><span class="python_name">engineers_table</span>
<span class="python_enclosure">}</span><span class="python_operator">, </span><span class="python_literal">'type'</span><span class="python_operator">, </span><span class="python_literal">'pjoin'</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_name">employee_mapper </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Employee</span><span class="python_operator">, </span><span class="python_name">pjoin</span><span class="python_operator">, </span><span class="python_name">polymorphic_on</span><span class="python_operator">=</span><span class="python_name">pjoin</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">type</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">manager_mapper </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Manager</span><span class="python_operator">, </span><span class="python_name">managers_table</span><span class="python_operator">, </span><span class="python_name">inherits</span><span class="python_operator">=</span><span class="python_name">employee_mapper</span><span class="python_operator">, </span><span class="python_name">concrete</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_operator">, </span><span class="python_name">polymorphic_identity</span><span class="python_operator">=</span><span class="python_literal">'manager'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">engineer_mapper </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Engineer</span><span class="python_operator">, </span><span class="python_name">engineers_table</span><span class="python_operator">, </span><span class="python_name">inherits</span><span class="python_operator">=</span><span class="python_name">employee_mapper</span><span class="python_operator">, </span><span class="python_name">concrete</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_operator">, </span><span class="python_name">polymorphic_identity</span><span class="python_operator">=</span><span class="python_literal">'engineer'</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre></div>
<p>A future release of SQLALchemy might better merge the generated UNION into the mapper construction phase.    <br></br>
</p>


    </div>

    <a href="#advdatamapping" class="toclink">back to section top</a>
</div>




<A name="advdatamapping_inheritance_multiple"></a>

<div class="subsection" style="margin-left:30px;">


<h3>Multiple Table Inheritance</h3>

    <div class="sectiontext">
    

<p>Like concrete table inheritance, this can be done non-polymorphically, or with a little more complexity, polymorphically:
</p>


<div class="sliding_code">
    <div class="codetitle">Multiple Table Inheritance, Non-polymorphic</div>
<pre><span class="python_name">employees </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'employees'</span><span class="python_operator">, </span><span class="python_name">metadata</span><span class="python_operator">, </span>
   <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'person_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
   <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'name'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">50</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
   <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'type'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">30</span><span class="python_enclosure">)))</span><span class="python_operator">
</span>
<span class="python_name">engineers </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'engineers'</span><span class="python_operator">, </span><span class="python_name">metadata</span><span class="python_operator">, </span>
   <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'person_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">ForeignKey</span><span class="python_enclosure">(</span><span class="python_literal">'employees.person_id'</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
   <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'engineer_info'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">50</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
  <span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_name">managers </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'managers'</span><span class="python_operator">, </span><span class="python_name">metadata</span><span class="python_operator">, </span>
   <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'person_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">ForeignKey</span><span class="python_enclosure">(</span><span class="python_literal">'employees.person_id'</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
   <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'manager_data'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">50</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
   <span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_name">person_mapper </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Employee</span><span class="python_operator">, </span><span class="python_name">employees</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Engineer</span><span class="python_operator">, </span><span class="python_name">engineers</span><span class="python_operator">, </span><span class="python_name">inherits</span><span class="python_operator">=</span><span class="python_name">person_mapper</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Manager</span><span class="python_operator">, </span><span class="python_name">managers</span><span class="python_operator">, </span><span class="python_name">inherits</span><span class="python_operator">=</span><span class="python_name">person_mapper</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre></div>
<p>Polymorphic:
</p>


<div class="sliding_code">
    <div class="codetitle">Multiple Table Inheritance, Polymorphic</div>
<pre><span class="python_name">person_join </span><span class="python_operator">= </span><span class="python_name">polymorphic_union</span><span class="python_enclosure">(</span>
    <span class="python_enclosure">{</span>
        <span class="python_literal">'engineer'</span><span class="python_operator">:</span><span class="python_name">employees</span><span class="python_operator">.</span><span class="python_name">join</span><span class="python_enclosure">(</span><span class="python_name">engineers</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
        <span class="python_literal">'manager'</span><span class="python_operator">:</span><span class="python_name">employees</span><span class="python_operator">.</span><span class="python_name">join</span><span class="python_enclosure">(</span><span class="python_name">managers</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
        <span class="python_literal">'person'</span><span class="python_operator">:</span><span class="python_name">employees</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">employees</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">type</span><span class="python_operator">==</span><span class="python_literal">'person'</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_enclosure">}</span><span class="python_operator">, </span><span class="python_name">None</span><span class="python_operator">, </span><span class="python_literal">'pjoin'</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_name">person_mapper </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Employee</span><span class="python_operator">, </span><span class="python_name">employees</span><span class="python_operator">, </span><span class="python_name">select_table</span><span class="python_operator">=</span><span class="python_name">person_join</span><span class="python_operator">, </span><span class="python_name">polymorphic_on</span><span class="python_operator">=</span><span class="python_name">person_join</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">type</span><span class="python_operator">, </span><span class="python_name">polymorphic_identity</span><span class="python_operator">=</span><span class="python_literal">'person'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Engineer</span><span class="python_operator">, </span><span class="python_name">engineers</span><span class="python_operator">, </span><span class="python_name">inherits</span><span class="python_operator">=</span><span class="python_name">person_mapper</span><span class="python_operator">, </span><span class="python_name">polymorphic_identity</span><span class="python_operator">=</span><span class="python_literal">'engineer'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Manager</span><span class="python_operator">, </span><span class="python_name">managers</span><span class="python_operator">, </span><span class="python_name">inherits</span><span class="python_operator">=</span><span class="python_name">person_mapper</span><span class="python_operator">, </span><span class="python_name">polymorphic_identity</span><span class="python_operator">=</span><span class="python_literal">'manager'</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre></div>
<p>The join condition in a multiple table inheritance relationship can be specified explicitly, using <code>inherit_condition</code>:
</p>


<div class="sliding_code">
<pre><span class="python_name">AddressUser</span><span class="python_operator">.</span><span class="python_name">mapper </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_enclosure">(</span>
        <span class="python_name">AddressUser</span><span class="python_operator">,</span>
        <span class="python_name">addresses_table</span><span class="python_operator">, </span><span class="python_name">inherits</span><span class="python_operator">=</span><span class="python_name">User</span><span class="python_operator">.</span><span class="python_name">mapper</span><span class="python_operator">, </span>
        <span class="python_name">inherit_condition</span><span class="python_operator">=</span><span class="python_name">users_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">==</span><span class="python_name">addresses_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span>
    <span class="python_enclosure">)</span><span class="python_operator"></span></pre></div>


    </div>

</div>



    </div>

    <a href="#advdatamapping" class="toclink">back to section top</a>
</div>




<A name="advdatamapping_joins"></a>

<div class="subsection" style="margin-left:20px;">


<h3>Mapping a Class against Multiple Tables</h3>

    <div class="sectiontext">
    

<p>Mappers can be constructed against arbitrary relational units (called <code>Selectables</code>) as well as plain <code>Tables</code>.  For example, The <code>join</code> keyword from the SQL package creates a neat selectable unit comprised of multiple tables, complete with its own composite primary key, which can be passed in to a mapper as the table.
</p>


<div class="sliding_code">
<pre><span class="python_comment"># a class
</span><span class="python_keyword">class </span><span class="python_name">AddressUser</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">pass</span><span class="python_operator">
</span>
<span class="python_comment"># define a Join
</span><span class="python_operator"></span><span class="python_name">j </span><span class="python_operator">= </span><span class="python_name">join</span><span class="python_enclosure">(</span><span class="python_name">users_table</span><span class="python_operator">, </span><span class="python_name">addresses_table</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># map to it - the identity of an AddressUser object will be 
# based on (user_id, address_id) since those are the primary keys involved
</span><span class="python_name">m </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">AddressUser</span><span class="python_operator">, </span><span class="python_name">j</span><span class="python_operator">, </span><span class="python_name">properties</span><span class="python_operator">=</span><span class="python_enclosure">{</span>
    <span class="python_literal">'user_id'</span><span class="python_operator">:</span><span class="python_enclosure">[</span><span class="python_name">users_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">, </span><span class="python_name">addresses_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_enclosure">]</span>
<span class="python_enclosure">})</span><span class="python_operator"></span></pre></div>
<p>A second example:
</p>


<div class="sliding_code">
<pre><span class="python_comment"># many-to-many join on an association table
</span><span class="python_name">j </span><span class="python_operator">= </span><span class="python_name">join</span><span class="python_enclosure">(</span><span class="python_name">users_table</span><span class="python_operator">, </span><span class="python_name">userkeywords</span><span class="python_operator">, </span>
        <span class="python_name">users_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">==</span><span class="python_name">userkeywords</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">join</span><span class="python_enclosure">(</span><span class="python_name">keywords</span><span class="python_operator">, </span>
           <span class="python_name">userkeywords</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">keyword_id</span><span class="python_operator">==</span><span class="python_name">keywords</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">keyword_id</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># a class 
</span><span class="python_keyword">class </span><span class="python_name">KeywordUser</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">pass</span><span class="python_operator">
</span>
<span class="python_comment"># map to it - the identity of a KeywordUser object will be
# (user_id, keyword_id) since those are the primary keys involved
</span><span class="python_operator"></span><span class="python_name">m </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">KeywordUser</span><span class="python_operator">, </span><span class="python_name">j</span><span class="python_operator">, </span><span class="python_name">properties</span><span class="python_operator">=</span><span class="python_enclosure">{</span>
    <span class="python_literal">'user_id'</span><span class="python_operator">:</span><span class="python_enclosure">[</span><span class="python_name">users_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">, </span><span class="python_name">userkeywords</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_enclosure">]</span><span class="python_operator">,</span>
    <span class="python_literal">'keyword_id'</span><span class="python_operator">:</span><span class="python_enclosure">[</span><span class="python_name">userkeywords</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">keyword_id</span><span class="python_operator">, </span><span class="python_name">keywords</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">keyword_id</span><span class="python_enclosure">]</span>
<span class="python_enclosure">})</span><span class="python_operator"></span></pre></div>
<p>In both examples above, "composite" columns were added as properties to the mappers; these are aggregations of multiple columns into one mapper property, which instructs the mapper to keep both of those columns set at the same value.
</p>


    </div>

    <a href="#advdatamapping" class="toclink">back to section top</a>
</div>




<A name="advdatamapping_selects"></a>

<div class="subsection" style="margin-left:20px;">


<h3>Mapping a Class against Arbitary Selects</h3>

    <div class="sectiontext">
    

<p>Similar to mapping against a join, a plain select() object can be used with a mapper as well.  Below, an example select which contains two aggregate functions and a group_by is mapped to a class:
</p>


<div class="sliding_code">
<pre><span class="python_name">s </span><span class="python_operator">= </span><span class="python_name">select</span><span class="python_enclosure">([</span><span class="python_name">customers</span><span class="python_operator">, </span>
            <span class="python_name">func</span><span class="python_operator">.</span><span class="python_name">count</span><span class="python_enclosure">(</span><span class="python_name">orders</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">label</span><span class="python_enclosure">(</span><span class="python_literal">'order_count'</span><span class="python_enclosure">)</span><span class="python_operator">, </span>
            <span class="python_name">func</span><span class="python_operator">.</span><span class="python_name">max</span><span class="python_enclosure">(</span><span class="python_name">orders</span><span class="python_operator">.</span><span class="python_name">price</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">label</span><span class="python_enclosure">(</span><span class="python_literal">'highest_order'</span><span class="python_enclosure">)]</span><span class="python_operator">,</span>
            <span class="python_name">customers</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">customer_id</span><span class="python_operator">==</span><span class="python_name">orders</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">customer_id</span><span class="python_operator">,</span>
            <span class="python_name">group_by</span><span class="python_operator">=</span><span class="python_enclosure">[</span><span class="python_name">c </span><span class="python_keyword">for </span><span class="python_name">c </span><span class="python_keyword">in </span><span class="python_name">customers</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_enclosure">]</span>
            <span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_keyword">class </span><span class="python_name">Customer</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">pass</span><span class="python_operator">
</span>
<span class="python_operator"></span><span class="python_name">m </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Customer</span><span class="python_operator">, </span><span class="python_name">s</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre></div>
<p>Above, the "customers" table is joined against the "orders" table to produce a full row for each customer row, the total count of related rows in the "orders" table, and the highest price in the "orders" table, grouped against the full set of columns in the "customers" table.  That query is then mapped against the Customer class.  New instances of Customer will contain attributes for each column in the "customers" table as well as an "order_count" and "highest_order" attribute.  Updates to the Customer object will only be reflected in the "customers" table and not the "orders" table.  This is because the primary keys of the "orders" table are not represented in this mapper and therefore the table is not affected by save or delete operations.
</p>


    </div>

    <a href="#advdatamapping" class="toclink">back to section top</a>
</div>




<A name="advdatamapping_multiple"></a>

<div class="subsection" style="margin-left:20px;">


<h3>Multiple Mappers for One Class</h3>

    <div class="sectiontext">
    

<p>The first mapper created for a certain class is known as that class's "primary mapper."  Other mappers can be created as well, these come in two varieties.
</p>
<ul>
 <li>
     <strong>secondary mapper</strong> - this is a mapper that must be constructed with the keyword argument <code>non_primary=True</code>, and represents a load-only mapper.  Objects that are loaded with a secondary mapper will have their save operation processed by the primary mapper.  It is also invalid to add new <code>relation()</code>s to a non-primary mapper. To use this mapper with the Session, specify it to the <code>query</code> method:
 </li>
</ul>
<p>example:
</p>


<div class="sliding_code">
<pre><span class="python_comment"># primary mapper
</span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">users_table</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># make a secondary mapper to load User against a join
</span><span class="python_name">othermapper </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">users_table</span><span class="python_operator">.</span><span class="python_name">join</span><span class="python_enclosure">(</span><span class="python_name">someothertable</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">non_primary</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># select
</span><span class="python_name">result </span><span class="python_operator">= </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">othermapper</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre></div>
<ul>
 <li>
     <strong>entity name mapper</strong> - this is a mapper that is a fully functioning primary mapper for a class, which is distinguished from the regular primary mapper by an <code>entity_name</code> parameter.  Instances loaded with this mapper will be totally managed by this new mapper and have no connection to the original one.  Most methods on <code>Session</code> include an optional <code>entity_name</code> parameter in order to specify this condition.
 </li>
</ul>
<p>example:
</p>


<div class="sliding_code">
<pre><span class="python_comment"># primary mapper
</span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">users_table</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># make an entity name mapper that stores User objects in another table
</span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">alternate_users_table</span><span class="python_operator">, </span><span class="python_name">entity_name</span><span class="python_operator">=</span><span class="python_literal">'alt'</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># make two User objects
</span><span class="python_name">user1 </span><span class="python_operator">= </span><span class="python_name">User</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_name">user2 </span><span class="python_operator">= </span><span class="python_name">User</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_comment"># save one in in the "users" table
</span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">save</span><span class="python_enclosure">(</span><span class="python_name">user1</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># save the other in the "alternate_users_table"
</span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">save</span><span class="python_enclosure">(</span><span class="python_name">user2</span><span class="python_operator">, </span><span class="python_name">entity_name</span><span class="python_operator">=</span><span class="python_literal">'alt'</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">flush</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_comment"># select from the alternate mapper
</span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">entity_name</span><span class="python_operator">=</span><span class="python_literal">'alt'</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre></div>


    </div>

    <a href="#advdatamapping" class="toclink">back to section top</a>
</div>




<A name="advdatamapping_recursive"></a>

<div class="subsection" style="margin-left:20px;">


<h3>Self Referential Mappers</h3>

    <div class="sectiontext">
    

<p>A self-referential mapper is a mapper that is designed to operate with an <em>adjacency list</em> table.  This is a table that contains one or more foreign keys back to itself, and is usually used to create hierarchical tree structures.  SQLAlchemy's default model of saving items based on table dependencies is not sufficient in this case, as an adjacency list table introduces dependencies between individual rows.  Fortunately, SQLAlchemy will automatically detect a self-referential mapper and do the extra lifting to make it work.  <br></br>
</p>


<div class="sliding_code">
<pre><span class="python_comment"># define a self-referential table
</span><span class="python_name">trees </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'treenodes'</span><span class="python_operator">, </span><span class="python_name">engine</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'node_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'parent_node_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">ForeignKey</span><span class="python_enclosure">(</span><span class="python_literal">'treenodes.node_id'</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">nullable</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'node_name'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">50</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">nullable</span><span class="python_operator">=</span><span class="python_name">False</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># treenode class
</span><span class="python_keyword">class </span><span class="python_name">TreeNode</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">pass</span><span class="python_operator">
</span>
<span class="python_comment"># mapper defines "children" property, pointing back to TreeNode class,
# with the mapper unspecified.  it will point back to the primary 
# mapper on the TreeNode class.
</span><span class="python_operator"></span><span class="python_name">TreeNode</span><span class="python_operator">.</span><span class="python_name">mapper </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">TreeNode</span><span class="python_operator">, </span><span class="python_name">trees</span><span class="python_operator">, </span><span class="python_name">properties</span><span class="python_operator">=</span><span class="python_enclosure">{</span>
        <span class="python_literal">'children' </span><span class="python_operator">: </span><span class="python_name">relation</span><span class="python_enclosure">(</span>
                        <span class="python_name">TreeNode</span><span class="python_operator">, </span>
                        <span class="python_name">cascade</span><span class="python_operator">=</span><span class="python_literal">"all"</span>
                     <span class="python_enclosure">)</span><span class="python_operator">,</span>
        <span class="python_enclosure">}</span>
    <span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># or, specify the circular relationship after establishing the original mapper:
</span><span class="python_name">mymapper </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">TreeNode</span><span class="python_operator">, </span><span class="python_name">trees</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_name">mymapper</span><span class="python_operator">.</span><span class="python_name">add_property</span><span class="python_enclosure">(</span><span class="python_literal">'children'</span><span class="python_operator">, </span><span class="python_name">relation</span><span class="python_enclosure">(</span>
                        <span class="python_name">mymapper</span><span class="python_operator">, </span>
                        <span class="python_name">cascade</span><span class="python_operator">=</span><span class="python_literal">"all"</span>
                     <span class="python_enclosure">))</span><span class="python_operator"></span></pre></div>
<p>This kind of mapper goes through a lot of extra effort when saving and deleting items, to determine the correct dependency graph of nodes within the tree.
</p>
<p>A self-referential mapper where there is more than one relationship on the table requires that all join conditions be explicitly spelled out.  Below is a self-referring table that contains a "parent_node_id" column to reference parent/child relationships, and a "root_node_id" column which points child nodes back to the ultimate root node:
</p>


<div class="sliding_code">
<pre><span class="python_comment"># define a self-referential table with several relations
</span><span class="python_name">trees </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'treenodes'</span><span class="python_operator">, </span><span class="python_name">engine</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'node_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'parent_node_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">ForeignKey</span><span class="python_enclosure">(</span><span class="python_literal">'treenodes.node_id'</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">nullable</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'root_node_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">ForeignKey</span><span class="python_enclosure">(</span><span class="python_literal">'treenodes.node_id'</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">nullable</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'node_name'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">50</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">nullable</span><span class="python_operator">=</span><span class="python_name">False</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># treenode class
</span><span class="python_keyword">class </span><span class="python_name">TreeNode</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">pass</span><span class="python_operator">
</span>
<span class="python_comment"># define the "children" property as well as the "root" property
</span><span class="python_operator"></span><span class="python_name">TreeNode</span><span class="python_operator">.</span><span class="python_name">mapper </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">TreeNode</span><span class="python_operator">, </span><span class="python_name">trees</span><span class="python_operator">, </span><span class="python_name">properties</span><span class="python_operator">=</span><span class="python_enclosure">{</span>
        <span class="python_literal">'children' </span><span class="python_operator">: </span><span class="python_name">relation</span><span class="python_enclosure">(</span>
                        <span class="python_name">TreeNode</span><span class="python_operator">, </span>
                        <span class="python_name">primaryjoin</span><span class="python_operator">=</span><span class="python_name">trees</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">parent_node_id</span><span class="python_operator">==</span><span class="python_name">trees</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">node_id</span>
                        <span class="python_name">cascade</span><span class="python_operator">=</span><span class="python_literal">"all"</span><span class="python_operator">,</span>
                        <span class="python_name">backref</span><span class="python_operator">=</span><span class="python_name">backref</span><span class="python_enclosure">(</span><span class="python_literal">"parent"</span><span class="python_operator">, </span><span class="python_name">remote_side</span><span class="python_operator">=</span><span class="python_enclosure">[</span><span class="python_name">trees</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">node_id</span><span class="python_enclosure">])</span>
                     <span class="python_enclosure">)</span><span class="python_operator">,</span>
        <span class="python_literal">'root' </span><span class="python_operator">: </span><span class="python_name">relation</span><span class="python_enclosure">(</span>
                <span class="python_name">TreeNode</span><span class="python_operator">,</span>
                <span class="python_name">primaryjoin</span><span class="python_operator">=</span><span class="python_name">trees</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">root_node_id</span><span class="python_operator">=</span><span class="python_name">trees</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">node_id</span><span class="python_operator">, </span>
                <span class="python_name">remote_side</span><span class="python_operator">=</span><span class="python_enclosure">[</span><span class="python_name">trees</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">node_id</span><span class="python_enclosure">]</span><span class="python_operator">,</span>
                <span class="python_name">uselist</span><span class="python_operator">=</span><span class="python_name">False</span>
            <span class="python_enclosure">)</span>
        <span class="python_enclosure">}</span>
    <span class="python_enclosure">)</span><span class="python_operator"></span></pre></div>
<p>The "root" property on a TreeNode is a many-to-one relationship.  By default, a self-referential mapper declares relationships as one-to-many, so the extra parameter <code>remote_side</code>, pointing to a column or list of columns on the remote side of a relationship, is needed to indicate a "many-to-one" self-referring relationship (note the previous keyword argument <code>foreignkey</code> is deprecated).
   Both TreeNode examples above are available in functional form in the <code>examples/adjacencytree</code> directory of the distribution.    <br></br>
</p>


    </div>

    <a href="#advdatamapping" class="toclink">back to section top</a>
</div>




<A name="advdatamapping_resultset"></a>

<div class="subsection" style="margin-left:20px;">


<h3>Result-Set Mapping</h3>

    <div class="sectiontext">
    

<p>Take any result set and feed it into a Query to produce objects.  Multiple mappers can be combined to retrieve unrelated objects from the same row in one step.  The <code>instances</code> method on Query takes a ResultProxy object, which is the result type generated from SQLEngine, and delivers object instances.  (note: this method has been moved off of Mapper, where it is deprecated).
</p>


<div class="sliding_code">
<pre><span class="python_keyword">class </span><span class="python_name">User</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">pass</span><span class="python_operator">
</span>
<span class="python_operator"></span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">users_table</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># select users
</span><span class="python_name">c </span><span class="python_operator">= </span><span class="python_name">users_table</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">()</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_comment"># get objects
</span><span class="python_name">userlist </span><span class="python_operator">= </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">instances</span><span class="python_enclosure">(</span><span class="python_name">c</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># define a second class/mapper
</span><span class="python_keyword">class </span><span class="python_name">Address</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">pass</span><span class="python_operator">
</span>
<span class="python_operator"></span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_operator">, </span><span class="python_name">addresses_table</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># select users and addresses in one query
</span><span class="python_name">s </span><span class="python_operator">= </span><span class="python_name">select</span><span class="python_enclosure">([</span><span class="python_name">users_table</span><span class="python_operator">, </span><span class="python_name">addresses_table</span><span class="python_enclosure">]</span><span class="python_operator">, </span><span class="python_name">users_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">==</span><span class="python_name">addresses_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># execute it, and process the results with the User mapper, chained to the Address mapper
</span><span class="python_name">r </span><span class="python_operator">= </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">instances</span><span class="python_enclosure">(</span><span class="python_name">s</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator">, </span><span class="python_name">class_mapper</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_enclosure">))</span><span class="python_operator">
</span>
<span class="python_comment"># result rows are an array of objects, one for each mapper used
</span><span class="python_keyword">for </span><span class="python_name">entry </span><span class="python_keyword">in </span><span class="python_name">r</span><span class="python_operator">:
    </span><span class="python_name">user </span><span class="python_operator">= </span><span class="python_name">r</span><span class="python_enclosure">[</span><span class="python_number">0</span><span class="python_enclosure">]</span><span class="python_operator">
    </span><span class="python_name">address </span><span class="python_operator">= </span><span class="python_name">r</span><span class="python_enclosure">[</span><span class="python_number">1</span><span class="python_enclosure">]</span><span class="python_operator"></span></pre></div>


    </div>

    <a href="#advdatamapping" class="toclink">back to section top</a>
</div>




<A name="advdatamapping_arguments"></a>

<div class="subsection" style="margin-left:20px;">


<h3>Mapper Arguments</h3>

    <div class="sectiontext">
    

<p>Other arguments not covered above include:
</p>
<ul>
 <li>
     select_table=None - often used with polymorphic mappers, this is a <code>Selectable</code> which will take the place of the <code>Mapper</code>'s main table argument when performing queries.
 </li>

 <li>
     version_id_col=None - an integer-holding Column object that will be assigned an incrementing
counter, which is added to the WHERE clause used by UPDATE and DELETE statements.  The matching row
count returned by the database is compared to the expected row count, and an exception is raised if they dont match.  This is a basic "optimistic concurrency" check.  Without the version id column, SQLAlchemy still compares the updated rowcount.
 </li>

 <li>
     always_refresh=False - this option will cause the mapper to refresh all the attributes of all objects loaded by select/get statements, regardless of if they already exist in the current session.  this includes all lazy- and eager-loaded relationship attributes, and will also overwrite any changes made to attributes on the column. 
 </li>
</ul>


    </div>

    <a href="#advdatamapping" class="toclink">back to section top</a>
</div>




<A name="advdatamapping_extending"></a>

<div class="subsection" style="margin-left:20px;">


<h3>Extending Mapper</h3>

    <div class="sectiontext">
    

<p>Mappers can have functionality augmented or replaced at many points in its execution via the usage of the MapperExtension class.  This class is just a series of "hooks" where various functionality takes place.  An application can make its own MapperExtension objects, overriding only the methods it needs.  Methods that are not overridden return the special value <code>sqlalchemy.orm.mapper.EXT_PASS</code>, which indicates the operation should proceed as normally.
</p>


<div class="sliding_code">
<pre><span class="python_keyword">class </span><span class="python_name">MapperExtension</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_literal">"""base implementation for an object that provides overriding behavior to various
    Mapper functions.  For each method in MapperExtension, a result of EXT_PASS indicates
    the functionality is not overridden."""</span><span class="python_operator">
    </span><span class="python_keyword">def </span><span class="python_name">get_session</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_literal">"""called to retrieve a contextual Session instance with which to
        register a new object. Note: this is not called if a session is 
        provided with the __init__ params (i.e. _sa_session)"""</span><span class="python_operator">
        </span><span class="python_keyword">return </span><span class="python_name">EXT_PASS</span><span class="python_operator">
    </span><span class="python_keyword">def </span><span class="python_name">select_by</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">query</span><span class="python_operator">, *</span><span class="python_name">args</span><span class="python_operator">, **</span><span class="python_name">kwargs</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_literal">"""overrides the select_by method of the Query object"""</span><span class="python_operator">
        </span><span class="python_keyword">return </span><span class="python_name">EXT_PASS</span><span class="python_operator">
    </span><span class="python_keyword">def </span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">query</span><span class="python_operator">, *</span><span class="python_name">args</span><span class="python_operator">, **</span><span class="python_name">kwargs</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_literal">"""overrides the select method of the Query object"""</span><span class="python_operator">
        </span><span class="python_keyword">return </span><span class="python_name">EXT_PASS</span><span class="python_operator">
    </span><span class="python_keyword">def </span><span class="python_name">create_instance</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">mapper</span><span class="python_operator">, </span><span class="python_name">selectcontext</span><span class="python_operator">, </span><span class="python_name">row</span><span class="python_operator">, </span><span class="python_name">class_</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_literal">"""called when a new object instance is about to be created from a row.  
        the method can choose to create the instance itself, or it can return 
        None to indicate normal object creation should take place.

        mapper - the mapper doing the operation

        selectcontext - SelectionContext corresponding to the instances() call

        row - the result row from the database

        class_ - the class we are mapping.
        """</span><span class="python_operator">
        </span><span class="python_keyword">return </span><span class="python_name">EXT_PASS</span><span class="python_operator">
    </span><span class="python_keyword">def </span><span class="python_name">append_result</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">mapper</span><span class="python_operator">, </span><span class="python_name">selectcontext</span><span class="python_operator">, </span><span class="python_name">row</span><span class="python_operator">, </span><span class="python_name">instance</span><span class="python_operator">, </span><span class="python_name">identitykey</span><span class="python_operator">, </span><span class="python_name">result</span><span class="python_operator">, </span><span class="python_name">isnew</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_literal">"""called when an object instance is being appended to a result list.

        If this method returns EXT_PASS, it is assumed that the mapper should do the appending, else
        if this method returns any other value or None, it is assumed that the append was handled by this method.

        mapper - the mapper doing the operation

        selectcontext - SelectionContext corresponding to the instances() call

        row - the result row from the database

        instance - the object instance to be appended to the result

        identitykey - the identity key of the instance

        result - list to which results are being appended

        isnew - indicates if this is the first time we have seen this object instance in the current result
        set.  if you are selecting from a join, such as an eager load, you might see the same object instance
        many times in the same result set.
        """</span><span class="python_operator">
        </span><span class="python_keyword">return </span><span class="python_name">EXT_PASS</span><span class="python_operator">
    </span><span class="python_keyword">def </span><span class="python_name">populate_instance</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">mapper</span><span class="python_operator">, </span><span class="python_name">selectcontext</span><span class="python_operator">, </span><span class="python_name">row</span><span class="python_operator">, </span><span class="python_name">instance</span><span class="python_operator">, </span><span class="python_name">identitykey</span><span class="python_operator">, </span><span class="python_name">isnew</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_literal">"""called right before the mapper, after creating an instance from a row, passes the row
        to its MapperProperty objects which are responsible for populating the object's attributes.
        If this method returns EXT_PASS, it is assumed that the mapper should do the appending, else
        if this method returns any other value or None, it is assumed that the append was handled by this method.

        Essentially, this method is used to have a different mapper populate the object:

            def populate_instance(self, mapper, selectcontext, instance, row, identitykey, isnew):
                othermapper.populate_instance(selectcontext, instance, row, identitykey, isnew, frommapper=mapper)
                return True
        """</span><span class="python_operator">
        </span><span class="python_keyword">return </span><span class="python_name">EXT_PASS</span><span class="python_operator">
    </span><span class="python_keyword">def </span><span class="python_name">before_insert</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">mapper</span><span class="python_operator">, </span><span class="python_name">connection</span><span class="python_operator">, </span><span class="python_name">instance</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_literal">"""called before an object instance is INSERTed into its table.

        this is a good place to set up primary key values and such that arent handled otherwise."""</span><span class="python_operator">
        </span><span class="python_keyword">return </span><span class="python_name">EXT_PASS</span><span class="python_operator">
    </span><span class="python_keyword">def </span><span class="python_name">before_update</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">mapper</span><span class="python_operator">, </span><span class="python_name">connection</span><span class="python_operator">, </span><span class="python_name">instance</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_literal">"""called before an object instnace is UPDATED"""</span><span class="python_operator">
        </span><span class="python_keyword">return </span><span class="python_name">EXT_PASS</span><span class="python_operator">
    </span><span class="python_keyword">def </span><span class="python_name">after_update</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">mapper</span><span class="python_operator">, </span><span class="python_name">connection</span><span class="python_operator">, </span><span class="python_name">instance</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_literal">"""called after an object instnace is UPDATED"""</span><span class="python_operator">
        </span><span class="python_keyword">return </span><span class="python_name">EXT_PASS</span><span class="python_operator">
    </span><span class="python_keyword">def </span><span class="python_name">after_insert</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">mapper</span><span class="python_operator">, </span><span class="python_name">connection</span><span class="python_operator">, </span><span class="python_name">instance</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_literal">"""called after an object instance has been INSERTed"""</span><span class="python_operator">
        </span><span class="python_keyword">return </span><span class="python_name">EXT_PASS</span><span class="python_operator">
    </span><span class="python_keyword">def </span><span class="python_name">before_delete</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">mapper</span><span class="python_operator">, </span><span class="python_name">connection</span><span class="python_operator">, </span><span class="python_name">instance</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_literal">"""called before an object instance is DELETEed"""</span><span class="python_operator">
        </span><span class="python_keyword">return </span><span class="python_name">EXT_PASS</span><span class="python_operator">
    </span><span class="python_keyword">def </span><span class="python_name">after_delete</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">mapper</span><span class="python_operator">, </span><span class="python_name">connection</span><span class="python_operator">, </span><span class="python_name">instance</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_literal">"""called after an object instance is DELETEed"""</span><span class="python_operator">
        </span><span class="python_keyword">return </span><span class="python_name">EXT_PASS</span><span class="python_operator"></span></pre></div>
<p>To use MapperExtension, make your own subclass of it and just send it off to a mapper:
</p>


<div class="sliding_code">
<pre><span class="python_name">m </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">users_table</span><span class="python_operator">, </span><span class="python_name">extension</span><span class="python_operator">=</span><span class="python_name">MyExtension</span><span class="python_enclosure">())</span><span class="python_operator"></span></pre></div>
<p>Multiple extensions will be chained together and processed in order; they are specified as a list:
</p>


<div class="sliding_code">
<pre><span class="python_name">m </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">users_table</span><span class="python_operator">, </span><span class="python_name">extension</span><span class="python_operator">=</span><span class="python_enclosure">[</span><span class="python_name">ext1</span><span class="python_operator">, </span><span class="python_name">ext2</span><span class="python_operator">, </span><span class="python_name">ext3</span><span class="python_enclosure">])</span><span class="python_operator"></span></pre></div>



    </div>

</div>



    </div>

    <a href="#advdatamapping" class="toclink">back to section top</a>
</div>


</html></div>
<A name="types"></a>

<div class="sectionnavblock">
<div class="sectionnav">

        Previous: <a href="#advdatamapping">Advanced Data Mapping</a>

                |

        Next: <a href="#pooling">Connection Pooling</a>

</div>
</div>

<div class="topnavmain">
	<div class="topnavheader">The Types System</div>
</div>
<div class="sectioncontent">
<html>



<A name="types"></a>

<div class="subsection" style="margin-left:10px;">



    <div class="sectiontext">
    

<p>The package <code>sqlalchemy.types</code> defines the datatype identifiers which may be used when defining <b>metadata</b>.  This package includes a set of generic types, a set of SQL-specific subclasses of those types, and a small extension system used by specific database connectors to adapt these generic types into database-specific type objects.
</p>



<A name="types_standard"></a>

<div class="subsection" style="margin-left:20px;">


<h3>Built-in Types</h3>

    <div class="sectiontext">
    

<p>SQLAlchemy comes with a set of standard generic datatypes, which are defined as classes.   <br></br>
</p>
<p>The standard set of generic types are:
</p>


<div class="sliding_code">
    <div class="codetitle">package sqlalchemy.types</div>
<pre><span class="python_keyword">class </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_name">TypeEngine</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">def </span><span class="python_name">__init__</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">length</span><span class="python_operator">=</span><span class="python_name">None</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_operator"></span><span class="python_keyword">class </span><span class="python_name">Integer</span><span class="python_enclosure">(</span><span class="python_name">TypeEngine</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_keyword">class </span><span class="python_name">SmallInteger</span><span class="python_enclosure">(</span><span class="python_name">Integer</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_keyword">class </span><span class="python_name">Numeric</span><span class="python_enclosure">(</span><span class="python_name">TypeEngine</span><span class="python_enclosure">)</span><span class="python_operator">: 
    </span><span class="python_keyword">def </span><span class="python_name">__init__</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">precision</span><span class="python_operator">=</span><span class="python_number">10</span><span class="python_operator">, </span><span class="python_name">length</span><span class="python_operator">=</span><span class="python_number">2</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_operator"></span><span class="python_keyword">class </span><span class="python_name">Float</span><span class="python_enclosure">(</span><span class="python_name">Numeric</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">def </span><span class="python_name">__init__</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">precision</span><span class="python_operator">=</span><span class="python_number">10</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># DateTime, Date and Time types deal with datetime objects from the Python datetime module
</span><span class="python_operator"></span><span class="python_keyword">class </span><span class="python_name">DateTime</span><span class="python_enclosure">(</span><span class="python_name">TypeEngine</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_keyword">class </span><span class="python_name">Date</span><span class="python_enclosure">(</span><span class="python_name">TypeEngine</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_keyword">class </span><span class="python_name">Time</span><span class="python_enclosure">(</span><span class="python_name">TypeEngine</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_keyword">class </span><span class="python_name">Binary</span><span class="python_enclosure">(</span><span class="python_name">TypeEngine</span><span class="python_enclosure">)</span><span class="python_operator">: 
    </span><span class="python_keyword">def </span><span class="python_name">__init__</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">length</span><span class="python_operator">=</span><span class="python_name">None</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_operator"></span><span class="python_keyword">class </span><span class="python_name">Boolean</span><span class="python_enclosure">(</span><span class="python_name">TypeEngine</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># converts unicode strings to raw bytes
# as bind params, raw bytes to unicode as 
# rowset values, using the unicode encoding 
# setting on the engine (defaults to 'utf-8')
</span><span class="python_keyword">class </span><span class="python_name">Unicode</span><span class="python_enclosure">(</span><span class="python_name">TypeDecorator</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_name">impl </span><span class="python_operator">= </span><span class="python_name">String</span><span class="python_operator">
</span>
<span class="python_comment"># uses the pickle protocol to serialize data
# in/out of Binary columns
</span><span class="python_operator"></span><span class="python_keyword">class </span><span class="python_name">PickleType</span><span class="python_enclosure">(</span><span class="python_name">TypeDecorator</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_name">impl </span><span class="python_operator">= </span><span class="python_name">Binary</span><span class="python_operator"></span></pre></div>
<p>More specific subclasses of these types are available, which various database engines may choose to implement specifically, allowing finer grained control over types:
</p>


<div class="sliding_code">
<pre><span class="python_keyword">class </span><span class="python_name">FLOAT</span><span class="python_enclosure">(</span><span class="python_name">Numeric</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_keyword">class </span><span class="python_name">TEXT</span><span class="python_enclosure">(</span><span class="python_name">String</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_keyword">class </span><span class="python_name">DECIMAL</span><span class="python_enclosure">(</span><span class="python_name">Numeric</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_keyword">class </span><span class="python_name">INT</span><span class="python_enclosure">(</span><span class="python_name">Integer</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">INTEGER </span><span class="python_operator">= </span><span class="python_name">INT</span><span class="python_operator">
</span><span class="python_keyword">class </span><span class="python_name">TIMESTAMP</span><span class="python_enclosure">(</span><span class="python_name">DateTime</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_keyword">class </span><span class="python_name">DATETIME</span><span class="python_enclosure">(</span><span class="python_name">DateTime</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_keyword">class </span><span class="python_name">CLOB</span><span class="python_enclosure">(</span><span class="python_name">String</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_keyword">class </span><span class="python_name">VARCHAR</span><span class="python_enclosure">(</span><span class="python_name">String</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_keyword">class </span><span class="python_name">CHAR</span><span class="python_enclosure">(</span><span class="python_name">String</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_keyword">class </span><span class="python_name">BLOB</span><span class="python_enclosure">(</span><span class="python_name">Binary</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_keyword">class </span><span class="python_name">BOOLEAN</span><span class="python_enclosure">(</span><span class="python_name">Boolean</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre></div>
<p>When using a specific database engine, these types are adapted even further via a set of database-specific subclasses defined by the database engine.
   There may eventually be more type objects that are defined for specific databases.  An example of this would be Postgres' Array type.
</p>
<p>Type objects are specified to table meta data using either the class itself, or an instance of the class.  Creating an instance of the class allows you to specify parameters for the type, such as string length, numerical precision, etc.:
</p>


<div class="sliding_code">
<pre><span class="python_name">mytable </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'mytable'</span><span class="python_operator">, </span><span class="python_name">engine</span><span class="python_operator">, </span>
    <span class="python_comment"># define type using a class</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'my_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">, </span>

    <span class="python_comment"># define type using an object instance</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'value'</span><span class="python_operator">, </span><span class="python_name">Number</span><span class="python_enclosure">(</span><span class="python_number">7</span><span class="python_operator">,</span><span class="python_number">4</span><span class="python_enclosure">)) </span>
<span class="python_enclosure">)</span><span class="python_operator"></span></pre></div>


    </div>

    <a href="#types" class="toclink">back to section top</a>
</div>




<A name="types_custom"></a>

<div class="subsection" style="margin-left:20px;">


<h3>Creating your Own Types</h3>

    <div class="sectiontext">
    

<p>User-defined types can be created, to support either database-specific types, or customized pre-processing of query parameters as well as post-processing of result set data.  You can make your own classes to perform these operations.  To augment the behavior of a <code>TypeEngine</code> type, such as <code>String</code>, the <code>TypeDecorator</code> class is used:
</p>


<div class="sliding_code">
<pre><span class="python_keyword">import </span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">types as types</span><span class="python_operator">
</span>
<span class="python_keyword">class </span><span class="python_name">MyType</span><span class="python_enclosure">(</span><span class="python_name">types</span><span class="python_operator">.</span><span class="python_name">TypeDecorator</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_literal">"""basic type that decorates String, prefixes values with "PREFIX:" on 
    the way in and strips it off on the way out."""</span><span class="python_operator">
    </span><span class="python_name">impl </span><span class="python_operator">= </span><span class="python_name">types</span><span class="python_operator">.</span><span class="python_name">String</span><span class="python_operator">
    </span><span class="python_keyword">def </span><span class="python_name">convert_bind_param</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">value</span><span class="python_operator">, </span><span class="python_name">engine</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_keyword">return </span><span class="python_literal">"PREFIX:" </span><span class="python_operator">+ </span><span class="python_name">value</span><span class="python_operator">
    </span><span class="python_keyword">def </span><span class="python_name">convert_result_value</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">value</span><span class="python_operator">, </span><span class="python_name">engine</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_keyword">return </span><span class="python_name">value</span><span class="python_enclosure">[</span><span class="python_number">7</span><span class="python_operator">:</span><span class="python_enclosure">]</span><span class="python_operator"></span></pre></div>
<p>The <code>Unicode</code> and <code>PickleType</code> classes are instances of <code>TypeDecorator</code> already and can be subclassed directly.
</p>
<p>To build a type object from scratch, which will not have a corresponding database-specific implementation, subclass <code>TypeEngine</code>:
</p>


<div class="sliding_code">
<pre><span class="python_keyword">import </span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">types as types</span><span class="python_operator">
</span>
<span class="python_keyword">class </span><span class="python_name">MyType</span><span class="python_enclosure">(</span><span class="python_name">types</span><span class="python_operator">.</span><span class="python_name">TypeEngine</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">def </span><span class="python_name">__init__</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">precision </span><span class="python_operator">= </span><span class="python_number">8</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">precision </span><span class="python_operator">= </span><span class="python_name">precision</span><span class="python_operator">
    </span><span class="python_keyword">def </span><span class="python_name">get_col_spec</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_keyword">return </span><span class="python_literal">"MYTYPE(%s)" </span><span class="python_operator">% </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">precision</span><span class="python_operator">
    </span><span class="python_keyword">def </span><span class="python_name">convert_bind_param</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">value</span><span class="python_operator">, </span><span class="python_name">engine</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_keyword">return </span><span class="python_name">value</span><span class="python_operator">
    </span><span class="python_keyword">def </span><span class="python_name">convert_result_value</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">value</span><span class="python_operator">, </span><span class="python_name">engine</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_keyword">return </span><span class="python_name">value</span><span class="python_operator"></span></pre></div>



    </div>

</div>



    </div>

    <a href="#types" class="toclink">back to section top</a>
</div>


</html></div>
<A name="pooling"></a>

<div class="sectionnavblock">
<div class="sectionnav">

        Previous: <a href="#types">The Types System</a>

                |

        Next: <a href="#plugins">Plugins</a>

</div>
</div>

<div class="topnavmain">
	<div class="topnavheader">Connection Pooling</div>
</div>
<div class="sectioncontent">
<html>



<A name="pooling"></a>

<div class="subsection" style="margin-left:10px;">



    <div class="sectiontext">
    

<p>This section describes the connection pool module of SQLAlchemy.  The <code>Pool</code> object it provides is normally embedded within an <code>Engine</code> instance.  For most cases, explicit access to the pool module is not required.  However, the <code>Pool</code> object can be used on its own, without the rest of SA, to manage DBAPI connections; this section describes that usage.  Also, this section will describe in more detail how to customize the pooling strategy used by an <code>Engine</code>.
</p>
<p>At the base of any database helper library is a system of efficiently acquiring connections to the database.  Since the establishment of a database connection is typically a somewhat expensive operation, an application needs a way to get at database connections repeatedly without incurring the full overhead each time.  Particularly for server-side web applications, a connection pool is the standard way to maintain a "pool" of database connections which are used over and over again among many requests.  Connection pools typically are configured to maintain a certain "size", which represents how many connections can be used simultaneously without resorting to creating more newly-established connections.
</p>



<A name="pooling_establishing"></a>

<div class="subsection" style="margin-left:20px;">


<h3>Establishing a Transparent Connection Pool</h3>

    <div class="sectiontext">
    

<p>Any DBAPI module can be "proxied" through the connection pool using the following technique (note that the usage of 'psycopg2' is <strong>just an example</strong>; substitute whatever DBAPI module you'd like):
</p>


<div class="sliding_code">
<pre><span class="python_keyword">import </span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">pool as pool</span><span class="python_operator">
</span><span class="python_keyword">import </span><span class="python_name">psycopg2 as psycopg</span><span class="python_operator">
</span><span class="python_name">psycopg </span><span class="python_operator">= </span><span class="python_name">pool</span><span class="python_operator">.</span><span class="python_name">manage</span><span class="python_enclosure">(</span><span class="python_name">psycopg</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># then connect normally
</span><span class="python_name">connection </span><span class="python_operator">= </span><span class="python_name">psycopg</span><span class="python_operator">.</span><span class="python_name">connect</span><span class="python_enclosure">(</span><span class="python_name">database</span><span class="python_operator">=</span><span class="python_literal">'test'</span><span class="python_operator">, </span><span class="python_name">username</span><span class="python_operator">=</span><span class="python_literal">'scott'</span><span class="python_operator">, </span><span class="python_name">password</span><span class="python_operator">=</span><span class="python_literal">'tiger'</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre></div>
<p>This produces a <code>sqlalchemy.pool.DBProxy</code> object which supports the same <code>connect()</code> function as the original DBAPI module.  Upon connection, a connection proxy object is returned, which delegates its calls to a real DBAPI connection object.  This connection object is stored persistently within a connection pool (an instance of <code>sqlalchemy.pool.Pool</code>) that corresponds to the exact connection arguments sent to the <code>connect()</code> function.  <br></br>
</p>
<p>The connection proxy supports all of the methods on the original connection object, most of which are proxied via <code>__getattr__()</code>.  The <code>close()</code> method will return the connection to the pool, and the <code>cursor()</code> method will return a proxied cursor object.  Both the connection proxy and the cursor proxy will also return the underlying connection to the pool after they have both been garbage collected, which is detected via the <code>__del__()</code> method.
</p>
<p>Additionally, when connections are returned to the pool, a <code>rollback()</code> is issued on the connection unconditionally.  This is to release any locks still held by the connection that may have resulted from normal activity.
</p>
<p>By default, the <code>connect()</code> method will return the same connection that is already checked out in the current thread.  This allows a particular connection to be used in a given thread without needing to pass it around between functions.  To disable this behavior, specify <code>use_threadlocal=False</code> to the <code>manage()</code> function.
</p>


    </div>

    <a href="#pooling" class="toclink">back to section top</a>
</div>




<A name="pooling_configuration"></a>

<div class="subsection" style="margin-left:20px;">


<h3>Connection Pool Configuration</h3>

    <div class="sectiontext">
    

<p>For all types of Pool construction, which includes the "transparent proxy" described in the previous section, using an <code>Engine</code> via <code>create_engine()</code>, or constructing a pool through direct class instantiation, the options are generally the same.  Additional options may be available based on the specific subclass of <code>Pool</code> being used.
</p>
<p>For a description of all pool classes, see the <a href="docstrings.html#docstrings_sqlalchemy.pool">generated documentation</a>.
</p>
<p>Common options include:
</p>
<ul>
 <li>
     echo=False : if set to True, connections being pulled and retrieved from/to the pool will
        be logged to the standard output, as well as pool sizing information.  Echoing can also
        be achieved by enabling logging for the "sqlalchemy.pool" namespace.  When using create_engine(), 
        this option is specified as <code>echo_pool</code>.
 </li>

 <li>
     use_threadlocal=False : if set to True, repeated calls to connect() within the same
        application thread will be guaranteed to return the same connection object, if one has
        already been retrieved from the pool and has not been returned yet. This allows code to
        retrieve a connection from the pool, and then while still holding on to that connection,
        to call other functions which also ask the pool for a connection of the same arguments;
        those functions will act upon the same connection that the calling method is using.
        This option is overridden during <code>create_engine()</code>, corresponding to the "plain" or 
   "threadlocal" connection strategy.
 </li>

 <li>
     recycle=-1 : if set to non -1, a number of seconds between connection recycling, which
        means upon checkout, if this timeout is surpassed the connection will be closed and replaced
        with a newly opened connection.
 </li>

 <li>
     auto_close_cursors = True : cursors, returned by connection.cursor(), are tracked and are 
        automatically closed when the connection is returned to the pool.  some DBAPIs like MySQLDB
        become unstable if cursors remain open.
 </li>

 <li>
     disallow_open_cursors = False : if auto_close_cursors is False, and disallow_open_cursors is True,
        will raise an exception if an open cursor is detected upon connection checkin.  If auto_close_cursors and disallow_open_cursors are both False, then no cursor processing occurs upon checkin.
 </li>
</ul>
<p>QueuePool options include:
</p>
<ul>
 <li>
     pool_size=5 : the size of the pool to be maintained. This is the
      largest number of connections that will be kept persistently in the pool. Note that the
      pool begins with no connections; once this number of connections is requested, that
      number of connections will remain.
 </li>

 <li>
     max_overflow=10 : the maximum overflow size of the pool. When the number of checked-out
      connections reaches the size set in pool_size, additional connections will be returned up
      to this limit. When those additional connections are returned to the pool, they are
      disconnected and discarded. It follows then that the total number of simultaneous
      connections the pool will allow is pool_size + max_overflow, and the total number of
      "sleeping" connections the pool will allow is pool_size. max_overflow can be set to -1 to
      indicate no overflow limit; no limit will be placed on the total number of concurrent
      connections.
 </li>

 <li>
     timeout=30 : the number of seconds to wait before giving up on returning a connection
 </li>
</ul>


    </div>

    <a href="#pooling" class="toclink">back to section top</a>
</div>




<A name="pooling_custom"></a>

<div class="subsection" style="margin-left:20px;">


<h3>Custom Pool Construction</h3>

    <div class="sectiontext">
    

<p>Besides using the transparent proxy, instances of <code>sqlalchemy.pool.Pool</code> can be created directly.  Constructing your own pool involves passing a callable used to create a connection.  Through this method, custom connection schemes can be made, such as a connection that automatically executes some initialization commands to start.  <br></br>
</p>


<div class="sliding_code">
    <div class="codetitle">Constructing a QueuePool</div>
<pre><span class="python_keyword">import </span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">pool as pool</span><span class="python_operator">
</span><span class="python_keyword">import </span><span class="python_name">psycopg2</span><span class="python_operator">
</span>
<span class="python_keyword">def </span><span class="python_name">getconn</span><span class="python_enclosure">()</span><span class="python_operator">:
    </span><span class="python_name">c </span><span class="python_operator">= </span><span class="python_name">psycopg2</span><span class="python_operator">.</span><span class="python_name">connect</span><span class="python_enclosure">(</span><span class="python_name">username</span><span class="python_operator">=</span><span class="python_literal">'ed'</span><span class="python_operator">, </span><span class="python_name">host</span><span class="python_operator">=</span><span class="python_literal">'127.0.0.1'</span><span class="python_operator">, </span><span class="python_name">dbname</span><span class="python_operator">=</span><span class="python_literal">'test'</span><span class="python_enclosure">)</span><span class="python_operator">
    </span><span class="python_comment"># execute an initialization function on the connection before returning
    </span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">cursor</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_literal">"setup_encodings()"</span><span class="python_enclosure">)</span><span class="python_operator">
    </span><span class="python_keyword">return </span><span class="python_name">c</span><span class="python_operator">
</span>
<span class="python_operator"></span><span class="python_name">p </span><span class="python_operator">= </span><span class="python_name">pool</span><span class="python_operator">.</span><span class="python_name">QueuePool</span><span class="python_enclosure">(</span><span class="python_name">getconn</span><span class="python_operator">, </span><span class="python_name">max_overflow</span><span class="python_operator">=</span><span class="python_number">10</span><span class="python_operator">, </span><span class="python_name">pool_size</span><span class="python_operator">=</span><span class="python_number">5</span><span class="python_operator">, </span><span class="python_name">use_threadlocal</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre></div>
<p>Or with SingletonThreadPool:
</p>


<div class="sliding_code">
    <div class="codetitle">Constructing a SingletonThreadPool</div>
<pre><span class="python_keyword">import </span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">pool as pool</span><span class="python_operator">
</span><span class="python_keyword">import </span><span class="python_name">sqlite</span><span class="python_operator">
</span>
<span class="python_keyword">def </span><span class="python_name">getconn</span><span class="python_enclosure">()</span><span class="python_operator">:
    </span><span class="python_keyword">return </span><span class="python_name">sqlite</span><span class="python_operator">.</span><span class="python_name">connect</span><span class="python_enclosure">(</span><span class="python_name">filename</span><span class="python_operator">=</span><span class="python_literal">'myfile.db'</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># SQLite connections require the SingletonThreadPool    
</span><span class="python_operator"></span><span class="python_name">p </span><span class="python_operator">= </span><span class="python_name">pool</span><span class="python_operator">.</span><span class="python_name">SingletonThreadPool</span><span class="python_enclosure">(</span><span class="python_name">getconn</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre></div>



    </div>

</div>



    </div>

    <a href="#pooling" class="toclink">back to section top</a>
</div>


</html></div>
<A name="plugins"></a>

<div class="sectionnavblock">
<div class="sectionnav">

        Previous: <a href="#pooling">Connection Pooling</a>

                |

        Next: <a href="#docstrings">Generated Documentation</a>

</div>
</div>

<div class="topnavmain">
	<div class="topnavheader">Plugins</div>
</div>
<div class="sectioncontent">
<html>



<A name="plugins"></a>

<div class="subsection" style="margin-left:10px;">



    <div class="sectiontext">
    

<p>SQLAlchemy has a variety of extensions and "mods" available which provide extra functionality to SA, either via explicit usage or by augmenting the core behavior.  Several of these extensions are designed to work together.
</p>



<A name="plugins_sessioncontext"></a>

<div class="subsection" style="margin-left:20px;">


<h3>SessionContext</h3>

    <div class="sectiontext">
    

<p><strong>Author:</strong>  Daniel Miller
</p>
<p>This plugin is used to instantiate and manage Session objects.  It is the preferred way to provide thread-local session functionality to an application.  It provides several services:
</p>
<ul>
 <li>
     serves as a factory to create sessions of a particular configuration.  This factory may either call <code>create_session()</code> with a particular set of arguments, or instantiate a different implementation of <code>Session</code> if one is available.
 </li>

 <li>
     for the <code>Session</code> objects it creates, provides the ability to maintain a single <code>Session</code> per distinct application thread.  The <code>Session</code> returned by a <code>SessionContext</code> is called the <em>contextual session.</em>   Providing at least a thread-local context to sessions is important because the <code>Session</code> object is not threadsafe, and is intended to be used with localized sets of data, as opposed to a single session being used application wide.
 </li>

 <li>
     besides maintaining a single <code>Session</code> per thread, the contextual algorithm can be changed to support any kind of contextual scheme.
 </li>

 <li>
     provides a <code>MapperExtension</code> that can enhance a <code>Mapper</code>, such that it can automatically <code>save()</code> newly instantiated objects to the current contextual session.  It also allows <code>Query</code> objects to be created without an explicit <code>Session</code>.  While this is very convenient functionality, having it switched on without understanding it can be very confusing.  Note that this feature is optional when using <code>SessionContext</code>.
 </li>
</ul>
<p>Using the SessionContext in its most basic form involves just instantiating a <code>SessionContext</code>:
</p>


<div class="sliding_code">
<pre><span class="python_keyword">import </span><span class="python_name">sqlalchemy</span><span class="python_operator">
</span><span class="python_keyword">from </span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">ext</span><span class="python_operator">.</span><span class="python_name">sessioncontext </span><span class="python_keyword">import </span><span class="python_name">SessionContext</span><span class="python_operator">
</span>
<span class="python_name">ctx </span><span class="python_operator">= </span><span class="python_name">SessionContext</span><span class="python_enclosure">(</span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">create_session</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_keyword">class </span><span class="python_name">User</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">pass</span><span class="python_operator">
</span>
<span class="python_operator"></span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">users_table</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">u </span><span class="python_operator">= </span><span class="python_name">User</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_comment"># the contextual session is referenced by the "current" property on SessionContext
</span><span class="python_name">ctx</span><span class="python_operator">.</span><span class="python_name">current</span><span class="python_operator">.</span><span class="python_name">save</span><span class="python_enclosure">(</span><span class="python_name">u</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">ctx</span><span class="python_operator">.</span><span class="python_name">current</span><span class="python_operator">.</span><span class="python_name">flush</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre></div>
<p>From this example, one might see that the <code>SessionContext</code>'s typical <em>scope</em> is at the module or application level.  Since the <code>Session</code> itself is better suited to be used in per-user-request or even per-function scope, the <code>SessionContext</code> provides an easy way to manage the scope of those <code>Session</code> objects.
</p>
<p>The construction of each <code>Session</code> instance can be customized by providing a "creation function" which returns a new <code>Session</code>.  A common customization is a <code>Session</code> which needs to explicitly bind to a particular <code>Engine</code>:
</p>


<div class="sliding_code">
<pre><span class="python_keyword">import </span><span class="python_name">sqlalchemy</span><span class="python_operator">
</span><span class="python_keyword">from </span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">ext</span><span class="python_operator">.</span><span class="python_name">sessioncontext </span><span class="python_keyword">import </span><span class="python_name">SessionContext</span><span class="python_operator">
</span>
<span class="python_comment"># create an engine
</span><span class="python_name">someengine </span><span class="python_operator">= </span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">create_engine</span><span class="python_enclosure">(</span><span class="python_literal">'sqlite:///'</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># a function to return a Session bound to our engine
</span><span class="python_keyword">def </span><span class="python_name">make_session</span><span class="python_enclosure">()</span><span class="python_operator">:
    </span><span class="python_keyword">return </span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">create_session</span><span class="python_enclosure">(</span><span class="python_name">bind_to</span><span class="python_operator">=</span><span class="python_name">someengine</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># SessionContext
</span><span class="python_operator"></span><span class="python_name">ctx </span><span class="python_operator">= </span><span class="python_name">SessionContext</span><span class="python_enclosure">(</span><span class="python_name">make_session</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># get the session bound to engine "someengine":
</span><span class="python_name">session </span><span class="python_operator">= </span><span class="python_name">ctx</span><span class="python_operator">.</span><span class="python_name">current</span><span class="python_operator"></span></pre></div>
<p>The above pattern is more succinctly expressed using Python lambdas:
</p>


<div class="sliding_code">
<pre><span class="python_name">ctx </span><span class="python_operator">= </span><span class="python_name">SessionContext</span><span class="python_enclosure">(</span><span class="python_keyword">lambda</span><span class="python_operator">:</span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">create_session</span><span class="python_enclosure">(</span><span class="python_name">bind_to</span><span class="python_operator">=</span><span class="python_name">someengine</span><span class="python_enclosure">))</span><span class="python_operator"></span></pre></div>
<p>The default creation function is simply:
</p>


<div class="sliding_code">
<pre><span class="python_name">ctx </span><span class="python_operator">= </span><span class="python_name">SessionContext</span><span class="python_enclosure">(</span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">create_session</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre></div>
<p>The "scope" to which the session is associated, which by default is a thread-local scope, can be customized by providing a "scope callable" which returns a hashable key that represents the current scope:
</p>


<div class="sliding_code">
<pre><span class="python_keyword">import </span><span class="python_name">sqlalchemy</span><span class="python_operator">
</span><span class="python_keyword">from </span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">ext</span><span class="python_operator">.</span><span class="python_name">sessioncontext </span><span class="python_keyword">import </span><span class="python_name">SessionContext</span><span class="python_operator">
</span>
<span class="python_comment"># global declaration of "scope"
</span><span class="python_name">scope </span><span class="python_operator">= </span><span class="python_literal">"scope1"</span><span class="python_operator">
</span>
<span class="python_comment"># a function to return the current "session scope"
</span><span class="python_keyword">def </span><span class="python_name">global_scope_func</span><span class="python_enclosure">()</span><span class="python_operator">:
    </span><span class="python_keyword">return </span><span class="python_name">scope</span><span class="python_operator">
</span>
<span class="python_comment"># create SessionContext with a custom "scopefunc"
</span><span class="python_operator"></span><span class="python_name">ctx </span><span class="python_operator">= </span><span class="python_name">SessionContext</span><span class="python_enclosure">(</span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">create_session</span><span class="python_operator">, </span><span class="python_name">scopefunc</span><span class="python_operator">=</span><span class="python_name">global_scope_func</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># get the session corresponding to "scope1":
</span><span class="python_name">session </span><span class="python_operator">= </span><span class="python_name">ctx</span><span class="python_operator">.</span><span class="python_name">current</span><span class="python_operator">
</span>
<span class="python_comment"># switch the "scope"
</span><span class="python_name">scope </span><span class="python_operator">= </span><span class="python_literal">"scope2"</span><span class="python_operator">
</span>
<span class="python_comment"># get the session corresponding to "scope2":
</span><span class="python_name">session </span><span class="python_operator">= </span><span class="python_name">ctx</span><span class="python_operator">.</span><span class="python_name">current</span><span class="python_operator"></span></pre></div>
<p>Examples of customized scope can include user-specific sessions or requests, or even sub-elements of an application, such as a graphical application which maintains a single <code>Session</code> per application window (this was the original motivation to create SessionContext).
</p>



<A name="plugins_sessioncontext_sessioncontextext"></a>

<div class="subsection" style="margin-left:30px;">


<h3>Using SessionContextExt</h3>

    <div class="sectiontext">
    

<p>This is a <code>MapperExtension</code> which allows a <code>Mapper</code> to be automatically associated with a <code>SessionContext</code>.  Newly constructed objects get <code>save()</code>d to the session automatically, and <code>Query</code> objects can be constructed without a session. The instance of <code>SessionContextExt</code> is provided by the <code>SessionContext</code> itself:
</p>


<div class="sliding_code">
<pre><span class="python_keyword">import </span><span class="python_name">sqlalchemy</span><span class="python_operator">
</span><span class="python_keyword">from </span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">ext</span><span class="python_operator">.</span><span class="python_name">sessioncontext </span><span class="python_keyword">import </span><span class="python_name">SessionContext</span><span class="python_operator">
</span>
<span class="python_name">ctx </span><span class="python_operator">= </span><span class="python_name">SessionContext</span><span class="python_enclosure">(</span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">create_session</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_keyword">class </span><span class="python_name">User</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">pass</span><span class="python_operator">
</span>
<span class="python_operator"></span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">users_table</span><span class="python_operator">, </span><span class="python_name">extension</span><span class="python_operator">=</span><span class="python_name">ctx</span><span class="python_operator">.</span><span class="python_name">mapper_extension</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># 'u' is automatically added to the current session of 'ctx'
</span><span class="python_name">u </span><span class="python_operator">= </span><span class="python_name">User</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_keyword">assert </span><span class="python_name">u </span><span class="python_keyword">in </span><span class="python_name">ctx</span><span class="python_operator">.</span><span class="python_name">current</span><span class="python_operator">
</span>
<span class="python_comment"># get the current session and flush
</span><span class="python_name">ctx</span><span class="python_operator">.</span><span class="python_name">current</span><span class="python_operator">.</span><span class="python_name">flush</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre></div>
<p>The <code>MapperExtension</code> can be configured either per-mapper as above, or on an application-wide basis using:
</p>


<div class="sliding_code">
<pre><span class="python_keyword">import </span><span class="python_name">sqlalchemy</span><span class="python_operator">
</span><span class="python_keyword">from </span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">orm</span><span class="python_operator">.</span><span class="python_name">mapper </span><span class="python_keyword">import </span><span class="python_name">global_extensions</span><span class="python_operator">
</span><span class="python_keyword">from </span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">ext</span><span class="python_operator">.</span><span class="python_name">sessioncontext </span><span class="python_keyword">import </span><span class="python_name">SessionContext</span><span class="python_operator">
</span>
<span class="python_name">ctx </span><span class="python_operator">= </span><span class="python_name">SessionContext</span><span class="python_enclosure">(</span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">create_session</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_name">global_extensions</span><span class="python_operator">.</span><span class="python_name">append</span><span class="python_enclosure">(</span><span class="python_name">ctx</span><span class="python_operator">.</span><span class="python_name">mapper_extension</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre></div>
<p>SessionContextExt allows <code>Query</code> objects to be created against the mapped class without specifying a <code>Session</code>.  Each <code>Query</code> will automatically make usage of the current contextual session:
</p>


<div class="sliding_code">
<pre><span class="python_comment"># create a Query from a class
</span><span class="python_name">query </span><span class="python_operator">= </span><span class="python_name">Query</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># specify entity name
</span><span class="python_name">query </span><span class="python_operator">= </span><span class="python_name">Query</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">entity_name</span><span class="python_operator">=</span><span class="python_literal">'foo'</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># create a Query from a mapper
</span><span class="python_name">query </span><span class="python_operator">= </span><span class="python_name">Query</span><span class="python_enclosure">(</span><span class="python_name">mapper</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># then use it
</span><span class="python_name">result </span><span class="python_operator">= </span><span class="python_name">query</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre></div>
<p>When installed globally, all <code>Mapper</code> objects will contain a built-in association to the <code>SessionContext</code>.  This means that once a mapped instance is created, creating a new <code>Session</code> and calling <code>save()</code> with the instance as an argument will raise an error stating that the instance is already associated with a different session.  While you can always remove the object from its original session, <code>SessionContextExt</code> is probably convenient only for an application that does not need much explicit manipulation of sessions.
</p>
<p>The user still has some control over which session gets used at instance construction time.  An instance can be redirected at construction time to a different <code>Session</code> by specifying the keyword parameter <code>_sa_session</code> to its constructor, which is decorated by the mapper:
</p>


<div class="sliding_code">
<pre><span class="python_name">session </span><span class="python_operator">= </span><span class="python_name">create_session</span><span class="python_enclosure">()  </span><span class="python_comment"># create a new session distinct from the contextual session</span><span class="python_operator">
</span><span class="python_name">myuser </span><span class="python_operator">= </span><span class="python_name">User</span><span class="python_enclosure">(</span><span class="python_name">_sa_session</span><span class="python_operator">=</span><span class="python_name">session</span><span class="python_enclosure">)  </span><span class="python_comment"># make a new User that is saved to this session</span><span class="python_operator"></span></pre></div>
<p>Similarly, the <code>entity_name</code> parameter, which specifies an alternate <code>Mapper</code> to be used when attaching this instance to the <code>Session</code>, can be specified via <code>_sa_entity_name</code>:
</p>


<div class="sliding_code">
<pre><span class="python_name">myuser </span><span class="python_operator">= </span><span class="python_name">User</span><span class="python_enclosure">(</span><span class="python_name">_sa_session</span><span class="python_operator">=</span><span class="python_name">session</span><span class="python_operator">, </span><span class="python_name">_sa_entity_name</span><span class="python_operator">=</span><span class="python_literal">'altentity'</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre></div>
<p>The decoration of mapped instances' <code>__init__()</code> method is similar to this example:    <br></br>
</p>


<div class="sliding_code">
<pre><span class="python_name">oldinit </span><span class="python_operator">= </span><span class="python_name">class_</span><span class="python_operator">.</span><span class="python_name">__init__   </span><span class="python_comment"># the previous init method</span><span class="python_operator">
</span><span class="python_keyword">def </span><span class="python_name">__init__</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, *</span><span class="python_name">args</span><span class="python_operator">, **</span><span class="python_name">kwargs</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_name">session </span><span class="python_operator">= </span><span class="python_name">kwargs</span><span class="python_operator">.</span><span class="python_name">pop</span><span class="python_enclosure">(</span><span class="python_literal">'_sa_session'</span><span class="python_operator">, </span><span class="python_name">None</span><span class="python_enclosure">)</span><span class="python_operator">
    </span><span class="python_name">entity_name </span><span class="python_operator">= </span><span class="python_name">kwargs</span><span class="python_operator">.</span><span class="python_name">pop</span><span class="python_enclosure">(</span><span class="python_literal">'_sa_entity_name'</span><span class="python_operator">, </span><span class="python_name">None</span><span class="python_enclosure">)</span><span class="python_operator">
    </span><span class="python_keyword">if </span><span class="python_name">session </span><span class="python_keyword">is </span><span class="python_name">None</span><span class="python_operator">:
        </span><span class="python_name">session </span><span class="python_operator">= </span><span class="python_name">ext</span><span class="python_operator">.</span><span class="python_name">get_session</span><span class="python_enclosure">() </span><span class="python_comment"># get Session from this Mapper's MapperExtension</span><span class="python_operator">
        </span><span class="python_keyword">if </span><span class="python_name">session </span><span class="python_keyword">is </span><span class="python_name">EXT_PASS</span><span class="python_operator">:
            </span><span class="python_name">session </span><span class="python_operator">= </span><span class="python_name">None</span><span class="python_operator">
    </span><span class="python_keyword">if </span><span class="python_name">session </span><span class="python_keyword">is not </span><span class="python_name">None</span><span class="python_operator">:
        </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">save</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">entity_name</span><span class="python_operator">=</span><span class="python_name">entity_name</span><span class="python_enclosure">)  </span><span class="python_comment"># attach to the current session</span><span class="python_operator">
    </span><span class="python_name">oldinit</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, *</span><span class="python_name">args</span><span class="python_operator">, **</span><span class="python_name">kwagrs</span><span class="python_enclosure">)   </span><span class="python_comment"># call previous init method</span><span class="python_operator"></span></pre></div>


    </div>

</div>



    </div>

    <a href="#plugins" class="toclink">back to section top</a>
</div>




<A name="plugins_selectresults"></a>

<div class="subsection" style="margin-left:20px;">


<h3>SelectResults</h3>

    <div class="sectiontext">
    

<p><strong>Author:</strong> Jonas Borgstrm
</p>
<p>SelectResults gives transformative behavior to the results returned from the <code>select</code> and <code>select_by</code> methods of <code>Query</code>. 
</p>


<div class="sliding_code">
<pre><span class="python_keyword">from </span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">ext</span><span class="python_operator">.</span><span class="python_name">selectresults </span><span class="python_keyword">import </span><span class="python_name">SelectResults</span><span class="python_operator">
</span>
<span class="python_name">query </span><span class="python_operator">= </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">MyClass</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">res </span><span class="python_operator">= </span><span class="python_name">SelectResults</span><span class="python_enclosure">(</span><span class="python_name">query</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_name">res </span><span class="python_operator">= </span><span class="python_name">res</span><span class="python_operator">.</span><span class="python_name">filter</span><span class="python_enclosure">(</span><span class="python_name">table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">column </span><span class="python_operator">== </span><span class="python_literal">"something"</span><span class="python_enclosure">) </span><span class="python_comment"># adds a WHERE clause (or appends to the existing via "and")</span><span class="python_operator">
</span><span class="python_name">res </span><span class="python_operator">= </span><span class="python_name">res</span><span class="python_operator">.</span><span class="python_name">order_by</span><span class="python_enclosure">([</span><span class="python_name">table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">column</span><span class="python_enclosure">]) </span><span class="python_comment"># adds an ORDER BY clause</span><span class="python_operator">
</span>
<span class="python_keyword">for </span><span class="python_name">x </span><span class="python_keyword">in </span><span class="python_name">res</span><span class="python_enclosure">[</span><span class="python_operator">:</span><span class="python_number">10</span><span class="python_enclosure">]</span><span class="python_operator">:  </span><span class="python_comment"># Fetch and print the top ten instances - adds OFFSET 0 LIMIT 10 or equivalent</span><span class="python_operator">
  </span><span class="python_keyword">print </span><span class="python_name">x</span><span class="python_operator">.</span><span class="python_name">column2</span><span class="python_operator">
</span>
<span class="python_comment"># evaluate as a list, which executes the query
</span><span class="python_operator"></span><span class="python_name">x </span><span class="python_operator">= </span><span class="python_name">list</span><span class="python_enclosure">(</span><span class="python_name">res</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># Count how many instances that have column2 > 42
# and column == "something"
</span><span class="python_keyword">print </span><span class="python_name">res</span><span class="python_operator">.</span><span class="python_name">filter</span><span class="python_enclosure">(</span><span class="python_name">table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">column2 </span><span class="python_operator">> </span><span class="python_number">42</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">count</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_comment"># select() is a synonym for filter()
</span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">MyClass</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">mytable</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">column</span><span class="python_operator">==</span><span class="python_literal">"something"</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">order_by</span><span class="python_enclosure">([</span><span class="python_name">mytable</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">column</span><span class="python_enclosure">])[</span><span class="python_number">2</span><span class="python_operator">:</span><span class="python_number">7</span><span class="python_enclosure">]</span><span class="python_operator"></span></pre></div>
<p>An important facet of SelectResults is that the actual SQL execution does not occur until the object is used in a list or iterator context.  This means you can call any number of transformative methods (including <code>filter</code>, <code>order_by</code>, list range expressions, etc) before any SQL is actually issued.
</p>
<p>Configuration of SelectResults may be per-Query, per Mapper, or per application:
</p>


<div class="sliding_code">
<pre><span class="python_keyword">from </span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">ext</span><span class="python_operator">.</span><span class="python_name">selectresults </span><span class="python_keyword">import </span><span class="python_name">SelectResults</span><span class="python_operator">, </span><span class="python_name">SelectResultsExt</span><span class="python_operator">
</span>
<span class="python_comment"># construct a SelectResults for an individual Query
</span><span class="python_name">sel </span><span class="python_operator">= </span><span class="python_name">SelectResults</span><span class="python_enclosure">(</span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">MyClass</span><span class="python_enclosure">))</span><span class="python_operator">
</span>
<span class="python_comment"># construct a Mapper where the Query.select()/select_by() methods will return a SelectResults:
</span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">MyClass</span><span class="python_operator">, </span><span class="python_name">mytable</span><span class="python_operator">, </span><span class="python_name">extension</span><span class="python_operator">=</span><span class="python_name">SelectResultsExt</span><span class="python_enclosure">())</span><span class="python_operator">
</span>
<span class="python_comment"># globally configure all Mappers to return SelectResults, using the "selectresults" mod
</span><span class="python_keyword">import </span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">mods</span><span class="python_operator">.</span><span class="python_name">selectresults</span><span class="python_operator"></span></pre></div>
<p>SelectResults greatly enhances querying and is highly recommended.  For example, heres an example of constructing a query using a combination of joins and outerjoins:
</p>


<div class="sliding_code">
<pre><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">users_table</span><span class="python_operator">, </span><span class="python_name">properties</span><span class="python_operator">=</span><span class="python_enclosure">{</span>
    <span class="python_literal">'orders'</span><span class="python_operator">:</span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Order</span><span class="python_operator">, </span><span class="python_name">orders_table</span><span class="python_operator">, </span><span class="python_name">properties</span><span class="python_operator">=</span><span class="python_enclosure">{</span>
        <span class="python_literal">'items'</span><span class="python_operator">:</span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Item</span><span class="python_operator">, </span><span class="python_name">items_table</span><span class="python_enclosure">))</span>
    <span class="python_enclosure">}))</span>
<span class="python_enclosure">})</span><span class="python_operator">
</span><span class="python_name">session </span><span class="python_operator">= </span><span class="python_name">create_session</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_name">query </span><span class="python_operator">= </span><span class="python_name">SelectResults</span><span class="python_enclosure">(</span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_enclosure">))</span><span class="python_operator">
</span>
<span class="python_name">result </span><span class="python_operator">= </span><span class="python_name">query</span><span class="python_operator">.</span><span class="python_name">outerjoin_to</span><span class="python_enclosure">(</span><span class="python_literal">'orders'</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">outerjoin_to</span><span class="python_enclosure">(</span><span class="python_literal">'items'</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">or_</span><span class="python_enclosure">(</span><span class="python_name">Order</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">order_id</span><span class="python_operator">==</span><span class="python_name">None</span><span class="python_operator">,</span><span class="python_name">Item</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">item_id</span><span class="python_operator">==</span><span class="python_number">2</span><span class="python_enclosure">))</span><span class="python_operator"></span></pre></div>
<p>For a full listing of methods, see the <a href="docstrings.html#docstrings_sqlalchemy.ext.selectresults">generated documentation</a>.
</p>


    </div>

    <a href="#plugins" class="toclink">back to section top</a>
</div>




<A name="plugins_assignmapper"></a>

<div class="subsection" style="margin-left:20px;">


<h3>assignmapper</h3>

    <div class="sectiontext">
    

<p><strong>Author:</strong> Mike Bayer
</p>
<p>This extension is used to decorate a mapped class with direct knowledge about its own <code>Mapper</code>, a contextual <code>Session</code>, as well as functions provided by the <code>Query</code> and <code>Session</code> objects.  The methods will automatically make usage of a contextual session with which all newly constructed objects are associated.  <code>assign_mapper</code> operates as a <code>MapperExtension</code>, and requires the usage of a <code>SessionContext</code> as well as <code>SessionContextExt</code>, described in <a href="plugins.html#plugins_sessioncontext">SessionContext</a>.  It replaces the usage of the normal <code>mapper</code> function with its own version that adds a <code>SessionContext</code> specified as the first argument:
</p>


<div class="sliding_code">
<pre><span class="python_keyword">import </span><span class="python_name">sqlalchemy</span><span class="python_operator">
</span><span class="python_keyword">from </span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">ext</span><span class="python_operator">.</span><span class="python_name">sessioncontext </span><span class="python_keyword">import </span><span class="python_name">SessionContext</span><span class="python_operator">
</span><span class="python_keyword">from </span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">ext</span><span class="python_operator">.</span><span class="python_name">assignmapper </span><span class="python_keyword">import </span><span class="python_name">assign_mapper</span><span class="python_operator">
</span>
<span class="python_comment"># session context
</span><span class="python_name">ctx </span><span class="python_operator">= </span><span class="python_name">SessionContext</span><span class="python_enclosure">(</span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">create_session</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># assign mapper to class MyClass using table 'sometable', getting
# Sessions from 'ctx'.
</span><span class="python_name">assign_mapper</span><span class="python_enclosure">(</span><span class="python_name">ctx</span><span class="python_operator">, </span><span class="python_name">MyClass</span><span class="python_operator">, </span><span class="python_name">sometable</span><span class="python_operator">, </span><span class="python_name">properties</span><span class="python_operator">=</span><span class="python_enclosure">{</span><span class="python_operator">...</span><span class="python_enclosure">}</span><span class="python_operator">, ...</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre></div>
<p>Above, all new instances of <code>MyClass</code> will be associated with the contextual session, <code>ctx.current</code>.  Additionally, <code>MyClass</code> and instances of <code>MyClass</code> now contain a large set of methods including <code>get</code>, <code>select</code>, <code>flush</code>, <code>delete</code>.  The full list is as follows:
</p>


<div class="sliding_code">
<pre><span class="python_comment"># Query methods:
</span><span class="python_enclosure">[</span><span class="python_literal">'get'</span><span class="python_operator">, </span><span class="python_literal">'select'</span><span class="python_operator">, </span><span class="python_literal">'select_by'</span><span class="python_operator">, </span><span class="python_literal">'selectone'</span><span class="python_operator">, </span><span class="python_literal">'get_by'</span><span class="python_operator">, </span><span class="python_literal">'join_to'</span><span class="python_operator">, </span><span class="python_literal">'join_via'</span><span class="python_operator">, </span><span class="python_literal">'count'</span><span class="python_operator">, </span><span class="python_literal">'count_by'</span><span class="python_enclosure">]</span><span class="python_operator">
</span>
<span class="python_comment"># Session methods:
</span><span class="python_enclosure">[</span><span class="python_literal">'flush'</span><span class="python_operator">, </span><span class="python_literal">'delete'</span><span class="python_operator">, </span><span class="python_literal">'expire'</span><span class="python_operator">, </span><span class="python_literal">'refresh'</span><span class="python_operator">, </span><span class="python_literal">'expunge'</span><span class="python_operator">, </span><span class="python_literal">'merge'</span><span class="python_operator">, </span><span class="python_literal">'save'</span><span class="python_operator">, </span><span class="python_literal">'update'</span><span class="python_operator">, </span><span class="python_literal">'save_or_update'</span><span class="python_enclosure">]</span><span class="python_operator"></span></pre></div>
<p>To continue the <code>MyClass</code> example:
</p>


<div class="sliding_code">
<pre><span class="python_comment"># create a MyClass.  it will be automatically assigned to the contextual Session.
</span><span class="python_name">mc </span><span class="python_operator">= </span><span class="python_name">MyClass</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_comment"># save MyClass - this will call flush() on the session, specifying 'mc' as the only
# object to be affected
</span><span class="python_name">mc</span><span class="python_operator">.</span><span class="python_name">flush</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_comment"># load an object, using Query methods attached to MyClass
</span><span class="python_name">result </span><span class="python_operator">= </span><span class="python_name">MyClass</span><span class="python_operator">.</span><span class="python_name">get_by</span><span class="python_enclosure">(</span><span class="python_name">id</span><span class="python_operator">=</span><span class="python_number">5</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># delete it
</span><span class="python_name">result</span><span class="python_operator">.</span><span class="python_name">delete</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_comment"># commit the change
</span><span class="python_name">result</span><span class="python_operator">.</span><span class="python_name">flush</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre></div>
<p>It should be noted that the <code>flush()</code> method on the instance need not be called.  You're probably better off calling <code>flush()</code> on the actual session, so that all changes are properly written to the database simultaneously:
</p>


<div class="sliding_code">
<pre><span class="python_comment"># create a MyClass.
</span><span class="python_name">mc </span><span class="python_operator">= </span><span class="python_name">MyClass</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_comment"># load some MyClass objects
</span><span class="python_name">result </span><span class="python_operator">= </span><span class="python_name">MyClass</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">MyClass</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">name</span><span class="python_operator">==</span><span class="python_literal">'bar'</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># delete one of them
</span><span class="python_name">result</span><span class="python_enclosure">[</span><span class="python_number">1</span><span class="python_enclosure">]</span><span class="python_operator">.</span><span class="python_name">delete</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_comment"># commit all changes
</span><span class="python_name">ctx</span><span class="python_operator">.</span><span class="python_name">current</span><span class="python_operator">.</span><span class="python_name">flush</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre></div>


    </div>

    <a href="#plugins" class="toclink">back to section top</a>
</div>




<A name="plugins_associationproxy"></a>

<div class="subsection" style="margin-left:20px;">


<h3>associationproxy</h3>

    <div class="sectiontext">
    

<p><strong>Author:</strong> Mike Bayer<br></br>
   <strong>Version:</strong> 0.3.1 or greater
</p>
<p><code>associationproxy</code> is used to create a transparent proxy to the associated object in an association relationship, thereby decreasing the verbosity of the pattern in cases where explicit access to the association object is not required.  The association relationship pattern is a richer form of a many-to-many relationship, which is described in <a href="datamapping.html#datamapping_association">Association Object</a>.  It is strongly recommended to fully understand the association object pattern in its explicit form before using this extension; see the examples in the SQLAlchemy distribution under the directory <code>examples/association/</code>.
</p>
<p>When dealing with association relationships, the <strong>association object</strong> refers to the object that maps to a row in the association table (i.e. the many-to-many table), while the <strong>associated object</strong> refers to the "endpoint" of the association, i.e. the ultimate object referenced by the parent.  The proxy can return collections of objects attached to association objects, and can also create new association objects given only the associated object.  An example using the Keyword mapping described in the data mapping documentation is as follows:
</p>


<div class="sliding_code">
<pre><span class="python_keyword">from </span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">ext</span><span class="python_operator">.</span><span class="python_name">associationproxy </span><span class="python_keyword">import </span><span class="python_name">AssociationProxy</span><span class="python_operator">
</span>
<span class="python_keyword">class </span><span class="python_name">User</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">pass</span><span class="python_operator">
</span>
<span class="python_operator"></span><span class="python_keyword">class </span><span class="python_name">Keyword</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">def </span><span class="python_name">__init__</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">name</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">keyword_name </span><span class="python_operator">= </span><span class="python_name">name</span><span class="python_operator">
</span>
<span class="python_operator"></span><span class="python_keyword">class </span><span class="python_name">Article</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_comment"># create "keywords" proxied association.
    # the collection is called 'keyword_associations', the endpoint
    # attribute of each association object is called 'keyword'.  the 
    # class itself of the association object will be figured out automatically  .
</span><span class="python_operator">    </span><span class="python_name">keywords </span><span class="python_operator">= </span><span class="python_name">AssociationProxy</span><span class="python_enclosure">(</span><span class="python_literal">'keyword_associations'</span><span class="python_operator">, </span><span class="python_literal">'keyword'</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_operator"></span><span class="python_keyword">class </span><span class="python_name">KeywordAssociation</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">pass</span><span class="python_operator">
</span>
<span class="python_comment"># create mappers normally
# note that we set up 'keyword_associations' on Article,
# and 'keyword' on KeywordAssociation.
</span><span class="python_operator"></span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Article</span><span class="python_operator">, </span><span class="python_name">articles_table</span><span class="python_operator">, </span><span class="python_name">properties</span><span class="python_operator">=</span><span class="python_enclosure">{</span>
    <span class="python_literal">'keyword_associations'</span><span class="python_operator">:</span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">KeywordAssociation</span><span class="python_operator">, </span><span class="python_name">lazy</span><span class="python_operator">=</span><span class="python_name">False</span><span class="python_operator">, </span><span class="python_name">cascade</span><span class="python_operator">=</span><span class="python_literal">"all, delete-orphan"</span><span class="python_enclosure">)</span>
    <span class="python_enclosure">}</span>
<span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">KeywordAssociation</span><span class="python_operator">, </span><span class="python_name">itemkeywords_table</span><span class="python_operator">,</span>
    <span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_enclosure">[</span><span class="python_name">itemkeywords_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">article_id</span><span class="python_operator">, </span><span class="python_name">itemkeywords_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">keyword_id</span><span class="python_enclosure">]</span><span class="python_operator">,</span>
    <span class="python_name">properties</span><span class="python_operator">=</span><span class="python_enclosure">{</span>
        <span class="python_literal">'keyword' </span><span class="python_operator">: </span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">Keyword</span><span class="python_operator">, </span><span class="python_name">lazy</span><span class="python_operator">=</span><span class="python_name">False</span><span class="python_enclosure">)</span><span class="python_operator">, </span>
        <span class="python_literal">'user' </span><span class="python_operator">: </span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">lazy</span><span class="python_operator">=</span><span class="python_name">False</span><span class="python_enclosure">) </span>
    <span class="python_enclosure">}</span>
<span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">users_table</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Keyword</span><span class="python_operator">, </span><span class="python_name">keywords_table</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># now, Keywords can be attached to an Article directly;
# KeywordAssociation will be created by the AssociationProxy, and have the 
# 'keyword' attribute set to the new Keyword.
# note that these KeywordAssociation objects will not have a User attached to them.
</span><span class="python_name">article </span><span class="python_operator">= </span><span class="python_name">Article</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_name">article</span><span class="python_operator">.</span><span class="python_name">keywords</span><span class="python_operator">.</span><span class="python_name">append</span><span class="python_enclosure">(</span><span class="python_name">Keyword</span><span class="python_enclosure">(</span><span class="python_literal">'blue'</span><span class="python_enclosure">))</span><span class="python_operator">
</span><span class="python_name">article</span><span class="python_operator">.</span><span class="python_name">keywords</span><span class="python_operator">.</span><span class="python_name">append</span><span class="python_enclosure">(</span><span class="python_name">Keyword</span><span class="python_enclosure">(</span><span class="python_literal">'red'</span><span class="python_enclosure">))</span><span class="python_operator">
</span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">save</span><span class="python_enclosure">(</span><span class="python_name">article</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">flush</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_comment"># the "keywords" collection also returns the underlying Keyword objects
</span><span class="python_name">article </span><span class="python_operator">= </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">Article</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">get_by</span><span class="python_enclosure">(</span><span class="python_name">id</span><span class="python_operator">=</span><span class="python_number">12</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_keyword">for </span><span class="python_name">k </span><span class="python_keyword">in </span><span class="python_name">article</span><span class="python_operator">.</span><span class="python_name">keywords</span><span class="python_operator">:
    </span><span class="python_keyword">print </span><span class="python_literal">"Keyword:"</span><span class="python_operator">, </span><span class="python_name">k</span><span class="python_operator">.</span><span class="python_name">keyword_name</span><span class="python_operator">
</span>
<span class="python_comment"># the original 'keyword_associations' relation exists normally with no awareness of the proxy
</span><span class="python_operator"></span><span class="python_name">article</span><span class="python_operator">.</span><span class="python_name">keyword_associations</span><span class="python_operator">.</span><span class="python_name">append</span><span class="python_enclosure">(</span><span class="python_name">KeywordAssociation</span><span class="python_enclosure">())</span><span class="python_operator">
</span><span class="python_keyword">print </span><span class="python_enclosure">[</span><span class="python_name">ka </span><span class="python_keyword">for </span><span class="python_name">ka </span><span class="python_keyword">in </span><span class="python_name">article</span><span class="python_operator">.</span><span class="python_name">keyword_associations</span><span class="python_enclosure">]</span><span class="python_operator"></span></pre></div>
<p>Note that the above operations on the <code>keywords</code> collection are proxying operations to and from the <code>keyword_associations</code> collection, which exists normally and can be accessed directly.  <code>AssociationProxy</code> will also detect if the collection is list or scalar based and will configure the proxied property to act the same way.
</p>
<p>For the common case where the association object's creation needs to be specified by the application, <code>AssociationProxy</code> takes an optional callable <code>creator()</code> which takes a single associated object as an argument, and returns a new association object.
</p>


<div class="sliding_code">
<pre><span class="python_keyword">def </span><span class="python_name">create_keyword_association</span><span class="python_enclosure">(</span><span class="python_name">keyword</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_name">ka </span><span class="python_operator">= </span><span class="python_name">KeywordAssociation</span><span class="python_enclosure">()</span><span class="python_operator">
    </span><span class="python_name">ka</span><span class="python_operator">.</span><span class="python_name">keyword </span><span class="python_operator">= </span><span class="python_name">keyword</span><span class="python_operator">
    </span><span class="python_keyword">return </span><span class="python_name">ka</span><span class="python_operator">
</span>
<span class="python_operator"></span><span class="python_keyword">class </span><span class="python_name">Article</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_comment"># create "keywords" proxied association
</span><span class="python_operator">    </span><span class="python_name">keywords </span><span class="python_operator">= </span><span class="python_name">AssociationProxy</span><span class="python_enclosure">(</span><span class="python_literal">'keyword_associations'</span><span class="python_operator">, </span><span class="python_literal">'keyword'</span><span class="python_operator">, </span><span class="python_name">creator</span><span class="python_operator">=</span><span class="python_name">create_keyword_association</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre></div>


    </div>

    <a href="#plugins" class="toclink">back to section top</a>
</div>




<A name="plugins_threadlocal"></a>

<div class="subsection" style="margin-left:20px;">


<h3>threadlocal</h3>

    <div class="sectiontext">
    

<p><strong>Author:</strong>  Mike Bayer and Daniel Miller
</p>
<p><code>threadlocal</code> is an extension that was created primarily to provide backwards compatibility with the older SQLAlchemy 0.1 series.  It uses three features which SQLAlchemy 0.2 and above provide as distinct features:  <code>SessionContext</code>, <code>assign_mapper</code>, and the <code>TLEngine</code>, which is the <code>Engine</code> used with the threadlocal <code>create_engine()</code> strategy.  It is <strong>strongly</strong> recommended that these three features are understood individually before using threadlocal.
</p>
<p>In SQLAlchemy 0.1, users never dealt with explcit connections and didn't have a very explicit <code>Session</code> interface, instead relying upon a more magical global object called <code>objectstore</code>.  The <code>objectstore</code> idea was wildly popular with about half of SA's users, and completely unpopular with the other half.  The threadlocal mod basically brings back <code>objectstore</code>, which is in fact just a <code>SessionContext</code> where you can call <code>Session</code> methods directly off of it, instead of saying <code>context.current</code>.  For <code>threadlocal</code> to faithfully produce 0.1 behavior, it is invoked as a <em>mod</em> which globally installs the objectstore's mapper extension, such that all <code>Mapper</code>s will automatically assign all new instances of mapped classes to the objectstore's contextual <code>Session</code>.  Additionally, it also changes the default engine strategy used by <code>create_engine</code> to be the "threadlocal" strategy, which in normal practice does not affect much. 
</p>
<p>When you import threadlocal, what you get is:
</p>
<ul>
 <li>
     the "objectstore" session context object is now added to the <code>sqlalchemy</code> namespace.
 </li>

 <li>
     a global <code>MapperExtension</code> is set up for all mappers which assigns "objectstore"'s session as the default session context, used by new instances as well as <code>Query</code> objects (see the section <a href="plugins.html#plugins_sessioncontext_sessioncontextext">Using SessionContextExt</a>).
 </li>

 <li>
     a new function "assign_mapper" is added to the <code>sqlalchemy</code> namespace, which calls the <code>assignmapper</code> mapper function using the new "objectstore" context.
 </li>

 <li>
     the <code>create_engine</code> function is modified so that "threadlocal", and not "plain", is the default engine strategy.
 </li>
</ul>
<p>So an important point to understand is, <strong>don't use the threadlocal mod unless you explcitly are looking for that behavior</strong>.  Unfortunately, the easy import of the "threadlocal" mod has found its way into several tutorials on external websites, which produces application-wide behavior that is in conflict with the SQLAlchemy tutorial and data mapping documentation.
</p>
<p>While "threadlocal" is only about 10 lines of code, it is strongly advised that users instead make usage of <code>SessionContext</code> and <code>assign_mapper</code> explictly to eliminate confusion.  Additionally, the "threadlocal" strategy on <code>create_engine()</code> also exists primarily to provide patterns used in 0.1 and is probably not worth using either, unless you specifically need those patterns.
</p>
<p>Basic usage of threadlocal involves importing the mod, <em>before</em> any usage of the <code>sqlalchemy</code> namespace, since threadlocal is going to add the "objectstore" and "assign_mapper" keywords to "sqlalchemy".
</p>
<p>To use <code>objectstore</code>:
</p>


<div class="sliding_code">
<pre><span class="python_keyword">import </span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">mods</span><span class="python_operator">.</span><span class="python_name">threadlocal</span><span class="python_operator">
</span><span class="python_keyword">from </span><span class="python_name">sqlalchemy </span><span class="python_keyword">import </span><span class="python_operator">*
</span>
<span class="python_name">metadata </span><span class="python_operator">= </span><span class="python_name">BoundMetaData</span><span class="python_enclosure">(</span><span class="python_literal">'sqlite:///'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">user_table </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'users'</span><span class="python_operator">, </span><span class="python_name">metadata</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'user_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'user_name'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">50</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">nullable</span><span class="python_operator">=</span><span class="python_name">False</span><span class="python_enclosure">)</span>
<span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_keyword">class </span><span class="python_name">User</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">pass</span><span class="python_operator">
</span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">user_table</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># "user" object is added to the session automatically
</span><span class="python_name">user </span><span class="python_operator">= </span><span class="python_name">User</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_comment"># flush the contextual session
</span><span class="python_name">objectstore</span><span class="python_operator">.</span><span class="python_name">flush</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre></div>
<p>The actual <code>Session</code> is available as:
</p>


<div class="sliding_code">
<pre><span class="python_name">objectstore</span><span class="python_operator">.</span><span class="python_name">get_session</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre></div>
<p>To use <code>assign_mapper</code>:
</p>


<div class="sliding_code">
<pre><span class="python_keyword">import </span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">mods</span><span class="python_operator">.</span><span class="python_name">threadlocal</span><span class="python_operator">
</span><span class="python_keyword">from </span><span class="python_name">sqlalchemy </span><span class="python_keyword">import </span><span class="python_operator">*
</span>
<span class="python_name">metadata </span><span class="python_operator">= </span><span class="python_name">BoundMetaData</span><span class="python_enclosure">(</span><span class="python_literal">'sqlite:///'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">user_table </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'users'</span><span class="python_operator">, </span><span class="python_name">metadata</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'user_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'user_name'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">50</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">nullable</span><span class="python_operator">=</span><span class="python_name">False</span><span class="python_enclosure">)</span>
<span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_keyword">class </span><span class="python_name">User</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">pass</span><span class="python_operator">
</span>
<span class="python_comment"># note that no "context" object is needed
</span><span class="python_operator"></span><span class="python_name">assign_mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">user_table</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># call up a user
</span><span class="python_name">user </span><span class="python_operator">= </span><span class="python_name">User</span><span class="python_operator">.</span><span class="python_name">selectfirst</span><span class="python_enclosure">(</span><span class="python_name">user_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">==</span><span class="python_number">7</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># call 'delete' on the user
</span><span class="python_name">user</span><span class="python_operator">.</span><span class="python_name">delete</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_comment"># flush
</span><span class="python_name">objectstore</span><span class="python_operator">.</span><span class="python_name">flush</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre></div>


    </div>

    <a href="#plugins" class="toclink">back to section top</a>
</div>




<A name="plugins_activemapper"></a>

<div class="subsection" style="margin-left:20px;">


<h3>ActiveMapper</h3>

    <div class="sectiontext">
    

<p><strong>Author:</strong> Jonathan LaCour
</p>
<p>ActiveMapper is a so-called "declarative layer" which allows the construction of a class, a <code>Table</code>, and a <code>Mapper</code> all in one step:
</p>


<div class="sliding_code">
<pre><span class="python_keyword">class </span><span class="python_name">Person</span><span class="python_enclosure">(</span><span class="python_name">ActiveMapper</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">class </span><span class="python_name">mapping</span><span class="python_operator">:
        </span><span class="python_name">id          </span><span class="python_operator">= </span><span class="python_name">column</span><span class="python_enclosure">(</span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">
        </span><span class="python_name">full_name   </span><span class="python_operator">= </span><span class="python_name">column</span><span class="python_enclosure">(</span><span class="python_name">String</span><span class="python_enclosure">)</span><span class="python_operator">
        </span><span class="python_name">first_name  </span><span class="python_operator">= </span><span class="python_name">column</span><span class="python_enclosure">(</span><span class="python_name">String</span><span class="python_enclosure">)</span><span class="python_operator">
        </span><span class="python_name">middle_name </span><span class="python_operator">= </span><span class="python_name">column</span><span class="python_enclosure">(</span><span class="python_name">String</span><span class="python_enclosure">)</span><span class="python_operator">
        </span><span class="python_name">last_name   </span><span class="python_operator">= </span><span class="python_name">column</span><span class="python_enclosure">(</span><span class="python_name">String</span><span class="python_enclosure">)</span><span class="python_operator">
        </span><span class="python_name">birth_date  </span><span class="python_operator">= </span><span class="python_name">column</span><span class="python_enclosure">(</span><span class="python_name">DateTime</span><span class="python_enclosure">)</span><span class="python_operator">
        </span><span class="python_name">ssn         </span><span class="python_operator">= </span><span class="python_name">column</span><span class="python_enclosure">(</span><span class="python_name">String</span><span class="python_enclosure">)</span><span class="python_operator">
        </span><span class="python_name">gender      </span><span class="python_operator">= </span><span class="python_name">column</span><span class="python_enclosure">(</span><span class="python_name">String</span><span class="python_enclosure">)</span><span class="python_operator">
        </span><span class="python_name">home_phone  </span><span class="python_operator">= </span><span class="python_name">column</span><span class="python_enclosure">(</span><span class="python_name">String</span><span class="python_enclosure">)</span><span class="python_operator">
        </span><span class="python_name">cell_phone  </span><span class="python_operator">= </span><span class="python_name">column</span><span class="python_enclosure">(</span><span class="python_name">String</span><span class="python_enclosure">)</span><span class="python_operator">
        </span><span class="python_name">work_phone  </span><span class="python_operator">= </span><span class="python_name">column</span><span class="python_enclosure">(</span><span class="python_name">String</span><span class="python_enclosure">)</span><span class="python_operator">
        </span><span class="python_name">prefs_id    </span><span class="python_operator">= </span><span class="python_name">column</span><span class="python_enclosure">(</span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">foreign_key</span><span class="python_operator">=</span><span class="python_name">ForeignKey</span><span class="python_enclosure">(</span><span class="python_literal">'preferences.id'</span><span class="python_enclosure">))</span><span class="python_operator">
        </span><span class="python_name">addresses   </span><span class="python_operator">= </span><span class="python_name">one_to_many</span><span class="python_enclosure">(</span><span class="python_literal">'Address'</span><span class="python_operator">, </span><span class="python_name">colname</span><span class="python_operator">=</span><span class="python_literal">'person_id'</span><span class="python_operator">, </span><span class="python_name">backref</span><span class="python_operator">=</span><span class="python_literal">'person'</span><span class="python_enclosure">)</span><span class="python_operator">
        </span><span class="python_name">preferences </span><span class="python_operator">= </span><span class="python_name">one_to_one</span><span class="python_enclosure">(</span><span class="python_literal">'Preferences'</span><span class="python_operator">, </span><span class="python_name">colname</span><span class="python_operator">=</span><span class="python_literal">'pref_id'</span><span class="python_operator">, </span><span class="python_name">backref</span><span class="python_operator">=</span><span class="python_literal">'person'</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
    <span class="python_operator"></span><span class="python_keyword">def </span><span class="python_name">__str__</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_name">s </span><span class="python_operator">=  </span><span class="python_literal">'%s\n' </span><span class="python_operator">% </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">full_name</span><span class="python_operator">
        </span><span class="python_name">s </span><span class="python_operator">+= </span><span class="python_literal">'  * birthdate: %s\n' </span><span class="python_operator">% </span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">birth_date </span><span class="python_keyword">or </span><span class="python_literal">'not provided'</span><span class="python_enclosure">)</span><span class="python_operator">
        </span><span class="python_name">s </span><span class="python_operator">+= </span><span class="python_literal">'  * fave color: %s\n' </span><span class="python_operator">% </span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">preferences</span><span class="python_operator">.</span><span class="python_name">favorite_color </span><span class="python_keyword">or </span><span class="python_literal">'Unknown'</span><span class="python_enclosure">)</span><span class="python_operator">
        </span><span class="python_name">s </span><span class="python_operator">+= </span><span class="python_literal">'  * personality: %s\n' </span><span class="python_operator">% </span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">preferences</span><span class="python_operator">.</span><span class="python_name">personality_type </span><span class="python_keyword">or </span><span class="python_literal">'Unknown'</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
        <span class="python_keyword">for </span><span class="python_name">address </span><span class="python_keyword">in </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">addresses</span><span class="python_operator">:
            </span><span class="python_name">s </span><span class="python_operator">+= </span><span class="python_literal">'  * address: %s\n' </span><span class="python_operator">% </span><span class="python_name">address</span><span class="python_operator">.</span><span class="python_name">address_1</span><span class="python_operator">
            </span><span class="python_name">s </span><span class="python_operator">+= </span><span class="python_literal">'             %s, %s %s\n' </span><span class="python_operator">% </span><span class="python_enclosure">(</span><span class="python_name">address</span><span class="python_operator">.</span><span class="python_name">city</span><span class="python_operator">, </span><span class="python_name">address</span><span class="python_operator">.</span><span class="python_name">state</span><span class="python_operator">, </span><span class="python_name">address</span><span class="python_operator">.</span><span class="python_name">postal_code</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
        <span class="python_operator"></span><span class="python_keyword">return </span><span class="python_name">s</span><span class="python_operator">
</span>
<span class="python_operator"></span><span class="python_keyword">class </span><span class="python_name">Preferences</span><span class="python_enclosure">(</span><span class="python_name">ActiveMapper</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">class </span><span class="python_name">mapping</span><span class="python_operator">:
        </span><span class="python_name">__table__        </span><span class="python_operator">= </span><span class="python_literal">'preferences'</span><span class="python_operator">
        </span><span class="python_name">id               </span><span class="python_operator">= </span><span class="python_name">column</span><span class="python_enclosure">(</span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">
        </span><span class="python_name">favorite_color   </span><span class="python_operator">= </span><span class="python_name">column</span><span class="python_enclosure">(</span><span class="python_name">String</span><span class="python_enclosure">)</span><span class="python_operator">
        </span><span class="python_name">personality_type </span><span class="python_operator">= </span><span class="python_name">column</span><span class="python_enclosure">(</span><span class="python_name">String</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_operator"></span><span class="python_keyword">class </span><span class="python_name">Address</span><span class="python_enclosure">(</span><span class="python_name">ActiveMapper</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">class </span><span class="python_name">mapping</span><span class="python_operator">:
        </span><span class="python_name">id          </span><span class="python_operator">= </span><span class="python_name">column</span><span class="python_enclosure">(</span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">
        </span><span class="python_name">type        </span><span class="python_operator">= </span><span class="python_name">column</span><span class="python_enclosure">(</span><span class="python_name">String</span><span class="python_enclosure">)</span><span class="python_operator">
        </span><span class="python_name">address_1   </span><span class="python_operator">= </span><span class="python_name">column</span><span class="python_enclosure">(</span><span class="python_name">String</span><span class="python_enclosure">)</span><span class="python_operator">
        </span><span class="python_name">city        </span><span class="python_operator">= </span><span class="python_name">column</span><span class="python_enclosure">(</span><span class="python_name">String</span><span class="python_enclosure">)</span><span class="python_operator">
        </span><span class="python_name">state       </span><span class="python_operator">= </span><span class="python_name">column</span><span class="python_enclosure">(</span><span class="python_name">String</span><span class="python_enclosure">)</span><span class="python_operator">
        </span><span class="python_name">postal_code </span><span class="python_operator">= </span><span class="python_name">column</span><span class="python_enclosure">(</span><span class="python_name">String</span><span class="python_enclosure">)</span><span class="python_operator">
        </span><span class="python_name">person_id   </span><span class="python_operator">= </span><span class="python_name">column</span><span class="python_enclosure">(</span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">foreign_key</span><span class="python_operator">=</span><span class="python_name">ForeignKey</span><span class="python_enclosure">(</span><span class="python_literal">'person.id'</span><span class="python_enclosure">))</span><span class="python_operator"></span></pre></div>
<p>More discussion on ActiveMapper can be found at <a href='http://cleverdevil.org/computing/35/declarative-mapping-with-sqlalchemy'>Jonathan LaCour's Blog</a> as well as the <a href='http://www.sqlalchemy.org/trac/wiki/ActiveMapper'>SQLAlchemy Wiki</a>.
</p>


    </div>

    <a href="#plugins" class="toclink">back to section top</a>
</div>




<A name="plugins_sqlsoup"></a>

<div class="subsection" style="margin-left:20px;">


<h3>SqlSoup</h3>

    <div class="sectiontext">
    

<p><strong>Author:</strong> Jonathan Ellis
</p>
<p>SqlSoup creates mapped classes on the fly from tables, which are automatically reflected from the database based on name.  It is essentially a nicer version of the "row data gateway" pattern.
</p>


<div class="sliding_code">
<pre><span class="python_literal">>>> </span><span class="python_keyword">from </span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">ext</span><span class="python_operator">.</span><span class="python_name">sqlsoup </span><span class="python_keyword">import </span><span class="python_name">SqlSoup</span><span class="python_operator">
</span><span class="python_literal">>>> </span><span class="python_name">soup </span><span class="python_operator">= </span><span class="python_name">SqlSoup</span><span class="python_enclosure">(</span><span class="python_literal">'sqlite:///'</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_literal">>>> </span><span class="python_name">db</span><span class="python_operator">.</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">order_by</span><span class="python_operator">=</span><span class="python_enclosure">[</span><span class="python_name">db</span><span class="python_operator">.</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">name</span><span class="python_enclosure">])</span><span class="python_operator">
</span><span class="python_enclosure">[</span><span class="python_name">MappedUsers</span><span class="python_enclosure">(</span><span class="python_name">name</span><span class="python_operator">=</span><span class="python_literal">'Bhargan Basepair'</span><span class="python_operator">,</span><span class="python_name">email</span><span class="python_operator">=</span><span class="python_literal">'basepair@example.edu'</span><span class="python_operator">,</span><span class="python_name">password</span><span class="python_operator">=</span><span class="python_literal">'basepair'</span><span class="python_operator">,</span><span class="python_name">classname</span><span class="python_operator">=</span><span class="python_name">None</span><span class="python_operator">,</span><span class="python_name">admin</span><span class="python_operator">=</span><span class="python_number">1</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
 <span class="python_name">MappedUsers</span><span class="python_enclosure">(</span><span class="python_name">name</span><span class="python_operator">=</span><span class="python_literal">'Joe Student'</span><span class="python_operator">,</span><span class="python_name">email</span><span class="python_operator">=</span><span class="python_literal">'student@example.edu'</span><span class="python_operator">,</span><span class="python_name">password</span><span class="python_operator">=</span><span class="python_literal">'student'</span><span class="python_operator">,</span><span class="python_name">classname</span><span class="python_operator">=</span><span class="python_name">None</span><span class="python_operator">,</span><span class="python_name">admin</span><span class="python_operator">=</span><span class="python_number">0</span><span class="python_enclosure">)]</span><span class="python_operator"></span></pre></div>
<p>Full SqlSoup documentation is on the <a href='http://www.sqlalchemy.org/trac/wiki/SqlSoup'>SQLAlchemy Wiki</a>.
</p>


    </div>

    <a href="#plugins" class="toclink">back to section top</a>
</div>




<A name="plugins_proxyengine"></a>

<div class="subsection" style="margin-left:20px;">


<h3>ProxyEngine</h3>

    <div class="sectiontext">
    

<p><strong>Author:</strong> Jason Pellerin
</p>
<p>The <code>ProxyEngine</code> is used to "wrap" an <code>Engine</code>, and via subclassing <code>ProxyEngine</code> one can instrument the functionality of an arbitrary <code>Engine</code> instance through the decorator pattern.  It also provides a <code>connect()</code> method which will send all <code>Engine</code> requests to different underlying engines.  Its functionality in that regard is largely superceded now by <code>DynamicMetaData</code> which is a better solution.
</p>


<div class="sliding_code">
<pre><span class="python_keyword">from </span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">ext</span><span class="python_operator">.</span><span class="python_name">proxy </span><span class="python_keyword">import </span><span class="python_name">ProxyEngine</span><span class="python_operator">
</span><span class="python_name">proxy </span><span class="python_operator">= </span><span class="python_name">ProxyEngine</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_name">proxy</span><span class="python_operator">.</span><span class="python_name">connect</span><span class="python_enclosure">(</span><span class="python_literal">'postgres://user:pw@host/db'</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre></div>



    </div>

</div>



    </div>

    <a href="#plugins" class="toclink">back to section top</a>
</div>


</html></div>
<A name="docstrings"></a>

<div class="sectionnavblock">
<div class="sectionnav">

        Previous: <a href="#plugins">Plugins</a>


</div>
</div>

<div class="topnavmain">
	<div class="topnavheader">Generated Documentation</div>
</div>
<div class="sectioncontent">


    


<A name="docstrings_sqlalchemy.sql"></a>

<div class="subsection" style="margin-left:20px;">


<h3>module sqlalchemy.sql</h3>

    <div class="sectiontext">
    
<p>
    defines the base components of SQL expression trees.
</p>




<A name="docstrings_sqlalchemy.sql_modfunc"></a>

<div class="subsection" style="margin-left:30px;">


<h3>Module Functions</h3>

    <div class="sectiontext">
    
    
            <div class="darkcell">
        <A name=""></a>
        <b>def alias(<i>*args</i>, <i>**params</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def and_(<i>*clauses</i>)</b>
        <div class="docstring">
        <p>
    joins a list of clauses together by the AND operator.  the &amp; operator can be used as well.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def asc(<i>column</i>)</b>
        <div class="docstring">
        <p>
    return an ascending ORDER BY clause element, e.g.:</p>
<p>order_by = [asc(table1.mycol)]</p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def between(<i>ctest</i>, <i>cleft</i>, <i>cright</i>)</b>
        <div class="docstring">
        <p>
     returns BETWEEN predicate clause (clausetest BETWEEN clauseleft AND clauseright).</p>
<p>this is better called off a ColumnElement directly, i.e.</p>
<p>column.between(value1, value2). </p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def bindparam(<i>key</i>, <i>value=None</i>, <i>type=None</i>, <i>shortname=None</i>)</b>
        <div class="docstring">
        <p>
    creates a bind parameter clause with the given key.  </p>
<p>An optional default value can be specified by the value parameter, and the optional type parameter
    is a sqlalchemy.types.TypeEngine object which indicates bind-parameter and result-set translation for
    this bind parameter.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def case(<i>whens</i>, <i>value=None</i>, <i>else_=None</i>)</b>
        <div class="docstring">
        <p>
     SQL CASE statement -- whens are a sequence of pairs to be translated into &quot;when / then&quot; clauses;
        optional [value] for simple case statements, and [else_] for case defaults 
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def cast(<i>clause</i>, <i>totype</i>, <i>**kwargs</i>)</b>
        <div class="docstring">
        <p>
     returns CAST function CAST(clause AS totype) 
        Use with a sqlalchemy.types.TypeEngine object, i.e
        cast(table.c.unit_price * table.c.qty, Numeric(10,4))
         or
        cast(table.c.timestamp, DATE)</p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def column(<i>text</i>, <i>table=None</i>, <i>type=None</i>)</b>
        <div class="docstring">
        <p>
    returns a textual column clause, relative to a table.  this is also the primitive version of
    a schema.Column which is a subclass. 
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def delete(<i>table</i>, <i>whereclause=None</i>, <i>**kwargs</i>)</b>
        <div class="docstring">
        <p>
    returns a DELETE clause element.  </p>
<p>This can also be called from a table directly via the table's delete() method.</p>
<p>'table' is the table to be updated.
    'whereclause' is a ClauseElement describing the WHERE condition of the UPDATE statement.</p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def desc(<i>column</i>)</b>
        <div class="docstring">
        <p>
    return a descending ORDER BY clause element, e.g.:</p>
<p>order_by = [desc(table1.mycol)]</p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def except_(<i>*selects</i>, <i>**params</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def except_all(<i>*selects</i>, <i>**params</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def exists(<i>*args</i>, <i>**params</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def extract(<i>field</i>, <i>expr</i>)</b>
        <div class="docstring">
        <p>
    return extract(field FROM expr)
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def insert(<i>table</i>, <i>values=None</i>, <i>**kwargs</i>)</b>
        <div class="docstring">
        <p>
    returns an INSERT clause element.  </p>
<p>This can also be called from a table directly via the table's insert() method.</p>
<p>'table' is the table to be inserted into.</p>
<p>'values' is a dictionary which specifies the column specifications of the INSERT, 
    and is optional.  If left as None, the column specifications are determined from the 
    bind parameters used during the compile phase of the INSERT statement.  If the 
    bind parameters also are None during the compile phase, then the column
    specifications will be generated from the full list of table columns.</p>
<p>If both 'values' and compile-time bind parameters are present, the compile-time 
    bind parameters override the information specified within 'values' on a per-key basis.</p>
<p>The keys within 'values' can be either Column objects or their string identifiers.  
    Each key may reference one of: a literal data value (i.e. string, number, etc.), a Column object,
    or a SELECT statement.  If a SELECT statement is specified which references this INSERT 
    statement's table, the statement will be correlated against the INSERT statement.  </p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def intersect(<i>*selects</i>, <i>**params</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def intersect_all(<i>*selects</i>, <i>**params</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def join(<i>left</i>, <i>right</i>, <i>onclause=None</i>, <i>**kwargs</i>)</b>
        <div class="docstring">
        <p>
    return a JOIN clause element (regular inner join).</p>
<p>left - the left side of the join
    right - the right side of the join
    onclause - optional criterion for the ON clause, 
    is derived from foreign key relationships otherwise</p>
<p>To chain joins together, use the resulting Join object's 
    &quot;join()&quot; or &quot;outerjoin()&quot; methods.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def literal(<i>value</i>, <i>type=None</i>)</b>
        <div class="docstring">
        <p>
    returns a literal clause, bound to a bind parameter.  </p>
<p>literal clauses are created automatically when used as the right-hand 
    side of a boolean or math operation against a column object.  use this 
    function when a literal is needed on the left-hand side (and optionally on the right as well).</p>
<p>the optional type parameter is a sqlalchemy.types.TypeEngine object which indicates bind-parameter
    and result-set translation for this literal.</p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def not_(<i>clause</i>)</b>
        <div class="docstring">
        <p>
    returns a negation of the given clause, i.e. NOT(clause).  the ~ operator can be used as well.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def null()</b>
        <div class="docstring">
        <p>
    returns a Null object, which compiles to NULL in a sql statement.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def or_(<i>*clauses</i>)</b>
        <div class="docstring">
        <p>
    joins a list of clauses together by the OR operator.  the | operator can be used as well.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def outerjoin(<i>left</i>, <i>right</i>, <i>onclause=None</i>, <i>**kwargs</i>)</b>
        <div class="docstring">
        <p>
    return an OUTER JOIN clause element.</p>
<p>left - the left side of the join
    right - the right side of the join
    onclause - optional criterion for the ON clause, 
    is derived from foreign key relationships otherwise</p>
<p>To chain joins together, use the resulting
    Join object's &quot;join()&quot; or &quot;outerjoin()&quot; methods.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def select(<i>columns=None</i>, <i>whereclause=None</i>, <i>from_obj=[]</i>, <i>**kwargs</i>)</b>
        <div class="docstring">
        <p>
    returns a SELECT clause element.</p>
<p>this can also be called via the table's select() method.</p>
<p>'columns' is a list of columns and/or selectable items to select columns from
    'whereclause' is a text or ClauseElement expression which will form the WHERE clause
    'from_obj' is an list of additional &quot;FROM&quot; objects, such as Join objects, which will 
    extend or override the default &quot;from&quot; objects created from the column list and the 
    whereclause.
    **kwargs - additional parameters for the Select object.</p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def subquery(<i>alias</i>, <i>*args</i>, <i>**kwargs</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def table(<i>name</i>, <i>*columns</i>)</b>
        <div class="docstring">
        <p>
    returns a table clause.  this is a primitive version of the schema.Table object, which is a subclass
    of this object.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def text(<i>text</i>, <i>engine=None</i>, <i>*args</i>, <i>**kwargs</i>)</b>
        <div class="docstring">
        <p>
    creates literal text to be inserted into a query.  </p>
<p>When constructing a query from a select(), update(), insert() or delete(), using 
    plain strings for argument values will usually result in text objects being created
    automatically.  Use this function when creating textual clauses outside of other
    ClauseElement objects, or optionally wherever plain text is to be used.</p>
<p>Arguments include:</p>
<p>text - the text of the SQL statement to be created.  use :&lt;param&gt; to specify
    bind parameters; they will be compiled to their engine-specific format.</p>
<p>engine - an optional engine to be used for this text query.</p>
<p>bindparams - a list of bindparam() instances which can be used to define the
    types and/or initial values for the bind parameters within the textual statement;
    the keynames of the bindparams must match those within the text of the statement.
    The types will be used for pre-processing on bind values.</p>
<p>typemap - a dictionary mapping the names of columns represented in the SELECT
    clause of the textual statement to type objects, which will be used to perform
    post-processing on columns within the result set (for textual statements that 
    produce result sets).
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def union(<i>*selects</i>, <i>**params</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def union_all(<i>*selects</i>, <i>**params</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def update(<i>table</i>, <i>whereclause=None</i>, <i>values=None</i>, <i>**kwargs</i>)</b>
        <div class="docstring">
        <p>
    returns an UPDATE clause element.   </p>
<p>This can also be called from a table directly via the table's update() method.</p>
<p>'table' is the table to be updated.
    'whereclause' is a ClauseElement describing the WHERE condition of the UPDATE statement.
    'values' is a dictionary which specifies the SET conditions of the UPDATE, and is
    optional. If left as None, the SET conditions are determined from the bind parameters
    used during the compile phase of the UPDATE statement.  If the bind parameters also are
    None during the compile phase, then the SET conditions will be generated from the full
    list of table columns.</p>
<p>If both 'values' and compile-time bind parameters are present, the compile-time bind
    parameters override the information specified within 'values' on a per-key basis.</p>
<p>The keys within 'values' can be either Column objects or their string identifiers. Each
    key may reference one of: a literal data value (i.e. string, number, etc.), a Column
    object, or a SELECT statement.  If a SELECT statement is specified which references this
    UPDATE statement's table, the statement will be correlated against the UPDATE statement.</p>
<p></p>
        </div>
        </div>


    </div>

    <a href="#docstrings" class="toclink">back to section top</a>
</div>




      
    


<A name="docstrings_sqlalchemy.sql_AbstractDialect"></a>

<div class="subsection" style="margin-left:30px;">


<h3>class AbstractDialect(object)</h3>

    <div class="sectiontext">
    
<p>
    represents the behavior of a particular database.  Used by Compiled objects.
</p>




    </div>

    <a href="#docstrings" class="toclink">back to section top</a>
</div>



      
    


<A name="docstrings_sqlalchemy.sql_Alias"></a>

<div class="subsection" style="margin-left:30px;">


<h3>class Alias(<a href="docstrings.html#docstrings_sqlalchemy.sql_FromClause">FromClause</a>)</h3>

    <div class="sectiontext">
    
<p></p>
<p></p>


    
            <div class="darkcell">
        <A name=""></a>
        <b>def __init__(<i>self</i>, <i>selectable</i>, <i>alias=None</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def accept_visitor(<i>self</i>, <i>visitor</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
             <div class="darkcell">
         <A name=""></a>
         <b>engine = property()</b>
         <div class="docstring">
         <p></p>
<p></p>
         </div> 
         </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def named_with_column(<i>self</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>



    </div>

    <a href="#docstrings" class="toclink">back to section top</a>
</div>



      
    


<A name="docstrings_sqlalchemy.sql_ClauseElement"></a>

<div class="subsection" style="margin-left:30px;">


<h3>class ClauseElement(object)</h3>

    <div class="sectiontext">
    
<p>
    base class for elements of a programmatically constructed SQL expression.
</p>


    
            <div class="darkcell">
        <A name=""></a>
        <b>def accept_visitor(<i>self</i>, <i>visitor</i>)</b>
        <div class="docstring">
        <p>
    accept a ClauseVisitor and call the appropriate visit_xxx method.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def compare(<i>self</i>, <i>other</i>)</b>
        <div class="docstring">
        <p>
    compare this ClauseElement to the given ClauseElement.</p>
<p>Subclasses should override the default behavior, which is a straight
        identity comparison.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def compile(<i>self</i>, <i>engine=None</i>, <i>parameters=None</i>, <i>compiler=None</i>, <i>dialect=None</i>)</b>
        <div class="docstring">
        <p>
    compile this SQL expression.</p>
<p>Uses the given Compiler, or the given AbstractDialect or Engine to create a Compiler.  If no compiler
        arguments are given, tries to use the underlying Engine this ClauseElement is bound
        to to create a Compiler, if any.  Finally, if there is no bound Engine, uses an ANSIDialect
        to create a default Compiler.</p>
<p>bindparams is a dictionary representing the default bind parameters to be used with 
        the statement.  if the bindparams is a list, it is assumed to be a list of dictionaries
        and the first dictionary in the list is used with which to compile against.
        The bind parameters can in some cases determine the output of the compilation, such as for UPDATE
        and INSERT statements the bind parameters that are present determine the SET and VALUES clause of 
        those statements.</p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def copy_container(<i>self</i>)</b>
        <div class="docstring">
        <p>
    return a copy of this ClauseElement, iff this ClauseElement contains other ClauseElements.  </p>
<p>If this ClauseElement is not a container, it should return self.  This is used to
        create copies of expression trees that still reference the same &quot;leaf nodes&quot;.  The
        new structure can then be restructured without affecting the original.
</p>
        </div>
        </div>

    
             <div class="darkcell">
         <A name=""></a>
         <b>engine = property()</b>
         <div class="docstring">
         <p>
    attempts to locate a Engine within this ClauseElement structure, or returns None if none found.
</p>
         </div> 
         </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def execute(<i>self</i>, <i>*multiparams</i>, <i>**params</i>)</b>
        <div class="docstring">
        <p>
    compile and execute this ClauseElement.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def scalar(<i>self</i>, <i>*multiparams</i>, <i>**params</i>)</b>
        <div class="docstring">
        <p>
    compile and execute this ClauseElement, returning the result's scalar representation.
</p>
        </div>
        </div>



    </div>

    <a href="#docstrings" class="toclink">back to section top</a>
</div>



      
    


<A name="docstrings_sqlalchemy.sql_ClauseParameters"></a>

<div class="subsection" style="margin-left:30px;">


<h3>class ClauseParameters(dict)</h3>

    <div class="sectiontext">
    
<p>
    represents a dictionary/iterator of bind parameter key names/values.  </p>
<p>Tracks the original BindParam objects as well as the keys/position of each
    parameter, and can return parameters as a dictionary or a list.
    Will process parameter values according to the TypeEngine objects present in
    the BindParams.</p>
<p></p>


    
            <div class="darkcell">
        <A name=""></a>
        <b>def __init__(<i>self</i>, <i>dialect</i>, <i>positional=None</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def get_original(<i>self</i>, <i>key</i>)</b>
        <div class="docstring">
        <p>
    returns the given parameter as it was originally placed in this ClauseParameters object, without any Type conversion
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def get_original_dict(<i>self</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def get_raw_dict(<i>self</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def get_raw_list(<i>self</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def set_parameter(<i>self</i>, <i>bindparam</i>, <i>value</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>



    </div>

    <a href="#docstrings" class="toclink">back to section top</a>
</div>



      
    


<A name="docstrings_sqlalchemy.sql_ClauseVisitor"></a>

<div class="subsection" style="margin-left:30px;">


<h3>class ClauseVisitor(object)</h3>

    <div class="sectiontext">
    
<p>
    Defines the visiting of ClauseElements.
</p>


    
            <div class="darkcell">
        <A name=""></a>
        <b>def visit_alias(<i>self</i>, <i>alias</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def visit_binary(<i>self</i>, <i>binary</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def visit_bindparam(<i>self</i>, <i>bindparam</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def visit_calculatedclause(<i>self</i>, <i>calcclause</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def visit_cast(<i>self</i>, <i>cast</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def visit_clauselist(<i>self</i>, <i>list</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def visit_column(<i>self</i>, <i>column</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def visit_compound(<i>self</i>, <i>compound</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def visit_compound_select(<i>self</i>, <i>compound</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def visit_fromclause(<i>self</i>, <i>fromclause</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def visit_function(<i>self</i>, <i>func</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def visit_join(<i>self</i>, <i>join</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def visit_label(<i>self</i>, <i>label</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def visit_null(<i>self</i>, <i>null</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def visit_select(<i>self</i>, <i>select</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def visit_table(<i>self</i>, <i>column</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def visit_textclause(<i>self</i>, <i>textclause</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def visit_typeclause(<i>self</i>, <i>typeclause</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>



    </div>

    <a href="#docstrings" class="toclink">back to section top</a>
</div>



      
    


<A name="docstrings_sqlalchemy.sql_ColumnCollection"></a>

<div class="subsection" style="margin-left:30px;">


<h3>class ColumnCollection(OrderedProperties)</h3>

    <div class="sectiontext">
    
<p>
    an ordered dictionary that stores a list of ColumnElement instances.</p>
<p>overrides the __eq__() method to produce SQL clauses between sets of
    correlated columns.
</p>


    
            <div class="darkcell">
        <A name=""></a>
        <b>def add(<i>self</i>, <i>column</i>)</b>
        <div class="docstring">
        <p>
    add a column to this collection.</p>
<p>the key attribute of the column will be used as the hash key for this
        dictionary.
</p>
        </div>
        </div>



    </div>

    <a href="#docstrings" class="toclink">back to section top</a>
</div>



      
    


<A name="docstrings_sqlalchemy.sql_ColumnElement"></a>

<div class="subsection" style="margin-left:30px;">


<h3>class ColumnElement(<a href="docstrings.html#docstrings_sqlalchemy.sql_Selectable">Selectable</a>,_CompareMixin)</h3>

    <div class="sectiontext">
    
<p>
    represents a column element within the list of a Selectable's columns.
    A ColumnElement can either be directly associated with a TableClause, or
    a free-standing textual column with no table, or is a &quot;proxy&quot; column, indicating
    it is placed on a Selectable such as an Alias or Select statement and ultimately corresponds 
    to a TableClause-attached column (or in the case of a CompositeSelect, a proxy ColumnElement
    may correspond to several TableClause-attached columns).
</p>


    
             <div class="darkcell">
         <A name=""></a>
         <b>columns = property()</b>
         <div class="docstring">
         <p>
    Columns accessor which just returns self, to provide compatibility with Selectable objects.
</p>
         </div> 
         </div>

    
             <div class="darkcell">
         <A name=""></a>
         <b>foreign_key = property()</b>
         <div class="docstring">
         <p></p>
<p></p>
         </div> 
         </div>

    
             <div class="darkcell">
         <A name=""></a>
         <b>foreign_keys = property()</b>
         <div class="docstring">
         <p>
    foreign key accessor.  points to a ForeignKey object which represents a Foreign Key placed on this column's ultimate ancestor.
</p>
         </div> 
         </div>

    
             <div class="darkcell">
         <A name=""></a>
         <b>orig_set = property()</b>
         <div class="docstring">
         <p>
    a Set containing TableClause-bound, non-proxied ColumnElements for which this ColumnElement is a proxy.  In all cases except for a column proxied from a Union (i.e. CompoundSelect), this set will be just one element.
</p>
         </div> 
         </div>

    
             <div class="darkcell">
         <A name=""></a>
         <b>primary_key = property()</b>
         <div class="docstring">
         <p>
    primary key flag.  indicates if this Column represents part or whole of a primary key.
</p>
         </div> 
         </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def shares_lineage(<i>self</i>, <i>othercolumn</i>)</b>
        <div class="docstring">
        <p>
    returns True if the given ColumnElement has a common ancestor to this ColumnElement.
</p>
        </div>
        </div>



    </div>

    <a href="#docstrings" class="toclink">back to section top</a>
</div>



      
    


<A name="docstrings_sqlalchemy.sql_Compiled"></a>

<div class="subsection" style="margin-left:30px;">


<h3>class Compiled(<a href="docstrings.html#docstrings_sqlalchemy.sql_ClauseVisitor">ClauseVisitor</a>)</h3>

    <div class="sectiontext">
    
<p>
    represents a compiled SQL expression.  the __str__ method of the Compiled object
    should produce the actual text of the statement.  Compiled objects are specific to the
    database library that created them, and also may or may not be specific to the columns
    referenced within a particular set of bind parameters.  In no case should the Compiled
    object be dependent on the actual values of those bind parameters, even though it may
    reference those values as defaults.
</p>


    
            <div class="darkcell">
        <A name=""></a>
        <b>def __init__(<i>self</i>, <i>dialect</i>, <i>statement</i>, <i>parameters</i>, <i>engine=None</i>)</b>
        <div class="docstring">
        <p>
    construct a new Compiled object.</p>
<p>statement - ClauseElement to be compiled</p>
<p>parameters - optional dictionary indicating a set of bind parameters
        specified with this Compiled object.  These parameters are the &quot;default&quot;
        values corresponding to the ClauseElement's _BindParamClauses when the Compiled 
        is executed.   In the case of an INSERT or UPDATE statement, these parameters 
        will also result in the creation of new _BindParamClause objects for each key
        and will also affect the generated column list in an INSERT statement and the SET 
        clauses of an UPDATE statement.  The keys of the parameter dictionary can
        either be the string names of columns or _ColumnClause objects.</p>
<p>engine - optional Engine to compile this statement against
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def compile(<i>self</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def execute(<i>self</i>, <i>*multiparams</i>, <i>**params</i>)</b>
        <div class="docstring">
        <p>
    execute this compiled object.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def get_params(<i>self</i>, <i>**params</i>)</b>
        <div class="docstring">
        <p>
    returns the bind params for this compiled object.</p>
<p>Will start with the default parameters specified when this Compiled object
        was first constructed, and will override those values with those sent via
        **params, which are key/value pairs.  Each key should match one of the 
        _BindParamClause objects compiled into this object; either the &quot;key&quot; or 
        &quot;shortname&quot; property of the _BindParamClause.</p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def scalar(<i>self</i>, <i>*multiparams</i>, <i>**params</i>)</b>
        <div class="docstring">
        <p>
    execute this compiled object and return the result's scalar value.
</p>
        </div>
        </div>



    </div>

    <a href="#docstrings" class="toclink">back to section top</a>
</div>



      
    


<A name="docstrings_sqlalchemy.sql_CompoundSelect"></a>

<div class="subsection" style="margin-left:30px;">


<h3>class CompoundSelect(_SelectBaseMixin,<a href="docstrings.html#docstrings_sqlalchemy.sql_FromClause">FromClause</a>)</h3>

    <div class="sectiontext">
    
<p></p>
<p></p>


    
            <div class="darkcell">
        <A name=""></a>
        <b>def __init__(<i>self</i>, <i>keyword</i>, <i>*selects</i>, <i>**kwargs</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def accept_visitor(<i>self</i>, <i>visitor</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
             <div class="darkcell">
         <A name=""></a>
         <b>name = property()</b>
         <div class="docstring">
         <p></p>
<p></p>
         </div> 
         </div>



    </div>

    <a href="#docstrings" class="toclink">back to section top</a>
</div>



      
    


<A name="docstrings_sqlalchemy.sql_Executor"></a>

<div class="subsection" style="margin-left:30px;">


<h3>class Executor(object)</h3>

    <div class="sectiontext">
    
<p>
    represents a 'thing that can produce Compiled objects and execute them'.
</p>


    
            <div class="darkcell">
        <A name=""></a>
        <b>def compiler(<i>self</i>, <i>statement</i>, <i>parameters</i>, <i>**kwargs</i>)</b>
        <div class="docstring">
        <p>
    return a Compiled object for the given statement and parameters.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def execute_compiled(<i>self</i>, <i>compiled</i>, <i>parameters</i>, <i>echo=None</i>, <i>**kwargs</i>)</b>
        <div class="docstring">
        <p>
    execute a Compiled object.
</p>
        </div>
        </div>



    </div>

    <a href="#docstrings" class="toclink">back to section top</a>
</div>



      
    


<A name="docstrings_sqlalchemy.sql_FromClause"></a>

<div class="subsection" style="margin-left:30px;">


<h3>class FromClause(<a href="docstrings.html#docstrings_sqlalchemy.sql_Selectable">Selectable</a>)</h3>

    <div class="sectiontext">
    
<p>
    represents an element that can be used within the FROM clause of a SELECT statement.
</p>


    
            <div class="darkcell">
        <A name=""></a>
        <b>def __init__(<i>self</i>, <i>name=None</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def accept_visitor(<i>self</i>, <i>visitor</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def alias(<i>self</i>, <i>name=None</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
             <div class="darkcell">
         <A name=""></a>
         <b>c = property()</b>
         <div class="docstring">
         <p></p>
<p></p>
         </div> 
         </div>

    
             <div class="darkcell">
         <A name=""></a>
         <b>columns = property()</b>
         <div class="docstring">
         <p></p>
<p></p>
         </div> 
         </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def corresponding_column(<i>self</i>, <i>column</i>, <i>raiseerr=True</i>, <i>keys_ok=False</i>)</b>
        <div class="docstring">
        <p>
    given a ColumnElement, return the ColumnElement object from this 
        Selectable which corresponds to that original Column via a proxy relationship.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def count(<i>self</i>, <i>whereclause=None</i>, <i>**params</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def default_order_by(<i>self</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
             <div class="darkcell">
         <A name=""></a>
         <b>foreign_keys = property()</b>
         <div class="docstring">
         <p></p>
<p></p>
         </div> 
         </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def join(<i>self</i>, <i>right</i>, <i>*args</i>, <i>**kwargs</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def named_with_column(<i>self</i>)</b>
        <div class="docstring">
        <p>
    True if the name of this FromClause may be prepended to a column in a generated SQL statement
</p>
        </div>
        </div>

    
             <div class="darkcell">
         <A name=""></a>
         <b>oid_column = property()</b>
         <div class="docstring">
         <p></p>
<p></p>
         </div> 
         </div>

    
             <div class="darkcell">
         <A name=""></a>
         <b>original_columns = property()</b>
         <div class="docstring">
         <p>
    a dictionary mapping an original Table-bound column to a proxied column in this FromClause.
</p>
         </div> 
         </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def outerjoin(<i>self</i>, <i>right</i>, <i>*args</i>, <i>**kwargs</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
             <div class="darkcell">
         <A name=""></a>
         <b>primary_key = property()</b>
         <div class="docstring">
         <p></p>
<p></p>
         </div> 
         </div>



    </div>

    <a href="#docstrings" class="toclink">back to section top</a>
</div>



      
    


<A name="docstrings_sqlalchemy.sql_Join"></a>

<div class="subsection" style="margin-left:30px;">


<h3>class Join(<a href="docstrings.html#docstrings_sqlalchemy.sql_FromClause">FromClause</a>)</h3>

    <div class="sectiontext">
    
<p></p>
<p></p>


    
            <div class="darkcell">
        <A name=""></a>
        <b>def __init__(<i>self</i>, <i>left</i>, <i>right</i>, <i>onclause=None</i>, <i>isouter=False</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def accept_visitor(<i>self</i>, <i>visitor</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def alias(<i>self</i>, <i>name=None</i>)</b>
        <div class="docstring">
        <p>
    creates a Select out of this Join clause and returns an Alias of it.  The Select is not correlating.
</p>
        </div>
        </div>

    
             <div class="darkcell">
         <A name=""></a>
         <b>engine = property()</b>
         <div class="docstring">
         <p></p>
<p></p>
         </div> 
         </div>

    
             <div class="darkcell">
         <A name=""></a>
         <b>name = property()</b>
         <div class="docstring">
         <p></p>
<p></p>
         </div> 
         </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def select(<i>self</i>, <i>whereclauses=None</i>, <i>**params</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>



    </div>

    <a href="#docstrings" class="toclink">back to section top</a>
</div>



      
    


<A name="docstrings_sqlalchemy.sql_Select"></a>

<div class="subsection" style="margin-left:30px;">


<h3>class Select(_SelectBaseMixin,<a href="docstrings.html#docstrings_sqlalchemy.sql_FromClause">FromClause</a>)</h3>

    <div class="sectiontext">
    
<p>
    represents a SELECT statement, with appendable clauses, as well as 
    the ability to execute itself and return a result set.
</p>


    
            <div class="darkcell">
        <A name=""></a>
        <b>def __init__(<i>self</i>, <i>columns=None</i>, <i>whereclause=None</i>, <i>from_obj=[]</i>, <i>order_by=None</i>, <i>group_by=None</i>, <i>having=None</i>, <i>use_labels=False</i>, <i>distinct=False</i>, <i>for_update=False</i>, <i>engine=None</i>, <i>limit=None</i>, <i>offset=None</i>, <i>scalar=False</i>, <i>correlate=True</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def accept_visitor(<i>self</i>, <i>visitor</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def append_column(<i>self</i>, <i>column</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def append_from(<i>self</i>, <i>fromclause</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def append_having(<i>self</i>, <i>having</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def append_whereclause(<i>self</i>, <i>whereclause</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def correlate(<i>self</i>, <i>from_obj</i>)</b>
        <div class="docstring">
        <p>
    given a FROM object, correlate this SELECT statement to it.  </p>
<p>this basically means the given from object will not come out in this select statement's FROM 
        clause when printed.
</p>
        </div>
        </div>

    
             <div class="darkcell">
         <A name=""></a>
         <b>froms = property()</b>
         <div class="docstring">
         <p>
    a collection containing all elements of the FROM clause
</p>
         </div> 
         </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def label(<i>self</i>, <i>name</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def union(<i>self</i>, <i>other</i>, <i>**kwargs</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def union_all(<i>self</i>, <i>other</i>, <i>**kwargs</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>



    </div>

    <a href="#docstrings" class="toclink">back to section top</a>
</div>



      
    


<A name="docstrings_sqlalchemy.sql_Selectable"></a>

<div class="subsection" style="margin-left:30px;">


<h3>class Selectable(<a href="docstrings.html#docstrings_sqlalchemy.sql_ClauseElement">ClauseElement</a>)</h3>

    <div class="sectiontext">
    
<p>
    represents a column list-holding object.
</p>


    
            <div class="darkcell">
        <A name=""></a>
        <b>def accept_visitor(<i>self</i>, <i>visitor</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def select(<i>self</i>, <i>whereclauses=None</i>, <i>**params</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>



    </div>

    <a href="#docstrings" class="toclink">back to section top</a>
</div>



      
    


<A name="docstrings_sqlalchemy.sql_TableClause"></a>

<div class="subsection" style="margin-left:30px;">


<h3>class TableClause(<a href="docstrings.html#docstrings_sqlalchemy.sql_FromClause">FromClause</a>)</h3>

    <div class="sectiontext">
    
<p></p>
<p></p>


    
            <div class="darkcell">
        <A name=""></a>
        <b>def __init__(<i>self</i>, <i>name</i>, <i>*columns</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def accept_visitor(<i>self</i>, <i>visitor</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def alias(<i>self</i>, <i>name=None</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def append_column(<i>self</i>, <i>c</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def count(<i>self</i>, <i>whereclause=None</i>, <i>**params</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def delete(<i>self</i>, <i>whereclause=None</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def insert(<i>self</i>, <i>values=None</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def join(<i>self</i>, <i>right</i>, <i>*args</i>, <i>**kwargs</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def named_with_column(<i>self</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
             <div class="darkcell">
         <A name=""></a>
         <b>original_columns = property()</b>
         <div class="docstring">
         <p></p>
<p></p>
         </div> 
         </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def outerjoin(<i>self</i>, <i>right</i>, <i>*args</i>, <i>**kwargs</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def select(<i>self</i>, <i>whereclause=None</i>, <i>**params</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def update(<i>self</i>, <i>whereclause=None</i>, <i>values=None</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>



    </div>

</div>




    </div>

    <a href="#docstrings" class="toclink">back to section top</a>
</div>




    


<A name="docstrings_sqlalchemy.schema"></a>

<div class="subsection" style="margin-left:20px;">


<h3>module sqlalchemy.schema</h3>

    <div class="sectiontext">
    
<p>
    the schema module provides the building blocks for database metadata.  This means
all the entities within a SQL database that we might want to look at, modify, or create
and delete are described by these objects, in a database-agnostic way.   </p>
<p>A structure of SchemaItems also provides a &quot;visitor&quot; interface which is the primary 
method by which other methods operate upon the schema.  The SQL package extends this
structure with its own clause-specific objects as well as the visitor interface, so that
the schema package &quot;plugs in&quot; to the SQL package.</p>
<p></p>



      
    


<A name="docstrings_sqlalchemy.schema_BoundMetaData"></a>

<div class="subsection" style="margin-left:30px;">


<h3>class BoundMetaData(<a href="docstrings.html#docstrings_sqlalchemy.schema_MetaData">MetaData</a>)</h3>

    <div class="sectiontext">
    
<p>
    builds upon MetaData to provide the capability to bind to an Engine implementation.
</p>


    
            <div class="darkcell">
        <A name=""></a>
        <b>def __init__(<i>self</i>, <i>engine_or_url</i>, <i>name=None</i>, <i>**kwargs</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def is_bound(<i>self</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>



    </div>

    <a href="#docstrings" class="toclink">back to section top</a>
</div>



      
    


<A name="docstrings_sqlalchemy.schema_CheckConstraint"></a>

<div class="subsection" style="margin-left:30px;">


<h3>class CheckConstraint(<a href="docstrings.html#docstrings_sqlalchemy.schema_Constraint">Constraint</a>)</h3>

    <div class="sectiontext">
    
<p></p>
<p></p>


    
            <div class="darkcell">
        <A name=""></a>
        <b>def __init__(<i>self</i>, <i>sqltext</i>, <i>name=None</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def accept_schema_visitor(<i>self</i>, <i>visitor</i>, <i>traverse=True</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>



    </div>

    <a href="#docstrings" class="toclink">back to section top</a>
</div>



      
    


<A name="docstrings_sqlalchemy.schema_Column"></a>

<div class="subsection" style="margin-left:30px;">


<h3>class Column(<a href="docstrings.html#docstrings_sqlalchemy.schema_SchemaItem">SchemaItem</a>,_ColumnClause)</h3>

    <div class="sectiontext">
    
<p>
    represents a column in a database table.  this is a subclass of sql.ColumnClause and
    represents an actual existing table in the database, in a similar fashion as TableClause/Table.
</p>


    
            <div class="darkcell">
        <A name=""></a>
        <b>def __init__(<i>self</i>, <i>name</i>, <i>type</i>, <i>*args</i>, <i>**kwargs</i>)</b>
        <div class="docstring">
        <p>
    constructs a new Column object.  Arguments are:</p>
<p>name : the name of this column.  this should be the identical name as it appears,
        or will appear, in the database.</p>
<p>type: the TypeEngine for this column.
        This can be any subclass of types.AbstractType, including the database-agnostic types defined 
        in the types module, database-specific types defined within specific database modules, or user-defined types.</p>
<p>type: the TypeEngine for this column. This can be any subclass of types.AbstractType, including 
        the database-agnostic types defined in the types module, database-specific types defined within 
        specific database modules, or user-defined types. If the column contains a ForeignKey, 
        the type can also be None, in which case the type assigned will be that of the referenced column.</p>
<p>*args: Constraint, ForeignKey, ColumnDefault and Sequence objects should be added as list values.</p>
<p>**kwargs : keyword arguments include:</p>
<p>key=None : an optional &quot;alias name&quot; for this column.  The column will then be identified everywhere
        in an application, including the column list on its Table, by this key, and not the given name.  
        Generated SQL, however, will still reference the column by its actual name.</p>
<p>primary_key=False : True if this column is a primary key column.  Multiple columns can have this flag
        set to specify composite primary keys.  As an alternative, the primary key of a Table can be specified
        via an explicit PrimaryKeyConstraint instance appended to the Table's list of objects.</p>
<p>nullable=True : True if this column should allow nulls. Defaults to True unless this column is a primary
        key column.</p>
<p>default=None : a scalar, python callable, or ClauseElement representing the &quot;default value&quot; for this column,
        which will be invoked upon insert if this column is not present in the insert list or is given a value
        of None.  The default expression will be converted into a ColumnDefault object upon initialization.</p>
<p>_is_oid=False : used internally to indicate that this column is used as the quasi-hidden &quot;oid&quot; column</p>
<p>index=False : Indicates that this column is
        indexed. The name of the index is autogenerated.
        to specify indexes with explicit names or indexes that contain multiple 
        columns, use the Index construct instead.</p>
<p>unique=False : Indicates that this column 
        contains a unique constraint, or if index=True as well, indicates
        that the Index should be created with the unique flag.
        To specify multiple columns in the constraint/index or to specify an 
        explicit name, use the UniqueConstraint or Index constructs instead.</p>
<p>autoincrement=True : Indicates that integer-based primary key columns should have autoincrementing behavior,
        if supported by the underlying database.  This will affect CREATE TABLE statements such that they will
        use the databases &quot;auto-incrementing&quot; keyword (such as SERIAL for postgres, AUTO_INCREMENT for mysql) and will
        also affect the behavior of some dialects during INSERT statement execution such that they will assume primary 
        key values are created in this manner.  If a Column has an explicit ColumnDefault object (such as via the 
        &quot;default&quot; keyword, or a Sequence or PassiveDefault), then the value of autoincrement is ignored and is assumed 
        to be False.  autoincrement value is only significant for a column with a type or subtype of Integer.</p>
<p>quote=False : indicates that the Column identifier must be properly escaped and quoted before being sent 
        to the database.  This flag should normally not be required as dialects can auto-detect conditions where quoting
        is required.</p>
<p>case_sensitive=True : indicates that the identifier should be interpreted by the database in the natural case for identifiers.
        Mixed case is not sufficient to cause this identifier to be quoted; it must contain an illegal character.</p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def accept_schema_visitor(<i>self</i>, <i>visitor</i>, <i>traverse=True</i>)</b>
        <div class="docstring">
        <p>
    traverses the given visitor to this Column's default and foreign key object,
        then calls visit_column on the visitor.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def append_foreign_key(<i>self</i>, <i>fk</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
             <div class="darkcell">
         <A name=""></a>
         <b>case_sensitive = property()</b>
         <div class="docstring">
         <p></p>
<p></p>
         </div> 
         </div>

    
             <div class="darkcell">
         <A name=""></a>
         <b>columns = property()</b>
         <div class="docstring">
         <p></p>
<p></p>
         </div> 
         </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def copy(<i>self</i>)</b>
        <div class="docstring">
        <p>
    creates a copy of this Column, unitialized.  this is used in Table.tometadata.
</p>
        </div>
        </div>



    </div>

    <a href="#docstrings" class="toclink">back to section top</a>
</div>



      
    


<A name="docstrings_sqlalchemy.schema_ColumnDefault"></a>

<div class="subsection" style="margin-left:30px;">


<h3>class ColumnDefault(<a href="docstrings.html#docstrings_sqlalchemy.schema_DefaultGenerator">DefaultGenerator</a>)</h3>

    <div class="sectiontext">
    
<p>
    A plain default value on a column.  this could correspond to a constant, 
    a callable function, or a SQL clause.
</p>


    
            <div class="darkcell">
        <A name=""></a>
        <b>def __init__(<i>self</i>, <i>arg</i>, <i>**kwargs</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def accept_schema_visitor(<i>self</i>, <i>visitor</i>, <i>traverse=True</i>)</b>
        <div class="docstring">
        <p>
    calls the visit_column_default method on the given visitor.
</p>
        </div>
        </div>



    </div>

    <a href="#docstrings" class="toclink">back to section top</a>
</div>



      
    


<A name="docstrings_sqlalchemy.schema_Constraint"></a>

<div class="subsection" style="margin-left:30px;">


<h3>class Constraint(<a href="docstrings.html#docstrings_sqlalchemy.schema_SchemaItem">SchemaItem</a>)</h3>

    <div class="sectiontext">
    
<p>
    represents a table-level Constraint such as a composite primary key, foreign key, or unique constraint.</p>
<p>Implements a hybrid of dict/setlike behavior with regards to the list of underying columns
</p>


    
            <div class="darkcell">
        <A name=""></a>
        <b>def __init__(<i>self</i>, <i>name=None</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def copy(<i>self</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def keys(<i>self</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>



    </div>

    <a href="#docstrings" class="toclink">back to section top</a>
</div>



      
    


<A name="docstrings_sqlalchemy.schema_DefaultGenerator"></a>

<div class="subsection" style="margin-left:30px;">


<h3>class DefaultGenerator(<a href="docstrings.html#docstrings_sqlalchemy.schema_SchemaItem">SchemaItem</a>)</h3>

    <div class="sectiontext">
    
<p>
    Base class for column &quot;default&quot; values.
</p>


    
            <div class="darkcell">
        <A name=""></a>
        <b>def __init__(<i>self</i>, <i>for_update=False</i>, <i>metadata=None</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def execute(<i>self</i>, <i>**kwargs</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>



    </div>

    <a href="#docstrings" class="toclink">back to section top</a>
</div>



      
    


<A name="docstrings_sqlalchemy.schema_DynamicMetaData"></a>

<div class="subsection" style="margin-left:30px;">


<h3>class DynamicMetaData(<a href="docstrings.html#docstrings_sqlalchemy.schema_MetaData">MetaData</a>)</h3>

    <div class="sectiontext">
    
<p>
    builds upon MetaData to provide the capability to bind to multiple Engine implementations
    on a dynamically alterable, thread-local basis.
</p>


    
            <div class="darkcell">
        <A name=""></a>
        <b>def __init__(<i>self</i>, <i>name=None</i>, <i>threadlocal=True</i>, <i>**kwargs</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def connect(<i>self</i>, <i>engine_or_url</i>, <i>**kwargs</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def dispose(<i>self</i>)</b>
        <div class="docstring">
        <p>
    disposes all Engines to which this DynamicMetaData has been connected.
</p>
        </div>
        </div>

    
             <div class="darkcell">
         <A name=""></a>
         <b>engine = property()</b>
         <div class="docstring">
         <p></p>
<p></p>
         </div> 
         </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def is_bound(<i>self</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>



    </div>

    <a href="#docstrings" class="toclink">back to section top</a>
</div>



      
    


<A name="docstrings_sqlalchemy.schema_ForeignKey"></a>

<div class="subsection" style="margin-left:30px;">


<h3>class ForeignKey(<a href="docstrings.html#docstrings_sqlalchemy.schema_SchemaItem">SchemaItem</a>)</h3>

    <div class="sectiontext">
    
<p>
    defines a column-level ForeignKey constraint between two columns.  </p>
<p>ForeignKey is specified as an argument to a Column object.</p>
<p>One or more ForeignKey objects are used within a ForeignKeyConstraint
    object which represents the table-level constraint definition.
</p>


    
            <div class="darkcell">
        <A name=""></a>
        <b>def __init__(<i>self</i>, <i>column</i>, <i>constraint=None</i>, <i>use_alter=False</i>, <i>name=None</i>, <i>onupdate=None</i>, <i>ondelete=None</i>)</b>
        <div class="docstring">
        <p>
    Construct a new ForeignKey object.  </p>
<p>&quot;column&quot; can be a schema.Column object representing the relationship, 
        or just its string name given as &quot;tablename.columnname&quot;.  schema can be 
        specified as &quot;schema.tablename.columnname&quot; </p>
<p>&quot;constraint&quot; is the owning ForeignKeyConstraint object, if any.  if not given,
        then a ForeignKeyConstraint will be automatically created and added to the parent table.</p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def accept_schema_visitor(<i>self</i>, <i>visitor</i>, <i>traverse=True</i>)</b>
        <div class="docstring">
        <p>
    calls the visit_foreign_key method on the given visitor.
</p>
        </div>
        </div>

    
             <div class="darkcell">
         <A name=""></a>
         <b>column = property()</b>
         <div class="docstring">
         <p></p>
<p></p>
         </div> 
         </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def copy(<i>self</i>)</b>
        <div class="docstring">
        <p>
    produce a copy of this ForeignKey object.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def references(<i>self</i>, <i>table</i>)</b>
        <div class="docstring">
        <p>
    returns True if the given table is referenced by this ForeignKey.
</p>
        </div>
        </div>



    </div>

    <a href="#docstrings" class="toclink">back to section top</a>
</div>



      
    


<A name="docstrings_sqlalchemy.schema_ForeignKeyConstraint"></a>

<div class="subsection" style="margin-left:30px;">


<h3>class ForeignKeyConstraint(<a href="docstrings.html#docstrings_sqlalchemy.schema_Constraint">Constraint</a>)</h3>

    <div class="sectiontext">
    
<p>
    table-level foreign key constraint, represents a colleciton of ForeignKey objects.
</p>


    
            <div class="darkcell">
        <A name=""></a>
        <b>def __init__(<i>self</i>, <i>columns</i>, <i>refcolumns</i>, <i>name=None</i>, <i>onupdate=None</i>, <i>ondelete=None</i>, <i>use_alter=False</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def accept_schema_visitor(<i>self</i>, <i>visitor</i>, <i>traverse=True</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def append_element(<i>self</i>, <i>col</i>, <i>refcol</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def copy(<i>self</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>



    </div>

    <a href="#docstrings" class="toclink">back to section top</a>
</div>



      
    


<A name="docstrings_sqlalchemy.schema_Index"></a>

<div class="subsection" style="margin-left:30px;">


<h3>class Index(<a href="docstrings.html#docstrings_sqlalchemy.schema_SchemaItem">SchemaItem</a>)</h3>

    <div class="sectiontext">
    
<p>
    Represents an index of columns from a database table</p>
<p></p>


    
            <div class="darkcell">
        <A name=""></a>
        <b>def __init__(<i>self</i>, <i>name</i>, <i>*columns</i>, <i>**kwargs</i>)</b>
        <div class="docstring">
        <p>
    Constructs an index object. Arguments are:</p>
<p>name : the name of the index</p>
<p>*columns : columns to include in the index. All columns must belong to
        the same table, and no column may appear more than once.</p>
<p>**kw : keyword arguments include:</p>
<p>unique=True : create a unique index</p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def accept_schema_visitor(<i>self</i>, <i>visitor</i>, <i>traverse=True</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def append_column(<i>self</i>, <i>column</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def create(<i>self</i>, <i>connectable=None</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def drop(<i>self</i>, <i>connectable=None</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>



    </div>

    <a href="#docstrings" class="toclink">back to section top</a>
</div>



      
    


<A name="docstrings_sqlalchemy.schema_MetaData"></a>

<div class="subsection" style="margin-left:30px;">


<h3>class MetaData(<a href="docstrings.html#docstrings_sqlalchemy.schema_SchemaItem">SchemaItem</a>)</h3>

    <div class="sectiontext">
    
<p>
    represents a collection of Tables and their associated schema constructs.
</p>


    
            <div class="darkcell">
        <A name=""></a>
        <b>def __init__(<i>self</i>, <i>name=None</i>, <i>**kwargs</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def accept_schema_visitor(<i>self</i>, <i>visitor</i>, <i>traverse=True</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def clear(<i>self</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def create_all(<i>self</i>, <i>connectable=None</i>, <i>tables=None</i>, <i>checkfirst=True</i>)</b>
        <div class="docstring">
        <p>
    create all tables stored in this metadata.</p>
<p>This will conditionally create tables depending on if they do not yet
        exist in the database.</p>
<p>connectable - a Connectable used to access the database; or use the engine
        bound to this MetaData.</p>
<p>tables - optional list of tables, which is a subset of the total
        tables in the MetaData (others are ignored)
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def drop_all(<i>self</i>, <i>connectable=None</i>, <i>tables=None</i>, <i>checkfirst=True</i>)</b>
        <div class="docstring">
        <p>
    drop all tables stored in this metadata.</p>
<p>This will conditionally drop tables depending on if they currently 
        exist in the database.</p>
<p>connectable - a Connectable used to access the database; or use the engine
        bound to this MetaData.</p>
<p>tables - optional list of tables, which is a subset of the total
        tables in the MetaData (others are ignored)</p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def is_bound(<i>self</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def table_iterator(<i>self</i>, <i>reverse=True</i>, <i>tables=None</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>



    </div>

    <a href="#docstrings" class="toclink">back to section top</a>
</div>



      
    


<A name="docstrings_sqlalchemy.schema_PassiveDefault"></a>

<div class="subsection" style="margin-left:30px;">


<h3>class PassiveDefault(<a href="docstrings.html#docstrings_sqlalchemy.schema_DefaultGenerator">DefaultGenerator</a>)</h3>

    <div class="sectiontext">
    
<p>
    a default that takes effect on the database side
</p>


    
            <div class="darkcell">
        <A name=""></a>
        <b>def __init__(<i>self</i>, <i>arg</i>, <i>**kwargs</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def accept_schema_visitor(<i>self</i>, <i>visitor</i>, <i>traverse=True</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>



    </div>

    <a href="#docstrings" class="toclink">back to section top</a>
</div>



      
    


<A name="docstrings_sqlalchemy.schema_PrimaryKeyConstraint"></a>

<div class="subsection" style="margin-left:30px;">


<h3>class PrimaryKeyConstraint(<a href="docstrings.html#docstrings_sqlalchemy.schema_Constraint">Constraint</a>)</h3>

    <div class="sectiontext">
    
<p></p>
<p></p>


    
            <div class="darkcell">
        <A name=""></a>
        <b>def __init__(<i>self</i>, <i>*columns</i>, <i>**kwargs</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def accept_schema_visitor(<i>self</i>, <i>visitor</i>, <i>traverse=True</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def add(<i>self</i>, <i>col</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def append_column(<i>self</i>, <i>col</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def copy(<i>self</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>



    </div>

    <a href="#docstrings" class="toclink">back to section top</a>
</div>



      
    


<A name="docstrings_sqlalchemy.schema_SchemaItem"></a>

<div class="subsection" style="margin-left:30px;">


<h3>class SchemaItem(object)</h3>

    <div class="sectiontext">
    
<p>
    base class for items that define a database schema.
</p>


    
             <div class="darkcell">
         <A name=""></a>
         <b>case_sensitive = property()</b>
         <div class="docstring">
         <p></p>
<p></p>
         </div> 
         </div>

    
             <div class="darkcell">
         <A name=""></a>
         <b>engine = property()</b>
         <div class="docstring">
         <p></p>
<p></p>
         </div> 
         </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def get_engine(<i>self</i>)</b>
        <div class="docstring">
        <p>
    return the engine or raise an error if no engine
</p>
        </div>
        </div>

    
             <div class="darkcell">
         <A name=""></a>
         <b>metadata = property()</b>
         <div class="docstring">
         <p></p>
<p></p>
         </div> 
         </div>



    </div>

    <a href="#docstrings" class="toclink">back to section top</a>
</div>



      
    


<A name="docstrings_sqlalchemy.schema_SchemaVisitor"></a>

<div class="subsection" style="margin-left:30px;">


<h3>class SchemaVisitor(<a href="docstrings.html#docstrings_sqlalchemy.sql_ClauseVisitor">ClauseVisitor</a>)</h3>

    <div class="sectiontext">
    
<p>
    defines the visiting for SchemaItem objects
</p>


    
            <div class="darkcell">
        <A name=""></a>
        <b>def visit_check_constraint(<i>self</i>, <i>constraint</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def visit_column(<i>self</i>, <i>column</i>)</b>
        <div class="docstring">
        <p>
    visit a Column.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def visit_column_default(<i>self</i>, <i>default</i>)</b>
        <div class="docstring">
        <p>
    visit a ColumnDefault.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def visit_column_onupdate(<i>self</i>, <i>onupdate</i>)</b>
        <div class="docstring">
        <p>
    visit a ColumnDefault with the &quot;for_update&quot; flag set.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def visit_foreign_key(<i>self</i>, <i>join</i>)</b>
        <div class="docstring">
        <p>
    visit a ForeignKey.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def visit_foreign_key_constraint(<i>self</i>, <i>constraint</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def visit_index(<i>self</i>, <i>index</i>)</b>
        <div class="docstring">
        <p>
    visit an Index.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def visit_passive_default(<i>self</i>, <i>default</i>)</b>
        <div class="docstring">
        <p>
    visit a passive default
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def visit_primary_key_constraint(<i>self</i>, <i>constraint</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def visit_schema(<i>self</i>, <i>schema</i>)</b>
        <div class="docstring">
        <p>
    visit a generic SchemaItem
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def visit_sequence(<i>self</i>, <i>sequence</i>)</b>
        <div class="docstring">
        <p>
    visit a Sequence.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def visit_table(<i>self</i>, <i>table</i>)</b>
        <div class="docstring">
        <p>
    visit a Table.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def visit_unique_constraint(<i>self</i>, <i>constraint</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>



    </div>

    <a href="#docstrings" class="toclink">back to section top</a>
</div>



      
    


<A name="docstrings_sqlalchemy.schema_Sequence"></a>

<div class="subsection" style="margin-left:30px;">


<h3>class Sequence(<a href="docstrings.html#docstrings_sqlalchemy.schema_DefaultGenerator">DefaultGenerator</a>)</h3>

    <div class="sectiontext">
    
<p>
    represents a sequence, which applies to Oracle and Postgres databases.
</p>


    
            <div class="darkcell">
        <A name=""></a>
        <b>def __init__(<i>self</i>, <i>name</i>, <i>start=None</i>, <i>increment=None</i>, <i>optional=False</i>, <i>quote=False</i>, <i>**kwargs</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def accept_schema_visitor(<i>self</i>, <i>visitor</i>, <i>traverse=True</i>)</b>
        <div class="docstring">
        <p>
    calls the visit_seauence method on the given visitor.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def create(<i>self</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def drop(<i>self</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>



    </div>

    <a href="#docstrings" class="toclink">back to section top</a>
</div>



      
    


<A name="docstrings_sqlalchemy.schema_Table"></a>

<div class="subsection" style="margin-left:30px;">


<h3>class Table(<a href="docstrings.html#docstrings_sqlalchemy.schema_SchemaItem">SchemaItem</a>,<a href="docstrings.html#docstrings_sqlalchemy.sql_TableClause">TableClause</a>)</h3>

    <div class="sectiontext">
    
<p>
    represents a relational database table.  This subclasses sql.TableClause to provide
    a table that is &quot;wired&quot; to an engine.  Whereas TableClause represents a table as its 
    used in a SQL expression, Table represents a table as its created in the database.  </p>
<p>Be sure to look at sqlalchemy.sql.TableImpl for additional methods defined on a Table.
</p>


    
            <div class="darkcell">
        <A name=""></a>
        <b>def __init__(<i>self</i>, <i>name</i>, <i>metadata</i>, <i>**kwargs</i>)</b>
        <div class="docstring">
        <p>
    Construct a Table.</p>
<p>Table objects can be constructed directly.  The init method is actually called via 
        the TableSingleton metaclass.  Arguments are:</p>
<p>name : the name of this table, exactly as it appears, or will appear, in the database.
        This property, along with the &quot;schema&quot;, indicates the &quot;singleton identity&quot; of this table.
        Further tables constructed with the same name/schema combination will return the same 
        Table instance.</p>
<p>*args : should contain a listing of the Column objects for this table.</p>
<p>**kwargs : options include:</p>
<p>schema=None : the &quot;schema name&quot; for this table, which is required if the table resides in a 
        schema other than the default selected schema for the engine's database connection.</p>
<p>autoload=False : the Columns for this table should be reflected from the database.  Usually
        there will be no Column objects in the constructor if this property is set.</p>
<p>mustexist=False : indicates that this Table must already have been defined elsewhere in the application,
        else an exception is raised.</p>
<p>useexisting=False : indicates that if this Table was already defined elsewhere in the application, disregard
        the rest of the constructor arguments.  </p>
<p>owner=None : optional owning user of this table.  useful for databases such as Oracle to aid in table
        reflection.</p>
<p>quote=False : indicates that the Table identifier must be properly escaped and quoted before being sent 
        to the database. This flag overrides all other quoting behavior.</p>
<p>quote_schema=False : indicates that the Namespace identifier must be properly escaped and quoted before being sent 
        to the database. This flag overrides all other quoting behavior.</p>
<p>case_sensitive=True : indicates that the identifier should be interpreted by the database in the natural case for identifiers.
        Mixed case is not sufficient to cause this identifier to be quoted; it must contain an illegal character.</p>
<p>case_sensitive_schema=True : indicates that the identifier should be interpreted by the database in the natural case for identifiers.
        Mixed case is not sufficient to cause this identifier to be quoted; it must contain an illegal character.</p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def accept_schema_visitor(<i>self</i>, <i>visitor</i>, <i>traverse=True</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def append_column(<i>self</i>, <i>column</i>)</b>
        <div class="docstring">
        <p>
    append a Column to this Table.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def append_constraint(<i>self</i>, <i>constraint</i>)</b>
        <div class="docstring">
        <p>
    append a Constraint to this Table.
</p>
        </div>
        </div>

    
             <div class="darkcell">
         <A name=""></a>
         <b>case_sensitive_schema = property()</b>
         <div class="docstring">
         <p></p>
<p></p>
         </div> 
         </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def create(<i>self</i>, <i>connectable=None</i>, <i>checkfirst=False</i>)</b>
        <div class="docstring">
        <p>
    issue a CREATE statement for this table.</p>
<p>see also metadata.create_all().
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def drop(<i>self</i>, <i>connectable=None</i>, <i>checkfirst=False</i>)</b>
        <div class="docstring">
        <p>
    issue a DROP statement for this table.</p>
<p>see also metadata.drop_all().
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def exists(<i>self</i>, <i>connectable=None</i>)</b>
        <div class="docstring">
        <p>
    return True if this table exists.
</p>
        </div>
        </div>

    
             <div class="darkcell">
         <A name=""></a>
         <b>primary_key = property()</b>
         <div class="docstring">
         <p></p>
<p></p>
         </div> 
         </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def tometadata(<i>self</i>, <i>metadata</i>, <i>schema=None</i>)</b>
        <div class="docstring">
        <p>
    return a copy of this Table associated with a different MetaData.
</p>
        </div>
        </div>



    </div>

    <a href="#docstrings" class="toclink">back to section top</a>
</div>



      
    


<A name="docstrings_sqlalchemy.schema_UniqueConstraint"></a>

<div class="subsection" style="margin-left:30px;">


<h3>class UniqueConstraint(<a href="docstrings.html#docstrings_sqlalchemy.schema_Constraint">Constraint</a>)</h3>

    <div class="sectiontext">
    
<p></p>
<p></p>


    
            <div class="darkcell">
        <A name=""></a>
        <b>def __init__(<i>self</i>, <i>*columns</i>, <i>**kwargs</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def accept_schema_visitor(<i>self</i>, <i>visitor</i>, <i>traverse=True</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def append_column(<i>self</i>, <i>col</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>



    </div>

</div>




    </div>

    <a href="#docstrings" class="toclink">back to section top</a>
</div>




    


<A name="docstrings_sqlalchemy.engine"></a>

<div class="subsection" style="margin-left:20px;">


<h3>module sqlalchemy.engine</h3>

    <div class="sectiontext">
    
<p></p>
<p></p>




<A name="docstrings_sqlalchemy.engine_modfunc"></a>

<div class="subsection" style="margin-left:30px;">


<h3>Module Functions</h3>

    <div class="sectiontext">
    
    
            <div class="darkcell">
        <A name=""></a>
        <b>def create_engine(<i>*args</i>, <i>**kwargs</i>)</b>
        <div class="docstring">
        <p>
    creates a new Engine instance.  Using the given strategy name,
    locates that strategy and invokes its create() method to produce the Engine.
    The strategies themselves are instances of EngineStrategy, and the built in 
    ones are present in the sqlalchemy.engine.strategies module.  Current implementations
    include &quot;plain&quot; and &quot;threadlocal&quot;.  The default used by this function is &quot;plain&quot;.</p>
<p>&quot;plain&quot; provides support for a Connection object which can be used to execute SQL queries 
    with a specific underlying DBAPI connection.</p>
<p>&quot;threadlocal&quot; is similar to &quot;plain&quot; except that it adds support for a thread-local connection and
    transaction context, which allows a group of engine operations to participate using the same
    connection and transaction without the need for explicit passing of a Connection object.</p>
<p>The standard method of specifying the engine is via URL as the first positional
    argument, to indicate the appropriate database dialect and connection arguments, with additional
    keyword arguments sent as options to the dialect and resulting Engine.</p>
<p>The URL is in the form &lt;dialect&gt;://opt1=val1&amp;opt2=val2.  
    Where &lt;dialect&gt; is a name such as &quot;mysql&quot;, &quot;oracle&quot;, &quot;postgres&quot;, and the options indicate
    username, password, database, etc.  Supported keynames include &quot;username&quot;, &quot;user&quot;, &quot;password&quot;,
    &quot;pw&quot;, &quot;db&quot;, &quot;database&quot;, &quot;host&quot;, &quot;filename&quot;.</p>
<p>**kwargs represents options to be sent to the Engine itself as well as the components of the Engine,
    including the Dialect, the ConnectionProvider, and the Pool.  A list of common options is as follows:</p>
<p>pool=None : an instance of sqlalchemy.pool.DBProxy or sqlalchemy.pool.Pool to be used as the
    underlying source for connections (DBProxy/Pool is described in the previous section). If None,
    a default DBProxy will be created using the engine's own database module with the given
    arguments.</p>
<p>echo=False : if True, the Engine will log all statements as well as a repr() of their 
    parameter lists to the engines logger, which defaults to sys.stdout.  A Engine instances' 
    &quot;echo&quot; data member can be modified at any time to turn logging on and off.  If set to the string 
    'debug', result rows will be printed to the standard output as well.</p>
<p>logger=None : a file-like object where logging output can be sent, if echo is set to True.  
    This defaults to sys.stdout.</p>
<p>encoding='utf-8' : the encoding to be used when encoding/decoding Unicode strings</p>
<p>convert_unicode=False : True if unicode conversion should be applied to all str types</p>
<p>module=None : used by Oracle and Postgres, this is a reference to a DBAPI2 module to be used 
    instead of the engine's default module.  For Postgres, the default is psycopg2, or psycopg1 if 
    2 cannot be found.  For Oracle, its cx_Oracle.  For mysql, MySQLdb.</p>
<p>use_ansi=True : used only by Oracle;  when False, the Oracle driver attempts to support a 
    particular &quot;quirk&quot; of some Oracle databases, that the LEFT OUTER JOIN SQL syntax is not 
    supported, and the &quot;Oracle join&quot; syntax of using &lt;column1&gt;(+)=&lt;column2&gt; must be used 
    in order to achieve a LEFT OUTER JOIN.  Its advised that the Oracle database be configured to 
    have full ANSI support instead of using this feature.</p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def engine_descriptors()</b>
        <div class="docstring">
        <p>
    provides a listing of all the database implementations supported.  this data
    is provided as a list of dictionaries, where each dictionary contains the following
    key/value pairs:</p>
<p>name :       the name of the engine, suitable for use in the create_engine function</p>
<p>description: a plain description of the engine.</p>
<p>arguments :  a dictionary describing the name and description of each parameter
                 used to connect to this engine's underlying DBAPI.</p>
<p>This function is meant for usage in automated configuration tools that wish to 
    query the user for database and connection information.</p>
<p></p>
        </div>
        </div>


    </div>

    <a href="#docstrings" class="toclink">back to section top</a>
</div>




      
    


<A name="docstrings_sqlalchemy.engine_Connectable"></a>

<div class="subsection" style="margin-left:30px;">


<h3>class Connectable(object)</h3>

    <div class="sectiontext">
    
<p>
    interface for an object that can provide an Engine and a Connection object which correponds to that Engine.
</p>


    
            <div class="darkcell">
        <A name=""></a>
        <b>def contextual_connect(<i>self</i>)</b>
        <div class="docstring">
        <p>
    returns a Connection object which may be part of an ongoing context.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def create(<i>self</i>, <i>entity</i>, <i>**kwargs</i>)</b>
        <div class="docstring">
        <p>
    creates a table or index given an appropriate schema object.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def drop(<i>self</i>, <i>entity</i>, <i>**kwargs</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
             <div class="darkcell">
         <A name=""></a>
         <b>engine = property()</b>
         <div class="docstring">
         <p>
    returns the Engine which this Connectable is associated with.
</p>
         </div> 
         </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def execute(<i>self</i>, <i>object</i>, <i>*multiparams</i>, <i>**params</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>



    </div>

    <a href="#docstrings" class="toclink">back to section top</a>
</div>



      
    


<A name="docstrings_sqlalchemy.engine_Connection"></a>

<div class="subsection" style="margin-left:30px;">


<h3>class Connection(<a href="docstrings.html#docstrings_sqlalchemy.engine_Connectable">Connectable</a>)</h3>

    <div class="sectiontext">
    
<p>
    represents a single DBAPI connection returned from the underlying connection pool.  Provides
    execution support for string-based SQL statements as well as ClauseElement, Compiled and DefaultGenerator objects.
    provides a begin method to return Transaction objects.</p>
<p>The Connection object is **not** threadsafe.
</p>


    
            <div class="darkcell">
        <A name=""></a>
        <b>def __init__(<i>self</i>, <i>engine</i>, <i>connection=None</i>, <i>close_with_result=False</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def begin(<i>self</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def close(<i>self</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def connect(<i>self</i>)</b>
        <div class="docstring">
        <p>
    connect() is implemented to return self so that an incoming Engine or Connection object can be treated similarly.
</p>
        </div>
        </div>

    
             <div class="darkcell">
         <A name=""></a>
         <b>connection = property()</b>
         <div class="docstring">
         <p>
    The underlying DBAPI connection managed by this Connection.
</p>
         </div> 
         </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def contextual_connect(<i>self</i>, <i>**kwargs</i>)</b>
        <div class="docstring">
        <p>
    contextual_connect() is implemented to return self so that an incoming Engine or Connection object can be treated similarly.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def create(<i>self</i>, <i>entity</i>, <i>**kwargs</i>)</b>
        <div class="docstring">
        <p>
    creates a table or index given an appropriate schema object.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def default_schema_name(<i>self</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def drop(<i>self</i>, <i>entity</i>, <i>**kwargs</i>)</b>
        <div class="docstring">
        <p>
    drops a table or index given an appropriate schema object.
</p>
        </div>
        </div>

    
             <div class="darkcell">
         <A name=""></a>
         <b>engine = property()</b>
         <div class="docstring">
         <p>
    The Engine with which this Connection is associated (read only)
</p>
         </div> 
         </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def execute(<i>self</i>, <i>object</i>, <i>*multiparams</i>, <i>**params</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def execute_clauseelement(<i>self</i>, <i>elem</i>, <i>*multiparams</i>, <i>**params</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def execute_compiled(<i>self</i>, <i>compiled</i>, <i>*multiparams</i>, <i>**params</i>)</b>
        <div class="docstring">
        <p>
    executes a sql.Compiled object.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def execute_default(<i>self</i>, <i>default</i>, <i>**kwargs</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def execute_text(<i>self</i>, <i>statement</i>, <i>parameters=None</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def in_transaction(<i>self</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def proxy(<i>self</i>, <i>statement=None</i>, <i>parameters=None</i>)</b>
        <div class="docstring">
        <p>
    executes the given statement string and parameter object.
        the parameter object is expected to be the result of a call to compiled.get_params().
        This callable is a generic version of a connection/cursor-specific callable that
        is produced within the execute_compiled method, and is used for objects that require
        this style of proxy when outside of an execute_compiled method, primarily the DefaultRunner.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def reflecttable(<i>self</i>, <i>table</i>, <i>**kwargs</i>)</b>
        <div class="docstring">
        <p>
    reflects the columns in the given table from the database.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def run_callable(<i>self</i>, <i>callable_</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def scalar(<i>self</i>, <i>object</i>, <i>parameters=None</i>, <i>**kwargs</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
             <div class="darkcell">
         <A name=""></a>
         <b>should_close_with_result = property()</b>
         <div class="docstring">
         <p>
    Indicates if this Connection should be closed when a corresponding ResultProxy is closed; this is essentially an auto-release mode.
</p>
         </div> 
         </div>



    </div>

    <a href="#docstrings" class="toclink">back to section top</a>
</div>



      
    


<A name="docstrings_sqlalchemy.engine_ConnectionProvider"></a>

<div class="subsection" style="margin-left:30px;">


<h3>class ConnectionProvider(object)</h3>

    <div class="sectiontext">
    
<p>
    defines an interface that returns raw Connection objects (or compatible).
</p>


    
            <div class="darkcell">
        <A name=""></a>
        <b>def dispose(<i>self</i>)</b>
        <div class="docstring">
        <p>
    releases all resources corresponding to this ConnectionProvider, such 
        as any underlying connection pools.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def get_connection(<i>self</i>)</b>
        <div class="docstring">
        <p>
    this method should return a Connection or compatible object from a DBAPI which
        also contains a close() method.  
        It is not defined what context this connection belongs to.  It may be newly connected, 
        returned from a pool, part of some other kind of context such as thread-local,
        or can be a fixed member of this object.
</p>
        </div>
        </div>



    </div>

    <a href="#docstrings" class="toclink">back to section top</a>
</div>



      
    


<A name="docstrings_sqlalchemy.engine_DefaultRunner"></a>

<div class="subsection" style="margin-left:30px;">


<h3>class DefaultRunner(<a href="docstrings.html#docstrings_sqlalchemy.schema_SchemaVisitor">SchemaVisitor</a>)</h3>

    <div class="sectiontext">
    
<p>
    a visitor which accepts ColumnDefault objects, produces the dialect-specific SQL corresponding
    to their execution, and executes the SQL, returning the result value.</p>
<p>DefaultRunners are used internally by Engines and Dialects.  Specific database modules should provide
    their own subclasses of DefaultRunner to allow database-specific behavior.
</p>


    
            <div class="darkcell">
        <A name=""></a>
        <b>def __init__(<i>self</i>, <i>engine</i>, <i>proxy</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def exec_default_sql(<i>self</i>, <i>default</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def get_column_default(<i>self</i>, <i>column</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def get_column_onupdate(<i>self</i>, <i>column</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def visit_column_default(<i>self</i>, <i>default</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def visit_column_onupdate(<i>self</i>, <i>onupdate</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def visit_passive_default(<i>self</i>, <i>default</i>)</b>
        <div class="docstring">
        <p>
    passive defaults by definition return None on the app side,
        and are post-fetched to get the DB-side value
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def visit_sequence(<i>self</i>, <i>seq</i>)</b>
        <div class="docstring">
        <p>
    sequences are not supported by default
</p>
        </div>
        </div>



    </div>

    <a href="#docstrings" class="toclink">back to section top</a>
</div>



      
    


<A name="docstrings_sqlalchemy.engine_Dialect"></a>

<div class="subsection" style="margin-left:30px;">


<h3>class Dialect(<a href="docstrings.html#docstrings_sqlalchemy.sql_AbstractDialect">AbstractDialect</a>)</h3>

    <div class="sectiontext">
    
<p>
    Defines the behavior of a specific database/DBAPI.</p>
<p>Any aspect of metadata defintion, SQL query generation, execution, result-set handling,
    or anything else which varies between databases is defined under the general category of 
    the Dialect.  The Dialect acts as a factory for other database-specific object implementations 
    including ExecutionContext, Compiled, DefaultGenerator, and TypeEngine.</p>
<p>All Dialects implement the following attributes:</p>
<p>positional - True if the paramstyle for this Dialect is positional</p>
<p>paramstyle - the paramstyle to be used (some DBAPIs support multiple paramstyles)</p>
<p>supports_autoclose_results - usually True; if False, indicates that rows returned by fetchone()
    might not be just plain tuples, and may be &quot;live&quot; proxy objects which still require the cursor
    to be open in order to be read (such as pyPgSQL which has active filehandles for BLOBs).  in that
    case, an auto-closing ResultProxy cannot automatically close itself after results are consumed.</p>
<p>convert_unicode - True if unicode conversion should be applied to all str types</p>
<p>encoding - type of encoding to use for unicode, usually defaults to 'utf-8'</p>
<p></p>


    
            <div class="darkcell">
        <A name=""></a>
        <b>def compile(<i>self</i>, <i>clauseelement</i>, <i>parameters=None</i>)</b>
        <div class="docstring">
        <p>
    compile the given ClauseElement using this Dialect.</p>
<p>a convenience method which simply flips around the compile() call
        on ClauseElement.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def compiler(<i>self</i>, <i>statement</i>, <i>parameters</i>)</b>
        <div class="docstring">
        <p>
    returns a sql.ClauseVisitor which will produce a string representation of the given
        ClauseElement and parameter dictionary.  This object is usually a subclass of 
        ansisql.ANSICompiler.  </p>
<p>compiler is called within the context of the compile() method.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def convert_compiled_params(<i>self</i>, <i>parameters</i>)</b>
        <div class="docstring">
        <p>
    given a sql.ClauseParameters object, returns an array or dictionary suitable to pass 
        directly to this Dialect's DBAPI's execute method.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def create_connect_args(<i>self</i>, <i>opts</i>)</b>
        <div class="docstring">
        <p>
    given a dictionary of key-valued connect parameters, returns a tuple 
        consisting of a *args/**kwargs suitable to send directly to the dbapi's connect function.
        The connect args will have any number of the following keynames:  host, hostname, database, dbanme,
        user,username, password, pw, passwd, filename.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def dbapi(<i>self</i>)</b>
        <div class="docstring">
        <p>
    subclasses override this method to provide the DBAPI module used to establish
        connections.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def defaultrunner(<i>self</i>, <i>engine</i>, <i>proxy</i>, <i>**params</i>)</b>
        <div class="docstring">
        <p>
    returns a schema.SchemaVisitor instances that can execute defaults.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def do_begin(<i>self</i>, <i>connection</i>)</b>
        <div class="docstring">
        <p>
    provides an implementation of connection.begin()
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def do_commit(<i>self</i>, <i>connection</i>)</b>
        <div class="docstring">
        <p>
    provides an implementation of connection.commit()
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def do_execute(<i>self</i>, <i>cursor</i>, <i>statement</i>, <i>parameters</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def do_executemany(<i>self</i>, <i>cursor</i>, <i>statement</i>, <i>parameters</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def do_rollback(<i>self</i>, <i>connection</i>)</b>
        <div class="docstring">
        <p>
    provides an implementation of connection.rollback()
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def execution_context(<i>self</i>)</b>
        <div class="docstring">
        <p>
    returns a new ExecutionContext object.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def get_default_schema_name(<i>self</i>, <i>connection</i>)</b>
        <div class="docstring">
        <p>
    returns the currently selected schema given an connection
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def has_sequence(<i>self</i>, <i>connection</i>, <i>sequence_name</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def has_table(<i>self</i>, <i>connection</i>, <i>table_name</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def oid_column_name(<i>self</i>)</b>
        <div class="docstring">
        <p>
    returns the oid column name for this dialect, or None if the dialect cant/wont support OID/ROWID.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def reflecttable(<i>self</i>, <i>connection</i>, <i>table</i>)</b>
        <div class="docstring">
        <p>
    given an Connection and a Table object, reflects its columns and properties from the database.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def schemadropper(<i>self</i>, <i>engine</i>, <i>proxy</i>, <i>**params</i>)</b>
        <div class="docstring">
        <p>
    returns a schema.SchemaVisitor instance that can drop schemas, when it is
        invoked to traverse a set of schema objects. </p>
<p>schemagenerator is called via the drop() method on Table, Index, and others.</p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def schemagenerator(<i>self</i>, <i>engine</i>, <i>proxy</i>, <i>**params</i>)</b>
        <div class="docstring">
        <p>
    returns a schema.SchemaVisitor instance that can generate schemas, when it is
        invoked to traverse a set of schema objects. </p>
<p>schemagenerator is called via the create() method on Table, Index, and others.</p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def supports_sane_rowcount(<i>self</i>)</b>
        <div class="docstring">
        <p>
    Provided to indicate when MySQL is being used, which does not have standard behavior
        for the &quot;rowcount&quot; function on a statement handle.  
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def type_descriptor(<i>self</i>, <i>typeobj</i>)</b>
        <div class="docstring">
        <p>
    provides a database-specific TypeEngine object, given the generic object
        which comes from the types module.  Subclasses will usually use the adapt_type()
        method in the types module to make this job easy.
</p>
        </div>
        </div>



    </div>

    <a href="#docstrings" class="toclink">back to section top</a>
</div>



      
    


<A name="docstrings_sqlalchemy.engine_Engine"></a>

<div class="subsection" style="margin-left:30px;">


<h3>class Engine(<a href="docstrings.html#docstrings_sqlalchemy.sql_Executor">Executor</a>,<a href="docstrings.html#docstrings_sqlalchemy.engine_Connectable">Connectable</a>)</h3>

    <div class="sectiontext">
    
<p></p>
<p>Connects a ConnectionProvider, a Dialect and a CompilerFactory together to 
    provide a default implementation of SchemaEngine.</p>
<p></p>


    
            <div class="darkcell">
        <A name=""></a>
        <b>def __init__(<i>self</i>, <i>connection_provider</i>, <i>dialect</i>, <i>echo=None</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def compiler(<i>self</i>, <i>statement</i>, <i>parameters</i>, <i>**kwargs</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def connect(<i>self</i>, <i>**kwargs</i>)</b>
        <div class="docstring">
        <p>
    returns a newly allocated Connection object.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def contextual_connect(<i>self</i>, <i>close_with_result=False</i>, <i>**kwargs</i>)</b>
        <div class="docstring">
        <p>
    returns a Connection object which may be newly allocated, or may be part of some 
        ongoing context.  This Connection is meant to be used by the various &quot;auto-connecting&quot; operations.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def create(<i>self</i>, <i>entity</i>, <i>connection=None</i>, <i>**kwargs</i>)</b>
        <div class="docstring">
        <p>
    creates a table or index within this engine's database connection given a schema.Table object.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def dispose(<i>self</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def drop(<i>self</i>, <i>entity</i>, <i>connection=None</i>, <i>**kwargs</i>)</b>
        <div class="docstring">
        <p>
    drops a table or index within this engine's database connection given a schema.Table object.
</p>
        </div>
        </div>

    
             <div class="darkcell">
         <A name=""></a>
         <b>engine = property()</b>
         <div class="docstring">
         <p></p>
<p></p>
         </div> 
         </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def execute(<i>self</i>, <i>statement</i>, <i>*multiparams</i>, <i>**params</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def execute_compiled(<i>self</i>, <i>compiled</i>, <i>*multiparams</i>, <i>**params</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def execute_default(<i>self</i>, <i>default</i>, <i>**kwargs</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
             <div class="darkcell">
         <A name=""></a>
         <b>func = property()</b>
         <div class="docstring">
         <p></p>
<p></p>
         </div> 
         </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def has_table(<i>self</i>, <i>table_name</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def log(<i>self</i>, <i>msg</i>)</b>
        <div class="docstring">
        <p>
    logs a message using this SQLEngine's logger stream.
</p>
        </div>
        </div>

    
             <div class="darkcell">
         <A name=""></a>
         <b>name = property()</b>
         <div class="docstring">
         <p></p>
<p></p>
         </div> 
         </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def raw_connection(<i>self</i>)</b>
        <div class="docstring">
        <p>
    returns a DBAPI connection.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def reflecttable(<i>self</i>, <i>table</i>, <i>connection=None</i>)</b>
        <div class="docstring">
        <p>
    given a Table object, reflects its columns and properties from the database.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def run_callable(<i>self</i>, <i>callable_</i>, <i>connection=None</i>, <i>*args</i>, <i>**kwargs</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def scalar(<i>self</i>, <i>statement</i>, <i>*multiparams</i>, <i>**params</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def text(<i>self</i>, <i>text</i>, <i>*args</i>, <i>**kwargs</i>)</b>
        <div class="docstring">
        <p>
    returns a sql.text() object for performing literal queries.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def transaction(<i>self</i>, <i>callable_</i>, <i>connection=None</i>, <i>*args</i>, <i>**kwargs</i>)</b>
        <div class="docstring">
        <p>
    executes the given function within a transaction boundary.  this is a shortcut for
        explicitly calling begin() and commit() and optionally rollback() when execptions are raised.
        The given *args and **kwargs will be passed to the function, as well as the Connection used 
        in the transaction.
</p>
        </div>
        </div>



    </div>

    <a href="#docstrings" class="toclink">back to section top</a>
</div>



      
    


<A name="docstrings_sqlalchemy.engine_ExecutionContext"></a>

<div class="subsection" style="margin-left:30px;">


<h3>class ExecutionContext(object)</h3>

    <div class="sectiontext">
    
<p>
    a messenger object for a Dialect that corresponds to a single execution.  The Dialect
    should provide an ExecutionContext via the create_execution_context() method.  
    The pre_exec and post_exec methods will be called for compiled statements, afterwhich
    it is expected that the various methods last_inserted_ids, last_inserted_params, etc.
    will contain appropriate values, if applicable.
</p>


    
            <div class="darkcell">
        <A name=""></a>
        <b>def get_rowcount(<i>self</i>, <i>cursor</i>)</b>
        <div class="docstring">
        <p>
    returns the count of rows updated/deleted for an UPDATE/DELETE statement
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def last_inserted_ids(<i>self</i>)</b>
        <div class="docstring">
        <p>
    return the list of the primary key values for the last insert statement executed.</p>
<p>This does not apply to straight textual clauses; only to sql.Insert objects compiled against 
        a schema.Table object, which are executed via statement.execute().  The order of items in the 
        list is the same as that of the Table's 'primary_key' attribute.</p>
<p>In some cases, this method may invoke a query back to the database to retrieve the data, based on
        the &quot;lastrowid&quot; value in the cursor.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def last_inserted_params(<i>self</i>)</b>
        <div class="docstring">
        <p>
    return a dictionary of the full parameter dictionary for the last compiled INSERT statement.</p>
<p>Includes any ColumnDefaults or Sequences that were pre-executed.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def last_updated_params(<i>self</i>)</b>
        <div class="docstring">
        <p>
    return a dictionary of the full parameter dictionary for the last compiled UPDATE statement.</p>
<p>Includes any ColumnDefaults that were pre-executed.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def lastrow_has_defaults(<i>self</i>)</b>
        <div class="docstring">
        <p>
    return True if the last row INSERTED via a compiled insert statement contained PassiveDefaults.</p>
<p>The presence of PassiveDefaults indicates that the database inserted data beyond that which we 
        passed to the query programmatically.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def post_exec(<i>self</i>, <i>engine</i>, <i>proxy</i>, <i>compiled</i>, <i>parameters</i>)</b>
        <div class="docstring">
        <p>
    called after the execution of a compiled statement.  proxy is a callable that
        takes a string statement and a bind parameter list/dictionary.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def pre_exec(<i>self</i>, <i>engine</i>, <i>proxy</i>, <i>compiled</i>, <i>parameters</i>)</b>
        <div class="docstring">
        <p>
    called before an execution of a compiled statement.  proxy is a callable that
        takes a string statement and a bind parameter list/dictionary.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def supports_sane_rowcount(<i>self</i>)</b>
        <div class="docstring">
        <p>
    Indicates if the &quot;rowcount&quot; DBAPI cursor function works properly.</p>
<p>Currently, MySQLDB does not properly implement this function.
</p>
        </div>
        </div>



    </div>

    <a href="#docstrings" class="toclink">back to section top</a>
</div>



      
    


<A name="docstrings_sqlalchemy.engine_ResultProxy"></a>

<div class="subsection" style="margin-left:30px;">


<h3>class ResultProxy(object)</h3>

    <div class="sectiontext">
    
<p>
    wraps a DBAPI cursor object to provide access to row columns based on integer
    position, case-insensitive column name, or by schema.Column object. e.g.:</p>
<p>row = fetchone()</p>
<p>col1 = row[0]    # access via integer position</p>
<p>col2 = row['col2']   # access via name</p>
<p>col3 = row[mytable.c.mycol] # access via Column object.  </p>
<p>ResultProxy also contains a map of TypeEngine objects and will invoke the appropriate
    convert_result_value() method before returning columns, as well as the ExecutionContext
    corresponding to the statement execution.  It provides several methods for which
    to obtain information from the underlying ExecutionContext.</p>
<p></p>


    
            <div class="darkcell">
        <A name=""></a>
        <b>def __init__(<i>self</i>, <i>engine</i>, <i>connection</i>, <i>cursor</i>, <i>executioncontext=None</i>, <i>typemap=None</i>)</b>
        <div class="docstring">
        <p>
    ResultProxy objects are constructed via the execute() method on SQLEngine.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def close(<i>self</i>)</b>
        <div class="docstring">
        <p>
    close this ResultProxy, and the underlying DBAPI cursor corresponding to the execution.</p>
<p>If this ResultProxy was generated from an implicit execution, the underlying Connection will
        also be closed (returns the underlying DBAPI connection to the connection pool.)</p>
<p>This method is also called automatically when all result rows are exhausted.
</p>
        </div>
        </div>

    
             <div class="darkcell">
         <A name=""></a>
         <b>executioncontext = property()</b>
         <div class="docstring">
         <p></p>
<p></p>
         </div> 
         </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def fetchall(<i>self</i>)</b>
        <div class="docstring">
        <p>
    fetch all rows, just like DBAPI cursor.fetchall().
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def fetchone(<i>self</i>)</b>
        <div class="docstring">
        <p>
    fetch one row, just like DBAPI cursor.fetchone().
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def last_inserted_ids(<i>self</i>)</b>
        <div class="docstring">
        <p>
    return last_inserted_ids() from the underlying ExecutionContext.</p>
<p>See ExecutionContext for details.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def last_inserted_params(<i>self</i>)</b>
        <div class="docstring">
        <p>
    return last_inserted_params() from the underlying ExecutionContext.</p>
<p>See ExecutionContext for details.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def last_updated_params(<i>self</i>)</b>
        <div class="docstring">
        <p>
    return last_updated_params() from the underlying ExecutionContext.</p>
<p>See ExecutionContext for details.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def lastrow_has_defaults(<i>self</i>)</b>
        <div class="docstring">
        <p>
    return lastrow_has_defaults() from the underlying ExecutionContext.</p>
<p>See ExecutionContext for details.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def scalar(<i>self</i>)</b>
        <div class="docstring">
        <p>
    fetch the first column of the first row, and close the result set.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def supports_sane_rowcount(<i>self</i>)</b>
        <div class="docstring">
        <p>
    return supports_sane_rowcount() from the underlying ExecutionContext.</p>
<p>See ExecutionContext for details.
</p>
        </div>
        </div>



    </div>

    <a href="#docstrings" class="toclink">back to section top</a>
</div>



      
    


<A name="docstrings_sqlalchemy.engine_RowProxy"></a>

<div class="subsection" style="margin-left:30px;">


<h3>class RowProxy(object)</h3>

    <div class="sectiontext">
    
<p>
    proxies a single cursor row for a parent ResultProxy.  Mostly follows 
    &quot;ordered dictionary&quot; behavior, mapping result values to the string-based column name,
    the integer position of the result in the row, as well as Column instances which
    can be mapped to the original Columns that produced this result set (for results
    that correspond to constructed SQL expressions).
</p>


    
            <div class="darkcell">
        <A name=""></a>
        <b>def __init__(<i>self</i>, <i>parent</i>, <i>row</i>)</b>
        <div class="docstring">
        <p>
    RowProxy objects are constructed by ResultProxy objects.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def close(<i>self</i>)</b>
        <div class="docstring">
        <p>
    close the parent ResultProxy.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def has_key(<i>self</i>, <i>key</i>)</b>
        <div class="docstring">
        <p>
    return True if this RowProxy contains the given key.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def items(<i>self</i>)</b>
        <div class="docstring">
        <p>
    return a list of tuples, each tuple containing a key/value pair.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def keys(<i>self</i>)</b>
        <div class="docstring">
        <p>
    return the list of keys as strings represented by this RowProxy.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def values(<i>self</i>)</b>
        <div class="docstring">
        <p>
    return the values represented by this RowProxy as a list.
</p>
        </div>
        </div>



    </div>

    <a href="#docstrings" class="toclink">back to section top</a>
</div>



      
    


<A name="docstrings_sqlalchemy.engine_SchemaIterator"></a>

<div class="subsection" style="margin-left:30px;">


<h3>class SchemaIterator(<a href="docstrings.html#docstrings_sqlalchemy.schema_SchemaVisitor">SchemaVisitor</a>)</h3>

    <div class="sectiontext">
    
<p>
    a visitor that can gather text into a buffer and execute the contents of the buffer.
</p>


    
            <div class="darkcell">
        <A name=""></a>
        <b>def __init__(<i>self</i>, <i>engine</i>, <i>proxy</i>, <i>**params</i>)</b>
        <div class="docstring">
        <p>
    construct a new SchemaIterator.</p>
<p>engine - the Engine used by this SchemaIterator</p>
<p>proxy - a callable which takes a statement and bind parameters and executes it, returning
        the cursor (the actual DBAPI cursor).  The callable should use the same cursor repeatedly.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def append(<i>self</i>, <i>s</i>)</b>
        <div class="docstring">
        <p>
    append content to the SchemaIterator's query buffer.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def execute(<i>self</i>)</b>
        <div class="docstring">
        <p>
    execute the contents of the SchemaIterator's buffer.
</p>
        </div>
        </div>



    </div>

    <a href="#docstrings" class="toclink">back to section top</a>
</div>



      
    


<A name="docstrings_sqlalchemy.engine_Transaction"></a>

<div class="subsection" style="margin-left:30px;">


<h3>class Transaction(object)</h3>

    <div class="sectiontext">
    
<p>
    represents a Transaction in progress.</p>
<p>the Transaction object is **not** threadsafe.
</p>


    
            <div class="darkcell">
        <A name=""></a>
        <b>def __init__(<i>self</i>, <i>connection</i>, <i>parent</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def commit(<i>self</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
             <div class="darkcell">
         <A name=""></a>
         <b>connection = property()</b>
         <div class="docstring">
         <p>
    The Connection object referenced by this Transaction
</p>
         </div> 
         </div>

    
             <div class="darkcell">
         <A name=""></a>
         <b>is_active = property()</b>
         <div class="docstring">
         <p></p>
<p></p>
         </div> 
         </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def rollback(<i>self</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>



    </div>

</div>




    </div>

    <a href="#docstrings" class="toclink">back to section top</a>
</div>




    


<A name="docstrings_sqlalchemy.engine.url"></a>

<div class="subsection" style="margin-left:20px;">


<h3>module sqlalchemy.engine.url</h3>

    <div class="sectiontext">
    
<p></p>
<p></p>




<A name="docstrings_sqlalchemy.engine.url_modfunc"></a>

<div class="subsection" style="margin-left:30px;">


<h3>Module Functions</h3>

    <div class="sectiontext">
    
    
            <div class="darkcell">
        <A name=""></a>
        <b>def make_url(<i>name_or_url</i>)</b>
        <div class="docstring">
        <p>
    given a string or unicode instance, produces a new URL instance.</p>
<p>the given string is parsed according to the rfc1738 spec.
    if an existing URL object is passed, just returns the object.
</p>
        </div>
        </div>


    </div>

    <a href="#docstrings" class="toclink">back to section top</a>
</div>




      
    


<A name="docstrings_sqlalchemy.engine.url_URL"></a>

<div class="subsection" style="margin-left:30px;">


<h3>class URL(object)</h3>

    <div class="sectiontext">
    
<p>
    represents the components of a URL used to connect to a database.</p>
<p>This object is suitable to be passed directly to a create_engine() call.
    The fields of the URL are parsed from a string by the module-level make_url() function.  
    the string format of the URL is an RFC-1738-style string.  </p>
<p>Attributes on URL include:</p>
<p>drivername</p>
<p>username</p>
<p>password</p>
<p>host</p>
<p>port</p>
<p>database</p>
<p>query - a dictionary containing key/value pairs representing the URL's query string.
</p>


    
            <div class="darkcell">
        <A name=""></a>
        <b>def __init__(<i>self</i>, <i>drivername</i>, <i>username=None</i>, <i>password=None</i>, <i>host=None</i>, <i>port=None</i>, <i>database=None</i>, <i>query=None</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def get_module(<i>self</i>)</b>
        <div class="docstring">
        <p>
    return the SQLAlchemy database module corresponding to this URL's driver name.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def translate_connect_args(<i>self</i>, <i>names</i>)</b>
        <div class="docstring">
        <p>
    translate this URL's attributes into a dictionary of connection arguments.</p>
<p>given a list of argument names corresponding to the URL attributes ('host', 'database', 'username', 'password', 'port'),
        will assemble the attribute values of this URL into the dictionary using the given names.
</p>
        </div>
        </div>



    </div>

</div>




    </div>

    <a href="#docstrings" class="toclink">back to section top</a>
</div>




    


<A name="docstrings_sqlalchemy.orm"></a>

<div class="subsection" style="margin-left:20px;">


<h3>module sqlalchemy.orm</h3>

    <div class="sectiontext">
    
<p></p>
<p>the mapper package provides object-relational functionality, building upon the schema and sql
packages and tying operations to class properties and constructors.</p>
<p></p>




<A name="docstrings_sqlalchemy.orm_modfunc"></a>

<div class="subsection" style="margin-left:30px;">


<h3>Module Functions</h3>

    <div class="sectiontext">
    
    
            <div class="darkcell">
        <A name=""></a>
        <b>def backref(<i>name</i>, <i>**kwargs</i>)</b>
        <div class="docstring">
        <p>
    create a BackRef object with explicit arguments, which are the same arguments one
    can send to relation().  </p>
<p>used with the &quot;backref&quot; keyword argument to relation() in place
    of a string argument. 
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def cascade_mappers(<i>*classes_or_mappers</i>)</b>
        <div class="docstring">
        <p>
    attempt to create a series of relations() between mappers automatically, via
    introspecting the foreign key relationships of the underlying tables.</p>
<p>given a list of classes and/or mappers, identifies the foreign key relationships
    between the given mappers or corresponding class mappers, and creates relation()
    objects representing those relationships, including a backreference.  Attempts to find
    the &quot;secondary&quot; table in a many-to-many relationship as well.  The names of the relations
    will be a lowercase version of the related class.  In the case of one-to-many or many-to-many,
    the name will be &quot;pluralized&quot;, which currently is based on the English language (i.e. an 's' or 
    'es' added to it).</p>
<p>NOTE: this method usually works poorly, and its usage is generally not advised.</p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def class_mapper(<i>class_</i>, <i>entity_name=None</i>, <i>compile=True</i>)</b>
        <div class="docstring">
        <p>
    given a ClassKey, returns the primary Mapper associated with the key.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def clear_mapper(<i>m</i>)</b>
        <div class="docstring">
        <p>
    remove the given mapper from the storage of mappers.  </p>
<p>when a new mapper is created for the previous mapper's class, it will be used as that classes' 
    new primary mapper.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def clear_mappers()</b>
        <div class="docstring">
        <p>
    remove all mappers that have been created thus far.  </p>
<p>when new mappers are created, they will be assigned to their classes as their primary mapper.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def contains_eager(<i>key</i>, <i>decorator=None</i>)</b>
        <div class="docstring">
        <p>
    return a MapperOption that will indicate to the query that the given 
    attribute will be eagerly loaded without any row decoration, or using
    a custom row decorator.  </p>
<p>used when feeding SQL result sets directly into
    query.instances().
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def defer(<i>name</i>)</b>
        <div class="docstring">
        <p>
    return a MapperOption that will convert the column property of the given 
    name into a deferred load.  </p>
<p>used with query.options()
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def deferred(<i>*columns</i>, <i>**kwargs</i>)</b>
        <div class="docstring">
        <p>
    return a DeferredColumnProperty, which indicates this object attributes should only be loaded 
    from its corresponding table column when first accessed.  </p>
<p>used with the 'properties' dictionary sent to mapper().
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def eagerload(<i>name</i>)</b>
        <div class="docstring">
        <p>
    return a MapperOption that will convert the property of the given name
    into an eager load.  </p>
<p>used with query.options().
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def extension(<i>ext</i>)</b>
        <div class="docstring">
        <p>
    return a MapperOption that will insert the given MapperExtension to the 
    beginning of the list of extensions that will be called in the context of the Query.</p>
<p>used with query.options().
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def lazyload(<i>name</i>)</b>
        <div class="docstring">
        <p>
    return a MapperOption that will convert the property of the given name
    into a lazy load.</p>
<p>used with query.options().
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def mapper(<i>class_</i>, <i>table=None</i>, <i>*args</i>, <i>**params</i>)</b>
        <div class="docstring">
        <p>
    return a new Mapper object.</p>
<p>See the Mapper class for a description of arguments.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def noload(<i>name</i>)</b>
        <div class="docstring">
        <p>
    return a MapperOption that will convert the property of the given name
    into a non-load.  </p>
<p>used with query.options().
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def object_mapper(<i>object</i>, <i>raiseerror=True</i>)</b>
        <div class="docstring">
        <p>
    given an object, returns the primary Mapper associated with the object instance
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def object_session(<i>obj</i>)</b>
        <div class="docstring">
        <p>
    return the Session to which the given object is bound, or None if none.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def polymorphic_union(<i>table_map</i>, <i>typecolname</i>, <i>aliasname='p_union'</i>)</b>
        <div class="docstring">
        <p>
    create a UNION statement used by a polymorphic mapper.</p>
<p>See the SQLAlchemy advanced mapping docs for an example of how this is used.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def relation(<i>*args</i>, <i>**kwargs</i>)</b>
        <div class="docstring">
        <p>
    provide a relationship of a primary Mapper to a secondary Mapper.</p>
<p>This corresponds to a parent-child or associative table relationship.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def synonym(<i>name</i>, <i>proxy=False</i>)</b>
        <div class="docstring">
        <p>
    set up 'name' as a synonym to another MapperProperty.  </p>
<p>Used with the 'properties' dictionary sent to mapper().
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def undefer(<i>name</i>)</b>
        <div class="docstring">
        <p>
    return a MapperOption that will convert the column property of the given
    name into a non-deferred (regular column) load.  </p>
<p>used with query.options().
</p>
        </div>
        </div>


    </div>

    <a href="#docstrings" class="toclink">back to section top</a>
</div>




      
    


<A name="docstrings_sqlalchemy.orm_MapperExtension"></a>

<div class="subsection" style="margin-left:30px;">


<h3>class MapperExtension(object)</h3>

    <div class="sectiontext">
    
<p>
    base implementation for an object that provides overriding behavior to various
    Mapper functions.  For each method in MapperExtension, a result of EXT_PASS indicates
    the functionality is not overridden.
</p>


    
            <div class="darkcell">
        <A name=""></a>
        <b>def after_delete(<i>self</i>, <i>mapper</i>, <i>connection</i>, <i>instance</i>)</b>
        <div class="docstring">
        <p>
    receive an object instance after that instance is DELETEed.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def after_insert(<i>self</i>, <i>mapper</i>, <i>connection</i>, <i>instance</i>)</b>
        <div class="docstring">
        <p>
    receive an object instance after that instance is INSERTed.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def after_update(<i>self</i>, <i>mapper</i>, <i>connection</i>, <i>instance</i>)</b>
        <div class="docstring">
        <p>
    receive an object instance after that instance is UPDATEed.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def append_result(<i>self</i>, <i>mapper</i>, <i>selectcontext</i>, <i>row</i>, <i>instance</i>, <i>identitykey</i>, <i>result</i>, <i>isnew</i>)</b>
        <div class="docstring">
        <p>
    receive an object instance before that instance is appended to a result list.</p>
<p>If this method returns EXT_PASS, result appending will proceed normally.  
        if this method returns any other value or None, result appending will not proceed for 
        this instance, giving this extension an opportunity to do the appending itself, if desired.</p>
<p>mapper - the mapper doing the operation</p>
<p>selectcontext - SelectionContext corresponding to the instances() call</p>
<p>row - the result row from the database</p>
<p>instance - the object instance to be appended to the result</p>
<p>identitykey - the identity key of the instance</p>
<p>result - list to which results are being appended</p>
<p>isnew - indicates if this is the first time we have seen this object instance in the current result
        set.  if you are selecting from a join, such as an eager load, you might see the same object instance
        many times in the same result set.</p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def before_delete(<i>self</i>, <i>mapper</i>, <i>connection</i>, <i>instance</i>)</b>
        <div class="docstring">
        <p>
    receive an object instance before that instance is DELETEed.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def before_insert(<i>self</i>, <i>mapper</i>, <i>connection</i>, <i>instance</i>)</b>
        <div class="docstring">
        <p>
    receive an object instance before that instance is INSERTed into its table.</p>
<p>this is a good place to set up primary key values and such that arent handled otherwise.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def before_update(<i>self</i>, <i>mapper</i>, <i>connection</i>, <i>instance</i>)</b>
        <div class="docstring">
        <p>
    receive an object instance before that instance is UPDATEed.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def create_instance(<i>self</i>, <i>mapper</i>, <i>selectcontext</i>, <i>row</i>, <i>class_</i>)</b>
        <div class="docstring">
        <p>
    receieve a row when a new object instance is about to be created from that row.  
        the method can choose to create the instance itself, or it can return 
        None to indicate normal object creation should take place.</p>
<p>mapper - the mapper doing the operation</p>
<p>selectcontext - SelectionContext corresponding to the instances() call</p>
<p>row - the result row from the database</p>
<p>class_ - the class we are mapping.</p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def get(<i>self</i>, <i>query</i>, <i>*args</i>, <i>**kwargs</i>)</b>
        <div class="docstring">
        <p>
    override the get method of the Query object.</p>
<p>the return value of this method is used as the result of query.get() if the
        value is anything other than EXT_PASS.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def get_by(<i>self</i>, <i>query</i>, <i>*args</i>, <i>**kwargs</i>)</b>
        <div class="docstring">
        <p>
    override the get_by method of the Query object.</p>
<p>the return value of this method is used as the result of query.get_by() if the
        value is anything other than EXT_PASS.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def get_session(<i>self</i>)</b>
        <div class="docstring">
        <p>
    retrieve a contextual Session instance with which to register a new object. </p>
<p>Note: this is not called if a session is provided with the __init__ params (i.e. _sa_session)
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def load(<i>self</i>, <i>query</i>, <i>*args</i>, <i>**kwargs</i>)</b>
        <div class="docstring">
        <p>
    override the load method of the Query object.</p>
<p>the return value of this method is used as the result of query.load() if the
        value is anything other than EXT_PASS.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def populate_instance(<i>self</i>, <i>mapper</i>, <i>selectcontext</i>, <i>row</i>, <i>instance</i>, <i>identitykey</i>, <i>isnew</i>)</b>
        <div class="docstring">
        <p>
    receive a newly-created instance before that instance has its attributes populated.</p>
<p>The normal population of attributes is according to each
        attribute's corresponding MapperProperty (which includes column-based attributes as well
        as relationships to other classes).  If this method returns EXT_PASS, instance population
        will proceed normally.  If any other value or None is returned, instance population
        will not proceed, giving this extension an opportunity to populate the instance itself, 
        if desired.</p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def select(<i>self</i>, <i>query</i>, <i>*args</i>, <i>**kwargs</i>)</b>
        <div class="docstring">
        <p>
    override the select method of the Query object.</p>
<p>the return value of this method is used as the result of query.select() if the
        value is anything other than EXT_PASS.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def select_by(<i>self</i>, <i>query</i>, <i>*args</i>, <i>**kwargs</i>)</b>
        <div class="docstring">
        <p>
    override the select_by method of the Query object.</p>
<p>the return value of this method is used as the result of query.select_by() if the
        value is anything other than EXT_PASS.
</p>
        </div>
        </div>



    </div>

</div>




    </div>

    <a href="#docstrings" class="toclink">back to section top</a>
</div>




    


<A name="docstrings_sqlalchemy.orm.mapper"></a>

<div class="subsection" style="margin-left:20px;">


<h3>module sqlalchemy.orm.mapper</h3>

    <div class="sectiontext">
    
<p></p>
<p></p>




<A name="docstrings_sqlalchemy.orm.mapper_modfunc"></a>

<div class="subsection" style="margin-left:30px;">


<h3>Module Functions</h3>

    <div class="sectiontext">
    
    
            <div class="darkcell">
        <A name=""></a>
        <b>def class_mapper(<i>class_</i>, <i>entity_name=None</i>, <i>compile=True</i>)</b>
        <div class="docstring">
        <p>
    given a ClassKey, returns the primary Mapper associated with the key.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def object_mapper(<i>object</i>, <i>raiseerror=True</i>)</b>
        <div class="docstring">
        <p>
    given an object, returns the primary Mapper associated with the object instance
</p>
        </div>
        </div>


    </div>

    <a href="#docstrings" class="toclink">back to section top</a>
</div>




      
    


<A name="docstrings_sqlalchemy.orm.mapper_Mapper"></a>

<div class="subsection" style="margin-left:30px;">


<h3>class Mapper(object)</h3>

    <div class="sectiontext">
    
<p>
    Defines the correlation of class attributes to database table columns.</p>
<p>Instances of this class should be constructed via the sqlalchemy.orm.mapper() function.
</p>


    
            <div class="darkcell">
        <A name=""></a>
        <b>def __init__(<i>self</i>, <i>class_</i>, <i>local_table</i>, <i>properties=None</i>, <i>primary_key=None</i>, <i>non_primary=False</i>, <i>inherits=None</i>, <i>inherit_condition=None</i>, <i>extension=None</i>, <i>order_by=False</i>, <i>allow_column_override=False</i>, <i>entity_name=None</i>, <i>always_refresh=False</i>, <i>version_id_col=None</i>, <i>polymorphic_on=None</i>, <i>_polymorphic_map=None</i>, <i>polymorphic_identity=None</i>, <i>concrete=False</i>, <i>select_table=None</i>, <i>allow_null_pks=False</i>, <i>batch=True</i>, <i>column_prefix=None</i>)</b>
        <div class="docstring">
        <p>
    construct a new mapper.  </p>
<p>All arguments may be sent to the sqlalchemy.orm.mapper() function where they are
        passed through to here.</p>
<p>class_ - the class to be mapped.</p>
<p>local_table - the table to which the class is mapped, or None if this mapper inherits
        from another mapper using concrete table inheritance.</p>
<p>properties - a dictionary mapping the string names of object attributes to MapperProperty 
        instances, which define the persistence behavior of that attribute.  Note that the columns in the 
        mapped table are automatically converted into ColumnProperty instances based on the &quot;key&quot; 
        property of each Column (although they can be overridden using this dictionary).</p>
<p>primary_key - a list of Column objects which define the &quot;primary key&quot; to be used against this mapper's
        selectable unit.  This is normally simply the primary key of the &quot;local_table&quot;, but can be overridden here.</p>
<p>non_primary - construct a Mapper that will define only the selection of instances, not their persistence.</p>
<p>inherits - another Mapper for which this Mapper will have an inheritance relationship with.</p>
<p>inherit_condition - for joined table inheritance, a SQL expression (constructed ClauseElement) which 
        will define how the two tables are joined; defaults to a natural join between the two tables.</p>
<p>extension - a MapperExtension instance or list of MapperExtension instances which will be applied to
        all operations by this Mapper.</p>
<p>order_by - a single Column or list of Columns for which selection operations should use as the default
        ordering for entities.  Defaults to the OID/ROWID of the table if any, or the first primary key column of the table.</p>
<p>allow_column_override - if True, allows association relationships to be set up which override the usage of 
        a column that is on the table (based on key/attribute name).</p>
<p>entity_name - a name to be associated with the class, to allow alternate mappings for a single class.</p>
<p>always_refresh - if True, all query operations for this mapped class will overwrite all data
        within object instances that already exist within the session, erasing any in-memory changes with whatever
        information was loaded from the database.</p>
<p>version_id_col - a Column which must have an integer type that will be used to keep a running &quot;version id&quot; of
        mapped entities in the database.  this is used during save operations to insure that no other thread or process
        has updated the instance during the lifetime of the entity, else a ConcurrentModificationError exception is thrown.</p>
<p>polymorphic_on - used with mappers in an inheritance relationship, a Column which will identify the class/mapper
        combination to be used with a particular row.  requires the polymorphic_identity value to be set for all mappers
        in the inheritance hierarchy.</p>
<p>_polymorphic_map - used internally to propigate the full map of polymorphic identifiers to surrogate mappers.</p>
<p>polymorphic_identity - a value which will be stored in the Column denoted by polymorphic_on, corresponding to the
        &quot;class identity&quot; of this mapper.</p>
<p>concrete - if True, indicates this mapper should use concrete table inheritance with its parent mapper.</p>
<p>select_table - a Table or (more commonly) Selectable which will be used to select instances of this mapper's class.
        usually used to provide polymorphic loading among several classes in an inheritance hierarchy.</p>
<p>allow_null_pks - indicates that composite primary keys where one or more (but not all) columns contain NULL is a valid
        primary key.  Primary keys which contain NULL values usually indicate that a result row does not contain an entity
        and should be skipped.</p>
<p>batch - indicates that save operations of multiple entities can be batched together for efficiency.  
        setting to False indicates that an instance will be fully saved before saving the next instance, which 
        includes inserting/updating all table rows corresponding to the entity as well as calling all MapperExtension 
        methods corresponding to the save operation.</p>
<p>column_prefix - a string which will be prepended to the &quot;key&quot; name of all Columns when creating column-based
        properties from the given Table.  does not affect explicitly specified column-based properties</p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def add_properties(<i>self</i>, <i>dict_of_properties</i>)</b>
        <div class="docstring">
        <p>
    adds the given dictionary of properties to this mapper, using add_property.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def add_property(<i>self</i>, <i>key</i>, <i>prop</i>)</b>
        <div class="docstring">
        <p>
    add an indiviual MapperProperty to this mapper.  </p>
<p>If the mapper has not been compiled yet, just adds the property to the initial 
        properties dictionary sent to the constructor.  if this Mapper
        has already been compiled, then the given MapperProperty is compiled immediately.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def base_mapper(<i>self</i>)</b>
        <div class="docstring">
        <p>
    return the ultimate base mapper in an inheritance chain
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def cascade_callable(<i>self</i>, <i>type</i>, <i>object</i>, <i>callable_</i>, <i>recursive=None</i>, <i>halt_on=None</i>)</b>
        <div class="docstring">
        <p>
    execute a callable for each element in an object graph, for all relations that meet the given cascade rule.</p>
<p>type - the name of the cascade rule (i.e. save-update, delete, etc.)</p>
<p>object - the lead object instance.  child items will be processed per the relations
        defined for this object's mapper.</p>
<p>callable_ - the callable function.</p>
<p>recursive - used by the function for internal context during recursive calls, leave as None.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def cascade_iterator(<i>self</i>, <i>type</i>, <i>object</i>, <i>recursive=None</i>, <i>halt_on=None</i>)</b>
        <div class="docstring">
        <p>
    iterate each element in an object graph, for all relations taht meet the given cascade rule.</p>
<p>type - the name of the cascade rule (i.e. save-update, delete, etc.)</p>
<p>object - the lead object instance.  child items will be processed per the relations
        defined for this object's mapper.</p>
<p>recursive - used by the function for internal context during recursive calls, leave as None.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def common_parent(<i>self</i>, <i>other</i>)</b>
        <div class="docstring">
        <p>
    return true if the given mapper shares a common inherited parent as this mapper
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def compile(<i>self</i>)</b>
        <div class="docstring">
        <p>
    compile this mapper into its final internal format.</p>
<p>this is the 'external' version of the method which is not reentrant.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def delete_obj(<i>self</i>, <i>objects</i>, <i>uowtransaction</i>)</b>
        <div class="docstring">
        <p>
    issue DELETE statements for a list of objects.</p>
<p>this is called within the context of a UOWTransaction during a flush operation.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def get_attr_by_column(<i>self</i>, <i>obj</i>, <i>column</i>, <i>raiseerror=True</i>)</b>
        <div class="docstring">
        <p>
    return an instance attribute using a Column as the key.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def get_select_mapper(<i>self</i>)</b>
        <div class="docstring">
        <p>
    return the mapper used for issuing selects.</p>
<p>this mapper is the same mapper as 'self' unless the select_table argument was specified for this mapper.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def get_session(<i>self</i>)</b>
        <div class="docstring">
        <p>
    return the contextual session provided by the mapper extension chain, if any.</p>
<p>raises InvalidRequestError if a session cannot be retrieved from the extension chain</p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def has_eager(<i>self</i>)</b>
        <div class="docstring">
        <p>
    return True if one of the properties attached to this Mapper is eager loading
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def identity(<i>self</i>, <i>instance</i>)</b>
        <div class="docstring">
        <p>
    deprecated. a synoynm for primary_key_from_instance.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def identity_key(<i>self</i>, <i>primary_key</i>)</b>
        <div class="docstring">
        <p>
    deprecated.  a synonym for identity_key_from_primary_key.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def identity_key_from_instance(<i>self</i>, <i>instance</i>)</b>
        <div class="docstring">
        <p>
    return the identity key for the given instance, based on its primary key attributes.</p>
<p>this value is typically also found on the instance itself under the attribute name '_instance_key'.</p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def identity_key_from_primary_key(<i>self</i>, <i>primary_key</i>)</b>
        <div class="docstring">
        <p>
    return an identity-map key for use in storing/retrieving an item from an identity map.</p>
<p>primary_key - a list of values indicating the identifier.</p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def identity_key_from_row(<i>self</i>, <i>row</i>)</b>
        <div class="docstring">
        <p>
    return an identity-map key for use in storing/retrieving an item from the identity map.</p>
<p>row - a sqlalchemy.dbengine.RowProxy instance or other map corresponding result-set
        column names to their values within a row.</p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def instance_key(<i>self</i>, <i>instance</i>)</b>
        <div class="docstring">
        <p>
    deprecated.  a synonym for identity_key_from_instance.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def instances(<i>self</i>, <i>cursor</i>, <i>session</i>, <i>*mappers</i>, <i>**kwargs</i>)</b>
        <div class="docstring">
        <p>
    return a list of mapped instances corresponding to the rows in a given ResultProxy.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def is_assigned(<i>self</i>, <i>instance</i>)</b>
        <div class="docstring">
        <p>
    return True if this mapper handles the given instance.  </p>
<p>this is dependent not only on class assignment but the optional &quot;entity_name&quot; parameter as well.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def isa(<i>self</i>, <i>other</i>)</b>
        <div class="docstring">
        <p>
    return True if the given mapper inherits from this mapper
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def iterate_to_root(<i>self</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def polymorphic_iterator(<i>self</i>)</b>
        <div class="docstring">
        <p>
    iterates through the collection including this mapper and all descendant mappers.</p>
<p>this includes not just the immediately inheriting mappers but all their inheriting mappers as well.</p>
<p>To iterate through an entire hierarchy, use mapper.base_mapper().polymorphic_iterator().
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def populate_instance(<i>self</i>, <i>selectcontext</i>, <i>instance</i>, <i>row</i>, <i>identitykey</i>, <i>isnew</i>)</b>
        <div class="docstring">
        <p>
    populate an instance from a result row.</p>
<p>This method iterates through the list of MapperProperty objects attached to this Mapper
        and calls each properties execute() method.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def primary_key_from_instance(<i>self</i>, <i>instance</i>)</b>
        <div class="docstring">
        <p>
    return the list of primary key values for the given instance.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def primary_mapper(<i>self</i>)</b>
        <div class="docstring">
        <p>
    returns the primary mapper corresponding to this mapper's class key (class + entity_name)
</p>
        </div>
        </div>

    
             <div class="darkcell">
         <A name=""></a>
         <b>props = property()</b>
         <div class="docstring">
         <p>
    compiles this mapper if needed, and returns the     dictionary of MapperProperty objects associated with this mapper.
</p>
         </div> 
         </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def register_dependencies(<i>self</i>, <i>uowcommit</i>, <i>*args</i>, <i>**kwargs</i>)</b>
        <div class="docstring">
        <p>
    register DependencyProcessor instances with a unitofwork.UOWTransaction.</p>
<p>this calls register_dependencies on all attached MapperProperty instances.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def save_obj(<i>self</i>, <i>objects</i>, <i>uowtransaction</i>, <i>postupdate=False</i>, <i>post_update_cols=None</i>, <i>single=False</i>)</b>
        <div class="docstring">
        <p>
    issue INSERT and/or UPDATE statements for a list of objects.</p>
<p>this is called within the context of a UOWTransaction during a flush operation.</p>
<p>save_obj issues SQL statements not just for instances mapped directly by this mapper, but
        for instances mapped by all inheriting mappers as well.  This is to maintain proper insert
        ordering among a polymorphic chain of instances. Therefore save_obj is typically 
        called only on a &quot;base mapper&quot;, or a mapper which does not inherit from any other mapper.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def set_attr_by_column(<i>self</i>, <i>obj</i>, <i>column</i>, <i>value</i>)</b>
        <div class="docstring">
        <p>
    set the value of an instance attribute using a Column as the key.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def translate_row(<i>self</i>, <i>tomapper</i>, <i>row</i>)</b>
        <div class="docstring">
        <p>
    translate the column keys of a row into a new or proxied row that
        can be understood by another mapper.</p>
<p>This can be used in conjunction with populate_instance to populate
        an instance using an alternate mapper.
</p>
        </div>
        </div>



    </div>

</div>




    </div>

    <a href="#docstrings" class="toclink">back to section top</a>
</div>




    


<A name="docstrings_sqlalchemy.orm.query"></a>

<div class="subsection" style="margin-left:20px;">


<h3>module sqlalchemy.orm.query</h3>

    <div class="sectiontext">
    
<p></p>
<p></p>



      
    


<A name="docstrings_sqlalchemy.orm.query_Query"></a>

<div class="subsection" style="margin-left:30px;">


<h3>class Query(object)</h3>

    <div class="sectiontext">
    
<p>
    encapsulates the object-fetching operations provided by Mappers.
</p>


    
            <div class="darkcell">
        <A name=""></a>
        <b>def __init__(<i>self</i>, <i>class_or_mapper</i>, <i>session=None</i>, <i>entity_name=None</i>, <i>lockmode=None</i>, <i>with_options=None</i>, <i>extension=None</i>, <i>**kwargs</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def compile(<i>self</i>, <i>whereclause=None</i>, <i>**kwargs</i>)</b>
        <div class="docstring">
        <p>
    given a WHERE criterion, produce a ClauseElement-based statement suitable for usage in the execute() method.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def count(<i>self</i>, <i>whereclause=None</i>, <i>params=None</i>, <i>**kwargs</i>)</b>
        <div class="docstring">
        <p>
    given a WHERE criterion, create a SELECT COUNT statement, execute and return the resulting count value.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def count_by(<i>self</i>, <i>*args</i>, <i>**params</i>)</b>
        <div class="docstring">
        <p>
    returns the count of instances based on the given clauses and key/value criterion.
        The criterion is constructed in the same way as the select_by() method.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def execute(<i>self</i>, <i>clauseelement</i>, <i>params=None</i>, <i>*args</i>, <i>**kwargs</i>)</b>
        <div class="docstring">
        <p>
    execute the given ClauseElement-based statement against this Query's session/mapper, return the resulting list of instances.</p>
<p>After execution, closes the ResultProxy and its underlying resources.  
        This method is one step above the instances() method, which takes the executed statement's ResultProxy directly.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def get(<i>self</i>, <i>ident</i>, <i>**kwargs</i>)</b>
        <div class="docstring">
        <p>
    return an instance of the object based on the given identifier, or None if not found.  </p>
<p>The ident argument is a scalar or tuple of primary key column values
        in the order of the table def's primary key columns.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def get_by(<i>self</i>, <i>*args</i>, <i>**params</i>)</b>
        <div class="docstring">
        <p>
    return a single object instance based on the given key/value criterion.</p>
<p>this is either the first value in the result list, or None if the list is 
        empty.</p>
<p>the keys are mapped to property or column names mapped by this mapper's Table, and the values
        are coerced into a WHERE clause separated by AND operators.  If the local property/column
        names dont contain the key, a search will be performed against this mapper's immediate
        list of relations as well, forming the appropriate join conditions if a matching property
        is located.</p>
<p>e.g.   u = usermapper.get_by(user_name = 'fred')</p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def instances(<i>self</i>, <i>cursor</i>, <i>*mappers</i>, <i>**kwargs</i>)</b>
        <div class="docstring">
        <p>
    return a list of mapped instances corresponding to the rows in a given &quot;cursor&quot; (i.e. ResultProxy).
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def join_by(<i>self</i>, <i>*args</i>, <i>**params</i>)</b>
        <div class="docstring">
        <p>
    return a ClauseElement representing the WHERE clause that would normally be sent to select_whereclause() by select_by().
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def join_to(<i>self</i>, <i>key</i>)</b>
        <div class="docstring">
        <p>
    given the key name of a property, will recursively descend through all child properties
        from this Query's mapper to locate the property, and will return a ClauseElement
        representing a join from this Query's mapper to the endmost mapper.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def join_via(<i>self</i>, <i>keys</i>)</b>
        <div class="docstring">
        <p>
    given a list of keys that represents a path from this Query's mapper to a related mapper
        based on names of relations from one mapper to the next, returns a 
        ClauseElement representing a join from this Query's mapper to the endmost mapper.</p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def load(<i>self</i>, <i>ident</i>, <i>**kwargs</i>)</b>
        <div class="docstring">
        <p>
    return an instance of the object based on the given identifier. </p>
<p>If not found, raises an exception.  The method will *remove all pending changes* to the object
        already existing in the Session.  The ident argument is a scalar or tuple of primary
        key column values in the order of the table def's primary key columns.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def options(<i>self</i>, <i>*args</i>, <i>**kwargs</i>)</b>
        <div class="docstring">
        <p>
    return a new Query object, applying the given list of MapperOptions.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def select(<i>self</i>, <i>arg=None</i>, <i>**kwargs</i>)</b>
        <div class="docstring">
        <p>
    selects instances of the object from the database.  </p>
<p>arg can be any ClauseElement, which will form the criterion with which to
        load the objects.</p>
<p>For more advanced usage, arg can also be a Select statement object, which
        will be executed and its resulting rowset used to build new object instances.  
        in this case, the developer must insure that an adequate set of columns exists in the 
        rowset with which to build new object instances.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def select_by(<i>self</i>, <i>*args</i>, <i>**params</i>)</b>
        <div class="docstring">
        <p>
    return an array of object instances based on the given clauses and key/value criterion. </p>
<p>*args is a list of zero or more ClauseElements which will be connected by AND operators.</p>
<p>**params is a set of zero or more key/value parameters which are converted into ClauseElements.
        the keys are mapped to property or column names mapped by this mapper's Table, and the values
        are coerced into a WHERE clause separated by AND operators.  If the local property/column
        names dont contain the key, a search will be performed against this mapper's immediate
        list of relations as well, forming the appropriate join conditions if a matching property
        is located.</p>
<p>e.g.   result = usermapper.select_by(user_name = 'fred')</p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def select_statement(<i>self</i>, <i>statement</i>, <i>**params</i>)</b>
        <div class="docstring">
        <p>
    given a ClauseElement-based statement, execute and return the resulting instances.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def select_text(<i>self</i>, <i>text</i>, <i>**params</i>)</b>
        <div class="docstring">
        <p>
    given a literal string-based statement, execute and return the resulting instances.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def select_whereclause(<i>self</i>, <i>whereclause=None</i>, <i>params=None</i>, <i>**kwargs</i>)</b>
        <div class="docstring">
        <p>
    given a WHERE criterion, create a SELECT statement, execute and return the resulting instances.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def selectfirst(<i>self</i>, <i>*args</i>, <i>**params</i>)</b>
        <div class="docstring">
        <p>
    works like select(), but only returns the first result by itself, or None if no 
        objects returned.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def selectfirst_by(<i>self</i>, <i>*args</i>, <i>**params</i>)</b>
        <div class="docstring">
        <p>
    works like select_by(), but only returns the first result by itself, or None if no 
        objects returned.  Synonymous with get_by()
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def selectone(<i>self</i>, <i>*args</i>, <i>**params</i>)</b>
        <div class="docstring">
        <p>
    works like selectfirst(), but throws an error if not exactly one result was returned.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def selectone_by(<i>self</i>, <i>*args</i>, <i>**params</i>)</b>
        <div class="docstring">
        <p>
    works like selectfirst_by(), but throws an error if not exactly one result was returned.
</p>
        </div>
        </div>

    
             <div class="darkcell">
         <A name=""></a>
         <b>session = property()</b>
         <div class="docstring">
         <p></p>
<p></p>
         </div> 
         </div>

    
             <div class="darkcell">
         <A name=""></a>
         <b>table = property()</b>
         <div class="docstring">
         <p></p>
<p></p>
         </div> 
         </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def with_lockmode(<i>self</i>, <i>mode</i>)</b>
        <div class="docstring">
        <p>
    return a new Query object with the specified locking mode.
</p>
        </div>
        </div>



    </div>

    <a href="#docstrings" class="toclink">back to section top</a>
</div>



      
    


<A name="docstrings_sqlalchemy.orm.query_QueryContext"></a>

<div class="subsection" style="margin-left:30px;">


<h3>class QueryContext(OperationContext)</h3>

    <div class="sectiontext">
    
<p>
    created within the Query.compile() method to store and share
    state among all the Mappers and MapperProperty objects used in a query construction.
</p>


    
            <div class="darkcell">
        <A name=""></a>
        <b>def __init__(<i>self</i>, <i>query</i>, <i>kwargs</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def accept_option(<i>self</i>, <i>opt</i>)</b>
        <div class="docstring">
        <p>
    accept a MapperOption which will process (modify) the state of this QueryContext.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def select_args(<i>self</i>)</b>
        <div class="docstring">
        <p>
    return a dictionary of attributes from this QueryContext that can be applied to a sql.Select statement.
</p>
        </div>
        </div>



    </div>

    <a href="#docstrings" class="toclink">back to section top</a>
</div>



      
    


<A name="docstrings_sqlalchemy.orm.query_SelectionContext"></a>

<div class="subsection" style="margin-left:30px;">


<h3>class SelectionContext(OperationContext)</h3>

    <div class="sectiontext">
    
<p>
    created within the query.instances() method to store and share
    state among all the Mappers and MapperProperty objects used in a load operation.</p>
<p>SelectionContext contains these attributes:</p>
<p>mapper - the Mapper which originated the instances() call.</p>
<p>session - the Session that is relevant to the instances call.</p>
<p>identity_map - a dictionary which stores newly created instances that have
    not yet been added as persistent to the Session.</p>
<p>attributes - a dictionary to store arbitrary data; eager loaders use it to
    store additional result lists</p>
<p>populate_existing - indicates if its OK to overwrite the attributes of instances
    that were already in the Session</p>
<p>version_check - indicates if mappers that have version_id columns should verify
    that instances existing already within the Session should have this attribute compared
    to the freshly loaded value</p>
<p></p>


    
            <div class="darkcell">
        <A name=""></a>
        <b>def __init__(<i>self</i>, <i>mapper</i>, <i>session</i>, <i>**kwargs</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def accept_option(<i>self</i>, <i>opt</i>)</b>
        <div class="docstring">
        <p>
    accept a MapperOption which will process (modify) the state of this SelectionContext.
</p>
        </div>
        </div>



    </div>

</div>




    </div>

    <a href="#docstrings" class="toclink">back to section top</a>
</div>




    


<A name="docstrings_sqlalchemy.orm.session"></a>

<div class="subsection" style="margin-left:20px;">


<h3>module sqlalchemy.orm.session</h3>

    <div class="sectiontext">
    
<p></p>
<p></p>




<A name="docstrings_sqlalchemy.orm.session_modfunc"></a>

<div class="subsection" style="margin-left:30px;">


<h3>Module Functions</h3>

    <div class="sectiontext">
    
    
            <div class="darkcell">
        <A name=""></a>
        <b>def class_mapper(<i>class_</i>, <i>entity_name=None</i>, <i>compile=True</i>)</b>
        <div class="docstring">
        <p>
    given a ClassKey, returns the primary Mapper associated with the key.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def object_mapper(<i>object</i>, <i>raiseerror=True</i>)</b>
        <div class="docstring">
        <p>
    given an object, returns the primary Mapper associated with the object instance
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def object_session(<i>obj</i>)</b>
        <div class="docstring">
        <p>
    return the Session to which the given object is bound, or None if none.
</p>
        </div>
        </div>


    </div>

    <a href="#docstrings" class="toclink">back to section top</a>
</div>




      
    


<A name="docstrings_sqlalchemy.orm.session_Session"></a>

<div class="subsection" style="margin-left:30px;">


<h3>class Session(object)</h3>

    <div class="sectiontext">
    
<p>
    encapsulates a set of objects being operated upon within an object-relational operation.</p>
<p>The Session object is **not** threadsafe.  For thread-management of Sessions, see the
    sqlalchemy.ext.sessioncontext module.
</p>


    
            <div class="darkcell">
        <A name=""></a>
        <b>def __init__(<i>self</i>, <i>bind_to=None</i>, <i>hash_key=None</i>, <i>import_session=None</i>, <i>echo_uow=False</i>, <i>weak_identity_map=False</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def bind_mapper(<i>self</i>, <i>mapper</i>, <i>bindto</i>)</b>
        <div class="docstring">
        <p>
    bind the given Mapper to the given Engine or Connection.  </p>
<p>All subsequent operations involving this Mapper will use the given bindto.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def bind_table(<i>self</i>, <i>table</i>, <i>bindto</i>)</b>
        <div class="docstring">
        <p>
    bind the given Table to the given Engine or Connection.  </p>
<p>All subsequent operations involving this Table will use the given bindto.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def clear(<i>self</i>)</b>
        <div class="docstring">
        <p>
    removes all object instances from this Session.  this is equivalent to calling expunge() for all
        objects in this Session.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def close(<i>self</i>)</b>
        <div class="docstring">
        <p>
    closes this Session.  </p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def connect(<i>self</i>, <i>mapper=None</i>, <i>**kwargs</i>)</b>
        <div class="docstring">
        <p>
    returns a unique connection corresponding to the given mapper.  this connection
        will not be part of any pre-existing transactional context.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def connection(<i>self</i>, <i>mapper</i>, <i>**kwargs</i>)</b>
        <div class="docstring">
        <p>
    returns a Connection corresponding to the given mapper.  used by the execute()
        method which performs select operations for Mapper and Query.
        if this Session is transactional, 
        the connection will be in the context of this session's transaction.  otherwise, the connection
        is returned by the contextual_connect method, which some Engines override to return a thread-local
        connection, and will have close_with_result set to True.</p>
<p>the given **kwargs will be sent to the engine's contextual_connect() method, if no transaction is in progress.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def create_transaction(<i>self</i>, <i>**kwargs</i>)</b>
        <div class="docstring">
        <p>
    returns a new SessionTransaction corresponding to an existing or new transaction.
        if the transaction is new, the returned SessionTransaction will have commit control
        over the underlying transaction, else will have rollback control only.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def delete(<i>self</i>, <i>object</i>, <i>entity_name=None</i>)</b>
        <div class="docstring">
        <p>
    mark the given instance as deleted.</p>
<p>the delete operation occurs upon flush().
</p>
        </div>
        </div>

    
             <div class="darkcell">
         <A name=""></a>
         <b>deleted = property()</b>
         <div class="docstring">
         <p>
    a Set of all objects marked as 'deleted' within this Session
</p>
         </div> 
         </div>

    
             <div class="darkcell">
         <A name=""></a>
         <b>dirty = property()</b>
         <div class="docstring">
         <p>
    a Set of all objects marked as 'dirty' within this Session
</p>
         </div> 
         </div>

    
             <div class="darkcell">
         <A name=""></a>
         <b>echo_uow = property()</b>
         <div class="docstring">
         <p></p>
<p></p>
         </div> 
         </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def execute(<i>self</i>, <i>mapper</i>, <i>clause</i>, <i>params</i>, <i>**kwargs</i>)</b>
        <div class="docstring">
        <p>
    using the given mapper to identify the appropriate Engine or Connection to be used for statement execution, 
        executes the given ClauseElement using the provided parameter dictionary.  Returns a ResultProxy corresponding
        to the execution's results.  If this method allocates a new Connection for the operation, then the ResultProxy's close() 
        method will release the resources of the underlying Connection, otherwise its a no-op.</p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def expire(<i>self</i>, <i>obj</i>)</b>
        <div class="docstring">
        <p>
    mark the given object as expired.</p>
<p>this will add an instrumentation to all mapped attributes on the instance such that when
        an attribute is next accessed, the session will reload all attributes on the instance
        from the database.</p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def expunge(<i>self</i>, <i>object</i>)</b>
        <div class="docstring">
        <p>
    remove the given object from this Session.  </p>
<p>this will free all internal references to the object.  cascading will be applied according to the
        'expunge' cascade rule.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def flush(<i>self</i>, <i>objects=None</i>)</b>
        <div class="docstring">
        <p>
    flush all the object modifications present in this session to the database.  </p>
<p>'objects' is a list or tuple of objects specifically to be flushed; if None, all
        new and modified objects are flushed.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def get(<i>self</i>, <i>class_</i>, <i>ident</i>, <i>**kwargs</i>)</b>
        <div class="docstring">
        <p>
    return an instance of the object based on the given identifier, or None if not found.  </p>
<p>The ident argument is a scalar or tuple of primary key column values in the order of the 
        table def's primary key columns.</p>
<p>the entity_name keyword argument may also be specified which further qualifies the underlying
        Mapper used to perform the query.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def get_bind(<i>self</i>, <i>mapper</i>)</b>
        <div class="docstring">
        <p>
    return the Engine or Connection which is used to execute statements on behalf of the given Mapper.</p>
<p>Calling connect() on the return result will always result in a Connection object.  This method 
        disregards any SessionTransaction that may be in progress.</p>
<p>The order of searching is as follows:</p>
<p>if an Engine or Connection was bound to this Mapper specifically within this Session, returns that 
        Engine or Connection.</p>
<p>if an Engine or Connection was bound to this Mapper's underlying Table within this Session
        (i.e. not to the Table directly), returns that Engine or Conneciton.</p>
<p>if an Engine or Connection was bound to this Session, returns that Engine or Connection.</p>
<p>finally, returns the Engine which was bound directly to the Table's MetaData object.  </p>
<p>If no Engine is bound to the Table, an exception is raised.</p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def has_key(<i>self</i>, <i>key</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
             <div class="darkcell">
         <A name=""></a>
         <b>identity_map = property()</b>
         <div class="docstring">
         <p>
    a dictionary consisting of all objects within this Session keyed to their _instance_key value.
</p>
         </div> 
         </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def import_instance(<i>self</i>, <i>*args</i>, <i>**kwargs</i>)</b>
        <div class="docstring">
        <p>
    deprecated; a synynom for merge()
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def is_expired(<i>self</i>, <i>obj</i>, <i>unexpire=False</i>)</b>
        <div class="docstring">
        <p>
    return True if the given object has been marked as expired.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def load(<i>self</i>, <i>class_</i>, <i>ident</i>, <i>**kwargs</i>)</b>
        <div class="docstring">
        <p>
    return an instance of the object based on the given identifier. </p>
<p>If not found, raises an exception.  The method will *remove all pending changes* to the object
        already existing in the Session.  The ident argument is a scalar or tuple of
        primary key columns in the order of the table def's primary key columns.</p>
<p>the entity_name keyword argument may also be specified which further qualifies the underlying
        Mapper used to perform the query.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def mapper(<i>self</i>, <i>class_</i>, <i>entity_name=None</i>)</b>
        <div class="docstring">
        <p>
    given an Class, return the primary Mapper responsible for persisting it
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def merge(<i>self</i>, <i>object</i>, <i>entity_name=None</i>)</b>
        <div class="docstring">
        <p>
    merge the object into a newly loaded or existing instance from this Session.</p>
<p>note: this method is currently not completely implemented.
</p>
        </div>
        </div>

    
             <div class="darkcell">
         <A name=""></a>
         <b>new = property()</b>
         <div class="docstring">
         <p>
    a Set of all objects marked as 'new' within this Session.
</p>
         </div> 
         </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def query(<i>self</i>, <i>mapper_or_class</i>, <i>entity_name=None</i>, <i>**kwargs</i>)</b>
        <div class="docstring">
        <p>
    return a new Query object corresponding to this Session and the mapper, or the classes' primary mapper.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def refresh(<i>self</i>, <i>obj</i>)</b>
        <div class="docstring">
        <p>
    reload the attributes for the given object from the database, clear any changes made.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def save(<i>self</i>, <i>object</i>, <i>entity_name=None</i>)</b>
        <div class="docstring">
        <p></p>
<p>Add a transient (unsaved) instance to this Session.  </p>
<p>This operation cascades the &quot;save_or_update&quot; method to associated instances if the 
        relation is mapped with cascade=&quot;save-update&quot;.        </p>
<p>The 'entity_name' keyword argument will further qualify the specific Mapper used to handle this
        instance.</p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def save_or_update(<i>self</i>, <i>object</i>, <i>entity_name=None</i>)</b>
        <div class="docstring">
        <p>
    save or update the given object into this Session.</p>
<p>The presence of an '_instance_key' attribute on the instance determines whether to
        save() or update() the instance.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def scalar(<i>self</i>, <i>mapper</i>, <i>clause</i>, <i>params</i>, <i>**kwargs</i>)</b>
        <div class="docstring">
        <p>
    works like execute() but returns a scalar result.
</p>
        </div>
        </div>

    
             <div class="darkcell">
         <A name=""></a>
         <b>sql = property()</b>
         <div class="docstring">
         <p></p>
<p></p>
         </div> 
         </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def update(<i>self</i>, <i>object</i>, <i>entity_name=None</i>)</b>
        <div class="docstring">
        <p>
    Bring the given detached (saved) instance into this Session.</p>
<p>If there is a persistent instance with the same identifier already associated
        with this Session, an exception is thrown. </p>
<p>This operation cascades the &quot;save_or_update&quot; method to associated instances if the relation is mapped 
        with cascade=&quot;save-update&quot;.
</p>
        </div>
        </div>



    </div>

    <a href="#docstrings" class="toclink">back to section top</a>
</div>



      
    


<A name="docstrings_sqlalchemy.orm.session_SessionTransaction"></a>

<div class="subsection" style="margin-left:30px;">


<h3>class SessionTransaction(object)</h3>

    <div class="sectiontext">
    
<p>
    represents a Session-level Transaction.  This corresponds to one or
    more sqlalchemy.engine.Transaction instances behind the scenes, with one
    Transaction per Engine in use.</p>
<p>the SessionTransaction object is **not** threadsafe.
</p>


    
            <div class="darkcell">
        <A name=""></a>
        <b>def __init__(<i>self</i>, <i>session</i>, <i>parent=None</i>, <i>autoflush=True</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def add(<i>self</i>, <i>connectable</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def close(<i>self</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def commit(<i>self</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def connection(<i>self</i>, <i>mapper_or_class</i>, <i>entity_name=None</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def get_or_add(<i>self</i>, <i>connectable</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def rollback(<i>self</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>



    </div>

</div>




    </div>

    <a href="#docstrings" class="toclink">back to section top</a>
</div>




    


<A name="docstrings_sqlalchemy.pool"></a>

<div class="subsection" style="margin-left:20px;">


<h3>module sqlalchemy.pool</h3>

    <div class="sectiontext">
    
<p>
    provides a connection pool implementation, which optionally manages connections
on a thread local basis.  Also provides a DBAPI2 transparency layer so that pools can
be managed automatically, based on module type and connect arguments,
 simply by calling regular DBAPI connect() methods.
</p>




<A name="docstrings_sqlalchemy.pool_modfunc"></a>

<div class="subsection" style="margin-left:30px;">


<h3>Module Functions</h3>

    <div class="sectiontext">
    
    
            <div class="darkcell">
        <A name=""></a>
        <b>def clear_managers()</b>
        <div class="docstring">
        <p>
    removes all current DBAPI2 managers.  all pools and connections are disposed.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def manage(<i>module</i>, <i>**params</i>)</b>
        <div class="docstring">
        <p>
    given a DBAPI2 module and pool management parameters, returns a proxy for the module
    that will automatically pool connections, creating new connection pools for each 
    distinct set of connection arguments sent to the decorated module's connect() function.</p>
<p>Arguments:
    module : a DBAPI2 database module.</p>
<p>poolclass=QueuePool : the class used by the pool module to provide pooling.</p>
<p>Options:
    See Pool for options.</p>
<p></p>
        </div>
        </div>


    </div>

    <a href="#docstrings" class="toclink">back to section top</a>
</div>




      
    


<A name="docstrings_sqlalchemy.pool_AssertionPool"></a>

<div class="subsection" style="margin-left:30px;">


<h3>class AssertionPool(<a href="docstrings.html#docstrings_sqlalchemy.pool_Pool">Pool</a>)</h3>

    <div class="sectiontext">
    
<p>
    a Pool implementation which will raise an exception
    if more than one connection is checked out at a time.  Useful for debugging
    code that is using more connections than desired.</p>
<p>TODO: modify this to handle an arbitrary connection count.
</p>


    
            <div class="darkcell">
        <A name=""></a>
        <b>def __init__(<i>self</i>, <i>creator</i>, <i>**params</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def create_connection(<i>self</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def do_get(<i>self</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def do_return_conn(<i>self</i>, <i>conn</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def do_return_invalid(<i>self</i>, <i>conn</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def status(<i>self</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>



    </div>

    <a href="#docstrings" class="toclink">back to section top</a>
</div>



      
    


<A name="docstrings_sqlalchemy.pool_NullPool"></a>

<div class="subsection" style="margin-left:30px;">


<h3>class NullPool(<a href="docstrings.html#docstrings_sqlalchemy.pool_Pool">Pool</a>)</h3>

    <div class="sectiontext">
    
<p>
    a Pool implementation which does not pool connections; instead
    it literally opens and closes the underlying DBAPI connection per each connection open/close.
</p>


    
            <div class="darkcell">
        <A name=""></a>
        <b>def do_get(<i>self</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def do_return_conn(<i>self</i>, <i>conn</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def do_return_invalid(<i>self</i>, <i>conn</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def status(<i>self</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>



    </div>

    <a href="#docstrings" class="toclink">back to section top</a>
</div>



      
    


<A name="docstrings_sqlalchemy.pool_Pool"></a>

<div class="subsection" style="margin-left:30px;">


<h3>class Pool(object)</h3>

    <div class="sectiontext">
    
<p>
    Base Pool class.  This is an abstract class, which is implemented by various subclasses
    including:</p>
<p>QueuePool  -          pools multiple connections using Queue.Queue</p>
<p>SingletonThreadPool - stores a single connection per execution thread</p>
<p>NullPool -            doesnt do any pooling; opens and closes connections</p>
<p>AssertionPool -       stores only one connection, and asserts that only one connection is checked out at a time.</p>
<p>the main argument, &quot;creator&quot;, is a callable function that returns a newly connected DBAPI connection
    object.</p>
<p>Options that are understood by Pool are:</p>
<p>echo=False : if set to True, connections being pulled and retrieved from/to the pool will
    be logged to the standard output, as well as pool sizing information.  Echoing can also
    be achieved by enabling logging for the &quot;sqlalchemy.pool&quot; namespace.</p>
<p>use_threadlocal=True : if set to True, repeated calls to connect() within the same
    application thread will be guaranteed to return the same connection object, if one has
    already been retrieved from the pool and has not been returned yet. This allows code to
    retrieve a connection from the pool, and then while still holding on to that connection,
    to call other functions which also ask the pool for a connection of the same arguments;
    those functions will act upon the same connection that the calling method is using.</p>
<p>recycle=-1 : if set to non -1, a number of seconds between connection recycling, which
    means upon checkout, if this timeout is surpassed the connection will be closed and replaced
    with a newly opened connection.</p>
<p>auto_close_cursors = True : cursors, returned by connection.cursor(), are tracked and are 
    automatically closed when the connection is returned to the pool.  some DBAPIs like MySQLDB
    become unstable if cursors remain open.</p>
<p>disallow_open_cursors = False : if auto_close_cursors is False, and disallow_open_cursors is True,
    will raise an exception if an open cursor is detected upon connection checkin.</p>
<p>If auto_close_cursors and disallow_open_cursors are both False, then no cursor processing
    occurs upon checkin.</p>
<p></p>


    
            <div class="darkcell">
        <A name=""></a>
        <b>def __init__(<i>self</i>, <i>creator</i>, <i>recycle=-1</i>, <i>echo=None</i>, <i>use_threadlocal=False</i>, <i>auto_close_cursors=True</i>, <i>disallow_open_cursors=False</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def connect(<i>self</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def create_connection(<i>self</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def dispose(<i>self</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def do_get(<i>self</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def do_return_conn(<i>self</i>, <i>conn</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def get(<i>self</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def log(<i>self</i>, <i>msg</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def return_conn(<i>self</i>, <i>agent</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def status(<i>self</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def unique_connection(<i>self</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>



    </div>

    <a href="#docstrings" class="toclink">back to section top</a>
</div>



      
    


<A name="docstrings_sqlalchemy.pool_QueuePool"></a>

<div class="subsection" style="margin-left:30px;">


<h3>class QueuePool(<a href="docstrings.html#docstrings_sqlalchemy.pool_Pool">Pool</a>)</h3>

    <div class="sectiontext">
    
<p>
    uses Queue.Queue to maintain a fixed-size list of connections.</p>
<p>Arguments include all those used by the base Pool class, as well as:</p>
<p>pool_size=5 : the size of the pool to be maintained. This is the
    largest number of connections that will be kept persistently in the pool. Note that the
    pool begins with no connections; once this number of connections is requested, that
    number of connections will remain.</p>
<p>max_overflow=10 : the maximum overflow size of the pool. When the number of checked-out
    connections reaches the size set in pool_size, additional connections will be returned up
    to this limit. When those additional connections are returned to the pool, they are
    disconnected and discarded. It follows then that the total number of simultaneous
    connections the pool will allow is pool_size + max_overflow, and the total number of
    &quot;sleeping&quot; connections the pool will allow is pool_size. max_overflow can be set to -1 to
    indicate no overflow limit; no limit will be placed on the total number of concurrent
    connections.</p>
<p>timeout=30 : the number of seconds to wait before giving up on returning a connection</p>
<p></p>


    
            <div class="darkcell">
        <A name=""></a>
        <b>def __init__(<i>self</i>, <i>creator</i>, <i>pool_size=5</i>, <i>max_overflow=10</i>, <i>timeout=30</i>, <i>**params</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def checkedin(<i>self</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def checkedout(<i>self</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def dispose(<i>self</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def do_get(<i>self</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def do_return_conn(<i>self</i>, <i>conn</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def overflow(<i>self</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def size(<i>self</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def status(<i>self</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>



    </div>

    <a href="#docstrings" class="toclink">back to section top</a>
</div>



      
    


<A name="docstrings_sqlalchemy.pool_SingletonThreadPool"></a>

<div class="subsection" style="margin-left:30px;">


<h3>class SingletonThreadPool(<a href="docstrings.html#docstrings_sqlalchemy.pool_Pool">Pool</a>)</h3>

    <div class="sectiontext">
    
<p>
    Maintains one connection per each thread, never moving a connection to a thread
    other than the one which it was created in.</p>
<p>this is used for SQLite, which both does not handle multithreading by default,
    and also requires a singleton connection if a :memory: database is being used.</p>
<p>options are the same as those of Pool, as well as:</p>
<p>pool_size=5 - the number of threads in which to maintain connections at once.
</p>


    
            <div class="darkcell">
        <A name=""></a>
        <b>def __init__(<i>self</i>, <i>creator</i>, <i>pool_size=5</i>, <i>**params</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def cleanup(<i>self</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def dispose(<i>self</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def dispose_local(<i>self</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def do_get(<i>self</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def do_return_conn(<i>self</i>, <i>conn</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def status(<i>self</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>



    </div>

</div>




    </div>

    <a href="#docstrings" class="toclink">back to section top</a>
</div>




    


<A name="docstrings_sqlalchemy.ext.sessioncontext"></a>

<div class="subsection" style="margin-left:20px;">


<h3>module sqlalchemy.ext.sessioncontext</h3>

    <div class="sectiontext">
    
<p></p>
<p></p>



      
    


<A name="docstrings_sqlalchemy.ext.sessioncontext_SessionContext"></a>

<div class="subsection" style="margin-left:30px;">


<h3>class SessionContext(object)</h3>

    <div class="sectiontext">
    
<p>
    A simple wrapper for ScopedRegistry that provides a &quot;current&quot; property
    which can be used to get, set, or remove the session in the current scope.</p>
<p>By default this object provides thread-local scoping, which is the default
    scope provided by sqlalchemy.util.ScopedRegistry.</p>
<p>Usage:
        engine = create_engine(...)
        def session_factory():
            return Session(bind_to=engine)
        context = SessionContext(session_factory)</p>
<p>s = context.current # get thread-local session
        context.current = Session(bind_to=other_engine) # set current session
        del context.current # discard the thread-local session (a new one will
                            # be created on the next call to context.current)</p>
<p></p>


    
            <div class="darkcell">
        <A name=""></a>
        <b>def __init__(<i>self</i>, <i>session_factory</i>, <i>scopefunc=None</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
             <div class="darkcell">
         <A name=""></a>
         <b>current = property()</b>
         <div class="docstring">
         <p>
    Property used to get/set/del the session in the current scope
</p>
         </div> 
         </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def del_current(<i>self</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def get_current(<i>self</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
             <div class="darkcell">
         <A name=""></a>
         <b>mapper_extension = property()</b>
         <div class="docstring">
         <p>
    get a mapper extension that implements get_session using this context
</p>
         </div> 
         </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def set_current(<i>self</i>, <i>session</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>



    </div>

    <a href="#docstrings" class="toclink">back to section top</a>
</div>



      
    


<A name="docstrings_sqlalchemy.ext.sessioncontext_SessionContextExt"></a>

<div class="subsection" style="margin-left:30px;">


<h3>class SessionContextExt(<a href="docstrings.html#docstrings_sqlalchemy.orm_MapperExtension">MapperExtension</a>)</h3>

    <div class="sectiontext">
    
<p>
    a mapper extionsion that provides sessions to a mapper using SessionContext
</p>


    
            <div class="darkcell">
        <A name=""></a>
        <b>def __init__(<i>self</i>, <i>context</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def get_session(<i>self</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>



    </div>

</div>




    </div>

    <a href="#docstrings" class="toclink">back to section top</a>
</div>




    


<A name="docstrings_sqlalchemy.mods.threadlocal"></a>

<div class="subsection" style="margin-left:20px;">


<h3>module sqlalchemy.mods.threadlocal</h3>

    <div class="sectiontext">
    
<p>
    this plugin installs thread-local behavior at the Engine and Session level.</p>
<p>The default Engine strategy will be &quot;threadlocal&quot;, producing TLocalEngine instances for create_engine by default.
With this engine, connect() method will return the same connection on the same thread, if it is already checked out
from the pool.  this greatly helps functions that call multiple statements to be able to easily use just one connection
without explicit &quot;close&quot; statements on result handles.</p>
<p>on the Session side, module-level methods will be installed within the objectstore module, such as flush(), delete(), etc.
which call this method on the thread-local session.</p>
<p>Note: this mod creates a global, thread-local session context named sqlalchemy.objectstore. All mappers created
while this mod is installed will reference this global context when creating new mapped object instances.</p>
<p></p>




<A name="docstrings_sqlalchemy.mods.threadlocal_modfunc"></a>

<div class="subsection" style="margin-left:30px;">


<h3>Module Functions</h3>

    <div class="sectiontext">
    
    
            <div class="darkcell">
        <A name=""></a>
        <b>def assign_mapper(<i>class_</i>, <i>*args</i>, <i>**kwargs</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>


    </div>

    <a href="#docstrings" class="toclink">back to section top</a>
</div>




      
    


<A name="docstrings_sqlalchemy.mods.threadlocal_Objectstore"></a>

<div class="subsection" style="margin-left:30px;">


<h3>class Objectstore(object)</h3>

    <div class="sectiontext">
    
<p></p>
<p></p>


    
            <div class="darkcell">
        <A name=""></a>
        <b>def __init__(<i>self</i>, <i>*args</i>, <i>**kwargs</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
             <div class="darkcell">
         <A name=""></a>
         <b>session = property()</b>
         <div class="docstring">
         <p></p>
<p></p>
         </div> 
         </div>



    </div>

</div>




    </div>

    <a href="#docstrings" class="toclink">back to section top</a>
</div>




    


<A name="docstrings_sqlalchemy.ext.selectresults"></a>

<div class="subsection" style="margin-left:20px;">


<h3>module sqlalchemy.ext.selectresults</h3>

    <div class="sectiontext">
    
<p></p>
<p></p>



      
    


<A name="docstrings_sqlalchemy.ext.selectresults_SelectResults"></a>

<div class="subsection" style="margin-left:30px;">


<h3>class SelectResults(object)</h3>

    <div class="sectiontext">
    
<p>
    Builds a query one component at a time via separate method calls, 
    each call transforming the previous SelectResults instance into a new SelectResults 
    instance with further limiting criterion added. When interpreted
    in an iterator context (such as via calling list(selectresults)), executes the query.
</p>


    
            <div class="darkcell">
        <A name=""></a>
        <b>def __init__(<i>self</i>, <i>query</i>, <i>clause=None</i>, <i>ops={}</i>, <i>joinpoint=None</i>)</b>
        <div class="docstring">
        <p>
    constructs a new SelectResults using the given Query object and optional WHERE 
        clause.  ops is an optional dictionary of bind parameter values.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def avg(<i>self</i>, <i>col</i>)</b>
        <div class="docstring">
        <p>
    executes the SQL avg() function against the given column
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def clone(<i>self</i>)</b>
        <div class="docstring">
        <p>
    creates a copy of this SelectResults.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def compile(<i>self</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def count(<i>self</i>)</b>
        <div class="docstring">
        <p>
    executes the SQL count() function against the SelectResults criterion.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def filter(<i>self</i>, <i>clause</i>)</b>
        <div class="docstring">
        <p>
    applies an additional WHERE clause against the query.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def join_to(<i>self</i>, <i>prop</i>)</b>
        <div class="docstring">
        <p>
    join the table of this SelectResults to the table located against the given property name.</p>
<p>subsequent calls to join_to or outerjoin_to will join against the rightmost table located from the 
        previous join_to or outerjoin_to call, searching for the property starting with the rightmost mapper
        last located.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def limit(<i>self</i>, <i>limit</i>)</b>
        <div class="docstring">
        <p>
    apply a LIMIT to the query.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def list(<i>self</i>)</b>
        <div class="docstring">
        <p>
    return the results represented by this SelectResults as a list.  </p>
<p>this results in an execution of the underlying query.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def max(<i>self</i>, <i>col</i>)</b>
        <div class="docstring">
        <p>
    executes the SQL max() function against the given column
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def min(<i>self</i>, <i>col</i>)</b>
        <div class="docstring">
        <p>
    executes the SQL min() function against the given column
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def offset(<i>self</i>, <i>offset</i>)</b>
        <div class="docstring">
        <p>
    apply an OFFSET to the query.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def order_by(<i>self</i>, <i>order_by</i>)</b>
        <div class="docstring">
        <p>
    apply an ORDER BY to the query.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def outerjoin_to(<i>self</i>, <i>prop</i>)</b>
        <div class="docstring">
        <p>
    outer join the table of this SelectResults to the table located against the given property name.</p>
<p>subsequent calls to join_to or outerjoin_to will join against the rightmost table located from the 
        previous join_to or outerjoin_to call, searching for the property starting with the rightmost mapper
        last located.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def select(<i>self</i>, <i>clause</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def select_from(<i>self</i>, <i>from_obj</i>)</b>
        <div class="docstring">
        <p>
    set the from_obj parameter of the query to a specific table or set of tables.</p>
<p>from_obj is a list.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def sum(<i>self</i>, <i>col</i>)</b>
        <div class="docstring">
        <p>
    executes the SQL sum() function against the given column
</p>
        </div>
        </div>



    </div>

    <a href="#docstrings" class="toclink">back to section top</a>
</div>



      
    


<A name="docstrings_sqlalchemy.ext.selectresults_SelectResultsExt"></a>

<div class="subsection" style="margin-left:30px;">


<h3>class SelectResultsExt(<a href="docstrings.html#docstrings_sqlalchemy.orm_MapperExtension">MapperExtension</a>)</h3>

    <div class="sectiontext">
    
<p>
    a MapperExtension that provides SelectResults functionality for the 
    results of query.select_by() and query.select()
</p>


    
            <div class="darkcell">
        <A name=""></a>
        <b>def select(<i>self</i>, <i>query</i>, <i>arg=None</i>, <i>**kwargs</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def select_by(<i>self</i>, <i>query</i>, <i>*args</i>, <i>**params</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>



    </div>

</div>




    </div>

    <a href="#docstrings" class="toclink">back to section top</a>
</div>




    


<A name="docstrings_sqlalchemy.exceptions"></a>

<div class="subsection" style="margin-left:20px;">


<h3>module sqlalchemy.exceptions</h3>

    <div class="sectiontext">
    
<p></p>
<p></p>



      
    


<A name="docstrings_sqlalchemy.exceptions_ArgumentError"></a>

<div class="subsection" style="margin-left:30px;">


<h3>class ArgumentError()</h3>

    <div class="sectiontext">
    
<p>
    raised for all those conditions where invalid arguments are sent to constructed
    objects.  This error generally corresponds to construction time state errors.
</p>




    </div>

    <a href="#docstrings" class="toclink">back to section top</a>
</div>



      
    


<A name="docstrings_sqlalchemy.exceptions_AssertionError"></a>

<div class="subsection" style="margin-left:30px;">


<h3>class AssertionError()</h3>

    <div class="sectiontext">
    
<p>
    corresponds to internal state being detected in an invalid state
</p>




    </div>

    <a href="#docstrings" class="toclink">back to section top</a>
</div>



      
    


<A name="docstrings_sqlalchemy.exceptions_ConcurrentModificationError"></a>

<div class="subsection" style="margin-left:30px;">


<h3>class ConcurrentModificationError()</h3>

    <div class="sectiontext">
    
<p>
    raised when a concurrent modification condition is detected
</p>




    </div>

    <a href="#docstrings" class="toclink">back to section top</a>
</div>



      
    


<A name="docstrings_sqlalchemy.exceptions_DBAPIError"></a>

<div class="subsection" style="margin-left:30px;">


<h3>class DBAPIError()</h3>

    <div class="sectiontext">
    
<p>
    something weird happened with a particular DBAPI version
</p>


    
            <div class="darkcell">
        <A name=""></a>
        <b>def __init__(<i>self</i>, <i>message</i>, <i>orig</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>



    </div>

    <a href="#docstrings" class="toclink">back to section top</a>
</div>



      
    


<A name="docstrings_sqlalchemy.exceptions_FlushError"></a>

<div class="subsection" style="margin-left:30px;">


<h3>class FlushError()</h3>

    <div class="sectiontext">
    
<p>
    raised when an invalid condition is detected upon a flush()
</p>




    </div>

    <a href="#docstrings" class="toclink">back to section top</a>
</div>



      
    


<A name="docstrings_sqlalchemy.exceptions_InvalidRequestError"></a>

<div class="subsection" style="margin-left:30px;">


<h3>class InvalidRequestError()</h3>

    <div class="sectiontext">
    
<p>
    sqlalchemy was asked to do something it cant do, return nonexistent data, etc.
    This error generally corresponds to runtime state errors.
</p>




    </div>

    <a href="#docstrings" class="toclink">back to section top</a>
</div>



      
    


<A name="docstrings_sqlalchemy.exceptions_NoSuchColumnError"></a>

<div class="subsection" style="margin-left:30px;">


<h3>class NoSuchColumnError()</h3>

    <div class="sectiontext">
    
<p>
    raised by RowProxy when a nonexistent column is requested from a row
</p>




    </div>

    <a href="#docstrings" class="toclink">back to section top</a>
</div>



      
    


<A name="docstrings_sqlalchemy.exceptions_NoSuchTableError"></a>

<div class="subsection" style="margin-left:30px;">


<h3>class NoSuchTableError()</h3>

    <div class="sectiontext">
    
<p>
    sqlalchemy was asked to load a table's definition from the database,
    but the table doesn't exist.
</p>




    </div>

    <a href="#docstrings" class="toclink">back to section top</a>
</div>



      
    


<A name="docstrings_sqlalchemy.exceptions_SQLAlchemyError"></a>

<div class="subsection" style="margin-left:30px;">


<h3>class SQLAlchemyError()</h3>

    <div class="sectiontext">
    
<p>
    generic error class
</p>




    </div>

    <a href="#docstrings" class="toclink">back to section top</a>
</div>



      
    


<A name="docstrings_sqlalchemy.exceptions_SQLError"></a>

<div class="subsection" style="margin-left:30px;">


<h3>class SQLError()</h3>

    <div class="sectiontext">
    
<p>
    raised when the execution of a SQL statement fails.  includes accessors
    for the underlying exception, as well as the SQL and bind parameters
</p>


    
            <div class="darkcell">
        <A name=""></a>
        <b>def __init__(<i>self</i>, <i>statement</i>, <i>params</i>, <i>orig</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>



    </div>

    <a href="#docstrings" class="toclink">back to section top</a>
</div>



      
    


<A name="docstrings_sqlalchemy.exceptions_TimeoutError"></a>

<div class="subsection" style="margin-left:30px;">


<h3>class TimeoutError()</h3>

    <div class="sectiontext">
    
<p>
    raised when a connection pool times out on getting a connection
</p>




    </div>

</div>




    </div>

    <a href="#docstrings" class="toclink">back to section top</a>
</div>




    


<A name="docstrings_sqlalchemy.ext.proxy"></a>

<div class="subsection" style="margin-left:20px;">


<h3>module sqlalchemy.ext.proxy</h3>

    <div class="sectiontext">
    
<p></p>
<p></p>



      
    


<A name="docstrings_sqlalchemy.ext.proxy_AutoConnectEngine"></a>

<div class="subsection" style="margin-left:30px;">


<h3>class AutoConnectEngine(<a href="docstrings.html#docstrings_sqlalchemy.ext.proxy_BaseProxyEngine">BaseProxyEngine</a>)</h3>

    <div class="sectiontext">
    
<p>
    An SQLEngine proxy that automatically connects when necessary.
</p>


    
            <div class="darkcell">
        <A name=""></a>
        <b>def __init__(<i>self</i>, <i>dburi</i>, <i>**kwargs</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def get_engine(<i>self</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>



    </div>

    <a href="#docstrings" class="toclink">back to section top</a>
</div>



      
    


<A name="docstrings_sqlalchemy.ext.proxy_BaseProxyEngine"></a>

<div class="subsection" style="margin-left:30px;">


<h3>class BaseProxyEngine(<a href="docstrings.html#docstrings_sqlalchemy.sql_Executor">Executor</a>)</h3>

    <div class="sectiontext">
    
<p>
    Basis for all proxy engines.
</p>


    
            <div class="darkcell">
        <A name=""></a>
        <b>def compiler(<i>self</i>, <i>*args</i>, <i>**kwargs</i>)</b>
        <div class="docstring">
        <p>
    this method is required to be present as it overrides the compiler method present in sql.Engine
</p>
        </div>
        </div>

    
             <div class="darkcell">
         <A name=""></a>
         <b>engine = property()</b>
         <div class="docstring">
         <p></p>
<p></p>
         </div> 
         </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def execute_compiled(<i>self</i>, <i>*args</i>, <i>**kwargs</i>)</b>
        <div class="docstring">
        <p>
    this method is required to be present as it overrides the execute_compiled present in sql.Engine
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def get_engine(<i>self</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def set_engine(<i>self</i>, <i>engine</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>



    </div>

    <a href="#docstrings" class="toclink">back to section top</a>
</div>



      
    


<A name="docstrings_sqlalchemy.ext.proxy_ProxyEngine"></a>

<div class="subsection" style="margin-left:30px;">


<h3>class ProxyEngine(<a href="docstrings.html#docstrings_sqlalchemy.ext.proxy_BaseProxyEngine">BaseProxyEngine</a>)</h3>

    <div class="sectiontext">
    
<p>
    Engine proxy for lazy and late initialization.</p>
<p>This engine will delegate access to a real engine set with connect().</p>
<p></p>


    
            <div class="darkcell">
        <A name=""></a>
        <b>def __init__(<i>self</i>, <i>**kwargs</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def connect(<i>self</i>, <i>*args</i>, <i>**kwargs</i>)</b>
        <div class="docstring">
        <p>
    Establish connection to a real engine.
</p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def get_engine(<i>self</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>

    
            <div class="darkcell">
        <A name=""></a>
        <b>def set_engine(<i>self</i>, <i>engine</i>)</b>
        <div class="docstring">
        <p></p>
<p></p>
        </div>
        </div>



    </div>

</div>




    </div>

</div>



</div>

</div>



<center>
</center>
</body>
</html>




