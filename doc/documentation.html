<html>
<head>
	<title>
        SQLAlchemy Documentation
</title>
</head>
<body>



<link href="style.css" rel="stylesheet" type="text/css"></link>
<link href="syntaxhighlight.css" rel="stylesheet" type="text/css"></link>

<link href="docs.css" rel="stylesheet" type="text/css"></link>
<script src="scripts.js"></script>


<div style="position:absolute;left:0px;top:0px;"><a name="top"></a>&nbsp;</div>

<div class="doccontainer">

<div class="docheader">

<div class="docheadertext" >SQLAlchemy Documentation</div>
<div class="">Version: 0.1.4   Last Updated: 03/13/06 12:39:29</div>
</div>



	
		
	
	<div class="maintoc">
	
	
	<div class="topnavcontrol">
	View: <a href="index.html">Paged</a> &nbsp;|&nbsp; <b>One Page</b>
	</div>



	<a name="table_of_contents"></a>
	<span class="docheadertext">Table of Contents</span>
	&nbsp;&nbsp;
	<a href="#full_index">(view full table)</a>
	<br/><br/>
	
	<div style="margin-left:50px;">
	


    
    
    <div class="toclink">
        <A style="" href="#intro">Introduction</a>
    </div>
    


    
    
    <div class="toclink">
        <A style="" href="#pooling">Connection Pooling</a>
    </div>
    


    
    
    <div class="toclink">
        <A style="" href="#dbengine">Database Engines</a>
    </div>
    


    
    
    <div class="toclink">
        <A style="" href="#metadata">Database Meta Data</a>
    </div>
    


    
    
    <div class="toclink">
        <A style="" href="#sql">Constructing SQL Queries via Python Expressions</a>
    </div>
    


    
    
    <div class="toclink">
        <A style="" href="#datamapping">Basic Data Mapping</a>
    </div>
    


    
    
    <div class="toclink">
        <A style="" href="#unitofwork">Unit of Work</a>
    </div>
    


    
    
    <div class="toclink">
        <A style="" href="#adv_datamapping">Advanced Data Mapping</a>
    </div>
    


    
    
    <div class="toclink">
        <A style="" href="#types">The Types System</a>
    </div>
    


    
    
    <div class="toclink">
        <A style="" href="#docstrings">Modules and Classes</a>
    </div>
    



	</div>

	</div>


	<div class="maintoc">
	<a name="full_index"></a>
	<span class="docheadertext">Table of Contents: Full</span>
	&nbsp;&nbsp;
	<a href="#table_of_contents">(view brief table)</a>
	<br/><br/>

	<div style="margin-left:50px;">
	


    
    
    <div class="toclink">
        <A style="" href="#intro">Introduction</a>
    </div>
    
    <div class="toclinkcontainer">
        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#intro_trailmap">Trail Map</a>
    </div>

    </div>


    </div>


    
    
    <div class="toclink">
        <A style="" href="#pooling">Connection Pooling</a>
    </div>
    
    <div class="toclinkcontainer">
        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#pooling_establishing">Establishing a Transparent Connection Pool</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#pooling_configuration">Connection Pool Configuration</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#pooling_custom">Custom Pool Construction</a>
    </div>

    </div>


    </div>


    
    
    <div class="toclink">
        <A style="" href="#dbengine">Database Engines</a>
    </div>
    
    <div class="toclinkcontainer">
        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#dbengine_establishing">Establishing a Database Engine</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#dbengine_methods">Database Engine Methods</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#dbengine_options">Database Engine Options</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#dbengine_proxy">Using the Proxy Engine</a>
    </div>

        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#dbengine_proxy_defaultproxy">Using the Global Proxy</a>
    </div>

    </div>


    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#dbengine_transactions">Transactions</a>
    </div>

    </div>


    </div>


    
    
    <div class="toclink">
        <A style="" href="#metadata">Database Meta Data</a>
    </div>
    
    <div class="toclinkcontainer">
        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#metadata_tables">Describing Tables with MetaData</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#metadata_creating">Creating and Dropping Database Tables</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#metadata_defaults">Column Defaults and OnUpdates</a>
    </div>

        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#metadata_defaults_oninsert">Pre-Executed Insert Defaults</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#metadata_defaults_onupdate">Pre-Executed OnUpdate Defaults</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#metadata_defaults_passive">Inline Default Execution: PassiveDefault</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#metadata_defaults_sequences">Defining Sequences</a>
    </div>

    </div>


    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#metadata_indexes">Defining Indexes</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#metadata_adapting">Adapting Tables to Alternate Engines</a>
    </div>

        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#metadata_adapting_primitives">Non-engine primitives: TableClause/ColumnClause</a>
    </div>

    </div>


    </div>


    </div>


    
    
    <div class="toclink">
        <A style="" href="#sql">Constructing SQL Queries via Python Expressions</a>
    </div>
    
    <div class="toclinkcontainer">
        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#sql_select">Simple Select</a>
    </div>

        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#sql_select_labels">Using Column Labels</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#sql_select_columns">Table/Column Specification</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#sql_select_whereclause">WHERE Clause</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#sql_select_engine">Specifying the Engine</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#sql_select_functions">Functions</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#sql_select_literals">Literals</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#sql_select_orderby">Order By</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#sql_select_options">DISTINCT, LIMIT and OFFSET</a>
    </div>

    </div>


    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#sql_join">Inner and Outer Joins</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#sql_alias">Table Aliases</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#sql_subqueries">Subqueries</a>
    </div>

        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#sql_subqueries_scalar">Scalar Column Subqueries</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#sql_subqueries_correlated">Correlated Subqueries</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#sql_subqueries_exists">EXISTS Clauses</a>
    </div>

    </div>


    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#sql_unions">Unions</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#sql_bindparams">Custom Bind Parameters</a>
    </div>

        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#sql_bindparams_precompiling">Precompiling a Query</a>
    </div>

    </div>


    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#sql_textual">Literal Text Blocks</a>
    </div>

        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#sql_textual_textual_binds">Using Bind Parameters in Text Blocks</a>
    </div>

    </div>


    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#sql_building">Building Select Objects</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#sql_insert">Inserts</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#sql_update">Updates</a>
    </div>

        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#sql_update_correlated">Correlated Updates</a>
    </div>

    </div>


    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#sql_delete">Deletes</a>
    </div>

    </div>


    </div>


    
    
    <div class="toclink">
        <A style="" href="#datamapping">Basic Data Mapping</a>
    </div>
    
    <div class="toclinkcontainer">
        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#datamapping_synopsis">Synopsis</a>
    </div>

        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#datamapping_synopsis_attaching">Attaching Mappers to their Class</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#datamapping_synopsis_overriding">Overriding Properties</a>
    </div>

    </div>


    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#datamapping_selecting">Selecting from a Mapper</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#datamapping_saving">Saving Objects</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#datamapping_relations">Defining and Using Relationships</a>
    </div>

        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#datamapping_relations_private">Useful Feature: Private Relations</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#datamapping_relations_backreferences">Useful Feature: Backreferences</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#datamapping_relations_cascade">Creating Relationships Automatically with cascade_mappers</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#datamapping_relations_lazyload">Selecting from Relationships: Lazy Load</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#datamapping_relations_eagerload">Selecting from Relationships: Eager Load</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#datamapping_relations_options">Switching Lazy/Eager, No Load</a>
    </div>

    </div>


    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#datamapping_onetoone">One to One/Many to One</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#datamapping_manytomany">Many to Many</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#datamapping_association">Association Object</a>
    </div>

    </div>


    </div>


    
    
    <div class="toclink">
        <A style="" href="#unitofwork">Unit of Work</a>
    </div>
    
    <div class="toclinkcontainer">
        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#unitofwork_overview">Overview</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#unitofwork_getting">Accessing UnitOfWork Instances</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#unitofwork_begincommit">Begin/Commit</a>
    </div>

        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#unitofwork_begincommit_begin">Controlling Scope with begin()</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#unitofwork_begincommit_transactionnesting">Nesting UnitOfWork in a Database Transaction</a>
    </div>

    </div>


    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#unitofwork_identity">The Identity Map</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#unitofwork_import">Bringing External Instances into the UnitOfWork</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#unitofwork_advscope">Advanced UnitOfWork Management</a>
    </div>

        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#unitofwork_advscope_object">Per-Object Sessions</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#unitofwork_advscope_scope">Custom Session Objects/Custom Scopes</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#unitofwork_advscope_logging">Analyzing Object Commits</a>
    </div>

    </div>


    </div>


    </div>


    
    
    <div class="toclink">
        <A style="" href="#adv_datamapping">Advanced Data Mapping</a>
    </div>
    
    <div class="toclinkcontainer">
        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#adv_datamapping_relations">More On Relations</a>
    </div>

        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#adv_datamapping_relations_customjoin">Custom Join Conditions</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#adv_datamapping_relations_multiplejoin">Lazy/Eager Joins Multiple Times to One Table</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#adv_datamapping_relations_relationoptions">Relation Options</a>
    </div>

    </div>


    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#adv_datamapping_orderby">Controlling Ordering</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#adv_datamapping_limits">Limiting Rows</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#adv_datamapping_colname">Overriding Column Names</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#adv_datamapping_deferred">Deferred Column Loading</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#adv_datamapping_options">More on Mapper Options</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#adv_datamapping_inheritance">Mapping a Class with Table Inheritance</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#adv_datamapping_joins">Mapping a Class against Multiple Tables</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#adv_datamapping_selects">Mapping a Class against Arbitary Selects</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#adv_datamapping_multiple">Multiple Mappers for One Class</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#adv_datamapping_circular">Circular Mapping</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#adv_datamapping_recursive">Self Referential Mappers</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#adv_datamapping_resultset">Result-Set Mapping</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#adv_datamapping_extending">Extending Mapper</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#adv_datamapping_class">How Mapper Modifies Mapped Classes</a>
    </div>

    </div>


    </div>


    
    
    <div class="toclink">
        <A style="" href="#types">The Types System</a>
    </div>
    
    <div class="toclinkcontainer">
        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#types_standard">Built-in Types</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#types_custom">Creating your Own Types</a>
    </div>

    </div>


    </div>


    
    
    <div class="toclink">
        <A style="" href="#docstrings">Modules and Classes</a>
    </div>
    
    <div class="toclinkcontainer">
        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#docstrings_sqlalchemy.schema">Module sqlalchemy.schema</a>
    </div>

        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#docstrings_sqlalchemy.schema_Column">Class Column(ColumnClause)</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#docstrings_sqlalchemy.schema_ColumnDefault">Class ColumnDefault(DefaultGenerator)</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#docstrings_sqlalchemy.schema_ForeignKey">Class ForeignKey(SchemaItem)</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#docstrings_sqlalchemy.schema_Index">Class Index(SchemaItem)</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#docstrings_sqlalchemy.schema_PassiveDefault">Class PassiveDefault(DefaultGenerator)</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#docstrings_sqlalchemy.schema_SchemaEngine">Class SchemaEngine(object)</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#docstrings_sqlalchemy.schema_SchemaItem">Class SchemaItem(object)</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#docstrings_sqlalchemy.schema_SchemaVisitor">Class SchemaVisitor(ClauseVisitor)</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#docstrings_sqlalchemy.schema_Sequence">Class Sequence(DefaultGenerator)</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#docstrings_sqlalchemy.schema_Table">Class Table(TableClause)</a>
    </div>

    </div>


    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#docstrings_sqlalchemy.engine">Module sqlalchemy.engine</a>
    </div>

        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#docstrings_sqlalchemy.engine_modfunc">Module Functions</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#docstrings_sqlalchemy.engine_SQLEngine">Class SQLEngine(SchemaEngine)</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#docstrings_sqlalchemy.engine_ResultProxy">Class ResultProxy</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#docstrings_sqlalchemy.engine_RowProxy">Class RowProxy</a>
    </div>

    </div>


    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#docstrings_sqlalchemy.sql">Module sqlalchemy.sql</a>
    </div>

        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#docstrings_sqlalchemy.sql_modfunc">Module Functions</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#docstrings_sqlalchemy.sql_ClauseParameters">Class ClauseParameters(OrderedDict)</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#docstrings_sqlalchemy.sql_Compiled">Class Compiled(ClauseVisitor)</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#docstrings_sqlalchemy.sql_ClauseElement">Class ClauseElement(object)</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#docstrings_sqlalchemy.sql_TableClause">Class TableClause(FromClause)</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#docstrings_sqlalchemy.sql_ColumnClause">Class ColumnClause(ColumnElement)</a>
    </div>

    </div>


    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#docstrings_sqlalchemy.pool">Module sqlalchemy.pool</a>
    </div>

        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#docstrings_sqlalchemy.pool_modfunc">Module Functions</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#docstrings_sqlalchemy.pool_DBProxy">Class DBProxy(object)</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#docstrings_sqlalchemy.pool_Pool">Class Pool(object)</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#docstrings_sqlalchemy.pool_QueuePool">Class QueuePool(Pool)</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#docstrings_sqlalchemy.pool_SingletonThreadPool">Class SingletonThreadPool(Pool)</a>
    </div>

    </div>


    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#docstrings_sqlalchemy.mapping">Module sqlalchemy.mapping</a>
    </div>

        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#docstrings_sqlalchemy.mapping_modfunc">Module Functions</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#docstrings_sqlalchemy.mapping_MapperExtension">Class MapperExtension(object)</a>
    </div>

    </div>


    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#docstrings_sqlalchemy.mapping.objectstore">Module sqlalchemy.mapping.objectstore</a>
    </div>

        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#docstrings_sqlalchemy.mapping.objectstore_modfunc">Module Functions</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#docstrings_sqlalchemy.mapping.objectstore_Session">Class Session(object)</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#docstrings_sqlalchemy.mapping.objectstore_SessionTrans">Class SessionTrans(object)</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#docstrings_sqlalchemy.mapping.objectstore_UnitOfWork">Class UnitOfWork(object)</a>
    </div>

    </div>


    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#docstrings_sqlalchemy.exceptions">Module sqlalchemy.exceptions</a>
    </div>

        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#docstrings_sqlalchemy.exceptions_ArgumentError">Class ArgumentError</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#docstrings_sqlalchemy.exceptions_AssertionError">Class AssertionError</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#docstrings_sqlalchemy.exceptions_CommitError">Class CommitError</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#docstrings_sqlalchemy.exceptions_DBAPIError">Class DBAPIError</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#docstrings_sqlalchemy.exceptions_InvalidRequestError">Class InvalidRequestError</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#docstrings_sqlalchemy.exceptions_SQLAlchemyError">Class SQLAlchemyError</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#docstrings_sqlalchemy.exceptions_SQLError">Class SQLError</a>
    </div>

    </div>


    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#docstrings_sqlalchemy.ext.proxy">Module sqlalchemy.ext.proxy</a>
    </div>

        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#docstrings_sqlalchemy.ext.proxy_modfunc">Module Functions</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#docstrings_sqlalchemy.ext.proxy_AutoConnectEngine">Class AutoConnectEngine(BaseProxyEngine)</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#docstrings_sqlalchemy.ext.proxy_BaseProxyEngine">Class BaseProxyEngine(SchemaEngine)</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#docstrings_sqlalchemy.ext.proxy_ProxyEngine">Class ProxyEngine(BaseProxyEngine)</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#docstrings_sqlalchemy.ext.proxy_ProxyType">Class ProxyType(object)</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#docstrings_sqlalchemy.ext.proxy_ProxyTypeEngine">Class ProxyTypeEngine(object)</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#docstrings_sqlalchemy.ext.proxy_TypeEngine">Class TypeEngine(object)</a>
    </div>

    </div>


    </div>


    </div>



	</div>

	</div>

	<div class="onepagecontent">
		<div class="section">
					
			<A name="intro"></a>
			<div class="topnavmargin">
			
	
<div class="topnav">


	
	<div class="topnavcontrol">
	View: <a href="index.html">Paged</a> &nbsp;|&nbsp; <b>One Page</b>
	</div>



<div class="topnavsectionlink">

<a href="#top">Table of Contents</a>

<div class="prevnext">



Next: <a href="#pooling">Connection Pooling</a>

</div>
</div>


<div class="topnavmain">
	<div class="topnavheader">Introduction</div>
	<div class="topnavitems">
	


    
    
    <div class="toclink">
        <A style="" href="#intro_trailmap">Trail Map</a>
    </div>
    
    <div class="toclinkcontainer">
    </div>



	</div>
</div>

</div>

			</div>

			




<div class="subsection" style="margin-left:10px;">

    <div class="sectiontext">


<p>SQLAlchemy features a lot of tools and patterns to help in every area of writing applications that talk to relational databases.  To achieve this, it has a lot of areas of functionality which work together to provide a cohesive package.  Ultimately, just a little bit of familiarity with each concept is all thats needed to get off the ground.</p>

<p>That said, here's two quick links that summarize the two most prominent features of SQLAlchemy:
<ul>
	<li><a href="#datamapping" class="trailbold">Basic Data Mapping</a> - a synopsis of how to map objects to database tables (Object Relational Mapping)</li>
	<li><a href="#sql" class="trailbold">Constructing SQL Queries via Python Expressions</a> - SQLAlchemy's own domain-oriented approach to constructing and executing SQL statements.</li>
</ul>
</p>


			

    </div>

        



<A name="intro_trailmap"></a>

<div class="subsection" style="margin-left:20px;">

    <span class="sectionheadertext">Trail Map</span>
    <div class="sectiontext">


<p>For a comprehensive tour through all of SQLAlchemy's components, below is a "Trail Map" of the knowledge dependencies between these components indicating the order in which concepts may be learned.   Concepts marked in bold indicate features that are useful on their own.
</p>
<pre>
Start
  |
  |
  |--- <a href="#pooling" class="trailbold">Connection Pooling</a>
  |              |
  |              |
  |              |------ <a href="#pooling_configuration" >Connection Pool Configuration</a>
  |                                         |              
  |                                         |
  +--- <a href="#dbengine_establishing" >Establishing a Database Engine</a>       |
                   |                        |
                   |                        | 
                   |--------- <a href="#dbengine_options" >Database Engine Options</a>
                   |
                   |
                   +---- <a href="#metadata_tables" >Describing Tables with MetaData</a>
                                   |
                                   |
                                   |---- <a href="#metadata_creating" >Creating and Dropping Database Tables</a>
                                   | 
                                   |    
                                   |---- <a href="#sql" class="trailbold">Constructing SQL Queries via Python Expressions</a>
                                   |                                      |                
                                   |                                      |                                  
                                   +---- <a href="#datamapping" class="trailbold">Basic Data Mapping</a>               |                
                                   |               |                      |  
                                   |               |                      |  
                                   |         <a href="#unitofwork" >Unit of Work</a>                 |              
                                   |               |                      |              
                                   |               |                      |              
                                   |               +----------- <a href="#adv_datamapping" >Advanced Data Mapping</a>
                                   |                                       
                                   +----- <a href="#types" >The Types System</a>
</pre>

    </div>


    <a href="#intro" class="toclink">back to section top</a>


</div>




    <hr width="400px" align="left" />

</div>


		</div>
		<div class="section">
					
			<A name="pooling"></a>
			<div class="topnavmargin">
			
	
<div class="topnav">


	
	<div class="topnavcontrol">
	View: <a href="index.html">Paged</a> &nbsp;|&nbsp; <b>One Page</b>
	</div>



<div class="topnavsectionlink">

<a href="#top">Table of Contents</a>

<div class="prevnext">
Previous: <a href="#intro">Introduction</a>

&nbsp; | &nbsp;


Next: <a href="#dbengine">Database Engines</a>

</div>
</div>


<div class="topnavmain">
	<div class="topnavheader">Connection Pooling</div>
	<div class="topnavitems">
	


    
    
    <div class="toclink">
        <A style="" href="#pooling_establishing">Establishing a Transparent Connection Pool</a>
    </div>
    
    <div class="toclinkcontainer">
    </div>


    
    
    <div class="toclink">
        <A style="" href="#pooling_configuration">Connection Pool Configuration</a>
    </div>
    
    <div class="toclinkcontainer">
    </div>


    
    
    <div class="toclink">
        <A style="" href="#pooling_custom">Custom Pool Construction</a>
    </div>
    
    <div class="toclinkcontainer">
    </div>



	</div>
</div>

</div>

			</div>

			




<div class="subsection" style="margin-left:10px;">

    <div class="sectiontext">


    <P><b>Note:</b>This section describes the connection pool module of SQLAlchemy, which is the smallest component of the library that can be used on its own.  If you are interested in using SQLAlchemy for query construction or Object Relational Mapping, this module is automatically managed behind the scenes; you can skip ahead to <a href="#dbengine" >Database Engines</a> in that case.</p>
    <p>At the base of any database helper library is a system of efficiently acquiring connections to the database.  Since the establishment of a database connection is typically a somewhat expensive operation, an application needs a way to get at database connections repeatedly without incurring the full overhead each time.  Particularly for server-side web applications, a connection pool is the standard way to maintain a "pool" of database connections which are used over and over again among many requests.  Connection pools typically are configured to maintain a certain "size", which represents how many connections can be used simultaneously without resorting to creating more newly-established connections.
    </p>
    <p>SQLAlchemy includes a pooling module that can be used completely independently of the rest of the toolset.  This section describes how it can be used on its own, as well as the available options.  If SQLAlchemy is being used more fully, the connection pooling described below occurs automatically.  The options are still available, though, so this core feature is a good place to start.
    </p>
    
			

    
			
    
    
			

    </div>

        



<A name="pooling_establishing"></a>

<div class="subsection" style="margin-left:20px;">

    <span class="sectionheadertext">Establishing a Transparent Connection Pool</span>
    <div class="sectiontext">


    Any DBAPI module can be "proxied" through the connection pool using the following technique (note that the usage of 'psycopg2' is <b>just an example</b>; substitute whatever DBAPI module you'd like):
    
    

<div class="code">
<pre><span class="python_keyword">import </span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">pool as pool</span><span class="python_operator">
</span><span class="python_keyword">import </span><span class="python_name">psycopg2 as psycopg</span><span class="python_operator">
</span><span class="python_name">psycopg </span><span class="python_operator">= </span><span class="python_name">pool</span><span class="python_operator">.</span><span class="python_name">manage</span><span class="python_enclosure">(</span><span class="python_name">psycopg</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># then connect normally
</span><span class="python_name">connection </span><span class="python_operator">= </span><span class="python_name">psycopg</span><span class="python_operator">.</span><span class="python_name">connect</span><span class="python_enclosure">(</span><span class="python_name">database</span><span class="python_operator">=</span><span class="python_literal">'test'</span><span class="python_operator">, </span><span class="python_name">username</span><span class="python_operator">=</span><span class="python_literal">'scott'</span><span class="python_operator">, </span><span class="python_name">password</span><span class="python_operator">=</span><span class="python_literal">'tiger'</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre></div>

    <p>This produces a <span class="codeline">sqlalchemy.pool.DBProxy</span> object which supports the same <span class="codeline">connect()</span> function as the original DBAPI module.  Upon connection, a thread-local connection proxy object is returned, which delegates its calls to a real DBAPI connection object.  This connection object is stored persistently within a connection pool (an instance of <span class="codeline">sqlalchemy.pool.Pool</span>) that corresponds to the exact connection arguments sent to the <span class="codeline">connect()</span> function.  The connection proxy also returns a proxied cursor object upon calling <span class="codeline">connection.cursor()</span>.  When all cursors as well as the connection proxy are de-referenced, the connection is automatically made available again by the owning pool object.</p>
    
    <p>Basically, the <span class="codeline">connect()</span> function is used in its usual way, and the pool module transparently returns thread-local pooled connections.  Each distinct set of connect arguments corresponds to a brand new connection pool created; in this way, an application can maintain connections to multiple schemas and/or databases, and each unique connect argument set will be managed by a different pool object.</p>
    
    </div>


    <a href="#pooling" class="toclink">back to section top</a>


</div>


        



<A name="pooling_configuration"></a>

<div class="subsection" style="margin-left:20px;">

    <span class="sectionheadertext">Connection Pool Configuration</span>
    <div class="sectiontext">


    <p>When proxying a DBAPI module through the <span class="codeline">pool</span> module, options exist for how the connections should be pooled:
    </p>
    <ul>
        <li>echo=False : if set to True, connections being pulled and retrieved from/to the pool will be logged to the standard output, as well as pool sizing information.</li>
        <li>use_threadlocal=True : if set to True, repeated calls to connect() within the same application thread will be guaranteed to return the <b>same</b> connection object, if one has already been retrieved from the pool and has not been returned yet.  This allows code to retrieve a connection from the pool, and then while still holding on to that connection, to call other functions which also ask the pool for a connection of the same arguments;  those functions will act upon the same connection that the calling method is using.  Note that once the connection is returned to the pool, it then may be used by another thread.  To guarantee a single unique connection per thread that <b>never</b> changes, use the option <span class="codeline">poolclass=SingletonThreadPool</span>, in which case the use_threadlocal parameter is automatically set to False.</li>
        <li>poolclass=QueuePool :  the Pool class used by the pool module to provide pooling.  QueuePool uses the Python <span class="codeline">Queue.Queue</span> class to maintain a list of available connections.  A developer can supply his or her own Pool class to supply a different pooling algorithm.  Also included is the ThreadSingletonPool, which provides a single distinct connection per thread and is required with SQLite.</li>
        <li>pool_size=5 : used by QueuePool - the size of the pool to be maintained.  This is the largest number of connections that will be kept persistently in the pool.  Note that the pool begins with no connections; once this number of connections is requested, that number of connections will remain.</li>
        <li>max_overflow=10 : used by QueuePool - the maximum overflow size of the pool.  When the number of checked-out connections reaches the size set in pool_size, additional connections will be returned up to this limit.  When those additional connections are returned to the pool, they are disconnected and discarded.  It follows then that the total number of simultaneous connections the pool will allow is pool_size + max_overflow, and the total number of "sleeping" connections the pool will allow is pool_size.  max_overflow can be set to -1 to indicate no overflow limit; no limit will be placed on the total number of concurrent connections.</li>
    </ul>
    
    </div>


    <a href="#pooling" class="toclink">back to section top</a>


</div>


        



<A name="pooling_custom"></a>

<div class="subsection" style="margin-left:20px;">

    <span class="sectionheadertext">Custom Pool Construction</span>
    <div class="sectiontext">


    <p>One level below using a DBProxy to make transparent pools is creating the pool yourself.  The pool module comes with two implementations of connection pools: <span class="codeline">QueuePool</span> and <span class="codeline">SingletonThreadPool</span>.  While QueuePool uses Queue.Queue to provide connections, SingletonThreadPool provides a single per-thread connection which SQLite requires.</p>
    
    <p>Constructing your own pool involves passing a callable used to create a connection.  Through this method, custom connection schemes can be made, such as a connection that automatically executes some initialization commands to start.  The options from the previous section can be used as they apply to QueuePool or SingletonThreadPool.</p>
    

<div class="code">
    <div class="codetitle">Plain QueuePool</div>
<pre><span class="python_keyword">import </span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">pool as pool</span><span class="python_operator">
</span><span class="python_keyword">import </span><span class="python_name">psycopg2</span><span class="python_operator">
</span>
<span class="python_keyword">def </span><span class="python_name">getconn</span><span class="python_enclosure">()</span><span class="python_operator">:
    </span><span class="python_name">c </span><span class="python_operator">= </span><span class="python_name">psycopg2</span><span class="python_operator">.</span><span class="python_name">connect</span><span class="python_enclosure">(</span><span class="python_name">username</span><span class="python_operator">=</span><span class="python_literal">'ed'</span><span class="python_operator">, </span><span class="python_name">host</span><span class="python_operator">=</span><span class="python_literal">'127.0.0.1'</span><span class="python_operator">, </span><span class="python_name">dbname</span><span class="python_operator">=</span><span class="python_literal">'test'</span><span class="python_enclosure">)</span><span class="python_operator">
    </span><span class="python_comment"># execute an initialization function on the connection before returning
    </span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">cursor</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_literal">"setup_encodings()"</span><span class="python_enclosure">)</span><span class="python_operator">
    </span><span class="python_keyword">return </span><span class="python_name">c</span><span class="python_operator">
    </span>
<span class="python_operator"></span><span class="python_name">p </span><span class="python_operator">= </span><span class="python_name">pool</span><span class="python_operator">.</span><span class="python_name">QueuePool</span><span class="python_enclosure">(</span><span class="python_name">getconn</span><span class="python_operator">, </span><span class="python_name">max_overflow</span><span class="python_operator">=</span><span class="python_number">10</span><span class="python_operator">, </span><span class="python_name">pool_size</span><span class="python_operator">=</span><span class="python_number">5</span><span class="python_operator">, </span><span class="python_name">use_threadlocal</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre></div>


    

<div class="code">
    <div class="codetitle">SingletonThreadPool</div>
<pre><span class="python_keyword">import </span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">pool as pool</span><span class="python_operator">
</span><span class="python_keyword">import </span><span class="python_name">sqlite</span><span class="python_operator">
</span>
<span class="python_keyword">def </span><span class="python_name">getconn</span><span class="python_enclosure">()</span><span class="python_operator">:
    </span><span class="python_keyword">return </span><span class="python_name">sqlite</span><span class="python_operator">.</span><span class="python_name">connect</span><span class="python_enclosure">(</span><span class="python_name">filename</span><span class="python_operator">=</span><span class="python_literal">'myfile.db'</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># SQLite connections require the SingletonThreadPool    
</span><span class="python_operator"></span><span class="python_name">p </span><span class="python_operator">= </span><span class="python_name">pool</span><span class="python_operator">.</span><span class="python_name">SingletonThreadPool</span><span class="python_enclosure">(</span><span class="python_name">getconn</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre></div>


    
    </div>


    <a href="#pooling" class="toclink">back to section top</a>


</div>




    <hr width="400px" align="left" />

</div>


		</div>
		<div class="section">
					
			<A name="dbengine"></a>
			<div class="topnavmargin">
			
	
<div class="topnav">


	
	<div class="topnavcontrol">
	View: <a href="index.html">Paged</a> &nbsp;|&nbsp; <b>One Page</b>
	</div>



<div class="topnavsectionlink">

<a href="#top">Table of Contents</a>

<div class="prevnext">
Previous: <a href="#pooling">Connection Pooling</a>

&nbsp; | &nbsp;


Next: <a href="#metadata">Database Meta Data</a>

</div>
</div>


<div class="topnavmain">
	<div class="topnavheader">Database Engines</div>
	<div class="topnavitems">
	


    
    
    <div class="toclink">
        <A style="" href="#dbengine_establishing">Establishing a Database Engine</a>
    </div>
    
    <div class="toclinkcontainer">
    </div>


    
    
    <div class="toclink">
        <A style="" href="#dbengine_methods">Database Engine Methods</a>
    </div>
    
    <div class="toclinkcontainer">
    </div>


    
    
    <div class="toclink">
        <A style="" href="#dbengine_options">Database Engine Options</a>
    </div>
    
    <div class="toclinkcontainer">
    </div>


    
    
    <div class="toclink">
        <A style="" href="#dbengine_proxy">Using the Proxy Engine</a>
    </div>
    
    <div class="toclinkcontainer">
        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#dbengine_proxy_defaultproxy">Using the Global Proxy</a>
    </div>

    </div>


    </div>


    
    
    <div class="toclink">
        <A style="" href="#dbengine_transactions">Transactions</a>
    </div>
    
    <div class="toclinkcontainer">
    </div>



	</div>
</div>

</div>

			</div>

			




<div class="subsection" style="margin-left:10px;">

    <div class="sectiontext">


    <p>A database engine is a subclass of <span class="codeline">sqlalchemy.engine.SQLEngine</span>, and is the starting point for where SQLAlchemy provides a layer of abstraction on top of the various DBAPI2 database modules.  It serves as an abstract factory for database-specific implementation objects as well as a layer of abstraction over the most essential tasks of a database connection, including connecting, executing queries, returning result sets, and managing transactions.</p>
    
    <p>
    The average developer doesn't need to know anything about the interface or workings of a SQLEngine in order to use it.  Simply creating one, and then specifying it when constructing tables and other SQL objects is all that's needed. </p>
    
    <p>A SQLEngine is also a layer of abstraction on top of the connection pooling described in the previous section.  While a DBAPI connection pool can be used explicitly alongside a SQLEngine, its not really necessary.  Once you have a SQLEngine, you can retrieve pooled connections directly from its underlying connection pool via its own <span class="codeline">connection()</span> method.  However, if you're exclusively using SQLALchemy's SQL construction objects and/or object-relational mappers, all the details of connecting are handled by those libraries automatically.
    </p>
    
			
    
			
    
    
			
    
			
    
			

    </div>

        



<A name="dbengine_establishing"></a>

<div class="subsection" style="margin-left:20px;">

    <span class="sectionheadertext">Establishing a Database Engine</span>
    <div class="sectiontext">


    <p>
    Engines exist for SQLite, Postgres, MySQL, and Oracle, using the Pysqlite, Psycopg (1 or 2), MySQLDB, and cx_Oracle modules.  Each engine imports its corresponding module which is required to be installed.  For Postgres and Oracle, an alternate module may be specified at construction time as well.
    </p>
    <p>The string based argument names for connecting are translated to the appropriate names when the connection is made; argument names include "host" or "hostname" for database host, "database", "db", or "dbname" for the database name (also is dsn for Oracle), "user" or "username" for the user, and "password", "pw", or "passwd" for the password.  SQLite expects "filename" or "file" for the filename, or if None it defaults to "":memory:".</p>
    <p>The connection arguments can be specified as a string + dictionary pair, or a single URL-encoded string, as follows:</p>
    
    

<div class="code">
<pre><span class="python_keyword">from </span><span class="python_name">sqlalchemy </span><span class="python_keyword">import </span><span class="python_operator">*
</span>
<span class="python_comment"># sqlite in memory    
</span><span class="python_name">sqlite_engine </span><span class="python_operator">= </span><span class="python_name">create_engine</span><span class="python_enclosure">(</span><span class="python_literal">'sqlite'</span><span class="python_operator">, </span><span class="python_enclosure">{</span><span class="python_literal">'filename'</span><span class="python_operator">:</span><span class="python_literal">':memory:'</span><span class="python_enclosure">}</span><span class="python_operator">, **</span><span class="python_name">opts</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># via URL
</span><span class="python_name">sqlite_engine </span><span class="python_operator">= </span><span class="python_name">create_engine</span><span class="python_enclosure">(</span><span class="python_literal">'sqlite://'</span><span class="python_operator">, **</span><span class="python_name">opts</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># sqlite using a file
</span><span class="python_name">sqlite_engine </span><span class="python_operator">= </span><span class="python_name">create_engine</span><span class="python_enclosure">(</span><span class="python_literal">'sqlite'</span><span class="python_operator">, </span><span class="python_enclosure">{</span><span class="python_literal">'filename'</span><span class="python_operator">:</span><span class="python_literal">'querytest.db'</span><span class="python_enclosure">}</span><span class="python_operator">, **</span><span class="python_name">opts</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># via URL
</span><span class="python_name">sqlite_engine </span><span class="python_operator">= </span><span class="python_name">create_engine</span><span class="python_enclosure">(</span><span class="python_literal">'sqlite://filename=querytest.db'</span><span class="python_operator">, **</span><span class="python_name">opts</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># postgres
</span><span class="python_name">postgres_engine </span><span class="python_operator">= </span><span class="python_name">create_engine</span><span class="python_enclosure">(</span><span class="python_literal">'postgres'</span><span class="python_operator">, </span>
                        <span class="python_enclosure">{</span><span class="python_literal">'database'</span><span class="python_operator">:</span><span class="python_literal">'test'</span><span class="python_operator">, </span>
                        <span class="python_literal">'host'</span><span class="python_operator">:</span><span class="python_literal">'127.0.0.1'</span><span class="python_operator">, </span>
                        <span class="python_literal">'user'</span><span class="python_operator">:</span><span class="python_literal">'scott'</span><span class="python_operator">, </span>
                        <span class="python_literal">'password'</span><span class="python_operator">:</span><span class="python_literal">'tiger'</span><span class="python_enclosure">}</span><span class="python_operator">, **</span><span class="python_name">opts</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># via URL
</span><span class="python_name">postgres_engine </span><span class="python_operator">= </span><span class="python_name">create_engine</span><span class="python_enclosure">(</span><span class="python_literal">'postgres://database=test&amp;host=127.0.0.1&amp;user=scott&amp;password=tiger'</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># mysql
</span><span class="python_name">mysql_engine </span><span class="python_operator">= </span><span class="python_name">create_engine</span><span class="python_enclosure">(</span><span class="python_literal">'mysql'</span><span class="python_operator">,</span>
                        <span class="python_enclosure">{</span>
                            <span class="python_literal">'db'</span><span class="python_operator">:</span><span class="python_literal">'mydb'</span><span class="python_operator">,</span>
                            <span class="python_literal">'user'</span><span class="python_operator">:</span><span class="python_literal">'scott'</span><span class="python_operator">,</span>
                            <span class="python_literal">'passwd'</span><span class="python_operator">:</span><span class="python_literal">'tiger'</span><span class="python_operator">,</span>
                            <span class="python_literal">'host'</span><span class="python_operator">:</span><span class="python_literal">'127.0.0.1'</span>
                        <span class="python_enclosure">}</span>
                        <span class="python_operator">**</span><span class="python_name">opts</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_comment"># oracle
</span><span class="python_name">oracle_engine </span><span class="python_operator">= </span><span class="python_name">create_engine</span><span class="python_enclosure">(</span><span class="python_literal">'oracle'</span><span class="python_operator">, </span>
                        <span class="python_enclosure">{</span><span class="python_literal">'dsn'</span><span class="python_operator">:</span><span class="python_literal">'mydsn'</span><span class="python_operator">, </span>
                        <span class="python_literal">'user'</span><span class="python_operator">:</span><span class="python_literal">'scott'</span><span class="python_operator">, </span>
                        <span class="python_literal">'password'</span><span class="python_operator">:</span><span class="python_literal">'tiger'</span><span class="python_enclosure">}</span><span class="python_operator">, **</span><span class="python_name">opts</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre></div>

    <p>Note that the general form of connecting to an engine is:</p>
    

<div class="code">
<pre><span class="python_comment"># separate arguments
</span><span class="python_operator">           </span><span class="python_name">engine </span><span class="python_operator">= </span><span class="python_name">create_engine</span><span class="python_enclosure">(</span>
            <span class="python_operator"><</span><span class="python_name">enginename</span><span class="python_operator">>, </span>
            <span class="python_enclosure">{</span><span class="python_operator"><</span><span class="python_name">named DBAPI arguments</span><span class="python_operator">></span><span class="python_enclosure">}</span><span class="python_operator">, </span>
            <span class="python_operator"><</span><span class="python_name">sqlalchemy options</span><span class="python_operator">>;</span>
        <span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># url
</span><span class="python_operator"></span><span class="python_name">engine </span><span class="python_operator">= </span><span class="python_name">create_engine</span><span class="python_enclosure">(</span><span class="python_literal">'&lt;enginename&gt;://&lt;named DBAPI arguments&gt;'</span><span class="python_operator">, <</span><span class="python_name">sqlalchemy options</span><span class="python_operator">></span><span class="python_enclosure">)</span><span class="python_operator"></span></pre></div>

    
    </div>


    <a href="#dbengine" class="toclink">back to section top</a>


</div>


        



<A name="dbengine_methods"></a>

<div class="subsection" style="margin-left:20px;">

    <span class="sectionheadertext">Database Engine Methods</span>
    <div class="sectiontext">


    <p>A few useful methods off the SQLEngine are described here:</p>
        

<div class="code">
<pre><span class="python_name">engine </span><span class="python_operator">= </span><span class="python_name">create_engine</span><span class="python_enclosure">(</span><span class="python_literal">'postgres://hostname=localhost&user=scott&password=tiger&database=test'</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># get a pooled DBAPI connection
</span><span class="python_name">conn </span><span class="python_operator">= </span><span class="python_name">engine</span><span class="python_operator">.</span><span class="python_name">connection</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_comment"># create/drop tables based on table metadata objects
# (see the next section, Table Metadata, for info on table metadata)
</span><span class="python_name">engine</span><span class="python_operator">.</span><span class="python_name">create</span><span class="python_enclosure">(</span><span class="python_name">mytable</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">engine</span><span class="python_operator">.</span><span class="python_name">drop</span><span class="python_enclosure">(</span><span class="python_name">mytable</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># get the DBAPI module being used
</span><span class="python_name">dbapi </span><span class="python_operator">= </span><span class="python_name">engine</span><span class="python_operator">.</span><span class="python_name">dbapi</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_comment"># get the default schema name
</span><span class="python_name">name </span><span class="python_operator">= </span><span class="python_name">engine</span><span class="python_operator">.</span><span class="python_name">get_default_schema_name</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_comment"># execute some SQL directly, returns a ResultProxy (see the SQL Construction section for details)
</span><span class="python_name">result </span><span class="python_operator">= </span><span class="python_name">engine</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_literal">"select * from table where col1=:col1"</span><span class="python_operator">, </span><span class="python_enclosure">{</span><span class="python_literal">'col1'</span><span class="python_operator">:</span><span class="python_literal">'foo'</span><span class="python_enclosure">})</span><span class="python_operator">
</span>
<span class="python_comment"># log a message to the engine's log stream
</span><span class="python_name">engine</span><span class="python_operator">.</span><span class="python_name">log</span><span class="python_enclosure">(</span><span class="python_literal">'this is a message'</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre></div>
    
    
    </div>


    <a href="#dbengine" class="toclink">back to section top</a>


</div>


        



<A name="dbengine_options"></a>

<div class="subsection" style="margin-left:20px;">

    <span class="sectionheadertext">Database Engine Options</span>
    <div class="sectiontext">


    <p>The remaining arguments to <span class="codeline">create_engine</span> are keyword arguments that are passed to the specific subclass of <span class="codeline">sqlalchemy.engine.SQLEngine</span> being used,  as well as the underlying <span class="codeline">sqlalchemy.pool.Pool</span> instance.  All of the options described in the previous section <a href="#pooling_configuration" >Connection Pool Configuration</a> can be specified, as well as engine-specific options:</p>
    <ul>
        <li><p>pool=None : an instance of <span class="codeline">sqlalchemy.pool.Pool</span> to be used as the underlying source for connections, overriding the engine's connect arguments (pooling is described in the previous section).  If None, a default Pool (QueuePool or SingletonThreadPool as appropriate) will be created using the engine's connect arguments.</p>
        <p>Example:</p>
        

<div class="code">
<pre><span class="python_keyword">from </span><span class="python_name">sqlalchemy </span><span class="python_keyword">import </span><span class="python_operator">*
</span><span class="python_keyword">import </span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">pool as pool</span><span class="python_operator">
</span><span class="python_keyword">import </span><span class="python_name">MySQLdb</span><span class="python_operator">
</span>
<span class="python_keyword">def </span><span class="python_name">getconn</span><span class="python_enclosure">()</span><span class="python_operator">:
    </span><span class="python_keyword">return </span><span class="python_name">MySQLdb</span><span class="python_operator">.</span><span class="python_name">connect</span><span class="python_enclosure">(</span><span class="python_name">user</span><span class="python_operator">=</span><span class="python_literal">'ed'</span><span class="python_operator">, </span><span class="python_name">dbname</span><span class="python_operator">=</span><span class="python_literal">'mydb'</span><span class="python_enclosure">)</span><span class="python_operator">
    </span>
<span class="python_operator"></span><span class="python_name">engine </span><span class="python_operator">= </span><span class="python_name">create_engine</span><span class="python_enclosure">(</span><span class="python_literal">'mysql'</span><span class="python_operator">, </span><span class="python_name">pool</span><span class="python_operator">=</span><span class="python_name">pool</span><span class="python_operator">.</span><span class="python_name">QueuePool</span><span class="python_enclosure">(</span><span class="python_name">getconn</span><span class="python_operator">, </span><span class="python_name">pool_size</span><span class="python_operator">=</span><span class="python_number">20</span><span class="python_operator">, </span><span class="python_name">max_overflow</span><span class="python_operator">=</span><span class="python_number">40</span><span class="python_enclosure">))</span><span class="python_operator"></span></pre></div>
</li>
        <li>echo=False : if True, the SQLEngine will log all statements as well as a repr() of their parameter lists to the engines logger, which defaults to sys.stdout.  A SQLEngine instances' "echo" data member can be modified at any time to turn logging on and off.  If set to the string 'debug', result rows will be printed to the standard output as well.</li>
        <li>logger=None : a file-like object where logging output can be sent, if echo is set to True.  This defaults to sys.stdout.</li>
        <li>module=None : used by Oracle and Postgres, this is a reference to a DBAPI2 module to be used instead of the engine's default module.  For Postgres, the default is psycopg2, or psycopg1 if 2 cannot be found.  For Oracle, its cx_Oracle.</li>
        <li>default_ordering=False : if True, table objects and associated joins and aliases will generate information used for ordering by primary keys (or OIDs, if the database supports OIDs).  This information is used by the Mapper system to when it constructs select queries to supply a default ordering to mapped objects.</li>
        <li>use_ansi=True : used only by Oracle;  when False, the Oracle driver attempts to support a particular "quirk" of some Oracle databases, that the LEFT OUTER JOIN SQL syntax is not supported, and the "Oracle join" syntax of using &lt;column1&gt;(+)=&lt;column2&gt; must be used in order to achieve a LEFT OUTER JOIN.  Its advised that the Oracle database be configured to have full ANSI support instead of using this feature.</li>
        <li>use_oids=False : used only by Postgres, will enable the column name "oid" as the object ID column.  Postgres as of 8.1 has object IDs disabled by default.</li>
        <li>convert_unicode=False : if set to True, all String/character based types will convert Unicode values to raw byte values going into the database, and all raw byte values to Python Unicode coming out in result sets.  This is an engine-wide method to provide unicode across the board.  For unicode conversion on a column-by-column level, use the Unicode column type instead.</li>
	<li>encoding='utf-8' : the encoding to use for Unicode translations - passed to all encode/decode methods.</li>
	<li>echo_uow=False : when True, logs unit of work commit plans to the standard output.</li>
    </ul>
    
    </div>


    <a href="#dbengine" class="toclink">back to section top</a>


</div>


        



<A name="dbengine_proxy"></a>

<div class="subsection" style="margin-left:20px;">

    <span class="sectionheadertext">Using the Proxy Engine</span>
    <div class="sectiontext">


    <p>The ProxyEngine is useful for applications that need to swap engines
    at runtime, or to create their tables and mappers before they know
    what engine they will use. One use case is an application meant to be
    pluggable into a mix of other applications, such as a WSGI
    application. Well-behaved WSGI applications should be relocatable; and
    since that means that two versions of the same application may be
    running in the same process (or in the same thread at different
    times), WSGI applications ought not to depend on module-level or
    global configuration. Using the ProxyEngine allows a WSGI application
    to define tables and mappers in a module, but keep the specific
    database connection uri as an application instance or thread-local
    value.</p>

    <p>The ProxyEngine is used in the same way as any other engine, with one
    additional method:</p>
    
    

<div class="code">
<pre><span class="python_comment"># define the tables and mappers
</span><span class="python_keyword">from </span><span class="python_name">sqlalchemy </span><span class="python_keyword">import </span><span class="python_operator">*
</span><span class="python_keyword">from </span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">ext</span><span class="python_operator">.</span><span class="python_name">proxy </span><span class="python_keyword">import </span><span class="python_name">ProxyEngine</span><span class="python_operator">
</span>
<span class="python_name">engine </span><span class="python_operator">= </span><span class="python_name">ProxyEngine</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_name">users </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'users'</span><span class="python_operator">, </span><span class="python_name">engine</span><span class="python_operator">, ... </span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_keyword">class </span><span class="python_name">Users</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">pass</span><span class="python_operator">
</span>
<span class="python_operator"></span><span class="python_name">assign_mapper</span><span class="python_enclosure">(</span><span class="python_name">Users</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_keyword">def </span><span class="python_name">app</span><span class="python_enclosure">(</span><span class="python_name">environ</span><span class="python_operator">, </span><span class="python_name">start_response</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_comment"># later, connect the proxy engine to a real engine via the connect() method
</span><span class="python_operator">    </span><span class="python_name">engine</span><span class="python_operator">.</span><span class="python_name">connect</span><span class="python_enclosure">(</span><span class="python_name">environ</span><span class="python_enclosure">[</span><span class="python_literal">'db_uri'</span><span class="python_enclosure">])</span><span class="python_operator">
    </span><span class="python_comment"># now you have a real db connection and can select, insert, etc.</span><span class="python_operator"></span></pre></div>


    
			
    
    </div>

        



<A name="dbengine_proxy_defaultproxy"></a>

<div class="subsection" style="margin-left:30px;">

    <span class="sectionheadertext">Using the Global Proxy</span>
    <div class="sectiontext">


    <p>There is an instance of ProxyEngine available within the schema package as "default_engine".  You can construct Table objects and not specify the engine parameter, and they will connect to this engine by default.  To connect the default_engine, use the <span class="codeline">global_connect</span> function.</p>
    

<div class="code">
<pre><span class="python_comment"># define the tables and mappers
</span><span class="python_keyword">from </span><span class="python_name">sqlalchemy </span><span class="python_keyword">import </span><span class="python_operator">*
</span>
<span class="python_comment"># specify a table with no explicit engine
</span><span class="python_name">users </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'users'</span><span class="python_operator">, </span>
        <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'user_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
        <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'user_name'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">)</span>
    <span class="python_enclosure">)</span><span class="python_operator">
    </span>
<span class="python_comment"># connect the global proxy engine
</span><span class="python_name">global_connect</span><span class="python_enclosure">(</span><span class="python_literal">'sqlite://filename=foo.db'</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># create the table in the selected database
</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">create</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre></div>


    
    </div>


    <a href="#dbengine" class="toclink">back to section top</a>


</div>





</div>


        



<A name="dbengine_transactions"></a>

<div class="subsection" style="margin-left:20px;">

    <span class="sectionheadertext">Transactions</span>
    <div class="sectiontext">


    <p>A SQLEngine also provides an interface to the transactional capabilities of the underlying DBAPI connection object, as well as the connection object itself.  Note that when using the object-relational-mapping package, described in a later section, basic transactional operation is handled for you automatically by its "Unit of Work" system;  the methods described here will usually apply just to literal SQL update/delete/insert operations or those performed via the SQL construction library.</p>
    
    <p>Typically, a connection is opened with "autocommit=False".  So to perform SQL operations and just commit as you go, you can simply pull out a connection from the connection pool, keep it in the local scope, and call commit() on it as needed.  As long as the connection remains referenced, all other SQL operations within the same thread will use this same connection, including those used by the SQL construction system as well as the object-relational mapper, both described in later sections:</p>
        

<div class="code">
<pre><span class="python_name">conn </span><span class="python_operator">= </span><span class="python_name">engine</span><span class="python_operator">.</span><span class="python_name">connection</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_comment"># execute SQL via the engine
</span><span class="python_name">engine</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_literal">"insert into mytable values ('foo', 'bar')"</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">conn</span><span class="python_operator">.</span><span class="python_name">commit</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_comment"># execute SQL via the SQL construction library            
</span><span class="python_name">mytable</span><span class="python_operator">.</span><span class="python_name">insert</span><span class="python_enclosure">()</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_name">col1</span><span class="python_operator">=</span><span class="python_literal">'bat'</span><span class="python_operator">, </span><span class="python_name">col2</span><span class="python_operator">=</span><span class="python_literal">'lala'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">conn</span><span class="python_operator">.</span><span class="python_name">commit</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre></div>

        
    <p>There is a more automated way to do transactions, and that is to use the engine's begin()/commit() functionality.  When the begin() method is called off the engine, a connection is checked out from the pool and stored in a thread-local context.  That way, all subsequent SQL operations within the same thread will use that same connection.  Subsequent commit() or rollback() operations are performed against that same connection.  In effect, its a more automated way to perform the "commit as you go" example above.  </p>
    
        

<div class="code">
<pre><span class="python_name">engine</span><span class="python_operator">.</span><span class="python_name">begin</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_name">engine</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_literal">"insert into mytable values ('foo', 'bar')"</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">mytable</span><span class="python_operator">.</span><span class="python_name">insert</span><span class="python_enclosure">()</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_name">col1</span><span class="python_operator">=</span><span class="python_literal">'foo'</span><span class="python_operator">, </span><span class="python_name">col2</span><span class="python_operator">=</span><span class="python_literal">'bar'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">engine</span><span class="python_operator">.</span><span class="python_name">commit</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre></div>


    <P>A traditional "rollback on exception" pattern looks like this:</p>    

        

<div class="code">
<pre><span class="python_name">engine</span><span class="python_operator">.</span><span class="python_name">begin</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_keyword">try</span><span class="python_operator">:
    </span><span class="python_name">engine</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_literal">"insert into mytable values ('foo', 'bar')"</span><span class="python_enclosure">)</span><span class="python_operator">
    </span><span class="python_name">mytable</span><span class="python_operator">.</span><span class="python_name">insert</span><span class="python_enclosure">()</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_name">col1</span><span class="python_operator">=</span><span class="python_literal">'foo'</span><span class="python_operator">, </span><span class="python_name">col2</span><span class="python_operator">=</span><span class="python_literal">'bar'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_keyword">except</span><span class="python_operator">:
    </span><span class="python_name">engine</span><span class="python_operator">.</span><span class="python_name">rollback</span><span class="python_enclosure">()</span><span class="python_operator">
    </span><span class="python_keyword">raise</span><span class="python_operator">
</span><span class="python_name">engine</span><span class="python_operator">.</span><span class="python_name">commit</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre></div>

    
    <p>An shortcut which is equivalent to the above is provided by the <span class="codeline">transaction</span> method:</p>
    
        

<div class="code">
<pre><span class="python_keyword">def </span><span class="python_name">do_stuff</span><span class="python_enclosure">()</span><span class="python_operator">:
    </span><span class="python_name">engine</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_literal">"insert into mytable values ('foo', 'bar')"</span><span class="python_enclosure">)</span><span class="python_operator">
    </span><span class="python_name">mytable</span><span class="python_operator">.</span><span class="python_name">insert</span><span class="python_enclosure">()</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_name">col1</span><span class="python_operator">=</span><span class="python_literal">'foo'</span><span class="python_operator">, </span><span class="python_name">col2</span><span class="python_operator">=</span><span class="python_literal">'bar'</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_operator"></span><span class="python_name">engine</span><span class="python_operator">.</span><span class="python_name">transaction</span><span class="python_enclosure">(</span><span class="python_name">do_stuff</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre></div>

    <p>An added bonus to the engine's transaction methods is "reentrant" functionality; once you call begin(), subsequent calls to begin() will increment a counter that must be decremented corresponding to each commit() statement before an actual commit can happen.  This way, any number of methods that want to insure a transaction can call begin/commit, and be nested arbitrarily:</p>
        

<div class="code">
<pre> 
 <span class="python_comment"># method_a starts a transaction and calls method_b
</span><span class="python_operator"> </span><span class="python_keyword">def </span><span class="python_name">method_a</span><span class="python_enclosure">()</span><span class="python_operator">:
     </span><span class="python_name">engine</span><span class="python_operator">.</span><span class="python_name">begin</span><span class="python_enclosure">()</span><span class="python_operator">
     </span><span class="python_keyword">try</span><span class="python_operator">:
         </span><span class="python_name">method_b</span><span class="python_enclosure">()</span><span class="python_operator">
     </span><span class="python_keyword">except</span><span class="python_operator">:
         </span><span class="python_name">engine</span><span class="python_operator">.</span><span class="python_name">rollback</span><span class="python_enclosure">()</span><span class="python_operator">
         </span><span class="python_keyword">raise</span><span class="python_operator">
     </span><span class="python_name">engine</span><span class="python_operator">.</span><span class="python_name">commit</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
 <span class="python_comment"># method_b starts a transaction, or joins the one already in progress,
 # and does some SQL
 </span><span class="python_operator"></span><span class="python_keyword">def </span><span class="python_name">method_b</span><span class="python_enclosure">()</span><span class="python_operator">:
     </span><span class="python_name">engine</span><span class="python_operator">.</span><span class="python_name">begin</span><span class="python_enclosure">()</span><span class="python_operator">
     </span><span class="python_keyword">try</span><span class="python_operator">:
         </span><span class="python_name">engine</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_literal">"insert into mytable values ('bat', 'lala')"</span><span class="python_enclosure">)</span><span class="python_operator">
         </span><span class="python_name">mytable</span><span class="python_operator">.</span><span class="python_name">insert</span><span class="python_enclosure">()</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_name">col1</span><span class="python_operator">=</span><span class="python_literal">'bat'</span><span class="python_operator">, </span><span class="python_name">col2</span><span class="python_operator">=</span><span class="python_literal">'lala'</span><span class="python_enclosure">)</span><span class="python_operator">
     </span><span class="python_keyword">except</span><span class="python_operator">:
         </span><span class="python_name">engine</span><span class="python_operator">.</span><span class="python_name">rollback</span><span class="python_enclosure">()</span><span class="python_operator">
         </span><span class="python_keyword">raise</span><span class="python_operator">
     </span><span class="python_name">engine</span><span class="python_operator">.</span><span class="python_name">commit</span><span class="python_enclosure">()</span><span class="python_operator">
     </span>
 <span class="python_comment"># call method_a                
 </span><span class="python_operator"></span><span class="python_name">method_a</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre></div>

       <p>Above, method_a is called first, which calls engine.begin().  Then it calls method_b. When method_b calls engine.begin(), it just increments a counter that is decremented when it calls commit().  If either method_a or method_b calls rollback(), the whole transaction is rolled back.  The transaction is not committed until method_a calls the commit() method.</p>
       
       <p>The object-relational-mapper capability of SQLAlchemy includes its own <span class="codeline">commit()</span> method that gathers SQL statements into a batch and runs them within one transaction.  That transaction is also invokved within the scope of the "reentrant" methodology above; so multiple objectstore.commit() operations can also be bundled into a larger database transaction via the above methodology.</p>
    
    </div>


    <a href="#dbengine" class="toclink">back to section top</a>


</div>




    <hr width="400px" align="left" />

</div>


		</div>
		<div class="section">
					
			<A name="metadata"></a>
			<div class="topnavmargin">
			
	
<div class="topnav">


	
	<div class="topnavcontrol">
	View: <a href="index.html">Paged</a> &nbsp;|&nbsp; <b>One Page</b>
	</div>



<div class="topnavsectionlink">

<a href="#top">Table of Contents</a>

<div class="prevnext">
Previous: <a href="#dbengine">Database Engines</a>

&nbsp; | &nbsp;


Next: <a href="#sql">Constructing SQL Queries via Python Expressions</a>

</div>
</div>


<div class="topnavmain">
	<div class="topnavheader">Database Meta Data</div>
	<div class="topnavitems">
	


    
    
    <div class="toclink">
        <A style="" href="#metadata_tables">Describing Tables with MetaData</a>
    </div>
    
    <div class="toclinkcontainer">
    </div>


    
    
    <div class="toclink">
        <A style="" href="#metadata_creating">Creating and Dropping Database Tables</a>
    </div>
    
    <div class="toclinkcontainer">
    </div>


    
    
    <div class="toclink">
        <A style="" href="#metadata_defaults">Column Defaults and OnUpdates</a>
    </div>
    
    <div class="toclinkcontainer">
        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#metadata_defaults_oninsert">Pre-Executed Insert Defaults</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#metadata_defaults_onupdate">Pre-Executed OnUpdate Defaults</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#metadata_defaults_passive">Inline Default Execution: PassiveDefault</a>
    </div>

        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#metadata_defaults_passive_postgres">The Catch: Postgres Primary Key Defaults always Pre-Execute</a>
    </div>

    </div>


    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#metadata_defaults_sequences">Defining Sequences</a>
    </div>

    </div>


    </div>


    
    
    <div class="toclink">
        <A style="" href="#metadata_indexes">Defining Indexes</a>
    </div>
    
    <div class="toclinkcontainer">
    </div>


    
    
    <div class="toclink">
        <A style="" href="#metadata_adapting">Adapting Tables to Alternate Engines</a>
    </div>
    
    <div class="toclinkcontainer">
        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#metadata_adapting_primitives">Non-engine primitives: TableClause/ColumnClause</a>
    </div>

    </div>


    </div>



	</div>
</div>

</div>

			</div>

			




<div class="subsection" style="margin-left:10px;">

    <div class="sectiontext">


    
			
    
			

    
    
			
    
			
    
			

    

    </div>

        



<A name="metadata_tables"></a>

<div class="subsection" style="margin-left:20px;">

    <span class="sectionheadertext">Describing Tables with MetaData</span>
    <div class="sectiontext">


    <p>The core of SQLAlchemy's query and object mapping operations is table metadata, which are Python objects that describe tables.  Metadata objects can be created by explicitly naming the table and all its properties, using the Table, Column, ForeignKey, and Sequence objects imported from <span class="codeline">sqlalchemy.schema</span>, and a database engine constructed as described in the previous section, or they can be automatically pulled from an existing database schema.  First, the explicit version: </p>
        

<div class="code">
<pre><span class="python_keyword">from </span><span class="python_name">sqlalchemy </span><span class="python_keyword">import </span><span class="python_operator">*
</span><span class="python_name">engine </span><span class="python_operator">= </span><span class="python_name">create_engine</span><span class="python_enclosure">(</span><span class="python_literal">'sqlite'</span><span class="python_operator">, </span><span class="python_enclosure">{</span><span class="python_literal">'filename'</span><span class="python_operator">:</span><span class="python_literal">':memory:'</span><span class="python_enclosure">}</span><span class="python_operator">, **</span><span class="python_name">opts</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_name">users </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'users'</span><span class="python_operator">, </span><span class="python_name">engine</span><span class="python_operator">, </span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'user_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key </span><span class="python_operator">= </span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'user_name'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">16</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">nullable </span><span class="python_operator">= </span><span class="python_name">False</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'email_address'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">60</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">key</span><span class="python_operator">=</span><span class="python_literal">'email'</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'password'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">20</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">nullable </span><span class="python_operator">= </span><span class="python_name">False</span><span class="python_enclosure">)</span>
<span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_name">user_prefs </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'user_prefs'</span><span class="python_operator">, </span><span class="python_name">engine</span><span class="python_operator">, </span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'pref_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'user_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">ForeignKey</span><span class="python_enclosure">(</span><span class="python_literal">"users.user_id"</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">nullable</span><span class="python_operator">=</span><span class="python_name">False</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'pref_name'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">40</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">nullable</span><span class="python_operator">=</span><span class="python_name">False</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'pref_value'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">100</span><span class="python_enclosure">))</span>
<span class="python_enclosure">)</span><span class="python_operator"></span></pre></div>

        <p>The specific datatypes, such as Integer, String, etc. are defined in <a href="#types" >sqlalchemy.types</a> and are automatically pulled in when you import * from <span class="codeline">sqlalchemy</span>.  Note that for Column objects, an altername name can be specified via the "key" parameter; if this parameter is given, then all programmatic references to this Column object will be based on its key, instead of its actual column name.</p>
        
        <p>Once constructed, the Table object provides a clean interface to the table's properties as well as that of its columns:
        
        

<div class="code">
<pre><span class="python_name">employees </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'employees'</span><span class="python_operator">, </span><span class="python_name">engine</span><span class="python_operator">, </span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'employee_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'employee_name'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">60</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">nullable</span><span class="python_operator">=</span><span class="python_name">False</span><span class="python_operator">, </span><span class="python_name">key</span><span class="python_operator">=</span><span class="python_literal">'name'</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'employee_dept'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">ForeignKey</span><span class="python_enclosure">(</span><span class="python_literal">"departments.department_id"</span><span class="python_enclosure">))</span>
<span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># access the column "EMPLOYEE_ID":
</span><span class="python_name">employees</span><span class="python_operator">.</span><span class="python_name">columns</span><span class="python_operator">.</span><span class="python_name">employee_id</span><span class="python_operator">
</span>
<span class="python_comment"># or just
</span><span class="python_name">employees</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">employee_id</span><span class="python_operator">
</span>
<span class="python_comment"># via string
</span><span class="python_name">employees</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_enclosure">[</span><span class="python_literal">'employee_id'</span><span class="python_enclosure">]</span><span class="python_operator">
</span>
<span class="python_comment"># iterate through all columns
</span><span class="python_keyword">for </span><span class="python_name">c </span><span class="python_keyword">in </span><span class="python_name">employees</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">:
    </span><span class="python_comment"># ...
    </span>
<span class="python_comment"># get the table's primary key columns
</span><span class="python_keyword">for </span><span class="python_name">primary_key </span><span class="python_keyword">in </span><span class="python_name">employees</span><span class="python_operator">.</span><span class="python_name">primary_key</span><span class="python_operator">:
    </span><span class="python_comment"># ...
</span>
<span class="python_comment"># get the table's foreign key objects:
</span><span class="python_keyword">for </span><span class="python_name">fkey </span><span class="python_keyword">in </span><span class="python_name">employees</span><span class="python_operator">.</span><span class="python_name">foreign_keys</span><span class="python_operator">:
    </span><span class="python_comment"># ...
    </span>
<span class="python_comment"># access the table's SQLEngine object:
</span><span class="python_name">employees</span><span class="python_operator">.</span><span class="python_name">engine</span><span class="python_operator">
</span>
<span class="python_comment"># access a column's name, type, nullable, primary key, foreign key
</span><span class="python_name">employees</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">employee_id</span><span class="python_operator">.</span><span class="python_name">name</span><span class="python_operator">
</span><span class="python_name">employees</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">employee_id</span><span class="python_operator">.</span><span class="python_name">type</span><span class="python_operator">
</span><span class="python_name">employees</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">employee_id</span><span class="python_operator">.</span><span class="python_name">nullable</span><span class="python_operator">
</span><span class="python_name">employees</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">employee_id</span><span class="python_operator">.</span><span class="python_name">primary_key</span><span class="python_operator">
</span><span class="python_name">employees</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">employee_dept</span><span class="python_operator">.</span><span class="python_name">foreign_key</span><span class="python_operator">
</span>
<span class="python_comment"># get the "key" of a column, which defaults to its name, but can 
# be any user-defined string:
</span><span class="python_name">employees</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">name</span><span class="python_operator">.</span><span class="python_name">key</span><span class="python_operator">
</span>
<span class="python_comment"># access a column's table:
</span><span class="python_name">employees</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">employee_id</span><span class="python_operator">.</span><span class="python_name">table </span><span class="python_keyword">is </span><span class="python_name">employees</span><span class="python_operator">
>>> </span><span class="python_name">True</span><span class="python_operator">
</span>
<span class="python_comment"># get the table related by a foreign key
</span><span class="python_name">fcolumn </span><span class="python_operator">= </span><span class="python_name">employees</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">employee_dept</span><span class="python_operator">.</span><span class="python_name">foreign_key</span><span class="python_operator">.</span><span class="python_name">column</span><span class="python_operator">.</span><span class="python_name">table</span><span class="python_operator"></span></pre></div>

        </p>
        
        <p>Metadata objects can also be <b>reflected</b> from tables that already exist in the database.  Reflection means based on a table name, the names, datatypes, and attributes of all columns, including foreign keys, will be loaded automatically.  This feature is supported by all database engines:</p>
        

<div class="code">
<pre><span class="python_operator">>>> </span><span class="python_name">messages </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'messages'</span><span class="python_operator">, </span><span class="python_name">engine</span><span class="python_operator">, </span><span class="python_name">autoload </span><span class="python_operator">= </span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">
>>> </span><span class="python_enclosure">[</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">name </span><span class="python_keyword">for </span><span class="python_name">c </span><span class="python_keyword">in </span><span class="python_name">messages</span><span class="python_operator">.</span><span class="python_name">columns</span><span class="python_enclosure">]</span><span class="python_operator">
</span><span class="python_enclosure">[</span><span class="python_literal">'message_id'</span><span class="python_operator">, </span><span class="python_literal">'message_name'</span><span class="python_operator">, </span><span class="python_literal">'date'</span><span class="python_enclosure">]</span><span class="python_operator"></span></pre></div>

        
        <p>
        Note that if a reflected table has a foreign key referencing another table, then the metadata for the related table will be loaded as well, even if it has not been defined by the application:              
        </p>
        

<div class="code">
<pre><span class="python_operator">>>> </span><span class="python_name">shopping_cart_items </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'shopping_cart_items'</span><span class="python_operator">, </span><span class="python_name">engine</span><span class="python_operator">, </span><span class="python_name">autoload </span><span class="python_operator">= </span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">
>>> </span><span class="python_keyword">print </span><span class="python_name">shopping_cart_items</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">cart_id</span><span class="python_operator">.</span><span class="python_name">table</span><span class="python_operator">.</span><span class="python_name">name</span><span class="python_operator">
</span><span class="python_name">shopping_carts</span><span class="python_operator"></span></pre></div>

        <p>To get direct access to 'shopping_carts', simply instantiate it via the Table constructor.  You'll get the same instance of the shopping cart Table as the one that is attached to shopping_cart_items:
        

<div class="code">
<pre><span class="python_operator">>>> </span><span class="python_name">shopping_carts </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'shopping_carts'</span><span class="python_operator">, </span><span class="python_name">engine</span><span class="python_enclosure">)</span><span class="python_operator">
>>> </span><span class="python_name">shopping_carts </span><span class="python_keyword">is </span><span class="python_name">shopping_cart_items</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">cart_id</span><span class="python_operator">.</span><span class="python_name">table</span><span class="python_operator">.</span><span class="python_name">name</span><span class="python_operator">
</span><span class="python_name">True</span><span class="python_operator"></span></pre></div>

        <p>This works because when the Table constructor is called for a particular name and database engine, if the table has already been created then the instance returned will be the same as the original.  This is a <b>singleton</b> constructor:</p>
        

<div class="code">
<pre><span class="python_operator">>>> </span><span class="python_name">news_articles </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'news'</span><span class="python_operator">, </span><span class="python_name">engine</span><span class="python_operator">, </span>
<span class="python_operator">... </span><span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'article_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key </span><span class="python_operator">= </span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
<span class="python_operator">... </span><span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'url'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">250</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">nullable </span><span class="python_operator">= </span><span class="python_name">False</span><span class="python_enclosure">)</span>
<span class="python_operator">... </span><span class="python_enclosure">)</span><span class="python_operator">
>>> </span><span class="python_name">othertable </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'news'</span><span class="python_operator">, </span><span class="python_name">engine</span><span class="python_enclosure">)</span><span class="python_operator">
>>> </span><span class="python_name">othertable </span><span class="python_keyword">is </span><span class="python_name">news_articles</span><span class="python_operator">
</span><span class="python_name">True</span><span class="python_operator"></span></pre></div>

    
    </div>


    <a href="#metadata" class="toclink">back to section top</a>


</div>


        



<A name="metadata_creating"></a>

<div class="subsection" style="margin-left:20px;">

    <span class="sectionheadertext">Creating and Dropping Database Tables</span>
    <div class="sectiontext">


    <p>Creating and dropping is easy, just use the <span class="codeline">create()</span> and <span class="codeline">drop()</span> methods:
        

<div class="code">
<pre><span class="python_literal"><a href="javascript:togglePopbox('popbox_1', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">employees </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'employees'</span><span class="python_operator">, </span><span class="python_name">engine</span><span class="python_operator">, </span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'employee_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'employee_name'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">60</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">nullable</span><span class="python_operator">=</span><span class="python_name">False</span><span class="python_operator">, </span><span class="python_name">key</span><span class="python_operator">=</span><span class="python_literal">'name'</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'employee_dept'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">ForeignKey</span><span class="python_enclosure">(</span><span class="python_literal">"departments.department_id"</span><span class="python_enclosure">))</span>
<span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">employees</span><span class="python_operator">.</span><span class="python_name">create</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_1_div" class="codepop" style="display:none;">CREATE TABLE employees(<br/>
        employee_id SERIAL NOT NULL PRIMARY KEY,<br/>
        employee_name VARCHAR(60) NOT NULL,<br/>
        employee_dept INTEGER REFERENCES departments(department_id)<br/>
)<br/>
{}</div><pre><span class="python_literal"><a href="javascript:togglePopbox('popbox_2', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">employees</span><span class="python_operator">.</span><span class="python_name">drop</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_2_div" class="codepop" style="display:none;">DROP TABLE employees<br/>
{}</div><pre><span class="python_operator"></span></pre></div>
    
    
    </div>


    <a href="#metadata" class="toclink">back to section top</a>


</div>


        



<A name="metadata_defaults"></a>

<div class="subsection" style="margin-left:20px;">

    <span class="sectionheadertext">Column Defaults and OnUpdates</span>
    <div class="sectiontext">


    <p>SQLAlchemy includes flexible constructs in which to create default values for columns upon the insertion of rows, as well as upon update.  These defaults can take several forms: a constant, a Python callable to be pre-executed before the SQL is executed, a SQL expression or function to be pre-executed before the SQL is executed, a pre-executed Sequence (for databases that support sequences), or a "passive" default, which is a default function triggered by the database itself upon insert, the value of which can then be post-fetched by the engine, provided the row provides a primary key in which to call upon.</p>
        
			

        
			
        
        
			
        
			
    
    </div>

        



<A name="metadata_defaults_oninsert"></a>

<div class="subsection" style="margin-left:30px;">

    <span class="sectionheadertext">Pre-Executed Insert Defaults</span>
    <div class="sectiontext">


        <p>A basic default is most easily specified by the "default" keyword argument to Column:</p>
            

<div class="code">
<pre><span class="python_comment"># a function to create primary key ids
</span><span class="python_name">i </span><span class="python_operator">= </span><span class="python_number">0</span><span class="python_operator">
</span><span class="python_keyword">def </span><span class="python_name">mydefault</span><span class="python_enclosure">()</span><span class="python_operator">:
    </span><span class="python_name">i </span><span class="python_operator">+= </span><span class="python_number">1</span><span class="python_operator">
    </span><span class="python_keyword">return </span><span class="python_name">i</span><span class="python_operator">
</span>
<span class="python_operator"></span><span class="python_name">t </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">"mytable"</span><span class="python_operator">, </span><span class="python_name">db</span><span class="python_operator">, </span>
    <span class="python_comment"># function-based default</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_operator">, </span><span class="python_name">default</span><span class="python_operator">=</span><span class="python_name">mydefault</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    
    <span class="python_comment"># a scalar default</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'key'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">10</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">default</span><span class="python_operator">=</span><span class="python_literal">"default"</span><span class="python_enclosure">)</span>
<span class="python_enclosure">)</span><span class="python_operator"></span></pre></div>

        <p>The "default" keyword can also take SQL expressions, including select statements or direct function calls:</p>
            

<div class="code">
<pre><span class="python_name">t </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">"mytable"</span><span class="python_operator">, </span><span class="python_name">db</span><span class="python_operator">, </span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    
    <span class="python_comment"># define 'create_date' to default to now()</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'create_date'</span><span class="python_operator">, </span><span class="python_name">DateTime</span><span class="python_operator">, </span><span class="python_name">default</span><span class="python_operator">=</span><span class="python_name">func</span><span class="python_operator">.</span><span class="python_name">now</span><span class="python_enclosure">())</span><span class="python_operator">,</span>
    
    <span class="python_comment"># define 'key' to pull its default from the 'keyvalues' table</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'key'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">20</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">default</span><span class="python_operator">=</span><span class="python_name">keyvalues</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">keyvalues</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">type</span><span class="python_operator">=</span><span class="python_literal">'type1'</span><span class="python_operator">, </span><span class="python_name">limit</span><span class="python_operator">=</span><span class="python_number">1</span><span class="python_enclosure">))</span>
    <span class="python_enclosure">)</span><span class="python_operator"></span></pre></div>

            <p>The "default" keyword argument is shorthand for using a ColumnDefault object in a column definition.  This syntax is optional, but is required for other types of defaults, futher described below:</p>
            

<div class="code">
<pre><span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'mycolumn'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">30</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">ColumnDefault</span><span class="python_enclosure">(</span><span class="python_name">func</span><span class="python_operator">.</span><span class="python_name">get_data</span><span class="python_enclosure">()))</span><span class="python_operator"></span></pre></div>

        
    </div>


    <a href="#metadata" class="toclink">back to section top</a>


</div>


        



<A name="metadata_defaults_onupdate"></a>

<div class="subsection" style="margin-left:30px;">

    <span class="sectionheadertext">Pre-Executed OnUpdate Defaults</span>
    <div class="sectiontext">


        <p>Similar to an on-insert default is an on-update default, which is most easily specified by the "onupdate" keyword to Column, which also can be a constanct, plain Python function or SQL expression:</p>
            

<div class="code">
<pre><span class="python_name">t </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">"mytable"</span><span class="python_operator">, </span><span class="python_name">db</span><span class="python_operator">, </span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    
    <span class="python_comment"># define 'last_updated' to be populated with current_timestamp (the ANSI-SQL version of now())</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'last_updated'</span><span class="python_operator">, </span><span class="python_name">DateTime</span><span class="python_operator">, </span><span class="python_name">onupdate</span><span class="python_operator">=</span><span class="python_name">func</span><span class="python_operator">.</span><span class="python_name">current_timestamp</span><span class="python_enclosure">())</span><span class="python_operator">,</span>
    <span class="python_enclosure">)</span><span class="python_operator"></span></pre></div>

            <p>To use a ColumnDefault explicitly for an on-update, use the "for_update" keyword argument:</p>
            

<div class="code">
<pre><span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'mycolumn'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">30</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">ColumnDefault</span><span class="python_enclosure">(</span><span class="python_name">func</span><span class="python_operator">.</span><span class="python_name">get_data</span><span class="python_enclosure">()</span><span class="python_operator">, </span><span class="python_name">for_update</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">))</span><span class="python_operator"></span></pre></div>

        
    </div>


    <a href="#metadata" class="toclink">back to section top</a>


</div>


        



<A name="metadata_defaults_passive"></a>

<div class="subsection" style="margin-left:30px;">

    <span class="sectionheadertext">Inline Default Execution: PassiveDefault</span>
    <div class="sectiontext">


        <p>A PassiveDefault indicates a column default or on-update value that is executed automatically by the database.  This construct is used to specify a SQL function that will be specified as "DEFAULT" when creating tables, and also to indicate the presence of new data that is available to be "post-fetched" after an insert or update execution.</p>
        

<div class="code">
<pre><span class="python_name">t </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'test'</span><span class="python_operator">, </span><span class="python_name">e</span><span class="python_operator">, </span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'mycolumn'</span><span class="python_operator">, </span><span class="python_name">DateTime</span><span class="python_operator">, </span><span class="python_name">PassiveDefault</span><span class="python_enclosure">(</span><span class="python_literal">"sysdate"</span><span class="python_enclosure">))</span>
<span class="python_enclosure">)</span><span class="python_operator"></span></pre></div>

        <p>A create call for the above table will produce:</p>
        

<div class="code">
<pre><span class="python_name">CREATE TABLE test </span><span class="python_enclosure">(</span>
        <span class="python_name">mycolumn datetime default sysdate</span>
    <span class="python_enclosure">)</span><span class="python_operator"></span></pre></div>

        <p>PassiveDefaults also send a message to the SQLEngine that data is available after update or insert.  The object-relational mapper system uses this information to post-fetch rows after insert or update, so that instances can be refreshed with the new data.  Below is a simplified version:</p>
        

<div class="code">
<pre><span class="python_comment"># table with passive defaults
</span><span class="python_name">mytable </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'mytable'</span><span class="python_operator">, </span><span class="python_name">engine</span><span class="python_operator">, </span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'my_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    
    <span class="python_comment"># an on-insert database-side default</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'data1'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">PassiveDefault</span><span class="python_enclosure">(</span><span class="python_literal">"d1_func"</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
    
    <span class="python_comment"># an on-update database-side default</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'data2'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">PassiveDefault</span><span class="python_enclosure">(</span><span class="python_literal">"d2_func"</span><span class="python_operator">, </span><span class="python_name">for_update</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">))</span>
    <span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_comment"># insert a row
</span><span class="python_name">mytable</span><span class="python_operator">.</span><span class="python_name">insert</span><span class="python_enclosure">()</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_name">name</span><span class="python_operator">=</span><span class="python_literal">'fred'</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># ask the engine: were there defaults fired off on that row ?
</span><span class="python_keyword">if </span><span class="python_name">table</span><span class="python_operator">.</span><span class="python_name">engine</span><span class="python_operator">.</span><span class="python_name">lastrow_has_defaults</span><span class="python_enclosure">()</span><span class="python_operator">:
    </span><span class="python_comment"># postfetch the row based on primary key.
    # this only works for a table with primary key columns defined
</span><span class="python_operator">    </span><span class="python_name">primary_key </span><span class="python_operator">= </span><span class="python_name">table</span><span class="python_operator">.</span><span class="python_name">engine</span><span class="python_operator">.</span><span class="python_name">last_inserted_ids</span><span class="python_enclosure">()</span><span class="python_operator">
    </span><span class="python_name">row </span><span class="python_operator">= </span><span class="python_name">table</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">id </span><span class="python_operator">== </span><span class="python_name">primary_key</span><span class="python_enclosure">[</span><span class="python_number">0</span><span class="python_enclosure">])</span><span class="python_operator"></span></pre></div>

        <p>Tables that are reflected from the database which have default values set on them, will receive those defaults as PassiveDefaults.</p>

        
			
        
    </div>

        



<A name="metadata_defaults_passive_postgres"></a>

<div class="subsection" style="margin-left:40px;">

    <span class="sectionheadertext">The Catch: Postgres Primary Key Defaults always Pre-Execute</span>
    <div class="sectiontext">


        <p>Current Postgres support does not rely upon OID's to determine the identity of a row.  This is because the usage of OIDs has been deprecated with Postgres and they are disabled by default for table creates as of PG version 8.  Pyscopg2's "cursor.lastrowid" function only returns OIDs.  Therefore, when inserting a new row which has passive defaults set on the primary key columns, the default function is <b>still pre-executed</b> since SQLAlchemy would otherwise have no way of retrieving the row just inserted.</p>
        
    </div>


    <a href="#metadata" class="toclink">back to section top</a>


</div>





</div>


        



<A name="metadata_defaults_sequences"></a>

<div class="subsection" style="margin-left:30px;">

    <span class="sectionheadertext">Defining Sequences</span>
    <div class="sectiontext">


        <P>A table with a sequence looks like:</p>
        

<div class="code">
<pre><span class="python_name">table </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">"cartitems"</span><span class="python_operator">, </span><span class="python_name">db</span><span class="python_operator">, </span>
<span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">"cart_id"</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">Sequence</span><span class="python_enclosure">(</span><span class="python_literal">'cart_id_seq'</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
<span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">"description"</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">40</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
<span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">"createdate"</span><span class="python_operator">, </span><span class="python_name">DateTime</span><span class="python_enclosure">())</span>
        <span class="python_enclosure">)</span><span class="python_operator"></span></pre></div>

        <p>The Sequence is used with Postgres or Oracle to indicate the name of a Sequence that will be used to create default values for a column.  When a table with a Sequence on a column is created by SQLAlchemy, the Sequence object is also created.   Similarly, the Sequence is dropped when the table is dropped.  Sequences are typically used with primary key columns.  When using Postgres, if an integer primary key column defines no explicit Sequence or other default method, SQLAlchemy will create the column with the SERIAL keyword, and will pre-execute a sequence named "tablename_columnname_seq" in order to retrieve new primary key values.   Oracle, which has no "auto-increment" keyword, requires that a Sequence be created for a table if automatic primary key generation is desired.  Note that for all databases, primary key values can always be explicitly stated within the bind parameters for any insert statement as well, removing the need for any kind of default generation function.</p>
    
    <p>A Sequence object can be defined on a Table that is then used for a non-sequence-supporting database.  In that case, the Sequence object is simply ignored.  Note that a Sequence object is <b>entirely optional for all databases except Oracle</b>, as other databases offer options for auto-creating primary key values, such as AUTOINCREMENT, SERIAL, etc.  SQLAlchemy will use these default methods for creating primary key values if no Sequence is present on the table metadata.</p>
    
    <p>A sequence can also be specified with <span class="codeline">optional=True</span> which indicates the Sequence should only be used on a database that requires an explicit sequence, and not those that supply some other method of providing integer values.  At the moment, it essentially means "use this sequence only with Oracle and not Postgres".</p>
        
    </div>


    <a href="#metadata" class="toclink">back to section top</a>


</div>





</div>


        



<A name="metadata_indexes"></a>

<div class="subsection" style="margin-left:20px;">

    <span class="sectionheadertext">Defining Indexes</span>
    <div class="sectiontext">


    <p>Indexes can be defined on table columns, including named indexes, non-unique or unique, multiple column.  Indexes are included along with table create and drop statements.  They are not used for any kind of run-time constraint checking...SQLAlchemy leaves that job to the expert on constraint checking, the database itself.</p>
    

<div class="code">
<pre><span class="python_name">mytable </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'mytable'</span><span class="python_operator">, </span><span class="python_name">engine</span><span class="python_operator">, </span>

    <span class="python_comment"># define a unique index </span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'col1'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">unique</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    
    <span class="python_comment"># define a unique index with a specific name</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'col2'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">unique</span><span class="python_operator">=</span><span class="python_literal">'mytab_idx_1'</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    
    <span class="python_comment"># define a non-unique index</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'col3'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">index</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    
    <span class="python_comment"># define a non-unique index with a specific name</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'col4'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">index</span><span class="python_operator">=</span><span class="python_literal">'mytab_idx_2'</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    
    <span class="python_comment"># pass the same name to multiple columns to add them to the same index</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'col5'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">index</span><span class="python_operator">=</span><span class="python_literal">'mytab_idx_2'</span><span class="python_enclosure">)</span><span class="python_operator">,</span>

    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'col6'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'col7'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_enclosure">)</span>
    <span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># create the table.  all the indexes will be created along with it.
</span><span class="python_name">mytable</span><span class="python_operator">.</span><span class="python_name">create</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_comment"># indexes can also be specified standalone
</span><span class="python_name">i </span><span class="python_operator">= </span><span class="python_name">Index</span><span class="python_enclosure">(</span><span class="python_literal">'mytab_idx_3'</span><span class="python_operator">, </span><span class="python_name">mytable</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">col6</span><span class="python_operator">, </span><span class="python_name">mytable</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">col7</span><span class="python_operator">, </span><span class="python_name">unique</span><span class="python_operator">=</span><span class="python_name">False</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># which can then be created separately (will also get created with table creates)
</span><span class="python_name">i</span><span class="python_operator">.</span><span class="python_name">create</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre></div>

    
    </div>


    <a href="#metadata" class="toclink">back to section top</a>


</div>


        



<A name="metadata_adapting"></a>

<div class="subsection" style="margin-left:20px;">

    <span class="sectionheadertext">Adapting Tables to Alternate Engines</span>
    <div class="sectiontext">


    <p>A Table object created against a specific engine can be re-created against a new engine using the <span class="codeline">toengine</span> method:</p>
    
        

<div class="code">
<pre><span class="python_comment"># create two engines
</span><span class="python_name">sqlite_engine </span><span class="python_operator">= </span><span class="python_name">create_engine</span><span class="python_enclosure">(</span><span class="python_literal">'sqlite'</span><span class="python_operator">, </span><span class="python_enclosure">{</span><span class="python_literal">'filename'</span><span class="python_operator">:</span><span class="python_literal">'querytest.db'</span><span class="python_enclosure">})</span><span class="python_operator">
</span><span class="python_name">postgres_engine </span><span class="python_operator">= </span><span class="python_name">create_engine</span><span class="python_enclosure">(</span><span class="python_literal">'postgres'</span><span class="python_operator">, </span>
                    <span class="python_enclosure">{</span><span class="python_literal">'database'</span><span class="python_operator">:</span><span class="python_literal">'test'</span><span class="python_operator">, </span>
                    <span class="python_literal">'host'</span><span class="python_operator">:</span><span class="python_literal">'127.0.0.1'</span><span class="python_operator">, </span><span class="python_literal">'user'</span><span class="python_operator">:</span><span class="python_literal">'scott'</span><span class="python_operator">, </span><span class="python_literal">'password'</span><span class="python_operator">:</span><span class="python_literal">'tiger'</span><span class="python_enclosure">})</span><span class="python_operator">
</span>
<span class="python_comment"># load 'users' from the sqlite engine
</span><span class="python_name">users </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'users'</span><span class="python_operator">, </span><span class="python_name">sqlite_engine</span><span class="python_operator">, </span><span class="python_name">autoload</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># create the same Table object for the other engine
</span><span class="python_name">pg_users </span><span class="python_operator">= </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">toengine</span><span class="python_enclosure">(</span><span class="python_name">postgres_engine</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre></div>

        
        <p>Also available is the "database neutral" ansisql engine:</p>
        

<div class="code">
<pre><span class="python_keyword">import </span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">ansisql as ansisql</span><span class="python_operator">
</span><span class="python_name">generic_engine </span><span class="python_operator">= </span><span class="python_name">ansisql</span><span class="python_operator">.</span><span class="python_name">engine</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_name">users </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'users'</span><span class="python_operator">, </span><span class="python_name">generic_engine</span><span class="python_operator">, </span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'user_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'user_name'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">50</span><span class="python_enclosure">))</span>
<span class="python_enclosure">)</span><span class="python_operator"></span></pre></div>
        
    <p>Flexible "multi-engined" tables can also be achieved via the proxy engine, described in the section <a href="#dbengine_proxy" >Using the Proxy Engine</a>.</p>

    
			
    
    </div>

        



<A name="metadata_adapting_primitives"></a>

<div class="subsection" style="margin-left:30px;">

    <span class="sectionheadertext">Non-engine primitives: TableClause/ColumnClause</span>
    <div class="sectiontext">


    
    <p>TableClause and ColumnClause are "primitive" versions of the Table and Column objects which dont use engines at all; applications that just want to generate SQL strings but not directly communicate with a database can use TableClause and ColumnClause objects (accessed via 'table' and 'column'), which are non-singleton and serve as the "lexical" base class of Table and Column:</p>
        

<div class="code">
<pre><span class="python_name">tab1 </span><span class="python_operator">= </span><span class="python_name">table</span><span class="python_enclosure">(</span><span class="python_literal">'table1'</span><span class="python_operator">,</span>
    <span class="python_name">column</span><span class="python_enclosure">(</span><span class="python_literal">'id'</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">column</span><span class="python_enclosure">(</span><span class="python_literal">'name'</span><span class="python_enclosure">))</span><span class="python_operator">
</span>
<span class="python_name">tab2 </span><span class="python_operator">= </span><span class="python_name">table</span><span class="python_enclosure">(</span><span class="python_literal">'table2'</span><span class="python_operator">,</span>
    <span class="python_name">column</span><span class="python_enclosure">(</span><span class="python_literal">'id'</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">column</span><span class="python_enclosure">(</span><span class="python_literal">'email'</span><span class="python_enclosure">))</span><span class="python_operator">
    </span>
<span class="python_name">tab1</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">tab1</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">name </span><span class="python_operator">== </span><span class="python_literal">'foo'</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre></div>

        
    <p>TableClause and ColumnClause are strictly lexical.  This means they are fully supported within the full range of SQL statement generation, but they don't support schema concepts like creates, drops, primary keys, defaults, nullable status, indexes, or foreign keys.</p>
    
    </div>


    <a href="#metadata" class="toclink">back to section top</a>


</div>





</div>




    <hr width="400px" align="left" />

</div>


		</div>
		<div class="section">
					
			<A name="sql"></a>
			<div class="topnavmargin">
			
	
<div class="topnav">


	
	<div class="topnavcontrol">
	View: <a href="index.html">Paged</a> &nbsp;|&nbsp; <b>One Page</b>
	</div>



<div class="topnavsectionlink">

<a href="#top">Table of Contents</a>

<div class="prevnext">
Previous: <a href="#metadata">Database Meta Data</a>

&nbsp; | &nbsp;


Next: <a href="#datamapping">Basic Data Mapping</a>

</div>
</div>


<div class="topnavmain">
	<div class="topnavheader">Constructing SQL Queries via Python Expressions</div>
	<div class="topnavitems">
	


    
    
    <div class="toclink">
        <A style="" href="#sql_select">Simple Select</a>
    </div>
    
    <div class="toclinkcontainer">
        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#sql_select_labels">Using Column Labels</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#sql_select_columns">Table/Column Specification</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#sql_select_whereclause">WHERE Clause</a>
    </div>

        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#sql_select_whereclause_operators">Operators</a>
    </div>

    </div>


    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#sql_select_engine">Specifying the Engine</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#sql_select_functions">Functions</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#sql_select_literals">Literals</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#sql_select_orderby">Order By</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#sql_select_options">DISTINCT, LIMIT and OFFSET</a>
    </div>

    </div>


    </div>


    
    
    <div class="toclink">
        <A style="" href="#sql_join">Inner and Outer Joins</a>
    </div>
    
    <div class="toclinkcontainer">
    </div>


    
    
    <div class="toclink">
        <A style="" href="#sql_alias">Table Aliases</a>
    </div>
    
    <div class="toclinkcontainer">
    </div>


    
    
    <div class="toclink">
        <A style="" href="#sql_subqueries">Subqueries</a>
    </div>
    
    <div class="toclinkcontainer">
        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#sql_subqueries_scalar">Scalar Column Subqueries</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#sql_subqueries_correlated">Correlated Subqueries</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#sql_subqueries_exists">EXISTS Clauses</a>
    </div>

    </div>


    </div>


    
    
    <div class="toclink">
        <A style="" href="#sql_unions">Unions</a>
    </div>
    
    <div class="toclinkcontainer">
    </div>


    
    
    <div class="toclink">
        <A style="" href="#sql_bindparams">Custom Bind Parameters</a>
    </div>
    
    <div class="toclinkcontainer">
        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#sql_bindparams_precompiling">Precompiling a Query</a>
    </div>

    </div>


    </div>


    
    
    <div class="toclink">
        <A style="" href="#sql_textual">Literal Text Blocks</a>
    </div>
    
    <div class="toclinkcontainer">
        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#sql_textual_textual_binds">Using Bind Parameters in Text Blocks</a>
    </div>

    </div>


    </div>


    
    
    <div class="toclink">
        <A style="" href="#sql_building">Building Select Objects</a>
    </div>
    
    <div class="toclinkcontainer">
    </div>


    
    
    <div class="toclink">
        <A style="" href="#sql_insert">Inserts</a>
    </div>
    
    <div class="toclinkcontainer">
    </div>


    
    
    <div class="toclink">
        <A style="" href="#sql_update">Updates</a>
    </div>
    
    <div class="toclinkcontainer">
        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#sql_update_correlated">Correlated Updates</a>
    </div>

    </div>


    </div>


    
    
    <div class="toclink">
        <A style="" href="#sql_delete">Deletes</a>
    </div>
    
    <div class="toclinkcontainer">
    </div>



	</div>
</div>

</div>

			</div>

			




<div class="subsection" style="margin-left:10px;">

    <div class="sectiontext">


    <p><b>Note:</b> This section describes how to use SQLAlchemy to construct SQL queries and receive result sets.  It does <b>not</b> cover the object relational mapping capabilities of SQLAlchemy; that is covered later on in <a href="#datamapping" >Basic Data Mapping</a>.  However, both areas of functionality work similarly in how selection criterion is constructed, so if you are interested just in ORM, you should probably skim through basic <a href="#sql_select_whereclause" >WHERE Clause</a> construction before moving on.</p>
    <p>Once you have used the <span class="codeline">sqlalchemy.schema</span> module to construct your tables and/or reflect them from the database, performing SQL queries using those table meta data objects is done via the <span class="codeline">sqlalchemy.sql</span> package.  This package defines a large set of classes, each of which represents a particular kind of lexical construct within a SQL query; all are descendants of the common base class <span class="codeline">sqlalchemy.sql.ClauseElement</span>.  A full query is represented via a structure of ClauseElements.  A set of reasonably intuitive creation functions is provided by the <span class="codeline">sqlalchemy.sql</span> package to create these structures; these functions are described in the rest of this section. </p>
    
    <p>To execute a query, you create its structure, then call the resulting structure's <span class="codeline">execute()</span> method, which returns a cursor-like object (more on that later).  The same clause structure can be used repeatedly.  A ClauseElement is compiled into a string representation by an underlying SQLEngine object, which is located by searching through the clause's child items for a Table object, which provides a reference to its SQLEngine. 
    </p>    
    <p>The examples below all include a dump of the generated SQL corresponding to the query object, as well as a dump of the statement's bind parameters.  In all cases, bind parameters are named parameters using the colon format (i.e. ':name').  A named parameter scheme, either ':name' or '%(name)s', is used with all databases, including those that use positional schemes.  For those, the named-parameter statement and its bind values are converted to the proper list-based format right before execution.  Therefore a SQLAlchemy application that uses ClauseElements can standardize on named parameters for all databases.</p>
    
    <p>For this section, we will assume the following tables:
       

<div class="code">
<pre><span class="python_keyword">from </span><span class="python_name">sqlalchemy </span><span class="python_keyword">import </span><span class="python_operator">*
</span><span class="python_name">db </span><span class="python_operator">= </span><span class="python_name">create_engine</span><span class="python_enclosure">(</span><span class="python_literal">'sqlite://filename=mydb'</span><span class="python_operator">, </span><span class="python_name">echo</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># a table to store users
</span><span class="python_name">users </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'users'</span><span class="python_operator">, </span><span class="python_name">db</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'user_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key </span><span class="python_operator">= </span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'user_name'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">40</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'password'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">80</span><span class="python_enclosure">))</span>
<span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># a table that stores mailing addresses associated with a specific user
</span><span class="python_name">addresses </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'addresses'</span><span class="python_operator">, </span><span class="python_name">db</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'address_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key </span><span class="python_operator">= </span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'user_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">ForeignKey</span><span class="python_enclosure">(</span><span class="python_literal">"users.user_id"</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'street'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">100</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'city'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">80</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'state'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">2</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'zip'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">10</span><span class="python_enclosure">))</span>
<span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># a table that stores keywords
</span><span class="python_name">keywords </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'keywords'</span><span class="python_operator">, </span><span class="python_name">db</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'keyword_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key </span><span class="python_operator">= </span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'name'</span><span class="python_operator">, </span><span class="python_name">VARCHAR</span><span class="python_enclosure">(</span><span class="python_number">50</span><span class="python_enclosure">))</span>
<span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># a table that associates keywords with users
</span><span class="python_name">userkeywords </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'userkeywords'</span><span class="python_operator">, </span><span class="python_name">db</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'user_id'</span><span class="python_operator">, </span><span class="python_name">INT</span><span class="python_operator">, </span><span class="python_name">ForeignKey</span><span class="python_enclosure">(</span><span class="python_literal">"users"</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'keyword_id'</span><span class="python_operator">, </span><span class="python_name">INT</span><span class="python_operator">, </span><span class="python_name">ForeignKey</span><span class="python_enclosure">(</span><span class="python_literal">"keywords"</span><span class="python_enclosure">))</span>
<span class="python_enclosure">)</span><span class="python_operator"></span></pre></div>

    </p>
    
    
			

    
			
    
			
    
			
    
			
    
			
    
			
    
			
    
			
    
			
    
			

    </div>

        



<A name="sql_select"></a>

<div class="subsection" style="margin-left:20px;">

    <span class="sectionheadertext">Simple Select</span>
    <div class="sectiontext">


        <p>A select is done by constructing a <span class="codeline">Select</span> object with the proper arguments, adding any extra arguments if desired, then calling its <span class="codeline">execute()</span> method.
        

<div class="code">
<pre><span class="python_keyword">from </span><span class="python_name">sqlalchemy </span><span class="python_keyword">import </span><span class="python_operator">*
</span>
<span class="python_comment"># use the select() function defined in the sql package
</span><span class="python_name">s </span><span class="python_operator">= </span><span class="python_name">select</span><span class="python_enclosure">([</span><span class="python_name">users</span><span class="python_enclosure">])</span><span class="python_operator">
</span>
<span class="python_comment"># or, call the select() method off of a Table object
</span><span class="python_name">s </span><span class="python_operator">= </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_comment"># then, call execute on the Select object:
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_3', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">c </span><span class="python_operator">= </span><span class="python_name">s</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_3_div" class="codepop" style="display:none;">SELECT users.user_id, users.user_name, users.password FROM users<br/>
{}</div><pre><span class="python_comment"># the SQL text of any clause object can also be viewed via the str() call:
</span><span class="python_operator">>>> </span><span class="python_name">str</span><span class="python_enclosure">(</span><span class="python_name">s</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">SELECT users</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">password FROM users</span><span class="python_operator"></span></pre></div>

        <p>The object returned by the execute call is a <span class="codeline">sqlalchemy.engine.ResultProxy</span> object, which acts much like a DBAPI <span class="codeline">cursor</span> object in the context of a result set, except that the rows returned can address their columns by ordinal position, column name, or even column object:</p>
        
        

<div class="code">
<pre><span class="python_comment"># select rows, get resulting ResultProxy object
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_4', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">c </span><span class="python_operator">= </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">()</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_4_div" class="codepop" style="display:none;">SELECT users.user_id, users.user_name, users.password FROM users<br/>
{}</div><pre><span class="python_comment"># get one row
</span><span class="python_name">row </span><span class="python_operator">= </span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">fetchone</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_comment"># get the 'user_id' column via integer index:
</span><span class="python_name">user_id </span><span class="python_operator">= </span><span class="python_name">row</span><span class="python_enclosure">[</span><span class="python_number">0</span><span class="python_enclosure">]</span><span class="python_operator">
</span>
<span class="python_comment"># or column name
</span><span class="python_name">user_name </span><span class="python_operator">= </span><span class="python_name">row</span><span class="python_enclosure">[</span><span class="python_literal">'user_name'</span><span class="python_enclosure">]</span><span class="python_operator">
</span>
<span class="python_comment"># or column object
</span><span class="python_name">password </span><span class="python_operator">= </span><span class="python_name">row</span><span class="python_enclosure">[</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">password</span><span class="python_enclosure">]</span><span class="python_operator">
</span>
<span class="python_comment"># or column accessor
</span><span class="python_name">password </span><span class="python_operator">= </span><span class="python_name">row</span><span class="python_operator">.</span><span class="python_name">password</span><span class="python_operator">
</span>
<span class="python_comment"># ResultProxy object also supports fetchall()
</span><span class="python_name">rows </span><span class="python_operator">= </span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">fetchall</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_comment"># or get the underlying DBAPI cursor object
</span><span class="python_name">cursor </span><span class="python_operator">= </span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">cursor</span><span class="python_operator"></span></pre></div>

        
			
        
        
			

        
			
        
			
        
			
        
			
        
			
        
			
    
    </div>

        



<A name="sql_select_labels"></a>

<div class="subsection" style="margin-left:30px;">

    <span class="sectionheadertext">Using Column Labels</span>
    <div class="sectiontext">


        <p>A common need when writing statements that reference multiple tables is to create labels for columns, thereby separating columns from different tables with the same name.  The Select construct supports automatic generation of column labels via the <span class="codeline">use_labels=True</span> parameter:</p>
        

<div class="code">
<pre> 
<span class="python_literal"><a href="javascript:togglePopbox('popbox_5', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">c </span><span class="python_operator">= </span><span class="python_name">select</span><span class="python_enclosure">([</span><span class="python_name">users</span><span class="python_operator">, </span><span class="python_name">addresses</span><span class="python_enclosure">]</span><span class="python_operator">, </span>
    <span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">==</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">address_id</span><span class="python_operator">, </span>
    <span class="python_name">use_labels</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_5_div" class="codepop" style="display:none;">SELECT users.user_id AS users_user_id, users.user_name AS users_user_name, <br/>
users.password AS users_password, addresses.address_id AS addresses_address_id, <br/>
addresses.user_id AS addresses_user_id, addresses.street AS addresses_street, <br/>
addresses.city AS addresses_city, addresses.state AS addresses_state, <br/>
addresses.zip AS addresses_zip<br/>
FROM users, addresses<br/>
WHERE users.user_id = addresses.address_id<br/>
{}</div><pre><span class="python_operator"></span></pre></div>

        <p>The table name part of the label is affected if you use a construct such as a table alias:</p>
        

<div class="code">
<pre><span class="python_name">person </span><span class="python_operator">= </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">alias</span><span class="python_enclosure">(</span><span class="python_literal">'person'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_6', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">c </span><span class="python_operator">= </span><span class="python_name">select</span><span class="python_enclosure">([</span><span class="python_name">person</span><span class="python_operator">, </span><span class="python_name">addresses</span><span class="python_enclosure">]</span><span class="python_operator">, </span>
    <span class="python_name">person</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">==</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">address_id</span><span class="python_operator">, </span>
    <span class="python_name">use_labels</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_6_div" class="codepop" style="display:none;">SELECT person.user_id AS person_user_id, person.user_name AS person_user_name, <br/>
person.password AS person_password, addresses.address_id AS addresses_address_id,<br/>
 addresses.user_id AS addresses_user_id, addresses.street AS addresses_street, <br/>
 addresses.city AS addresses_city, addresses.state AS addresses_state, <br/>
 addresses.zip AS addresses_zip FROM users AS person, addresses<br/>
WHERE person.user_id = addresses.address_id</div><pre><span class="python_operator"></span></pre></div>
    
        <p>You can also specify custom labels on a per-column basis using the <span class="codeline">label()</span> function:
        

<div class="code">
<pre><span class="python_literal"><a href="javascript:togglePopbox('popbox_7', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">c </span><span class="python_operator">= </span><span class="python_name">select</span><span class="python_enclosure">([</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">.</span><span class="python_name">label</span><span class="python_enclosure">(</span><span class="python_literal">'id'</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator">.</span><span class="python_name">label</span><span class="python_enclosure">(</span><span class="python_literal">'name'</span><span class="python_enclosure">)])</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_7_div" class="codepop" style="display:none;">SELECT users.user_id AS id, users.user_name AS name<br/>
FROM users<br/>
{}</div><pre><span class="python_operator"></span></pre></div>

        
    </div>


    <a href="#sql" class="toclink">back to section top</a>


</div>


        



<A name="sql_select_columns"></a>

<div class="subsection" style="margin-left:30px;">

    <span class="sectionheadertext">Table/Column Specification</span>
    <div class="sectiontext">


            <P>Calling <span class="codeline">select</span> off a table automatically generates a column clause which includes all the table's columns, in the order they are specified in the source Table object.</p>
            <p>But in addition to selecting all the columns off a single table, any set of columns can be specified, as well as full tables, and any combination of the two:</p>
            

<div class="code">
<pre><span class="python_comment"># individual columns
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_8', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">c </span><span class="python_operator">= </span><span class="python_name">select</span><span class="python_enclosure">([</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_enclosure">])</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_8_div" class="codepop" style="display:none;">SELECT users.user_id, users.user_name FROM users<br/>
{}</div><pre><span class="python_comment"># full tables
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_9', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">c </span><span class="python_operator">= </span><span class="python_name">select</span><span class="python_enclosure">([</span><span class="python_name">users</span><span class="python_operator">, </span><span class="python_name">addresses</span><span class="python_enclosure">])</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_9_div" class="codepop" style="display:none;">SELECT users.user_id, users.user_name, users.password, <br/>
addresses.address_id, addresses.user_id, <br/>
addresses.street, addresses.city, addresses.state, addresses.zip<br/>
FROM users, addresses<br/>
{}</div><pre><span class="python_comment"># combinations
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_10', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">c </span><span class="python_operator">= </span><span class="python_name">select</span><span class="python_enclosure">([</span><span class="python_name">users</span><span class="python_operator">, </span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">zip</span><span class="python_enclosure">])</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_10_div" class="codepop" style="display:none;">SELECT users.user_id, users.user_name, users.password, <br/>
addresses.zip FROM users, addresses<br/>
{}</div><pre><span class="python_operator"></span></pre></div>
            
        
    </div>


    <a href="#sql" class="toclink">back to section top</a>


</div>


        



<A name="sql_select_whereclause"></a>

<div class="subsection" style="margin-left:30px;">

    <span class="sectionheadertext">WHERE Clause</span>
    <div class="sectiontext">


            <P>The WHERE condition is the named keyword argument <span class="codeline">whereclause</span>, or the second positional argument to the <span class="codeline">select()</span> constructor and the first positional argument to the <span class="codeline">select()</span> method of <span class="codeline">Table</span>.</p>
            
            <p>WHERE conditions are constructed using column objects, literal values, and functions defined in the <span class="codeline">sqlalchemy.sql</span> module.  Column objects override the standard Python operators to provide clause compositional objects, which compile down to SQL operations:
            
            

<div class="code">
<pre><span class="python_literal"><a href="javascript:togglePopbox('popbox_11', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">c </span><span class="python_operator">= </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id </span><span class="python_operator">== </span><span class="python_number">7</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_11_div" class="codepop" style="display:none;">SELECT users.user_id, users.user_name, users.password, <br/>
FROM users WHERE users.user_id = :users_user_id<br/>
{'users_user_id': 7}</div><pre><span class="python_operator"></span></pre></div>

            <p>Notice that the literal value "7" was broken out of the query and placed into a bind parameter.  Databases such as Oracle must parse incoming SQL and create a "plan" when new queries are received, which is an expensive process.  By using bind parameters, the same query with various literal values can have its plan compiled only once, and used repeatedly with less overhead.
            </p>
            <P>More where clauses:</p>
            

<div class="code">
<pre><span class="python_comment"># another comparison operator
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_12', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">c </span><span class="python_operator">= </span><span class="python_name">select</span><span class="python_enclosure">([</span><span class="python_name">users</span><span class="python_enclosure">]</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">></span><span class="python_number">7</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_12_div" class="codepop" style="display:none;">SELECT users.user_id, users.user_name, users.password, <br/>
FROM users WHERE users.user_id > :users_user_id<br/>
{'users_user_id': 7}</div><pre><span class="python_comment"># OR keyword
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_13', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">c </span><span class="python_operator">= </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">or_</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator">==</span><span class="python_literal">'jack'</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator">==</span><span class="python_literal">'ed'</span><span class="python_enclosure">))</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_13_div" class="codepop" style="display:none;">SELECT users.user_id, users.user_name, users.password <br/>
FROM users WHERE users.user_name = :users_user_name <br/>
OR users.user_name = :users_user_name_1<br/>
{'users_user_name_1': 'ed', 'users_user_name': 'jack'}</div><pre><span class="python_comment"># AND keyword
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_14', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">c </span><span class="python_operator">= </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">and_</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator">==</span><span class="python_literal">'jack'</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">password</span><span class="python_operator">==</span><span class="python_literal">'dog'</span><span class="python_enclosure">))</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_14_div" class="codepop" style="display:none;">SELECT users.user_id, users.user_name, users.password<br/>
FROM users WHERE users.user_name = :users_user_name <br/>
AND users.password = :users_password<br/>
{'users_user_name': 'jack', 'users_password': 'dog'}</div><pre><span class="python_comment"># NOT keyword
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_15', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">c </span><span class="python_operator">= </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">not_</span><span class="python_enclosure">(</span>
        <span class="python_name">or_</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator">==</span><span class="python_literal">'jack'</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">password</span><span class="python_operator">==</span><span class="python_literal">'dog'</span><span class="python_enclosure">)</span>
    <span class="python_enclosure">))</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_15_div" class="codepop" style="display:none;">SELECT users.user_id, users.user_name, users.password <br/>
FROM users <br/>
WHERE NOT (users.user_name = :users_user_name <br/>
    OR users.password = :users_password)<br/>
{'users_user_name': 'jack', 'users_password': 'dog'}</div><pre> 
 <span class="python_comment"># IN clause
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_16', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">c </span><span class="python_operator">= </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator">.</span><span class="python_name">in_</span><span class="python_enclosure">(</span><span class="python_literal">'jack'</span><span class="python_operator">, </span><span class="python_literal">'ed'</span><span class="python_operator">, </span><span class="python_literal">'fred'</span><span class="python_enclosure">))</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_16_div" class="codepop" style="display:none;">SELECT users.user_id, users.user_name, users.password<br/>
FROM users WHERE users.user_name <br/>
IN (:users_user_name, :users_user_name_1, :users_user_name_2)<br/>
{'users_user_name': 'jack', 'users_user_name_1': 'ed', <br/>
    'users_user_name_2': 'fred'}</div><pre> 
 <span class="python_comment"># join users and addresses together
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_17', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">c </span><span class="python_operator">= </span><span class="python_name">select</span><span class="python_enclosure">([</span><span class="python_name">users</span><span class="python_operator">, </span><span class="python_name">addresses</span><span class="python_enclosure">]</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">==</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">address_id</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_17_div" class="codepop" style="display:none;">SELECT users.user_id, users.user_name, users.password,  <br/>
addresses.address_id, addresses.user_id, addresses.street, addresses.city, <br/>
addresses.state, addresses.zip<br/>
FROM users, addresses<br/>
WHERE users.user_id = addresses.address_id<br/>
{}</div><pre> 
 <span class="python_comment"># join users and addresses together, but dont specify "addresses" in the 
 # selection criterion.  The WHERE criterion adds it to the FROM list 
 # automatically.
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_18', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">c </span><span class="python_operator">= </span><span class="python_name">select</span><span class="python_enclosure">([</span><span class="python_name">users</span><span class="python_enclosure">]</span><span class="python_operator">, </span><span class="python_name">and_</span><span class="python_enclosure">(</span>
     <span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">==</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">,</span>
     <span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator">==</span><span class="python_literal">'fred'</span>
 <span class="python_enclosure">))</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_18_div" class="codepop" style="display:none;">SELECT users.user_id, users.user_name, users.password<br/>
FROM users, addresses WHERE users.user_id = addresses.user_id <br/>
AND users.user_name = :users_user_name<br/>
{'users_user_name': 'fred'}</div><pre><span class="python_operator"></span></pre></div>
            

        <P>Select statements can also generate a WHERE clause based on the parameters you give it.  If a given parameter, which matches the name of a column or its "label" (the combined tablename + "_" + column name), and does not already correspond to a bind parameter in the select object, it will be added as a comparison against that column.  This is a shortcut to creating a full WHERE clause:</p>
        

<div class="code">
<pre><span class="python_comment"># specify a match for the "user_name" column
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_19', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">c </span><span class="python_operator">= </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">()</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_name">user_name</span><span class="python_operator">=</span><span class="python_literal">'ed'</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre><div id="popbox_19_div" class="codepop" style="display:none;">SELECT users.user_id, users.user_name, users.password<br/>
FROM users WHERE users.user_name = :users_user_name<br/>
{'users_user_name': 'ed'}</div><pre><span class="python_comment"># specify a full where clause for the "user_name" column, as well as a
# comparison for the "user_id" column
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_20', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">c </span><span class="python_operator">= </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator">==</span><span class="python_literal">'ed'</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_name">user_id</span><span class="python_operator">=</span><span class="python_number">10</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre><div id="popbox_20_div" class="codepop" style="display:none;">SELECT users.user_id, users.user_name, users.password<br/>
FROM users WHERE users.user_name = :users_user_name AND users.user_id = :users_user_id<br/>
{'users_user_name': 'ed', 'users_user_id': 10}</div><pre><span class="python_operator"></span></pre></div>

            
			

        
    </div>

        



<A name="sql_select_whereclause_operators"></a>

<div class="subsection" style="margin-left:40px;">

    <span class="sectionheadertext">Operators</span>
    <div class="sectiontext">


            <p>Supported column operators so far are all the numerical comparison operators, i.e. '==', '>', '>=', etc., as well as like(), startswith(), endswith(), between(), and in().  Boolean operators include not_(), and_() and or_(), which also can be used inline via '~', '&', and '|'.  Math operators are '+', '-', '*', '/'.  Any custom operator can be specified via the op() function shown below.</p>
            

<div class="code">
<pre><span class="python_comment"># "like" operator
</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator">.</span><span class="python_name">like</span><span class="python_enclosure">(</span><span class="python_literal">'%ter'</span><span class="python_enclosure">))</span><span class="python_operator">
</span>
<span class="python_comment"># equality operator
</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name </span><span class="python_operator">== </span><span class="python_literal">'jane'</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># in opertator
</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">.</span><span class="python_name">in_</span><span class="python_enclosure">(</span><span class="python_number">1</span><span class="python_operator">,</span><span class="python_number">2</span><span class="python_operator">,</span><span class="python_number">3</span><span class="python_enclosure">))</span><span class="python_operator">
</span>
<span class="python_comment"># and_, endswith, equality operators
</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">and_</span><span class="python_enclosure">(</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">street</span><span class="python_operator">.</span><span class="python_name">endswith</span><span class="python_enclosure">(</span><span class="python_literal">'green street'</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">zip</span><span class="python_operator">==</span><span class="python_literal">'11234'</span><span class="python_enclosure">))</span><span class="python_operator">
</span>
<span class="python_comment"># & operator subsituting for 'and_'
</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">street</span><span class="python_operator">.</span><span class="python_name">endswith</span><span class="python_enclosure">(</span><span class="python_literal">'green street'</span><span class="python_enclosure">) </span><span class="python_operator">& </span><span class="python_enclosure">(</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">zip</span><span class="python_operator">==</span><span class="python_literal">'11234'</span><span class="python_enclosure">))</span><span class="python_operator">
</span>
<span class="python_comment"># + concatenation operator
</span><span class="python_name">select</span><span class="python_enclosure">([</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name </span><span class="python_operator">+ </span><span class="python_literal">'_name'</span><span class="python_enclosure">])</span><span class="python_operator">
</span>
<span class="python_comment"># NOT operator
</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_operator">~</span><span class="python_enclosure">(</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">street </span><span class="python_operator">== </span><span class="python_literal">'Green Street'</span><span class="python_enclosure">))</span><span class="python_operator">
</span>
<span class="python_comment"># any custom operator
</span><span class="python_name">select</span><span class="python_enclosure">([</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator">.</span><span class="python_name">op</span><span class="python_enclosure">(</span><span class="python_literal">'||'</span><span class="python_enclosure">)(</span><span class="python_literal">'_category'</span><span class="python_enclosure">)])</span><span class="python_operator"></span></pre></div>

            
    </div>


    <a href="#sql" class="toclink">back to section top</a>


</div>





</div>


        



<A name="sql_select_engine"></a>

<div class="subsection" style="margin-left:30px;">

    <span class="sectionheadertext">Specifying the Engine</span>
    <div class="sectiontext">


        <p>For queries that don't contain any tables, the SQLEngine can be specified to any constructed statement via the <span class="codeline">engine</span> keyword parameter:</p>
        

<div class="code">
<pre><span class="python_comment"># select a literal
</span><span class="python_name">select</span><span class="python_enclosure">([</span><span class="python_literal">"hi"</span><span class="python_enclosure">]</span><span class="python_operator">, </span><span class="python_name">engine</span><span class="python_operator">=</span><span class="python_name">myengine</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># select a function
</span><span class="python_name">select</span><span class="python_enclosure">([</span><span class="python_name">func</span><span class="python_operator">.</span><span class="python_name">now</span><span class="python_enclosure">()]</span><span class="python_operator">, </span><span class="python_name">engine</span><span class="python_operator">=</span><span class="python_name">db</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre></div>

        
    </div>


    <a href="#sql" class="toclink">back to section top</a>


</div>


        



<A name="sql_select_functions"></a>

<div class="subsection" style="margin-left:30px;">

    <span class="sectionheadertext">Functions</span>
    <div class="sectiontext">


        <p>Functions can be specified using the <span class="codeline">func</span> keyword:</p>
        

<div class="code">
<pre><span class="python_literal"><a href="javascript:togglePopbox('popbox_21', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">select</span><span class="python_enclosure">([</span><span class="python_name">func</span><span class="python_operator">.</span><span class="python_name">count</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_enclosure">)])</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_21_div" class="codepop" style="display:none;">SELECT count(users.user_id) FROM users</div><pre><span class="python_literal"><a href="javascript:togglePopbox('popbox_22', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">func</span><span class="python_operator">.</span><span class="python_name">substr</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator">, </span><span class="python_number">1</span><span class="python_enclosure">) </span><span class="python_operator">== </span><span class="python_literal">'J'</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_22_div" class="codepop" style="display:none;">SELECT users.user_id, users.user_name, users.password FROM users <br/>
WHERE substr(users.user_name, :substr) = :substr_1<br/>
{'substr_1': 'J', 'substr': 1}</div><pre><span class="python_operator"></span></pre></div>

        <p>Functions also are callable as standalone values:</p>
        

<div class="code">
<pre><span class="python_comment"># call the "now()" function
</span><span class="python_name">time </span><span class="python_operator">= </span><span class="python_name">func</span><span class="python_operator">.</span><span class="python_name">now</span><span class="python_enclosure">(</span><span class="python_name">engine</span><span class="python_operator">=</span><span class="python_name">myengine</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">scalar</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_comment"># call myfunc(1,2,3)
</span><span class="python_name">myvalue </span><span class="python_operator">= </span><span class="python_name">func</span><span class="python_operator">.</span><span class="python_name">myfunc</span><span class="python_enclosure">(</span><span class="python_number">1</span><span class="python_operator">, </span><span class="python_number">2</span><span class="python_operator">, </span><span class="python_number">3</span><span class="python_operator">, </span><span class="python_name">engine</span><span class="python_operator">=</span><span class="python_name">db</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_comment"># or call them off the engine
</span><span class="python_name">db</span><span class="python_operator">.</span><span class="python_name">func</span><span class="python_operator">.</span><span class="python_name">now</span><span class="python_enclosure">()</span><span class="python_operator">.</span><span class="python_name">scalar</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre></div>

        
    </div>


    <a href="#sql" class="toclink">back to section top</a>


</div>


        



<A name="sql_select_literals"></a>

<div class="subsection" style="margin-left:30px;">

    <span class="sectionheadertext">Literals</span>
    <div class="sectiontext">


        <p>You can drop in a literal value anywhere there isnt a column to attach to via the <span class="codeline">literal</span> keyword:</p>
        

<div class="code">
<pre><span class="python_literal"><a href="javascript:togglePopbox('popbox_23', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">select</span><span class="python_enclosure">([</span><span class="python_name">literal</span><span class="python_enclosure">(</span><span class="python_literal">'foo'</span><span class="python_enclosure">) </span><span class="python_operator">+ </span><span class="python_name">literal</span><span class="python_enclosure">(</span><span class="python_literal">'bar'</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_enclosure">])</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_23_div" class="codepop" style="display:none;">SELECT :literal + :literal_1, users.user_name <br/>
        FROM users<br/>
        {'literal_1': 'bar', 'literal': 'foo'}</div><pre><span class="python_comment"># literals have all the same comparison functions as columns
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_24', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">select</span><span class="python_enclosure">([</span><span class="python_name">literal</span><span class="python_enclosure">(</span><span class="python_literal">'foo'</span><span class="python_enclosure">) </span><span class="python_operator">== </span><span class="python_name">literal</span><span class="python_enclosure">(</span><span class="python_literal">'bar'</span><span class="python_enclosure">)]</span><span class="python_operator">, </span><span class="python_name">engine</span><span class="python_operator">=</span><span class="python_name">myengine</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">scalar</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_24_div" class="codepop" style="display:none;">SELECT :literal = :literal_1<br/>
        {'literal_1': 'bar', 'literal': 'foo'}</div><pre><span class="python_operator"></span></pre></div>

        <p>Literals also take an optional <span class="codeline">type</span> parameter to give literals a type.  This can sometimes be significant, for example when using the "+" operator with SQLite, the String type is detected and the operator is converted to "||":</p>
        

<div class="code">
<pre><span class="python_literal"><a href="javascript:togglePopbox('popbox_25', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">select</span><span class="python_enclosure">([</span><span class="python_name">literal</span><span class="python_enclosure">(</span><span class="python_literal">'foo'</span><span class="python_operator">, </span><span class="python_name">type</span><span class="python_operator">=</span><span class="python_name">String</span><span class="python_enclosure">) </span><span class="python_operator">+ </span><span class="python_literal">'bar'</span><span class="python_enclosure">]</span><span class="python_operator">, </span><span class="python_name">engine</span><span class="python_operator">=</span><span class="python_name">e</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_25_div" class="codepop" style="display:none;">SELECT ? || ?<br/>
        ['foo', 'bar']</div><pre><span class="python_operator"></span></pre></div>

        
        
    </div>


    <a href="#sql" class="toclink">back to section top</a>


</div>


        



<A name="sql_select_orderby"></a>

<div class="subsection" style="margin-left:30px;">

    <span class="sectionheadertext">Order By</span>
    <div class="sectiontext">


        <P>The ORDER BY clause of a select statement can be specified as individual columns to order by within an array     specified via the <span class="codeline">order_by</span> parameter, and optional usage of the asc() and desc() functions:
            

<div class="code">
<pre><span class="python_comment"># straight order by
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_26', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">c </span><span class="python_operator">= </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">order_by</span><span class="python_operator">=</span><span class="python_enclosure">[</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_enclosure">])</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_26_div" class="codepop" style="display:none;">SELECT users.user_id, users.user_name, users.password<br/>
FROM users ORDER BY users.user_name</div><pre> 
         <span class="python_comment"># descending/ascending order by on multiple columns
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_27', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">c </span><span class="python_operator">= </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span>
                 <span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator">></span><span class="python_literal">'J'</span><span class="python_operator">, </span>
                 <span class="python_name">order_by</span><span class="python_operator">=</span><span class="python_enclosure">[</span><span class="python_name">desc</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">asc</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_enclosure">)])</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_27_div" class="codepop" style="display:none;">SELECT users.user_id, users.user_name, users.password<br/>
FROM users WHERE users.user_name > :users_user_name <br/>
ORDER BY users.user_id DESC, users.user_name ASC<br/>
{'users_user_name':'J'}</div><pre><span class="python_operator"></span></pre></div>
        
        
    </div>


    <a href="#sql" class="toclink">back to section top</a>


</div>


        



<A name="sql_select_options"></a>

<div class="subsection" style="margin-left:30px;">

    <span class="sectionheadertext">DISTINCT, LIMIT and OFFSET</span>
    <div class="sectiontext">


        These are specified as keyword arguments:
        

<div class="code">
<pre><span class="python_literal"><a href="javascript:togglePopbox('popbox_28', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">c </span><span class="python_operator">= </span><span class="python_name">select</span><span class="python_enclosure">([</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_enclosure">]</span><span class="python_operator">, </span><span class="python_name">distinct</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_28_div" class="codepop" style="display:none;">SELECT DISTINCT users.user_name FROM users</div><pre><span class="python_literal"><a href="javascript:togglePopbox('popbox_29', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">c </span><span class="python_operator">= </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">limit</span><span class="python_operator">=</span><span class="python_number">10</span><span class="python_operator">, </span><span class="python_name">offset</span><span class="python_operator">=</span><span class="python_number">20</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_29_div" class="codepop" style="display:none;">SELECT users.user_id, users.user_name, users.password FROM users LIMIT 10 OFFSET 20</div><pre><span class="python_operator"></span></pre></div>

        The Oracle driver does not support LIMIT and OFFSET directly, but instead wraps the generated query into a subquery and uses the "rownum" variable to control the rows selected (this is somewhat experimental).
        
    </div>


    <a href="#sql" class="toclink">back to section top</a>


</div>





</div>


        



<A name="sql_join"></a>

<div class="subsection" style="margin-left:20px;">

    <span class="sectionheadertext">Inner and Outer Joins</span>
    <div class="sectiontext">


        <p>As some of the examples indicated above, a regular inner join can be implicitly stated, just like in a SQL expression, by just specifying the tables to be joined as well as their join conditions:</p>
            

<div class="code">
<pre><span class="python_literal"><a href="javascript:togglePopbox('popbox_30', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">==</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_30_div" class="codepop" style="display:none;">SELECT addresses.address_id, addresses.user_id, addresses.street, <br/>
addresses.city, addresses.state, addresses.zip FROM addresses, users<br/>
WHERE addresses.user_id = users.user_id<br/>
{}</div><pre><span class="python_operator"></span></pre></div>

            <p>There is also an explicit join constructor, which can be embedded into a select query via the <span class="codeline">from_obj</span> parameter of the select statement:</p>

            

<div class="code">
<pre><span class="python_literal"><a href="javascript:togglePopbox('popbox_31', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">from_obj</span><span class="python_operator">=</span><span class="python_enclosure">[</span>
            <span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">join</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">, </span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">==</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_enclosure">)</span>
        <span class="python_enclosure">])</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_31_div" class="codepop" style="display:none;">SELECT addresses.address_id, addresses.user_id, addresses.street, addresses.city, <br/>
            addresses.state, addresses.zip <br/>
            FROM addresses JOIN users ON addresses.user_id = users.user_id<br/>
            {}</div><pre><span class="python_operator"></span></pre></div>


        <p>The join constructor can also be used by itself:</p>
                    

<div class="code">
<pre><span class="python_literal"><a href="javascript:togglePopbox('popbox_32', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">join</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">, </span><span class="python_name">addresses</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">==</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">()</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_32_div" class="codepop" style="display:none;">SELECT users.user_id, users.user_name, users.password, <br/>
        addresses.address_id, addresses.user_id, addresses.street, addresses.city, <br/>
        addresses.state, addresses.zip <br/>
        FROM addresses JOIN users ON addresses.user_id = users.user_id<br/>
        {}</div><pre><span class="python_operator"></span></pre></div>

        <p>The join criterion in a join() call is optional.  If not specified, the condition will be derived from the foreign key relationships of the two tables.  If no criterion can be constructed, an exception will be raised.</p>
        
                    

<div class="code">
<pre><span class="python_literal"><a href="javascript:togglePopbox('popbox_33', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">join</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">, </span><span class="python_name">addresses</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">()</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_33_div" class="codepop" style="display:none;">SELECT users.user_id, users.user_name, users.password, <br/>
        addresses.address_id, addresses.user_id, addresses.street, addresses.city, <br/>
        addresses.state, addresses.zip <br/>
        FROM addresses JOIN users ON addresses.user_id = users.user_id<br/>
        {}</div><pre><span class="python_operator"></span></pre></div>

        
        <p>Notice that this is the first example where the FROM criterion of the select statement is explicitly specified.  In most cases, the FROM criterion is automatically determined from the columns requested as well as the WHERE clause.  The <span class="codeline">from_obj</span> keyword argument indicates a list of explicit FROM clauses to be used in the statement.</p>
        
        <p>A join can be created on its own using the <span class="codeline">join</span> or <span class="codeline">outerjoin</span> functions, or can be created off of an existing Table or other selectable unit via the <span class="codeline">join</span> or <span class="codeline">outerjoin</span> methods:</p>
        
            

<div class="code">
<pre><span class="python_literal"><a href="javascript:togglePopbox('popbox_34', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">outerjoin</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">, </span><span class="python_name">addresses</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">==</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">address_id</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">()</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_34_div" class="codepop" style="display:none;">SELECT users.user_id, users.user_name, users.password, addresses.address_id, <br/>
addresses.user_id, addresses.street, addresses.city, addresses.state, addresses.zip<br/>
FROM users LEFT OUTER JOIN addresses ON users.user_id = addresses.address_id<br/>
{}</div><pre><span class="python_literal"><a href="javascript:togglePopbox('popbox_35', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">keywords</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">name</span><span class="python_operator">==</span><span class="python_literal">'running'</span><span class="python_operator">, </span><span class="python_name">from_obj</span><span class="python_operator">=</span><span class="python_enclosure">[</span>
<span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">join</span><span class="python_enclosure">(</span>
    <span class="python_name">userkeywords</span><span class="python_operator">, </span><span class="python_name">userkeywords</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">==</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">join</span><span class="python_enclosure">(</span>
        <span class="python_name">keywords</span><span class="python_operator">, </span><span class="python_name">keywords</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">keyword_id</span><span class="python_operator">==</span><span class="python_name">userkeywords</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">keyword_id</span><span class="python_enclosure">)</span>
<span class="python_enclosure">])</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_35_div" class="codepop" style="display:none;">SELECT users.user_id, users.user_name, users.password FROM users <br/>
JOIN userkeywords ON userkeywords.user_id = users.user_id <br/>
JOIN keywords ON keywords.keyword_id = userkeywords.keyword_id<br/>
WHERE keywords.name = :keywords_name<br/>
{'keywords_name': 'running'}</div><pre><span class="python_operator"></span></pre></div>

            
    
    </div>


    <a href="#sql" class="toclink">back to section top</a>


</div>


        



<A name="sql_alias"></a>

<div class="subsection" style="margin-left:20px;">

    <span class="sectionheadertext">Table Aliases</span>
    <div class="sectiontext">


    <p>Aliases are used primarily when you want to use the same table more than once as a FROM expression in a statement:</p>
    
            

<div class="code">
<pre><span class="python_name">address_b </span><span class="python_operator">= </span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">alias</span><span class="python_enclosure">(</span><span class="python_literal">'addressb'</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_literal"><a href="javascript:togglePopbox('popbox_36', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_comment"># select users who have an address on Green street as well as Orange street</span><span class="python_operator">
</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">and_</span><span class="python_enclosure">(</span>
    <span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">==</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">,</span>
    <span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">street</span><span class="python_operator">.</span><span class="python_name">like</span><span class="python_enclosure">(</span><span class="python_literal">'%Green%'</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">==</span><span class="python_name">address_b</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">,</span>
    <span class="python_name">address_b</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">street</span><span class="python_operator">.</span><span class="python_name">like</span><span class="python_enclosure">(</span><span class="python_literal">'%Orange%'</span><span class="python_enclosure">)</span>
    <span class="python_enclosure">))</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_36_div" class="codepop" style="display:none;">SELECT users.user_id, users.user_name, users.password<br/>
FROM users, addresses, addresses AS addressb<br/>
WHERE users.user_id = addresses.user_id <br/>
AND addresses.street LIKE :addresses_street <br/>
AND users.user_id = addressb.user_id <br/>
AND addressb.street LIKE :addressb_street<br/>
{'addressb_street': '%Orange%', 'addresses_street': '%Green%'}</div><pre><span class="python_operator"></span></pre></div>
    
    
    </div>


    <a href="#sql" class="toclink">back to section top</a>


</div>


        



<A name="sql_subqueries"></a>

<div class="subsection" style="margin-left:20px;">

    <span class="sectionheadertext">Subqueries</span>
    <div class="sectiontext">


    <p>SQLAlchemy allows the creation of select statements from not just Table objects, but from a whole class of objects that implement the <span class="codeline">Selectable</span> interface.  This includes Tables, Aliases, Joins and Selects.  Therefore, if you have a Select, you can select from the Select:</p>
    
            

<div class="code">
<pre><span class="python_operator">>>> </span><span class="python_name">s </span><span class="python_operator">= </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">()</span><span class="python_operator">
>>> </span><span class="python_name">str</span><span class="python_enclosure">(</span><span class="python_name">s</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">SELECT users</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">password FROM users</span><span class="python_operator">
</span>
<span class="python_operator">>>> </span><span class="python_name">s </span><span class="python_operator">= </span><span class="python_name">s</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">()</span><span class="python_operator">
>>> </span><span class="python_name">str</span><span class="python_enclosure">(</span><span class="python_name">s</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">SELECT user_id</span><span class="python_operator">, </span><span class="python_name">user_name</span><span class="python_operator">, </span><span class="python_name">password</span><span class="python_operator">
</span><span class="python_name">FROM </span><span class="python_enclosure">(</span><span class="python_name">SELECT users</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">password FROM users</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre></div>

        <p>Any Select, Join, or Alias object supports the same column accessors as a Table:</p>
        

<div class="code">
<pre><span class="python_operator">>>> </span><span class="python_name">s </span><span class="python_operator">= </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">()</span><span class="python_operator">
>>> </span><span class="python_enclosure">[</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">key </span><span class="python_keyword">for </span><span class="python_name">c </span><span class="python_keyword">in </span><span class="python_name">s</span><span class="python_operator">.</span><span class="python_name">columns</span><span class="python_enclosure">]</span><span class="python_operator">
</span><span class="python_enclosure">[</span><span class="python_literal">'user_id'</span><span class="python_operator">, </span><span class="python_literal">'user_name'</span><span class="python_operator">, </span><span class="python_literal">'password'</span><span class="python_enclosure">]</span><span class="python_operator"></span></pre></div>
 

        
        <p>
        When you use <span class="codeline">use_labels=True</span> in a Select object, the label version of the column names become the keys of the accessible columns.  In effect you can create your own "view objects":
        </p>
        

<div class="code">
<pre><span class="python_name">s </span><span class="python_operator">= </span><span class="python_name">select</span><span class="python_enclosure">([</span><span class="python_name">users</span><span class="python_operator">, </span><span class="python_name">addresses</span><span class="python_enclosure">]</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">==</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">, </span><span class="python_name">use_labels</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_literal"><a href="javascript:togglePopbox('popbox_37', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">select</span><span class="python_enclosure">([</span>
        <span class="python_name">s</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">users_user_name</span><span class="python_operator">, </span><span class="python_name">s</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">addresses_street</span><span class="python_operator">, </span><span class="python_name">s</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">addresses_zip</span>
        <span class="python_enclosure">]</span><span class="python_operator">, </span><span class="python_name">s</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">addresses_city</span><span class="python_operator">==</span><span class="python_literal">'San Francisco'</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_37_div" class="codepop" style="display:none;">SELECT users_user_name, addresses_street, addresses_zip<br/>
FROM (SELECT users.user_id AS users_user_id, users.user_name AS users_user_name,<br/>
 users.password AS users_password, addresses.address_id AS addresses_address_id,<br/>
 addresses.user_id AS addresses_user_id, addresses.street AS addresses_street, <br/>
 addresses.city AS addresses_city, addresses.state AS addresses_state, <br/>
 addresses.zip AS addresses_zip<br/>
FROM users, addresses<br/>
WHERE users.user_id = addresses.user_id)<br/>
WHERE addresses_city = :addresses_city<br/>
{'addresses_city': 'San Francisco'}</div><pre><span class="python_operator"></span></pre></div>

        <p>To specify a SELECT statement as one of the selectable units in a FROM clause, it usually should be given an alias.</p>
        

<div class="code">
<pre><span class="python_literal"><a href="javascript:togglePopbox('popbox_38', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">s </span><span class="python_operator">= </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">()</span><span class="python_operator">.</span><span class="python_name">alias</span><span class="python_enclosure">(</span><span class="python_literal">'u'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">select</span><span class="python_enclosure">([</span><span class="python_name">addresses</span><span class="python_operator">, </span><span class="python_name">s</span><span class="python_enclosure">])</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_38_div" class="codepop" style="display:none;">SELECT addresses.address_id, addresses.user_id, addresses.street, addresses.city, <br/>
addresses.state, addresses.zip, u.user_id, u.user_name, u.password <br/>
FROM addresses, <br/>
(SELECT users.user_id, users.user_name, users.password FROM users) AS u<br/>
{}</div><pre><span class="python_operator"></span></pre></div>

        
        <p>Select objects can be used in a WHERE condition, in operators such as IN:</p>
            

<div class="code">
<pre><span class="python_comment"># select user ids for all users whos name starts with a "p"
</span><span class="python_name">s </span><span class="python_operator">= </span><span class="python_name">select</span><span class="python_enclosure">([</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_enclosure">]</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator">.</span><span class="python_name">like</span><span class="python_enclosure">(</span><span class="python_literal">'p%'</span><span class="python_enclosure">))</span><span class="python_operator">
            </span>
<span class="python_comment"># now select all addresses for those users
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_39', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">.</span><span class="python_name">in_</span><span class="python_enclosure">(</span><span class="python_name">s</span><span class="python_enclosure">))</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_39_div" class="codepop" style="display:none;">SELECT addresses.address_id, addresses.user_id, addresses.street, <br/>
addresses.city, addresses.state, addresses.zip<br/>
FROM addresses WHERE addresses.address_id IN <br/>
(SELECT users.user_id FROM users WHERE users.user_name LIKE :users_user_name)<br/>
{'users_user_name': 'p%'}</div><pre><span class="python_operator"></span></pre></div>


        <P>The sql package supports embedding select statements into other select statements as the criterion in a WHERE condition, or as one of the "selectable" objects in the FROM list of the query.  It does not at the moment directly support embedding a SELECT statement as one of the column criterion for a statement, although this can be achieved via direct text insertion, described later.</p>
        
        
			
        
        
			
        
			
    
    </div>

        



<A name="sql_subqueries_scalar"></a>

<div class="subsection" style="margin-left:30px;">

    <span class="sectionheadertext">Scalar Column Subqueries</span>
    <div class="sectiontext">


        <p>Subqueries can be used in the column clause of a select statement by specifying the <span class="codeline">scalar=True</span> flag:</p>
        

<div class="code">
<pre><span class="python_literal"><a href="javascript:togglePopbox('popbox_40', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">select</span><span class="python_enclosure">([</span><span class="python_name">table2</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">col1</span><span class="python_operator">, </span><span class="python_name">table2</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">col2</span><span class="python_operator">, </span><span class="python_name">select</span><span class="python_enclosure">([</span><span class="python_name">table1</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">col1</span><span class="python_enclosure">]</span><span class="python_operator">, </span><span class="python_name">table1</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">col2</span><span class="python_operator">==</span><span class="python_number">7</span><span class="python_operator">, </span><span class="python_name">scalar</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)])</span><span class="python_operator"></span></pre><div id="popbox_40_div" class="codepop" style="display:none;">SELECT table2.col1, table2.col2, <br/>
(SELECT table1.col1 AS col1 FROM table1 WHERE col2=:table1_col2) <br/>
FROM table2<br/>
{'table1_col2': 7}</div><pre><span class="python_operator"></span></pre></div>

        
    </div>


    <a href="#sql" class="toclink">back to section top</a>


</div>


        



<A name="sql_subqueries_correlated"></a>

<div class="subsection" style="margin-left:30px;">

    <span class="sectionheadertext">Correlated Subqueries</span>
    <div class="sectiontext">


        <P>When a select object is embedded inside of another select object, and both objects reference the same table, SQLAlchemy makes the assumption that the table should be correlated from the child query to the parent query.  To disable this behavior, specify the flag <span class="codeline">correlate=False</span> to the Select statement.</p>
        

<div class="code">
<pre><span class="python_comment"># make an alias of a regular select.   
</span><span class="python_name">s </span><span class="python_operator">= </span><span class="python_name">select</span><span class="python_enclosure">([</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">street</span><span class="python_enclosure">]</span><span class="python_operator">, </span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">==</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">alias</span><span class="python_enclosure">(</span><span class="python_literal">'s'</span><span class="python_enclosure">)</span><span class="python_operator">
>>> </span><span class="python_name">str</span><span class="python_enclosure">(</span><span class="python_name">s</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">SELECT addresses</span><span class="python_operator">.</span><span class="python_name">street FROM addresses</span><span class="python_operator">, </span><span class="python_name">users </span><span class="python_operator">
</span><span class="python_name">WHERE addresses</span><span class="python_operator">.</span><span class="python_name">user_id </span><span class="python_operator">= </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">
</span>
<span class="python_comment"># now embed that select into another one.  the "users" table is removed from
# the embedded query's FROM list and is instead correlated to the parent query
</span><span class="python_name">s2 </span><span class="python_operator">= </span><span class="python_name">select</span><span class="python_enclosure">([</span><span class="python_name">users</span><span class="python_operator">, </span><span class="python_name">s</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">street</span><span class="python_enclosure">])</span><span class="python_operator">
>>> </span><span class="python_name">str</span><span class="python_enclosure">(</span><span class="python_name">s2</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">SELECT users</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">password</span><span class="python_operator">, </span><span class="python_name">s</span><span class="python_operator">.</span><span class="python_name">street</span><span class="python_operator">
</span><span class="python_name">FROM users</span><span class="python_operator">, </span><span class="python_enclosure">(</span><span class="python_name">SELECT addresses</span><span class="python_operator">.</span><span class="python_name">street FROM addresses</span>
<span class="python_name">WHERE addresses</span><span class="python_operator">.</span><span class="python_name">user_id </span><span class="python_operator">= </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_enclosure">) </span><span class="python_name">s</span><span class="python_operator"></span></pre></div>

        
    </div>


    <a href="#sql" class="toclink">back to section top</a>


</div>


        



<A name="sql_subqueries_exists"></a>

<div class="subsection" style="margin-left:30px;">

    <span class="sectionheadertext">EXISTS Clauses</span>
    <div class="sectiontext">


        <p>An EXISTS clause can function as a higher-scaling version of an IN clause, and is usually used in a correlated fashion:</p>
        

<div class="code">
<pre><span class="python_comment"># find all users who have an address on Green street:
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_41', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span>
            <span class="python_name">exists</span><span class="python_enclosure">(</span>
                <span class="python_enclosure">[</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">address_id</span><span class="python_enclosure">]</span><span class="python_operator">, </span>
                <span class="python_name">and_</span><span class="python_enclosure">(</span>
                    <span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">==</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">, </span>
                    <span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">street</span><span class="python_operator">.</span><span class="python_name">like</span><span class="python_enclosure">(</span><span class="python_literal">'%Green%'</span><span class="python_enclosure">)</span>
                <span class="python_enclosure">)</span>
            <span class="python_enclosure">))</span><span class="python_operator"></span></pre><div id="popbox_41_div" class="codepop" style="display:none;">SELECT users.user_id, users.user_name, users.password <br/>
FROM users WHERE EXISTS (SELECT addresses.address_id <br/>
FROM addresses WHERE addresses.user_id = users.user_id <br/>
AND addresses.street LIKE :addresses_street)<br/>
{'addresses_street': '%Green%'}</div><pre><span class="python_operator"></span></pre></div>

        
    </div>


    <a href="#sql" class="toclink">back to section top</a>


</div>





</div>


        



<A name="sql_unions"></a>

<div class="subsection" style="margin-left:20px;">

    <span class="sectionheadertext">Unions</span>
    <div class="sectiontext">


    <p>Unions come in two flavors, UNION and UNION ALL, which are available via module level functions or methods off a Selectable:</p>
        

<div class="code">
<pre><span class="python_literal"><a href="javascript:togglePopbox('popbox_42', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">union</span><span class="python_enclosure">(</span>
        <span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">street</span><span class="python_operator">==</span><span class="python_literal">'123 Green Street'</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
        <span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">street</span><span class="python_operator">==</span><span class="python_literal">'44 Park Ave.'</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
        <span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">street</span><span class="python_operator">==</span><span class="python_literal">'3 Mill Road'</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
        <span class="python_name">order_by</span><span class="python_operator">=</span><span class="python_enclosure">[</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">street</span><span class="python_enclosure">]</span>
    <span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_42_div" class="codepop" style="display:none;">SELECT addresses.address_id, addresses.user_id, addresses.street, <br/>
addresses.city, addresses.state, addresses.zip <br/>
FROM addresses WHERE addresses.street = :addresses_street <br/>
UNION <br/>
SELECT addresses.address_id, addresses.user_id, addresses.street, <br/>
addresses.city, addresses.state, addresses.zip <br/>
FROM addresses WHERE addresses.street = :addresses_street_1 <br/>
UNION <br/>
SELECT addresses.address_id, addresses.user_id, addresses.street, <br/>
addresses.city, addresses.state, addresses.zip <br/>
FROM addresses WHERE addresses.street = :addresses_street_2 <br/>
ORDER BY addresses.street<br/>
{'addresses_street_1': '44 Park Ave.', <br/>
'addresses_street': '123 Green Street', <br/>
'addresses_street_2': '3 Mill Road'}</div><pre><span class="python_literal"><a href="javascript:togglePopbox('popbox_43', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span>
        <span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">==</span><span class="python_number">7</span>
      <span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">union_all</span><span class="python_enclosure">(</span>
          <span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span>
              <span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">==</span><span class="python_number">9</span>
          <span class="python_enclosure">)</span><span class="python_operator">, </span>
          <span class="python_name">order_by</span><span class="python_operator">=</span><span class="python_enclosure">[</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_enclosure">]   </span><span class="python_comment"># order_by is an argument to union_all()</span>
      <span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_43_div" class="codepop" style="display:none;">SELECT users.user_id, users.user_name, users.password <br/>
FROM users WHERE users.user_id = :users_user_id <br/>
UNION ALL <br/>
SELECT users.user_id, users.user_name, users.password <br/>
FROM users WHERE users.user_id = :users_user_id_1 <br/>
ORDER BY users.user_id<br/>
{'users_user_id_1': 9, 'users_user_id': 7}</div><pre><span class="python_operator"></span></pre></div>

    
    </div>


    <a href="#sql" class="toclink">back to section top</a>


</div>


        



<A name="sql_bindparams"></a>

<div class="subsection" style="margin-left:20px;">

    <span class="sectionheadertext">Custom Bind Parameters</span>
    <div class="sectiontext">


    <p>Throughout all these examples, SQLAlchemy is busy creating bind parameters wherever literal expressions occur.  You can also specify your own bind parameters with your own names, and use the same statement repeatedly.  As mentioned at the top of this section, named bind parameters are always used regardless of the type of DBAPI being used; for DBAPI's that expect positional arguments, bind parameters are converted to lists right before execution, and Pyformat strings in statements, i.e. '%(name)s', are converted to the appropriate positional style.</p>
    

<div class="code">
<pre><span class="python_name">s </span><span class="python_operator">= </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator">==</span><span class="python_name">bindparam</span><span class="python_enclosure">(</span><span class="python_literal">'username'</span><span class="python_enclosure">))</span><span class="python_operator">
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_44', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">s</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_name">username</span><span class="python_operator">=</span><span class="python_literal">'fred'</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre><div id="popbox_44_div" class="codepop" style="display:none;">SELECT users.user_id, users.user_name, users.password <br/>
FROM users WHERE users.user_name = :username<br/>
{'username': 'fred'}</div><pre><span class="python_literal"><a href="javascript:togglePopbox('popbox_45', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">s</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_name">username</span><span class="python_operator">=</span><span class="python_literal">'jane'</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre><div id="popbox_45_div" class="codepop" style="display:none;">SELECT users.user_id, users.user_name, users.password <br/>
FROM users WHERE users.user_name = :username<br/>
{'username': 'jane'}</div><pre><span class="python_literal"><a href="javascript:togglePopbox('popbox_46', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">s</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_name">username</span><span class="python_operator">=</span><span class="python_literal">'mary'</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre><div id="popbox_46_div" class="codepop" style="display:none;">SELECT users.user_id, users.user_name, users.password <br/>
FROM users WHERE users.user_name = :username<br/>
{'username': 'mary'}</div><pre><span class="python_operator"></span></pre></div>

    <p><span class="codeline">executemany()</span> is also available, but that applies more to INSERT/UPDATE/DELETE, described later.</p>
    <P>The generation of bind parameters is performed specific to the engine being used.  The examples in this document all show "named" parameters like those used in sqlite and oracle.  Depending on the parameter type specified by the DBAPI module, the correct bind parameter scheme will be used.</p>
    
			
    
    </div>

        



<A name="sql_bindparams_precompiling"></a>

<div class="subsection" style="margin-left:30px;">

    <span class="sectionheadertext">Precompiling a Query</span>
    <div class="sectiontext">


    <p>By throwing the <span class="codeline">compile()</span> method onto the end of any query object, the query can be "compiled" by the SQLEngine into a <span class="codeline">sqlalchemy.sql.Compiled</span> object just once, and the resulting compiled object reused, which eliminates repeated internal compilation of the SQL string:</p>
        

<div class="code">
<pre><span class="python_name">s </span><span class="python_operator">= </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator">==</span><span class="python_name">bindparam</span><span class="python_enclosure">(</span><span class="python_literal">'username'</span><span class="python_enclosure">))</span><span class="python_operator">.</span><span class="python_name">compile</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_name">s</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_name">username</span><span class="python_operator">=</span><span class="python_literal">'fred'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">s</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_name">username</span><span class="python_operator">=</span><span class="python_literal">'jane'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">s</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_name">username</span><span class="python_operator">=</span><span class="python_literal">'mary'</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre></div>

    
    </div>


    <a href="#sql" class="toclink">back to section top</a>


</div>





</div>


        



<A name="sql_textual"></a>

<div class="subsection" style="margin-left:20px;">

    <span class="sectionheadertext">Literal Text Blocks</span>
    <div class="sectiontext">


        <p>The sql package tries to allow free textual placement in as many ways as possible.  In the examples below, note that the from_obj parameter is used only when no other information exists within the select object with which to determine table metadata.  Also note that in a query where there isnt even table metadata used, the SQLEngine to be used for the query has to be explicitly specified:
        

<div class="code">
<pre><span class="python_comment"># strings as column clauses
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_47', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">select</span><span class="python_enclosure">([</span><span class="python_literal">"user_id"</span><span class="python_operator">, </span><span class="python_literal">"user_name"</span><span class="python_enclosure">]</span><span class="python_operator">, </span><span class="python_name">from_obj</span><span class="python_operator">=</span><span class="python_enclosure">[</span><span class="python_name">users</span><span class="python_enclosure">])</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_47_div" class="codepop" style="display:none;">SELECT user_id, user_name FROM users<br/>
{}</div><pre><span class="python_comment"># strings for full column lists
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_48', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">select</span><span class="python_enclosure">(</span>
        <span class="python_enclosure">[</span><span class="python_literal">"user_id, user_name, password, addresses.*"</span><span class="python_enclosure">]</span><span class="python_operator">, </span>
        <span class="python_name">from_obj</span><span class="python_operator">=</span><span class="python_enclosure">[</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">alias</span><span class="python_enclosure">(</span><span class="python_literal">'u'</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">addresses</span><span class="python_enclosure">])</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_48_div" class="codepop" style="display:none;">SELECT u.user_id, u.user_name, u.password, addresses.* <br/>
FROM users AS u, addresses<br/>
{}</div><pre><span class="python_comment"># functions, etc.
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_49', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">select</span><span class="python_enclosure">([</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">, </span><span class="python_literal">"process_string(user_name)"</span><span class="python_enclosure">])</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_49_div" class="codepop" style="display:none;">SELECT users.user_id, process_string(user_name) FROM users<br/>
{}</div><pre><span class="python_comment"># where clauses
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_50', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">and_</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">==</span><span class="python_number">7</span><span class="python_operator">, </span><span class="python_literal">"process_string(user_name)=27"</span><span class="python_enclosure">))</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_50_div" class="codepop" style="display:none;">SELECT users.user_id, users.user_name, users.password FROM users <br/>
WHERE users.user_id = :users_user_id AND process_string(user_name)=27<br/>
{'users_user_id': 7}</div><pre><span class="python_comment"># subqueries
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_51', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span>
    <span class="python_literal">"exists (select 1 from addresses where addresses.user_id=users.user_id)"</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_51_div" class="codepop" style="display:none;">SELECT users.user_id, users.user_name, users.password FROM users <br/>
WHERE exists (select 1 from addresses where addresses.user_id=users.user_id)<br/>
{}</div><pre><span class="python_comment"># custom FROM objects
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_52', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">select</span><span class="python_enclosure">(</span>
        <span class="python_enclosure">[</span><span class="python_literal">"*"</span><span class="python_enclosure">]</span><span class="python_operator">, </span>
        <span class="python_name">from_obj</span><span class="python_operator">=</span><span class="python_enclosure">[</span><span class="python_literal">"(select user_id, user_name from users)"</span><span class="python_enclosure">]</span><span class="python_operator">, </span>
        <span class="python_name">engine</span><span class="python_operator">=</span><span class="python_name">db</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_52_div" class="codepop" style="display:none;">SELECT * FROM (select user_id, user_name from users)<br/>
{}</div><pre><span class="python_comment"># a full query
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_53', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">text</span><span class="python_enclosure">(</span><span class="python_literal">"select user_name from users"</span><span class="python_operator">, </span><span class="python_name">engine</span><span class="python_operator">=</span><span class="python_name">db</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_53_div" class="codepop" style="display:none;">select user_name from users<br/>
{}</div><pre><span class="python_comment"># or call text() off of the engine
</span><span class="python_name">engine</span><span class="python_operator">.</span><span class="python_name">text</span><span class="python_enclosure">(</span><span class="python_literal">"select user_name from users"</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_comment"># execute off the engine directly - you must use the engine's native bind parameter
# style (i.e. named, pyformat, positional, etc.)
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_54', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">db</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span>
        <span class="python_literal">"select user_name from users where user_id=:user_id"</span><span class="python_operator">, </span>
        <span class="python_enclosure">{</span><span class="python_literal">'user_id'</span><span class="python_operator">:</span><span class="python_number">7</span><span class="python_enclosure">})</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_54_div" class="codepop" style="display:none;">select user_name from users where user_id=:user_id<br/>
{'user_id':7}</div><pre><span class="python_operator"></span></pre></div>


        
			
    
    </div>

        



<A name="sql_textual_textual_binds"></a>

<div class="subsection" style="margin-left:30px;">

    <span class="sectionheadertext">Using Bind Parameters in Text Blocks</span>
    <div class="sectiontext">


        <p>Use the format <span class="codeline">:&lt;paramname&gt;</span> to define bind parameters inside of a text block.  They will be converted to the appropriate format upon compilation:</p>
        

<div class="code">
<pre><span class="python_name">t </span><span class="python_operator">= </span><span class="python_name">engine</span><span class="python_operator">.</span><span class="python_name">text</span><span class="python_enclosure">(</span><span class="python_literal">"select foo from mytable where lala=:hoho"</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">r </span><span class="python_operator">= </span><span class="python_name">t</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_name">hoho</span><span class="python_operator">=</span><span class="python_number">7</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre></div>
        
        <p>Bind parameters can also be explicit, which allows typing information to be added.  Just specify them as a list with
        keys that match those inside the textual statement:</p>
        

<div class="code">
<pre><span class="python_name">t </span><span class="python_operator">= </span><span class="python_name">engine</span><span class="python_operator">.</span><span class="python_name">text</span><span class="python_enclosure">(</span><span class="python_literal">"select foo from mytable where lala=:hoho"</span><span class="python_operator">, </span>
            <span class="python_name">bindparams</span><span class="python_operator">=</span><span class="python_enclosure">[</span><span class="python_name">bindparam</span><span class="python_enclosure">(</span><span class="python_literal">'hoho'</span><span class="python_operator">, </span><span class="python_name">type</span><span class="python_operator">=</span><span class="python_name">types</span><span class="python_operator">.</span><span class="python_name">String</span><span class="python_enclosure">)])</span><span class="python_operator">
</span><span class="python_name">r </span><span class="python_operator">= </span><span class="python_name">t</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_name">hoho</span><span class="python_operator">=</span><span class="python_literal">"im hoho"</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre></div>
        
        <p>Result-row type processing can be added via the <span class="codeline">typemap</span> argument, which 
        is a dictionary of return columns mapped to types:</p>
        

<div class="code">
<pre><span class="python_comment"># specify DateTime type for the 'foo' column in the result set
# sqlite, for example, uses result-row post-processing to construct dates
</span><span class="python_name">t </span><span class="python_operator">= </span><span class="python_name">engine</span><span class="python_operator">.</span><span class="python_name">text</span><span class="python_enclosure">(</span><span class="python_literal">"select foo from mytable where lala=:hoho"</span><span class="python_operator">, </span>
        <span class="python_name">bindparams</span><span class="python_operator">=</span><span class="python_enclosure">[</span><span class="python_name">bindparam</span><span class="python_enclosure">(</span><span class="python_literal">'hoho'</span><span class="python_operator">, </span><span class="python_name">type</span><span class="python_operator">=</span><span class="python_name">types</span><span class="python_operator">.</span><span class="python_name">String</span><span class="python_enclosure">)]</span><span class="python_operator">,</span>
        <span class="python_name">typemap</span><span class="python_operator">=</span><span class="python_enclosure">{</span><span class="python_literal">'foo'</span><span class="python_operator">:</span><span class="python_name">types</span><span class="python_operator">.</span><span class="python_name">DateTime</span><span class="python_enclosure">}</span>
        <span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">r </span><span class="python_operator">= </span><span class="python_name">t</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_name">hoho</span><span class="python_operator">=</span><span class="python_literal">"im hoho"</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># 'foo' is a datetime
</span><span class="python_name">year </span><span class="python_operator">= </span><span class="python_name">r</span><span class="python_operator">.</span><span class="python_name">fetchone</span><span class="python_enclosure">()[</span><span class="python_literal">'foo'</span><span class="python_enclosure">]</span><span class="python_operator">.</span><span class="python_name">year</span><span class="python_operator"></span></pre></div>
        
        
        
    </div>


    <a href="#sql" class="toclink">back to section top</a>


</div>





</div>


        



<A name="sql_building"></a>

<div class="subsection" style="margin-left:20px;">

    <span class="sectionheadertext">Building Select Objects</span>
    <div class="sectiontext">


    <p>One of the primary motivations for a programmatic SQL library is to allow the piecemeal construction of a SQL statement based on program variables.  All the above examples typically show Select objects being created all at once.  The Select object also includes "builder" methods to allow building up an object.  The below example is a "user search" function, where users can be selected based on primary key, user name, street address, keywords, or any combination:
        

<div class="code">
<pre><span class="python_keyword">def </span><span class="python_name">find_users</span><span class="python_enclosure">(</span><span class="python_name">id</span><span class="python_operator">=</span><span class="python_name">None</span><span class="python_operator">, </span><span class="python_name">name</span><span class="python_operator">=</span><span class="python_name">None</span><span class="python_operator">, </span><span class="python_name">street</span><span class="python_operator">=</span><span class="python_name">None</span><span class="python_operator">, </span><span class="python_name">keywords</span><span class="python_operator">=</span><span class="python_name">None</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_name">statement </span><span class="python_operator">= </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">()</span><span class="python_operator">
    </span><span class="python_keyword">if </span><span class="python_name">id </span><span class="python_keyword">is not </span><span class="python_name">None</span><span class="python_operator">:
        </span><span class="python_name">statement</span><span class="python_operator">.</span><span class="python_name">append_whereclause</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">==</span><span class="python_name">id</span><span class="python_enclosure">)</span><span class="python_operator">
    </span><span class="python_keyword">if </span><span class="python_name">name </span><span class="python_keyword">is not </span><span class="python_name">None</span><span class="python_operator">:
        </span><span class="python_name">statement</span><span class="python_operator">.</span><span class="python_name">append_whereclause</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator">==</span><span class="python_name">name</span><span class="python_enclosure">)</span><span class="python_operator">
    </span><span class="python_keyword">if </span><span class="python_name">street </span><span class="python_keyword">is not </span><span class="python_name">None</span><span class="python_operator">:
        </span><span class="python_comment"># append_whereclause joins "WHERE" conditions together with AND
</span><span class="python_operator">        </span><span class="python_name">statement</span><span class="python_operator">.</span><span class="python_name">append_whereclause</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">==</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_enclosure">)</span><span class="python_operator">
        </span><span class="python_name">statement</span><span class="python_operator">.</span><span class="python_name">append_whereclause</span><span class="python_enclosure">(</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">street</span><span class="python_operator">==</span><span class="python_name">street</span><span class="python_enclosure">)</span><span class="python_operator">
    </span><span class="python_keyword">if </span><span class="python_name">keywords </span><span class="python_keyword">is not </span><span class="python_name">None</span><span class="python_operator">:
        </span><span class="python_name">statement</span><span class="python_operator">.</span><span class="python_name">append_from</span><span class="python_enclosure">(</span>
                <span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">join</span><span class="python_enclosure">(</span><span class="python_name">userkeywords</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">==</span><span class="python_name">userkeywords</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">join</span><span class="python_enclosure">(</span>
                        <span class="python_name">keywords</span><span class="python_operator">, </span><span class="python_name">userkeywords</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">keyword_id</span><span class="python_operator">==</span><span class="python_name">keywords</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">keyword_id</span><span class="python_enclosure">))</span><span class="python_operator">
        </span><span class="python_name">statement</span><span class="python_operator">.</span><span class="python_name">append_whereclause</span><span class="python_enclosure">(</span><span class="python_name">keywords</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">name</span><span class="python_operator">.</span><span class="python_name">in_</span><span class="python_enclosure">(</span><span class="python_name">keywords</span><span class="python_enclosure">))</span><span class="python_operator">
        </span><span class="python_comment"># to avoid multiple repeats, set query to be DISTINCT:
        </span><span class="python_name">statement</span><span class="python_operator">.</span><span class="python_name">distinct</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_operator">
    </span><span class="python_keyword">return </span><span class="python_name">statement</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator">
    </span>
<span class="python_operator"></span><span class="python_literal"><a href="javascript:togglePopbox('popbox_55', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">find_users</span><span class="python_enclosure">(</span><span class="python_name">id</span><span class="python_operator">=</span><span class="python_number">7</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre><div id="popbox_55_div" class="codepop" style="display:none;">SELECT users.user_id, users.user_name, users.password <br/>
FROM users <br/>
WHERE users.user_id = :users_user_id<br/>
{'users_user_id': 7}</div><pre><span class="python_literal"><a href="javascript:togglePopbox('popbox_56', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">find_users</span><span class="python_enclosure">(</span><span class="python_name">street</span><span class="python_operator">=</span><span class="python_literal">'123 Green Street'</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre><div id="popbox_56_div" class="codepop" style="display:none;">SELECT users.user_id, users.user_name, users.password <br/>
FROM users, addresses <br/>
WHERE users.user_id = addresses.user_id AND addresses.street = :addresses_street<br/>
{'addresses_street': '123 Green Street'}</div><pre><span class="python_literal"><a href="javascript:togglePopbox('popbox_57', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">find_users</span><span class="python_enclosure">(</span><span class="python_name">name</span><span class="python_operator">=</span><span class="python_literal">'Jack'</span><span class="python_operator">, </span><span class="python_name">keywords</span><span class="python_operator">=</span><span class="python_enclosure">[</span><span class="python_literal">'jack'</span><span class="python_operator">,</span><span class="python_literal">'foo'</span><span class="python_enclosure">])</span><span class="python_operator"></span></pre><div id="popbox_57_div" class="codepop" style="display:none;">SELECT DISTINCT users.user_id, users.user_name, users.password <br/>
FROM users JOIN userkeywords ON users.user_id = userkeywords.user_id <br/>
JOIN keywords ON userkeywords.keyword_id = keywords.keyword_id <br/>
WHERE users.user_name = :users_user_name AND keywords.name IN ('jack', 'foo')<br/>
{'users_user_name': 'Jack'}</div><pre><span class="python_operator"></span></pre></div>

    
    </div>


    <a href="#sql" class="toclink">back to section top</a>


</div>


        



<A name="sql_insert"></a>

<div class="subsection" style="margin-left:20px;">

    <span class="sectionheadertext">Inserts</span>
    <div class="sectiontext">


    <p>An INSERT involves just one table.  The Insert object is used via the insert() function, and the specified columns determine what columns show up in the generated SQL.  If primary key columns are left out of the criterion, the SQL generator will try to populate them as specified by the particular database engine and sequences, i.e. relying upon an auto-incremented column or explicitly calling a sequence beforehand.  Insert statements, as well as updates and deletes, can also execute multiple parameters in one pass via specifying an array of dictionaries as parameters.</p>
        <p>The values to be populated for an INSERT or an UPDATE can be specified to the insert()/update() functions as the <span class="codeline">values</span> named argument, or the query will be compiled based on the values of the parameters sent to the execute() method.</p>


<div class="code">
<pre><span class="python_comment"># basic insert
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_58', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">insert</span><span class="python_enclosure">()</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_name">user_id</span><span class="python_operator">=</span><span class="python_number">1</span><span class="python_operator">, </span><span class="python_name">user_name</span><span class="python_operator">=</span><span class="python_literal">'jack'</span><span class="python_operator">, </span><span class="python_name">password</span><span class="python_operator">=</span><span class="python_literal">'asdfdaf'</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre><div id="popbox_58_div" class="codepop" style="display:none;">INSERT INTO users (user_id, user_name, password) <br/>
VALUES (:user_id, :user_name, :password)<br/>
{'user_name': 'jack', 'password': 'asdfdaf', 'user_id': 1}</div><pre><span class="python_comment"># insert just user_name, NULL for others
# will auto-populate primary key columns if they are configured
# to do so
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_59', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">insert</span><span class="python_enclosure">()</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_name">user_name</span><span class="python_operator">=</span><span class="python_literal">'ed'</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre><div id="popbox_59_div" class="codepop" style="display:none;">INSERT INTO users (user_name) VALUES (:user_name)<br/>
{'user_name': 'ed'}</div><pre><span class="python_comment"># INSERT with a list:
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_60', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">insert</span><span class="python_enclosure">(</span><span class="python_name">values</span><span class="python_operator">=</span><span class="python_enclosure">(</span><span class="python_number">3</span><span class="python_operator">, </span><span class="python_literal">'jane'</span><span class="python_operator">, </span><span class="python_literal">'sdfadfas'</span><span class="python_enclosure">))</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_60_div" class="codepop" style="display:none;">INSERT INTO users (user_id, user_name, password) <br/>
VALUES (:user_id, :user_name, :password)<br/>
{'user_id': 3, 'password': 'sdfadfas', 'user_name': 'jane'}</div><pre><span class="python_comment"># INSERT with user-defined bind parameters
</span><span class="python_name">i </span><span class="python_operator">= </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">insert</span><span class="python_enclosure">(</span>
    <span class="python_name">values</span><span class="python_operator">=</span><span class="python_enclosure">{</span><span class="python_literal">'user_name'</span><span class="python_operator">:</span><span class="python_name">bindparam</span><span class="python_enclosure">(</span><span class="python_literal">'name'</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_literal">'password'</span><span class="python_operator">:</span><span class="python_name">bindparam</span><span class="python_enclosure">(</span><span class="python_literal">'pw'</span><span class="python_enclosure">)}</span>
    <span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_61', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">i</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_name">name</span><span class="python_operator">=</span><span class="python_literal">'mary'</span><span class="python_operator">, </span><span class="python_name">pw</span><span class="python_operator">=</span><span class="python_literal">'adas5fs'</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre><div id="popbox_61_div" class="codepop" style="display:none;">INSERT INTO users (user_name, password) VALUES (:name, :pw)<br/>
{'name': 'mary', 'pw': 'adas5fs'}</div><pre><span class="python_comment"># INSERT many - if no explicit 'values' parameter is sent,
# the first parameter list in the list determines
# the generated SQL of the insert (i.e. what columns are present)
# executemany() is used at the DBAPI level
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_62', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">insert</span><span class="python_enclosure">()</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span>
    <span class="python_enclosure">{</span><span class="python_literal">'user_id'</span><span class="python_operator">:</span><span class="python_number">7</span><span class="python_operator">, </span><span class="python_literal">'user_name'</span><span class="python_operator">:</span><span class="python_literal">'jack'</span><span class="python_operator">, </span><span class="python_literal">'password'</span><span class="python_operator">:</span><span class="python_literal">'asdfasdf'</span><span class="python_enclosure">}</span><span class="python_operator">,</span>
    <span class="python_enclosure">{</span><span class="python_literal">'user_id'</span><span class="python_operator">:</span><span class="python_number">8</span><span class="python_operator">, </span><span class="python_literal">'user_name'</span><span class="python_operator">:</span><span class="python_literal">'ed'</span><span class="python_operator">, </span><span class="python_literal">'password'</span><span class="python_operator">:</span><span class="python_literal">'asdffcadf'</span><span class="python_enclosure">}</span><span class="python_operator">,</span>
    <span class="python_enclosure">{</span><span class="python_literal">'user_id'</span><span class="python_operator">:</span><span class="python_number">9</span><span class="python_operator">, </span><span class="python_literal">'user_name'</span><span class="python_operator">:</span><span class="python_literal">'fred'</span><span class="python_operator">, </span><span class="python_literal">'password'</span><span class="python_operator">:</span><span class="python_literal">'asttf'</span><span class="python_enclosure">}</span><span class="python_operator">,</span>
<span class="python_enclosure">)</span><span class="python_operator"></span></pre><div id="popbox_62_div" class="codepop" style="display:none;">INSERT INTO users (user_id, user_name, password) <br/>
VALUES (:user_id, :user_name, :password)<br/>
[{'user_name': 'jack', 'password': 'asdfasdf', 'user_id': 7}, <br/>
{'user_name': 'ed', 'password': 'asdffcadf', 'user_id': 8}, <br/>
{'user_name': 'fred', 'password': 'asttf', 'user_id': 9}]</div><pre><span class="python_operator"></span></pre></div>

    
    </div>


    <a href="#sql" class="toclink">back to section top</a>


</div>


        



<A name="sql_update"></a>

<div class="subsection" style="margin-left:20px;">

    <span class="sectionheadertext">Updates</span>
    <div class="sectiontext">


        <p>Updates work a lot like INSERTS, except there is an additional WHERE clause that can be specified.</p>
        

<div class="code">
<pre><span class="python_comment"># change 'jack' to 'ed'
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_63', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">update</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator">==</span><span class="python_literal">'jack'</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_name">user_name</span><span class="python_operator">=</span><span class="python_literal">'ed'</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre><div id="popbox_63_div" class="codepop" style="display:none;">UPDATE users SET user_name=:user_name WHERE users.user_name = :users_user_name<br/>
            {'users_user_name': 'jack', 'user_name': 'ed'}</div><pre><span class="python_comment"># use bind parameters
</span><span class="python_name">u </span><span class="python_operator">= </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">update</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator">==</span><span class="python_name">bindparam</span><span class="python_enclosure">(</span><span class="python_literal">'name'</span><span class="python_enclosure">)</span><span class="python_operator">, </span>
                <span class="python_name">values</span><span class="python_operator">=</span><span class="python_enclosure">{</span><span class="python_literal">'user_name'</span><span class="python_operator">:</span><span class="python_name">bindparam</span><span class="python_enclosure">(</span><span class="python_literal">'newname'</span><span class="python_enclosure">)})</span><span class="python_operator">
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_64', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">u</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_name">name</span><span class="python_operator">=</span><span class="python_literal">'jack'</span><span class="python_operator">, </span><span class="python_name">newname</span><span class="python_operator">=</span><span class="python_literal">'ed'</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre><div id="popbox_64_div" class="codepop" style="display:none;">UPDATE users SET user_name=:newname WHERE users.user_name = :name<br/>
            {'newname': 'ed', 'name': 'jack'}</div><pre><span class="python_comment"># update a column to another column
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_65', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">update</span><span class="python_enclosure">(</span><span class="python_name">values</span><span class="python_operator">=</span><span class="python_enclosure">{</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">password</span><span class="python_operator">:</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_enclosure">})</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_65_div" class="codepop" style="display:none;">UPDATE users SET password=users.user_name<br/>
            {}</div><pre><span class="python_comment"># multi-update
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_66', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">update</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">==</span><span class="python_name">bindparam</span><span class="python_enclosure">(</span><span class="python_literal">'id'</span><span class="python_enclosure">))</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span>
        <span class="python_enclosure">{</span><span class="python_literal">'id'</span><span class="python_operator">:</span><span class="python_number">7</span><span class="python_operator">, </span><span class="python_literal">'user_name'</span><span class="python_operator">:</span><span class="python_literal">'jack'</span><span class="python_operator">, </span><span class="python_literal">'password'</span><span class="python_operator">:</span><span class="python_literal">'fh5jks'</span><span class="python_enclosure">}</span><span class="python_operator">,</span>
        <span class="python_enclosure">{</span><span class="python_literal">'id'</span><span class="python_operator">:</span><span class="python_number">8</span><span class="python_operator">, </span><span class="python_literal">'user_name'</span><span class="python_operator">:</span><span class="python_literal">'ed'</span><span class="python_operator">, </span><span class="python_literal">'password'</span><span class="python_operator">:</span><span class="python_literal">'fsr234ks'</span><span class="python_enclosure">}</span><span class="python_operator">,</span>
        <span class="python_enclosure">{</span><span class="python_literal">'id'</span><span class="python_operator">:</span><span class="python_number">9</span><span class="python_operator">, </span><span class="python_literal">'user_name'</span><span class="python_operator">:</span><span class="python_literal">'mary'</span><span class="python_operator">, </span><span class="python_literal">'password'</span><span class="python_operator">:</span><span class="python_literal">'7h5jse'</span><span class="python_enclosure">}</span><span class="python_operator">,</span>
    <span class="python_enclosure">)</span><span class="python_operator"></span></pre><div id="popbox_66_div" class="codepop" style="display:none;">UPDATE users SET user_name=:user_name, password=:password WHERE users.user_id = :id<br/>
            [{'password': 'fh5jks', 'user_name': 'jack', 'id': 7}, <br/>
            {'password': 'fsr234ks', 'user_name': 'ed', 'id': 8}, <br/>
            {'password': '7h5jse', 'user_name': 'mary', 'id': 9}]</div><pre><span class="python_operator"></span></pre></div>

        
			
    
    </div>

        



<A name="sql_update_correlated"></a>

<div class="subsection" style="margin-left:30px;">

    <span class="sectionheadertext">Correlated Updates</span>
    <div class="sectiontext">


        <p>A correlated update lets you update a table using selection from another table, or the same table:</p>
        

<div class="code">
<pre><span class="python_name">s </span><span class="python_operator">= </span><span class="python_name">select</span><span class="python_enclosure">([</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">city</span><span class="python_enclosure">]</span><span class="python_operator">, </span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">==</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_67', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">update</span><span class="python_enclosure">(</span>
        <span class="python_name">and_</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">></span><span class="python_number">10</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator"><</span><span class="python_number">20</span><span class="python_enclosure">)</span><span class="python_operator">, </span>
        <span class="python_name">values</span><span class="python_operator">=</span><span class="python_enclosure">{</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator">:</span><span class="python_name">s</span><span class="python_enclosure">}</span>
        <span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_67_div" class="codepop" style="display:none;">UPDATE users SET user_name=(SELECT addresses.city <br/>
            FROM addresses <br/>
            WHERE addresses.user_id = users.user_id) <br/>
            WHERE users.user_id > :users_user_id AND users.user_id < :users_user_id_1<br/>
            {'users_user_id_1': 20, 'users_user_id': 10}</div><pre><span class="python_operator"></span></pre></div>

        
    </div>


    <a href="#sql" class="toclink">back to section top</a>


</div>





</div>


        



<A name="sql_delete"></a>

<div class="subsection" style="margin-left:20px;">

    <span class="sectionheadertext">Deletes</span>
    <div class="sectiontext">


    <p>A delete is formulated like an update, except theres no values:</p>
    

<div class="code">
<pre><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">delete</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">==</span><span class="python_number">7</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">delete</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator">.</span><span class="python_name">like</span><span class="python_enclosure">(</span><span class="python_name">bindparam</span><span class="python_enclosure">(</span><span class="python_literal">'name'</span><span class="python_enclosure">)))</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span>
        <span class="python_enclosure">{</span><span class="python_literal">'name'</span><span class="python_operator">:</span><span class="python_literal">'%Jack%'</span><span class="python_enclosure">}</span><span class="python_operator">,</span>
        <span class="python_enclosure">{</span><span class="python_literal">'name'</span><span class="python_operator">:</span><span class="python_literal">'%Ed%'</span><span class="python_enclosure">}</span><span class="python_operator">,</span>
        <span class="python_enclosure">{</span><span class="python_literal">'name'</span><span class="python_operator">:</span><span class="python_literal">'%Jane%'</span><span class="python_enclosure">}</span><span class="python_operator">,</span>
    <span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">delete</span><span class="python_enclosure">(</span><span class="python_name">exists</span><span class="python_enclosure">())</span><span class="python_operator"></span></pre></div>

    
    </div>


    <a href="#sql" class="toclink">back to section top</a>


</div>




    <hr width="400px" align="left" />

</div>


		</div>
		<div class="section">
					
			<A name="datamapping"></a>
			<div class="topnavmargin">
			
	
<div class="topnav">


	
	<div class="topnavcontrol">
	View: <a href="index.html">Paged</a> &nbsp;|&nbsp; <b>One Page</b>
	</div>



<div class="topnavsectionlink">

<a href="#top">Table of Contents</a>

<div class="prevnext">
Previous: <a href="#sql">Constructing SQL Queries via Python Expressions</a>

&nbsp; | &nbsp;


Next: <a href="#unitofwork">Unit of Work</a>

</div>
</div>


<div class="topnavmain">
	<div class="topnavheader">Basic Data Mapping</div>
	<div class="topnavitems">
	


    
    
    <div class="toclink">
        <A style="" href="#datamapping_synopsis">Synopsis</a>
    </div>
    
    <div class="toclinkcontainer">
        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#datamapping_synopsis_attaching">Attaching Mappers to their Class</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#datamapping_synopsis_overriding">Overriding Properties</a>
    </div>

    </div>


    </div>


    
    
    <div class="toclink">
        <A style="" href="#datamapping_selecting">Selecting from a Mapper</a>
    </div>
    
    <div class="toclinkcontainer">
    </div>


    
    
    <div class="toclink">
        <A style="" href="#datamapping_saving">Saving Objects</a>
    </div>
    
    <div class="toclinkcontainer">
    </div>


    
    
    <div class="toclink">
        <A style="" href="#datamapping_relations">Defining and Using Relationships</a>
    </div>
    
    <div class="toclinkcontainer">
        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#datamapping_relations_private">Useful Feature: Private Relations</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#datamapping_relations_backreferences">Useful Feature: Backreferences</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#datamapping_relations_cascade">Creating Relationships Automatically with cascade_mappers</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#datamapping_relations_lazyload">Selecting from Relationships: Lazy Load</a>
    </div>

        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#datamapping_relations_lazyload_relselectby">Useful Feature: Creating Joins via select_by</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#datamapping_relations_lazyload_refreshing">How to Refresh the List?</a>
    </div>

    </div>


    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#datamapping_relations_eagerload">Selecting from Relationships: Eager Load</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#datamapping_relations_options">Switching Lazy/Eager, No Load</a>
    </div>

    </div>


    </div>


    
    
    <div class="toclink">
        <A style="" href="#datamapping_onetoone">One to One/Many to One</a>
    </div>
    
    <div class="toclinkcontainer">
    </div>


    
    
    <div class="toclink">
        <A style="" href="#datamapping_manytomany">Many to Many</a>
    </div>
    
    <div class="toclinkcontainer">
    </div>


    
    
    <div class="toclink">
        <A style="" href="#datamapping_association">Association Object</a>
    </div>
    
    <div class="toclinkcontainer">
    </div>



	</div>
</div>

</div>

			</div>

			




<div class="subsection" style="margin-left:10px;">

    <div class="sectiontext">


<p>Data mapping describes the process of defining <b>Mapper</b> objects, which associate table metadata with user-defined classes.  

The Mapper's role is to perform SQL operations upon the database, associating individual table rows with instances of those classes, and individual database columns with properties upon those instances, to transparently associate in-memory objects with a persistent database representation. </p>

<p>When a Mapper is created to associate a Table object with a class, all of the columns defined in the Table object are associated with the class via property accessors, which add overriding functionality to the normal process of setting and getting object attributes.  These property accessors also keep track of changes to object attributes; these changes will be stored to the database when the application "commits" the current transactional context (known as a <b>Unit of Work</b>).  The <span class="codeline">__init__()</span> method of the object is also decorated to communicate changes when new instances of the object are created.</p>

<p>The Mapper also provides the interface by which instances of the object are loaded from the database.  The primary method for this is its <span class="codeline">select()</span> method, which has similar arguments to a <span class="codeline">sqlalchemy.sql.Select</span> object.  But this select method executes automatically and returns results, instead of awaiting an execute() call.  Instead of returning a cursor-like object, it returns an array of objects.</p>

<p>The three elements to be defined, i.e. the Table metadata, the user-defined class, and the Mapper, are typically defined as module-level variables, and may be defined in any fashion suitable to the application, with the only requirement being that the class and table metadata are described before the mapper.  For the sake of example, we will be defining these elements close together, but this should not be construed as a requirement; since SQLAlchemy is not a framework, those decisions are left to the developer or an external framework.
</p>

			

			

			


			



			


			

			


    </div>

        



<A name="datamapping_synopsis"></a>

<div class="subsection" style="margin-left:20px;">

    <span class="sectionheadertext">Synopsis</span>
    <div class="sectiontext">


  <p>This is the simplest form of a full "round trip" of creating table meta data, creating a class, mapping the class to the table, getting some results, and saving changes.  For each concept, the following sections will dig in deeper to the available capabilities.</p>
        

<div class="code">
<pre><span class="python_keyword">from </span><span class="python_name">sqlalchemy </span><span class="python_keyword">import </span><span class="python_operator">*
</span>
<span class="python_comment"># engine
</span><span class="python_name">engine </span><span class="python_operator">= </span><span class="python_name">create_engine</span><span class="python_enclosure">(</span><span class="python_literal">"sqlite://mydb.db"</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># table metadata
</span><span class="python_name">users </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'users'</span><span class="python_operator">, </span><span class="python_name">engine</span><span class="python_operator">, </span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'user_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'user_name'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">16</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'password'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">20</span><span class="python_enclosure">))</span>
<span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># class definition 
</span><span class="python_keyword">class </span><span class="python_name">User</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">pass</span><span class="python_operator">
    </span>
<span class="python_comment"># create a mapper
</span><span class="python_operator"></span><span class="python_name">usermapper </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># select
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_68', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">user </span><span class="python_operator">= </span><span class="python_name">usermapper</span><span class="python_operator">.</span><span class="python_name">select_by</span><span class="python_enclosure">(</span><span class="python_name">user_name</span><span class="python_operator">=</span><span class="python_literal">'fred'</span><span class="python_enclosure">)[</span><span class="python_number">0</span><span class="python_enclosure">]</span><span class="python_operator"></span></pre><div id="popbox_68_div" class="codepop" style="display:none;">SELECT users.user_id AS users_user_id, users.user_name AS users_user_name, <br/>
users.password AS users_password <br/>
FROM users <br/>
WHERE users.user_name = :users_user_name ORDER BY users.oid<br/>
<br/>
{'users_user_name': 'fred'}</div><pre><span class="python_comment"># modify
</span><span class="python_name">user</span><span class="python_operator">.</span><span class="python_name">user_name </span><span class="python_operator">= </span><span class="python_literal">'fred jones'</span><span class="python_operator">
</span>
<span class="python_comment"># commit - saves everything that changed
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_69', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">objectstore</span><span class="python_operator">.</span><span class="python_name">commit</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_69_div" class="codepop" style="display:none;">UPDATE users SET user_name=:user_name <br/>
 WHERE users.user_id = :user_id<br/>
<br/>
[{'user_name': 'fred jones', 'user_id': 1}]</div><pre><span class="python_operator"></span></pre></div>

    
			
    
			

    </div>

        



<A name="datamapping_synopsis_attaching"></a>

<div class="subsection" style="margin-left:30px;">

    <span class="sectionheadertext">Attaching Mappers to their Class</span>
    <div class="sectiontext">


    <p>For convenience's sake, the Mapper can be attached as an attribute on the class itself as well:</p>
        

<div class="code">
<pre><span class="python_name">User</span><span class="python_operator">.</span><span class="python_name">mapper </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_name">userlist </span><span class="python_operator">= </span><span class="python_name">User</span><span class="python_operator">.</span><span class="python_name">mapper</span><span class="python_operator">.</span><span class="python_name">select_by</span><span class="python_enclosure">(</span><span class="python_name">user_id</span><span class="python_operator">=</span><span class="python_number">12</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre></div>

    <p>There is also a full-blown "monkeypatch" function that creates a primary mapper, attaches the above mapper class property, and also the  methods <span class="codeline">get, get_by, select, select_by, selectone, commit</span> and <span class="codeline">delete</span>:</p>
    

<div class="code">
<pre><span class="python_name">assign_mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">userlist </span><span class="python_operator">= </span><span class="python_name">User</span><span class="python_operator">.</span><span class="python_name">select_by</span><span class="python_enclosure">(</span><span class="python_name">user_id</span><span class="python_operator">=</span><span class="python_number">12</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre></div>

    <p>Other methods of associating mappers and finder methods with their corresponding classes, such as via common base classes or mixins, can be devised as well.  SQLAlchemy does not aim to dictate application architecture and will always allow the broadest variety of architectural patterns, but may include more helper objects and suggested architectures in the future.</p>
    
    </div>


    <a href="#datamapping" class="toclink">back to section top</a>


</div>


        



<A name="datamapping_synopsis_overriding"></a>

<div class="subsection" style="margin-left:30px;">

    <span class="sectionheadertext">Overriding Properties</span>
    <div class="sectiontext">


    <p>A common request is the ability to create custom class properties that override the behavior of setting/getting an attribute.  Currently, the easiest way to do this in SQLAlchemy is just how its done normally; define your attribute with a different name, such as "_attribute", and use a property to get/set its value.  The mapper just needs to be told of the special name:</p>
    

<div class="code">
<pre><span class="python_keyword">class </span><span class="python_name">MyClass</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">def </span><span class="python_name">_set_email</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">email</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">_email </span><span class="python_operator">= </span><span class="python_name">email</span><span class="python_operator">
    </span><span class="python_keyword">def </span><span class="python_name">_get_email</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">email</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_keyword">return </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">_email</span><span class="python_operator">
    </span><span class="python_name">email </span><span class="python_operator">= </span><span class="python_name">property</span><span class="python_enclosure">(</span><span class="python_name">_get_email</span><span class="python_operator">, </span><span class="python_name">_set_email</span><span class="python_enclosure">)</span><span class="python_operator">
    </span>
<span class="python_operator"></span><span class="python_name">m </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">MyClass</span><span class="python_operator">, </span><span class="python_name">mytable</span><span class="python_operator">, </span><span class="python_name">properties </span><span class="python_operator">= </span><span class="python_enclosure">{</span>
        <span class="python_comment"># map the '_email' attribute to the "email" column</span>
        <span class="python_comment"># on the table</span>
        <span class="python_literal">'_email'</span><span class="python_operator">: </span><span class="python_name">mytable</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">email</span>
<span class="python_enclosure">})</span><span class="python_operator"></span></pre></div>

    <p>In a later release, SQLAlchemy will also allow _get_email and _set_email to be attached directly to the "email" property created by the mapper, and will also allow this association to occur via decorators.</p>
    
    </div>


    <a href="#datamapping" class="toclink">back to section top</a>


</div>





</div>


        



<A name="datamapping_selecting"></a>

<div class="subsection" style="margin-left:20px;">

    <span class="sectionheadertext">Selecting from a Mapper</span>
    <div class="sectiontext">


    <p>There are a variety of ways to select from a mapper.  These range from minimalist to explicit.  Below is a synopsis of the these methods:</p>
        

<div class="code">
<pre><span class="python_comment"># select_by, using property names or column names as keys
# the keys are grouped together by an AND operator
</span><span class="python_name">result </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_operator">.</span><span class="python_name">select_by</span><span class="python_enclosure">(</span><span class="python_name">name</span><span class="python_operator">=</span><span class="python_literal">'john'</span><span class="python_operator">, </span><span class="python_name">street</span><span class="python_operator">=</span><span class="python_literal">'123 green street'</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># select_by can also combine SQL criterion with key/value properties
</span><span class="python_name">result </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_operator">.</span><span class="python_name">select_by</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator">==</span><span class="python_literal">'john'</span><span class="python_operator">, </span>
        <span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">zip_code</span><span class="python_operator">==</span><span class="python_literal">'12345, street='</span><span class="python_number">123 </span><span class="python_name">green street</span><span class="python_operator">'</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># get_by, which takes the same arguments as select_by
# returns a single scalar result or None if no results
</span><span class="python_name">user </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_operator">.</span><span class="python_name">get_by</span><span class="python_enclosure">(</span><span class="python_name">id</span><span class="python_operator">=</span><span class="python_number">12</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># "dynamic" versions of select_by and get_by - everything past the 
# "select_by_" or "get_by_" is used as the key, and the function argument
# as the value
</span><span class="python_name">result </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_operator">.</span><span class="python_name">select_by_name</span><span class="python_enclosure">(</span><span class="python_literal">'fred'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">u </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_operator">.</span><span class="python_name">get_by_name</span><span class="python_enclosure">(</span><span class="python_literal">'fred'</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># get an object directly from its primary key.  this will bypass the SQL
# call if the object has already been loaded
</span><span class="python_name">u </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_operator">.</span><span class="python_name">get</span><span class="python_enclosure">(</span><span class="python_number">15</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># get an object that has a composite primary key of three columns.
# the order of the arguments matches that of the table meta data.
</span><span class="python_name">myobj </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_operator">.</span><span class="python_name">get</span><span class="python_enclosure">(</span><span class="python_number">27</span><span class="python_operator">, </span><span class="python_number">3</span><span class="python_operator">, </span><span class="python_literal">'receipts'</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># using a WHERE criterion
</span><span class="python_name">result </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">or_</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name </span><span class="python_operator">== </span><span class="python_literal">'john'</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator">==</span><span class="python_literal">'fred'</span><span class="python_enclosure">))</span><span class="python_operator">
</span>
<span class="python_comment"># using a WHERE criterion to get a scalar
</span><span class="python_name">u </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_operator">.</span><span class="python_name">selectone</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator">==</span><span class="python_literal">'john'</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># using a full select object
</span><span class="python_name">result </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator">==</span><span class="python_literal">'john'</span><span class="python_enclosure">))</span><span class="python_operator">
</span>
<span class="python_comment"># using straight text  
</span><span class="python_name">result </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_operator">.</span><span class="python_name">select_text</span><span class="python_enclosure">(</span><span class="python_literal">"select * from users where user_name='fred'"</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># or using a "text" object
</span><span class="python_name">result </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">text</span><span class="python_enclosure">(</span><span class="python_literal">"select * from users where user_name='fred'"</span><span class="python_operator">, </span><span class="python_name">engine</span><span class="python_operator">=</span><span class="python_name">engine</span><span class="python_enclosure">))</span><span class="python_operator"></span></pre></div>
    
    <p>The last few examples above show the usage of the mapper's table object to provide the columns for a WHERE Clause.  These columns are also accessible off of the mapped class directly.  When a mapper is assigned to a class, it also attaches a special property accessor <span class="codeline">c</span> to the class itself, which can be used just like the table metadata to access the columns of the table:</p>
        

<div class="code">
<pre><span class="python_name">User</span><span class="python_operator">.</span><span class="python_name">mapper </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_name">userlist </span><span class="python_operator">= </span><span class="python_name">User</span><span class="python_operator">.</span><span class="python_name">mapper</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">==</span><span class="python_number">12</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre></div>
    

    </div>


    <a href="#datamapping" class="toclink">back to section top</a>


</div>


        



<A name="datamapping_saving"></a>

<div class="subsection" style="margin-left:20px;">

    <span class="sectionheadertext">Saving Objects</span>
    <div class="sectiontext">


    <p>When objects corresponding to mapped classes are created or manipulated, all changes are logged by a package called <span class="codeline">sqlalchemy.mapping.objectstore</span>.   The changes are then written to the database when an application calls <span class="codeline">objectstore.commit()</span>.  This pattern is known as a <b>Unit of Work</b>, and has many advantages over saving individual objects or attributes on those objects with individual method invocations.  Domain models can be built with far greater complexity with no concern over the order of saves and deletes, excessive database round-trips and write operations, or deadlocking issues.  The commit() operation uses a transaction as well, and will also perform "concurrency checking" to insure the proper number of rows were in fact affected (not supported with the current MySQL drivers). Transactional resources are used effectively in all cases; the unit of work handles all the details.</p>
    
    <p>When a mapper is created, the target class has its mapped properties decorated by specialized property accessors that track changes, and its <span class="codeline">__init__()</span> method is also decorated to mark new objects as "new".</p>
        

<div class="code">
<pre><span class="python_name">User</span><span class="python_operator">.</span><span class="python_name">mapper </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># create a new User
</span><span class="python_name">myuser </span><span class="python_operator">= </span><span class="python_name">User</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_name">myuser</span><span class="python_operator">.</span><span class="python_name">user_name </span><span class="python_operator">= </span><span class="python_literal">'jane'</span><span class="python_operator">
</span><span class="python_name">myuser</span><span class="python_operator">.</span><span class="python_name">password </span><span class="python_operator">= </span><span class="python_literal">'hello123'</span><span class="python_operator">
</span>
<span class="python_comment"># create another new User      
</span><span class="python_name">myuser2 </span><span class="python_operator">= </span><span class="python_name">User</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_name">myuser2</span><span class="python_operator">.</span><span class="python_name">user_name </span><span class="python_operator">= </span><span class="python_literal">'ed'</span><span class="python_operator">
</span><span class="python_name">myuser2</span><span class="python_operator">.</span><span class="python_name">password </span><span class="python_operator">= </span><span class="python_literal">'lalalala'</span><span class="python_operator">
</span>
<span class="python_comment"># load a third User from the database            
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_70', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">myuser3 </span><span class="python_operator">= </span><span class="python_name">User</span><span class="python_operator">.</span><span class="python_name">mapper</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator">==</span><span class="python_literal">'fred'</span><span class="python_enclosure">)[</span><span class="python_number">0</span><span class="python_enclosure">]</span><span class="python_operator"></span></pre><div id="popbox_70_div" class="codepop" style="display:none;">SELECT users.user_id AS users_user_id, <br/>
users.user_name AS users_user_name, users.password AS users_password<br/>
FROM users WHERE users.user_name = :users_user_name<br/>
{'users_user_name': 'fred'}</div><pre><span class="python_name">myuser3</span><span class="python_operator">.</span><span class="python_name">user_name </span><span class="python_operator">= </span><span class="python_literal">'fredjones'</span><span class="python_operator">
</span>
<span class="python_comment"># save all changes            
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_71', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">objectstore</span><span class="python_operator">.</span><span class="python_name">commit</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_71_div" class="codepop" style="display:none;">UPDATE users SET user_name=:user_name<br/>
WHERE users.user_id =:users_user_id<br/>
[{'users_user_id': 1, 'user_name': 'fredjones'}]<br/>
<br/>
INSERT INTO users (user_name, password) VALUES (:user_name, :password)<br/>
{'password': 'hello123', 'user_name': 'jane'}<br/>
<br/>
INSERT INTO users (user_name, password) VALUES (:user_name, :password)<br/>
{'password': 'lalalala', 'user_name': 'ed'}</div><pre><span class="python_operator"></span></pre></div>

    <p>In the examples above, we defined a User class with basically no properties or methods.  Theres no particular reason it has to be this way, the class can explicitly set up whatever properties it wants, whether or not they will be managed by the mapper.  It can also specify a constructor, with the restriction that the constructor is able to function with no arguments being passed to it (this restriction can be lifted with some extra parameters to the mapper; more on that later):</p>
        

<div class="code">
<pre><span class="python_keyword">class </span><span class="python_name">User</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">def </span><span class="python_name">__init__</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">user_name </span><span class="python_operator">= </span><span class="python_name">None</span><span class="python_operator">, </span><span class="python_name">password </span><span class="python_operator">= </span><span class="python_name">None</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">user_id </span><span class="python_operator">= </span><span class="python_name">None</span><span class="python_operator">
        </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">user_name </span><span class="python_operator">= </span><span class="python_name">user_name</span><span class="python_operator">
        </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">password </span><span class="python_operator">= </span><span class="python_name">password</span><span class="python_operator">
    </span><span class="python_keyword">def </span><span class="python_name">get_name</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_keyword">return </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator">
    </span><span class="python_keyword">def </span><span class="python_name">__repr__</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_keyword">return </span><span class="python_literal">"User id %s name %s password %s" </span><span class="python_operator">% </span><span class="python_enclosure">(</span><span class="python_name">repr</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_enclosure">)</span><span class="python_operator">, </span>
            <span class="python_name">repr</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">repr</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">password</span><span class="python_enclosure">))</span><span class="python_operator">
</span><span class="python_name">User</span><span class="python_operator">.</span><span class="python_name">mapper </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_name">u </span><span class="python_operator">= </span><span class="python_name">User</span><span class="python_enclosure">(</span><span class="python_literal">'john'</span><span class="python_operator">, </span><span class="python_literal">'foo'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_72', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">objectstore</span><span class="python_operator">.</span><span class="python_name">commit</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_72_div" class="codepop" style="display:none;">INSERT INTO users (user_name, password) VALUES (:user_name, :password)<br/>
{'password': 'foo', 'user_name': 'john'}</div><pre><span class="python_operator">>>> </span><span class="python_name">u</span><span class="python_operator">
</span><span class="python_name">User id </span><span class="python_number">1 </span><span class="python_name">name </span><span class="python_literal">'john' </span><span class="python_name">password </span><span class="python_literal">'foo'</span><span class="python_operator"></span></pre></div>


<p>Recent versions of SQLAlchemy will only put modified object attributes columns into the UPDATE statements generated upon commit.  This is to conserve database traffic and also to successfully interact with a "deferred" attribute, which is a mapped object attribute against the mapper's primary table that isnt loaded until referenced by the application.</p>

    </div>


    <a href="#datamapping" class="toclink">back to section top</a>


</div>


        



<A name="datamapping_relations"></a>

<div class="subsection" style="margin-left:20px;">

    <span class="sectionheadertext">Defining and Using Relationships</span>
    <div class="sectiontext">


<p>So that covers how to map the columns in a table to an object, how to load objects, create new ones, and save changes.  The next step is how to define an object's relationships to other database-persisted objects.  This is done via the <span class="codeline">relation</span> function provided by the mapper module.  So with our User class, lets also define the User has having one or more mailing addresses.  First, the table metadata:</p>
        

<div class="code">
<pre><span class="python_keyword">from </span><span class="python_name">sqlalchemy </span><span class="python_keyword">import </span><span class="python_operator">*
</span><span class="python_name">engine </span><span class="python_operator">= </span><span class="python_name">create_engine</span><span class="python_enclosure">(</span><span class="python_literal">'sqlite'</span><span class="python_operator">, </span><span class="python_enclosure">{</span><span class="python_literal">'filename'</span><span class="python_operator">:</span><span class="python_literal">'mydb'</span><span class="python_enclosure">})</span><span class="python_operator">
</span>
<span class="python_comment"># define user table
</span><span class="python_name">users </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'users'</span><span class="python_operator">, </span><span class="python_name">engine</span><span class="python_operator">, </span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'user_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'user_name'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">16</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'password'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">20</span><span class="python_enclosure">))</span>
<span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># define user address table
</span><span class="python_name">addresses </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'addresses'</span><span class="python_operator">, </span><span class="python_name">engine</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'address_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'user_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">ForeignKey</span><span class="python_enclosure">(</span><span class="python_literal">"users.user_id"</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'street'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">100</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'city'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">80</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'state'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">2</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'zip'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">10</span><span class="python_enclosure">))</span>
<span class="python_enclosure">)</span><span class="python_operator"></span></pre></div>

<p>Of importance here is the addresses table's definition of a <b>foreign key</b> relationship to the users table, relating the user_id column into a parent-child relationship.  When a Mapper wants to indicate a relation of one object to another, this ForeignKey object is the default method by which the relationship is determined (although if you didn't define ForeignKeys, or you want to specify explicit relationship columns, that is available as well).   </p>
<p>So then lets define two classes, the familiar User class, as well as an Address class:

        

<div class="code">
<pre><span class="python_keyword">class </span><span class="python_name">User</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">def </span><span class="python_name">__init__</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">user_name </span><span class="python_operator">= </span><span class="python_name">None</span><span class="python_operator">, </span><span class="python_name">password </span><span class="python_operator">= </span><span class="python_name">None</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">user_name </span><span class="python_operator">= </span><span class="python_name">user_name</span><span class="python_operator">
        </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">password </span><span class="python_operator">= </span><span class="python_name">password</span><span class="python_operator">
        </span>
<span class="python_operator"></span><span class="python_keyword">class </span><span class="python_name">Address</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">def </span><span class="python_name">__init__</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">street</span><span class="python_operator">=</span><span class="python_name">None</span><span class="python_operator">, </span><span class="python_name">city</span><span class="python_operator">=</span><span class="python_name">None</span><span class="python_operator">, </span><span class="python_name">state</span><span class="python_operator">=</span><span class="python_name">None</span><span class="python_operator">, </span><span class="python_name">zip</span><span class="python_operator">=</span><span class="python_name">None</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">street </span><span class="python_operator">= </span><span class="python_name">street</span><span class="python_operator">
        </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">city </span><span class="python_operator">= </span><span class="python_name">city</span><span class="python_operator">
        </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">state </span><span class="python_operator">= </span><span class="python_name">state</span><span class="python_operator">
        </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">zip </span><span class="python_operator">= </span><span class="python_name">zip</span><span class="python_operator"></span></pre></div>

<p>And then a Mapper that will define a relationship of the User and the Address classes to each other as well as their table metadata.  We will add an additional mapper keyword argument <span class="codeline">properties</span> which is a dictionary relating the name of an object property to a database relationship, in this case a <span class="codeline">relation</span> object against a newly defined  mapper for the Address class:</p>
        

<div class="code">
<pre><span class="python_name">User</span><span class="python_operator">.</span><span class="python_name">mapper </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">, </span><span class="python_name">properties </span><span class="python_operator">= </span><span class="python_enclosure">{</span>
                    <span class="python_literal">'addresses' </span><span class="python_operator">: </span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_operator">, </span><span class="python_name">addresses</span><span class="python_enclosure">))</span>
                <span class="python_enclosure">}</span>
              <span class="python_enclosure">)</span><span class="python_operator"></span></pre></div>

<p>Lets do some operations with these classes and see what happens:</p>

        

<div class="code">
<pre><span class="python_name">u </span><span class="python_operator">= </span><span class="python_name">User</span><span class="python_enclosure">(</span><span class="python_literal">'jane'</span><span class="python_operator">, </span><span class="python_literal">'hihilala'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">u</span><span class="python_operator">.</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">append</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_enclosure">(</span><span class="python_literal">'123 anywhere street'</span><span class="python_operator">, </span><span class="python_literal">'big city'</span><span class="python_operator">, </span><span class="python_literal">'UT'</span><span class="python_operator">, </span><span class="python_literal">'76543'</span><span class="python_enclosure">))</span><span class="python_operator">
</span><span class="python_name">u</span><span class="python_operator">.</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">append</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_enclosure">(</span><span class="python_literal">'1 Park Place'</span><span class="python_operator">, </span><span class="python_literal">'some other city'</span><span class="python_operator">, </span><span class="python_literal">'OK'</span><span class="python_operator">, </span><span class="python_literal">'83923'</span><span class="python_enclosure">))</span><span class="python_operator">
</span>
<span class="python_name">objectstore</span><span class="python_operator">.</span><span class="python_name">commit</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div class="codepop">INSERT INTO users (user_name, password) VALUES (:user_name, :password)<br/>
{'password': 'hihilala', 'user_name': 'jane'}<br/>
<br/>
INSERT INTO addresses (user_id, street, city, state, zip) VALUES (:user_id, :street, :city, :state, :zip)<br/>
{'city': 'big city', 'state': 'UT', 'street': '123 anywhere street', 'user_id':1, 'zip': '76543'}<br/>
<br/>
INSERT INTO addresses (user_id, street, city, state, zip) VALUES (:user_id, :street, :city, :state, :zip)<br/>
{'city': 'some other city', 'state': 'OK', 'street': '1 Park Place', 'user_id':1, 'zip': '83923'}</div><pre><span class="python_operator"></span></pre></div>

<p>A lot just happened there!  The Mapper object figured out how to relate rows in the addresses table to the users table, and also upon commit had to determine the proper order in which to insert rows.  After the insert, all the User and Address objects have all their new primary and foreign keys populated.</p>

<p>Also notice that when we created a Mapper on the User class which defined an 'addresses' relation, the newly created User instance magically had an "addresses" attribute which behaved like a list.   This list is in reality a property accessor function, which returns an instance of <span class="codeline">sqlalchemy.util.HistoryArraySet</span>, which fulfills the full set of Python list accessors, but maintains a <b>unique</b> set of objects (based on their in-memory identity), and also tracks additions and deletions to the list:</p>
        

<div class="code">
<pre><span class="python_keyword">del </span><span class="python_name">u</span><span class="python_operator">.</span><span class="python_name">addresses</span><span class="python_enclosure">[</span><span class="python_number">1</span><span class="python_enclosure">]</span><span class="python_operator">
</span><span class="python_name">u</span><span class="python_operator">.</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">append</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_enclosure">(</span><span class="python_literal">'27 New Place'</span><span class="python_operator">, </span><span class="python_literal">'Houston'</span><span class="python_operator">, </span><span class="python_literal">'TX'</span><span class="python_operator">, </span><span class="python_literal">'34839'</span><span class="python_enclosure">))</span><span class="python_operator">
</span>
<span class="python_name">objectstore</span><span class="python_operator">.</span><span class="python_name">commit</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div class="codepop">UPDATE addresses SET user_id=:user_id<br/>
 WHERE addresses.address_id = :addresses_address_id<br/>
[{'user_id': None, 'addresses_address_id': 2}]<br/>
<br/>
INSERT INTO addresses (user_id, street, city, state, zip) <br/>
VALUES (:user_id, :street, :city, :state, :zip)<br/>
{'city': 'Houston', 'state': 'TX', 'street': '27 New Place', 'user_id': 1, 'zip': '34839'}</div><pre><span class="python_operator"></span></pre></div>


			

			

			
    
			
    
			
    
			


    </div>

        



<A name="datamapping_relations_private"></a>

<div class="subsection" style="margin-left:30px;">

    <span class="sectionheadertext">Useful Feature: Private Relations</span>
    <div class="sectiontext">


<p>So our one address that was removed from the list, was updated to have a user_id of <span class="codeline">None</span>, and a new address object was inserted to correspond to the new Address added to the User.  But now, theres a mailing address with no user_id floating around in the database of no use to anyone.  How can we avoid this ?  This is acheived by using the <span class="codeline">private=True</span> parameter of <span class="codeline">relation</span>:

        

<div class="code">
<pre><span class="python_name">User</span><span class="python_operator">.</span><span class="python_name">mapper </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">, </span><span class="python_name">properties </span><span class="python_operator">= </span><span class="python_enclosure">{</span>
                    <span class="python_literal">'addresses' </span><span class="python_operator">: </span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_operator">, </span><span class="python_name">addresses</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">private</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span>
                <span class="python_enclosure">}</span>
              <span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_keyword">del </span><span class="python_name">u</span><span class="python_operator">.</span><span class="python_name">addresses</span><span class="python_enclosure">[</span><span class="python_number">1</span><span class="python_enclosure">]</span><span class="python_operator">
</span><span class="python_name">u</span><span class="python_operator">.</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">append</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_enclosure">(</span><span class="python_literal">'27 New Place'</span><span class="python_operator">, </span><span class="python_literal">'Houston'</span><span class="python_operator">, </span><span class="python_literal">'TX'</span><span class="python_operator">, </span><span class="python_literal">'34839'</span><span class="python_enclosure">))</span><span class="python_operator">
</span>
<span class="python_name">objectstore</span><span class="python_operator">.</span><span class="python_name">commit</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div class="codepop">INSERT INTO addresses (user_id, street, city, state, zip) <br/>
VALUES (:user_id, :street, :city, :state, :zip)<br/>
{'city': 'Houston', 'state': 'TX', 'street': '27 New Place', 'user_id': 1, 'zip': '34839'}<br/>
<br/>
DELETE FROM addresses WHERE addresses.address_id = :address_id<br/>
[{'address_id': 2}]</div><pre><span class="python_operator"></span></pre></div>

<p>In this case, with the private flag set, the element that was removed from the addresses list was also removed from the database.  By specifying the <span class="codeline">private</span> flag on a relation, it is indicated to the Mapper that these related objects exist only as children of the parent object, otherwise should be deleted.</p>

    </div>


    <a href="#datamapping" class="toclink">back to section top</a>


</div>


        



<A name="datamapping_relations_backreferences"></a>

<div class="subsection" style="margin-left:30px;">

    <span class="sectionheadertext">Useful Feature: Backreferences</span>
    <div class="sectiontext">


<p>By creating relations with the <span class="codeline">backref</span> keyword, a bi-directional relationship can be created which will keep both ends of the relationship updated automatically, even without any database queries being executed.  Below, the User mapper is created with an "addresses" property, and the corresponding Address mapper receives a "backreference" to the User object via the property name "user":
        

<div class="code">
<pre><span class="python_name">Address</span><span class="python_operator">.</span><span class="python_name">mapper </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_operator">, </span><span class="python_name">addresses</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">User</span><span class="python_operator">.</span><span class="python_name">mapper </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">, </span><span class="python_name">properties </span><span class="python_operator">= </span><span class="python_enclosure">{</span>
                    <span class="python_literal">'addresses' </span><span class="python_operator">: </span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_operator">.</span><span class="python_name">mapper</span><span class="python_operator">, </span><span class="python_name">backref</span><span class="python_operator">=</span><span class="python_literal">'user'</span><span class="python_enclosure">)</span>
                <span class="python_enclosure">}</span>
              <span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_name">u </span><span class="python_operator">= </span><span class="python_name">User</span><span class="python_enclosure">(</span><span class="python_literal">'fred'</span><span class="python_operator">, </span><span class="python_literal">'hi'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">a1 </span><span class="python_operator">= </span><span class="python_name">Address</span><span class="python_enclosure">(</span><span class="python_literal">'123 anywhere street'</span><span class="python_operator">, </span><span class="python_literal">'big city'</span><span class="python_operator">, </span><span class="python_literal">'UT'</span><span class="python_operator">, </span><span class="python_literal">'76543'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">a2 </span><span class="python_operator">= </span><span class="python_name">Address</span><span class="python_enclosure">(</span><span class="python_literal">'1 Park Place'</span><span class="python_operator">, </span><span class="python_literal">'some other city'</span><span class="python_operator">, </span><span class="python_literal">'OK'</span><span class="python_operator">, </span><span class="python_literal">'83923'</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># append a1 to u
</span><span class="python_name">u</span><span class="python_operator">.</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">append</span><span class="python_enclosure">(</span><span class="python_name">a1</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># attach u to a2
</span><span class="python_name">a2</span><span class="python_operator">.</span><span class="python_name">user </span><span class="python_operator">= </span><span class="python_name">u</span><span class="python_operator">
</span>
<span class="python_comment"># the bi-directional relation is maintained
</span><span class="python_operator">>>> </span><span class="python_name">u</span><span class="python_operator">.</span><span class="python_name">addresses </span><span class="python_operator">== </span><span class="python_enclosure">[</span><span class="python_name">a1</span><span class="python_operator">, </span><span class="python_name">a2</span><span class="python_enclosure">]</span><span class="python_operator">
</span><span class="python_name">True</span><span class="python_operator">
>>> </span><span class="python_name">a1</span><span class="python_operator">.</span><span class="python_name">user </span><span class="python_keyword">is </span><span class="python_name">user </span><span class="python_keyword">and </span><span class="python_name">a2</span><span class="python_operator">.</span><span class="python_name">user </span><span class="python_keyword">is </span><span class="python_name">user</span><span class="python_operator">
</span><span class="python_name">True</span><span class="python_operator"></span></pre></div>


+<p>The backreference feature also works with many-to-many relationships, which are described later.  When creating a backreference, a corresponding property is placed on the child mapper.  The default arguments to this property can be overridden using the <span class="codeline">backref()</span> function:
        

<div class="code">
<pre><span class="python_name">Address</span><span class="python_operator">.</span><span class="python_name">mapper </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_operator">, </span><span class="python_name">addresses</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_name">User</span><span class="python_operator">.</span><span class="python_name">mapper </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">, </span><span class="python_name">properties </span><span class="python_operator">= </span><span class="python_enclosure">{</span>
                    <span class="python_literal">'addresses' </span><span class="python_operator">: </span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_operator">.</span><span class="python_name">mapper</span><span class="python_operator">, </span><span class="python_name">backref</span><span class="python_operator">=</span><span class="python_name">backref</span><span class="python_enclosure">(</span><span class="python_literal">'user'</span><span class="python_operator">, </span><span class="python_name">lazy</span><span class="python_operator">=</span><span class="python_name">False</span><span class="python_operator">, </span><span class="python_name">private</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">))</span>
                <span class="python_enclosure">}</span>
              <span class="python_enclosure">)</span><span class="python_operator"></span></pre></div>

<p>Note that when overriding a backreferenced property, we re-specify the backreference as well.  This will not override the existing 'addresses' property on the User class, but just sends a message to the attribute-management system that it should continue to maintain this backreference.</p>

    </div>


    <a href="#datamapping" class="toclink">back to section top</a>


</div>


        



<A name="datamapping_relations_cascade"></a>

<div class="subsection" style="margin-left:30px;">

    <span class="sectionheadertext">Creating Relationships Automatically with cascade_mappers</span>
    <div class="sectiontext">


<p>The mapper package has a helper function <span class="codeline">cascade_mappers()</span> which can simplify the task of linking several mappers together.  Given a list of classes and/or mappers, it identifies the foreign key relationships between the given mappers or corresponding class mappers, and creates relation() objects representing those relationships, including a backreference.  Attempts to find
the "secondary" table in a many-to-many relationship as well.  The names of the relations
are a lowercase version of the related class.  In the case of one-to-many or many-to-many,
the name is "pluralized", which currently is based on the English language (i.e. an 's' or 
'es' added to it):</p>
    

<div class="code">
<pre><span class="python_comment"># create two mappers.  the 'users' and 'addresses' tables have a foreign key
# relationship
</span><span class="python_name">mapper1 </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">mapper2 </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_operator">, </span><span class="python_name">addresses</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># cascade the two mappers together (can also specify User, Address as the arguments)
</span><span class="python_name">cascade_mappers</span><span class="python_enclosure">(</span><span class="python_name">mapper1</span><span class="python_operator">, </span><span class="python_name">mapper2</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># two new object instances
</span><span class="python_name">u </span><span class="python_operator">= </span><span class="python_name">User</span><span class="python_enclosure">(</span><span class="python_literal">'user1'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">a </span><span class="python_operator">= </span><span class="python_name">Address</span><span class="python_enclosure">(</span><span class="python_literal">'test'</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># "addresses" and "user" property are automatically added
</span><span class="python_name">u</span><span class="python_operator">.</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">append</span><span class="python_enclosure">(</span><span class="python_name">a</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_keyword">print </span><span class="python_name">a</span><span class="python_operator">.</span><span class="python_name">user</span><span class="python_operator"></span></pre></div>



    </div>


    <a href="#datamapping" class="toclink">back to section top</a>


</div>


        



<A name="datamapping_relations_lazyload"></a>

<div class="subsection" style="margin-left:30px;">

    <span class="sectionheadertext">Selecting from Relationships: Lazy Load</span>
    <div class="sectiontext">


    <P>We've seen how the <span class="codeline">relation</span> specifier affects the saving of an object and its child items, how does it affect selecting them?  By default, the relation keyword indicates that the related property should be attached a <b>Lazy Loader</b> when instances of the parent object are loaded from the database; this is just a callable function that when accessed will invoke a second SQL query to load the child objects of the parent.</p>
    
        

<div class="code">
<pre><span class="python_comment"># define a mapper
</span><span class="python_name">User</span><span class="python_operator">.</span><span class="python_name">mapper </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">, </span><span class="python_name">properties </span><span class="python_operator">= </span><span class="python_enclosure">{</span>
                  <span class="python_literal">'addresses' </span><span class="python_operator">: </span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_operator">, </span><span class="python_name">addresses</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">private</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span>
                <span class="python_enclosure">})</span><span class="python_operator">
        </span>
<span class="python_comment"># select users where username is 'jane', get the first element of the list
# this will incur a load operation for the parent table
</span><span class="python_name">user </span><span class="python_operator">= </span><span class="python_name">User</span><span class="python_operator">.</span><span class="python_name">mapper</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">user_name</span><span class="python_operator">=</span><span class="python_literal">'jane'</span><span class="python_enclosure">)[</span><span class="python_number">0</span><span class="python_enclosure">]</span><span class="python_operator"></span></pre><div class="codepop">SELECT users.user_id AS users_user_id, <br/>
users.user_name AS users_user_name, users.password AS users_password<br/>
FROM users WHERE users.user_name = :users_user_name ORDER BY users.oid<br/>
{'users_user_name': 'jane'}</div><pre><span class="python_comment"># iterate through the User object's addresses.  this will incur an
# immediate load of those child items
</span><span class="python_keyword">for </span><span class="python_name">a </span><span class="python_keyword">in </span><span class="python_name">user</span><span class="python_operator">.</span><span class="python_name">addresses</span><span class="python_operator">:</span></pre><div class="codepop">SELECT addresses.address_id AS addresses_address_id, <br/>
addresses.user_id AS addresses_user_id, addresses.street AS addresses_street, <br/>
addresses.city AS addresses_city, addresses.state AS addresses_state, <br/>
addresses.zip AS addresses_zip FROM addresses<br/>
WHERE addresses.user_id = :users_user_id ORDER BY addresses.oid<br/>
{'users_user_id': 1}</div><pre> 
<span class="python_operator">     </span><span class="python_keyword">print </span><span class="python_name">repr</span><span class="python_enclosure">(</span><span class="python_name">a</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre></div>
    
        
			
        
			
    
    </div>

        



<A name="datamapping_relations_lazyload_relselectby"></a>

<div class="subsection" style="margin-left:40px;">

    <span class="sectionheadertext">Useful Feature: Creating Joins via select_by</span>
    <div class="sectiontext">


        <p>In mappers that have relationships, the <span class="codeline">select_by</span> method and its cousins include special functionality that can be used to create joins.  Just specify a key in the argument list which is not present in the primary mapper's list of properties or columns, but *is* present in the property list of one of its relationships:
        

<div class="code">
<pre><span class="python_literal"><a href="javascript:togglePopbox('popbox_73', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">l </span><span class="python_operator">= </span><span class="python_name">User</span><span class="python_operator">.</span><span class="python_name">mapper</span><span class="python_operator">.</span><span class="python_name">select_by</span><span class="python_enclosure">(</span><span class="python_name">street</span><span class="python_operator">=</span><span class="python_literal">'123 Green Street'</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre><div id="popbox_73_div" class="codepop" style="display:none;">SELECT users.user_id AS users_user_id, <br/>
users.user_name AS users_user_name, users.password AS users_password<br/>
FROM users, addresses <br/>
WHERE users.user_id=addresses.user_id<br/>
AND addresses.street=:addresses_street<br/>
ORDER BY users.oid<br/>
{'addresses_street', '123 Green Street'}</div><pre><span class="python_operator"></span></pre></div>

                <p>The above example is shorthand for:</p>
        

<div class="code">
<pre><span class="python_name">l </span><span class="python_operator">= </span><span class="python_name">User</span><span class="python_operator">.</span><span class="python_name">mapper</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">and_</span><span class="python_enclosure">(</span>
          <span class="python_name">Address</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">==</span><span class="python_name">User</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">, </span>
          <span class="python_name">Address</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">street</span><span class="python_operator">==</span><span class="python_literal">'123 Green Street'</span><span class="python_enclosure">)</span>
    <span class="python_enclosure">)</span><span class="python_operator"></span></pre></div>

        
                
    </div>


    <a href="#datamapping" class="toclink">back to section top</a>


</div>


        



<A name="datamapping_relations_lazyload_refreshing"></a>

<div class="subsection" style="margin-left:40px;">

    <span class="sectionheadertext">How to Refresh the List?</span>
    <div class="sectiontext">


        <p>Once the child list of Address objects is loaded, it is done loading for the lifetime of the object instance.  Changes to the list will not be interfered with by subsequent loads, and upon commit those changes will be saved.  Similarly, if a new User object is created and child Address objects added, a subsequent select operation which happens to touch upon that User instance, will also not affect the child list, since it is already loaded.</p>
        
        <p>The issue of when the mapper actually gets brand new objects from the database versus when it assumes the in-memory version is fine the way it is, is a subject of <b>transactional scope</b>.  Described in more detail in the Unit of Work section, for now it should be noted that the total storage of all newly created and selected objects, <b>within the scope of the current thread</b>, can be reset via releasing or otherwise disregarding all current object instances, and calling:</p>
        

<div class="code">
<pre><span class="python_name">objectstore</span><span class="python_operator">.</span><span class="python_name">clear</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre></div>

        <p>This operation will clear out all currently mapped object instances, and subsequent select statements will load fresh copies from the databse.</p>
        
        <p>To operate upon a single object, just use the <span class="codeline">remove</span> function:</p>
        

<div class="code">
<pre><span class="python_comment"># (this function coming soon)
</span><span class="python_name">objectstore</span><span class="python_operator">.</span><span class="python_name">remove</span><span class="python_enclosure">(</span><span class="python_name">myobject</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre></div>

        
        
    </div>


    <a href="#datamapping" class="toclink">back to section top</a>


</div>





</div>


        



<A name="datamapping_relations_eagerload"></a>

<div class="subsection" style="margin-left:30px;">

    <span class="sectionheadertext">Selecting from Relationships: Eager Load</span>
    <div class="sectiontext">


        <p>With just a single parameter "lazy=False" specified to the relation object, the parent and child SQL queries can be joined together.

        

<div class="code">
<pre><span class="python_name">Address</span><span class="python_operator">.</span><span class="python_name">mapper </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_operator">, </span><span class="python_name">addresses</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">User</span><span class="python_operator">.</span><span class="python_name">mapper </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">, </span><span class="python_name">properties </span><span class="python_operator">= </span><span class="python_enclosure">{</span>
                    <span class="python_literal">'addresses' </span><span class="python_operator">: </span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_operator">.</span><span class="python_name">mapper</span><span class="python_operator">, </span><span class="python_name">lazy</span><span class="python_operator">=</span><span class="python_name">False</span><span class="python_enclosure">)</span>
                <span class="python_enclosure">}</span>
              <span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_name">user </span><span class="python_operator">= </span><span class="python_name">User</span><span class="python_operator">.</span><span class="python_name">mapper</span><span class="python_operator">.</span><span class="python_name">get_by</span><span class="python_enclosure">(</span><span class="python_name">user_name</span><span class="python_operator">=</span><span class="python_literal">'jane'</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre><div class="codepop">SELECT users.user_id AS users_user_id, users.user_name AS users_user_name, <br/>
users.password AS users_password, <br/>
addresses.address_id AS addresses_address_id, addresses.user_id AS addresses_user_id, <br/>
addresses.street AS addresses_street, addresses.city AS addresses_city, <br/>
addresses.state AS addresses_state, addresses.zip AS addresses_zip<br/>
FROM users LEFT OUTER JOIN addresses ON users.user_id = addresses.user_id<br/>
WHERE users.user_name = :users_user_name ORDER BY users.oid, addresses.oid<br/>
{'users_user_name': 'jane'}</div><pre><span class="python_keyword">for </span><span class="python_name">a </span><span class="python_keyword">in </span><span class="python_name">user</span><span class="python_operator">.</span><span class="python_name">addresses</span><span class="python_operator">:  
    </span><span class="python_keyword">print </span><span class="python_name">repr</span><span class="python_enclosure">(</span><span class="python_name">a</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre></div>

        <P>Above, a pretty ambitious query is generated just by specifying that the User should be loaded with its child Addresses in one query.  When the mapper processes the results, it uses an <b>Identity Map</b> to keep track of objects that were already loaded, based on their primary key identity.  Through this method, the redundant rows produced by the join are organized into the distinct object instances they represent.</p>
        
        <p>The generation of this query is also immune to the effects of additional joins being specified in the original query.  To use our select_by example above, joining against the "addresses" table to locate users with a certain street results in this behavior:
        

<div class="code">
<pre><span class="python_name">users </span><span class="python_operator">= </span><span class="python_name">User</span><span class="python_operator">.</span><span class="python_name">mapper</span><span class="python_operator">.</span><span class="python_name">select_by</span><span class="python_enclosure">(</span><span class="python_name">street</span><span class="python_operator">=</span><span class="python_literal">'123 Green Street'</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre><div class="codepop">SELECT users.user_id AS users_user_id, <br/>
users.user_name AS users_user_name, users.password AS users_password, <br/>
addresses.address_id AS addresses_address_id, <br/>
addresses.user_id AS addresses_user_id, addresses.street AS addresses_street, <br/>
addresses.city AS addresses_city, addresses.state AS addresses_state, <br/>
addresses.zip AS addresses_zip<br/>
FROM addresses AS addresses_417c, <br/>
users LEFT OUTER JOIN addresses ON users.user_id = addresses.user_id<br/>
WHERE addresses_417c.street = :addresses_street <br/>
AND users.user_id = addresses_417c.user_id <br/>
ORDER BY users.oid, addresses.oid<br/>
{'addresses_street': '123 Green Street'}</div><pre><span class="python_operator"></span></pre></div>
        
            <p>The join implied by passing the "street" parameter is converted into an "aliasized" clause by the eager loader, so that it does not conflict with the join used to eager load the child address objects.</p>
    
    </div>


    <a href="#datamapping" class="toclink">back to section top</a>


</div>


        



<A name="datamapping_relations_options"></a>

<div class="subsection" style="margin-left:30px;">

    <span class="sectionheadertext">Switching Lazy/Eager, No Load</span>
    <div class="sectiontext">


    <p>The <span class="codeline">options</span> method of mapper provides an easy way to get alternate forms of a mapper from an original one.  The most common use of this feature is to change the "eager/lazy" loading behavior of a particular mapper, via the functions <span class="codeline">eagerload()</span>, <span class="codeline">lazyload()</span> and <span class="codeline">noload()</span>:
    </p>
        

<div class="code">
<pre><span class="python_comment"># user mapper with lazy addresses
</span><span class="python_name">User</span><span class="python_operator">.</span><span class="python_name">mapper </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">, </span><span class="python_name">properties </span><span class="python_operator">= </span><span class="python_enclosure">{</span>
                       <span class="python_literal">'addresses' </span><span class="python_operator">: </span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_operator">, </span><span class="python_name">addresses</span><span class="python_enclosure">))</span>
                   <span class="python_enclosure">}</span>
          <span class="python_enclosure">)</span><span class="python_operator">
          </span>
<span class="python_comment"># make an eager loader                    
</span><span class="python_name">eagermapper </span><span class="python_operator">= </span><span class="python_name">User</span><span class="python_operator">.</span><span class="python_name">mapper</span><span class="python_operator">.</span><span class="python_name">options</span><span class="python_enclosure">(</span><span class="python_name">eagerload</span><span class="python_enclosure">(</span><span class="python_literal">'addresses'</span><span class="python_enclosure">))</span><span class="python_operator">
</span><span class="python_name">u </span><span class="python_operator">= </span><span class="python_name">eagermapper</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_comment"># make another mapper that wont load the addresses at all
</span><span class="python_name">plainmapper </span><span class="python_operator">= </span><span class="python_name">User</span><span class="python_operator">.</span><span class="python_name">mapper</span><span class="python_operator">.</span><span class="python_name">options</span><span class="python_enclosure">(</span><span class="python_name">noload</span><span class="python_enclosure">(</span><span class="python_literal">'addresses'</span><span class="python_enclosure">))</span><span class="python_operator">
</span>
<span class="python_comment"># multiple options can be specified
</span><span class="python_name">mymapper </span><span class="python_operator">= </span><span class="python_name">oldmapper</span><span class="python_operator">.</span><span class="python_name">options</span><span class="python_enclosure">(</span><span class="python_name">lazyload</span><span class="python_enclosure">(</span><span class="python_literal">'tracker'</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">noload</span><span class="python_enclosure">(</span><span class="python_literal">'streets'</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">eagerload</span><span class="python_enclosure">(</span><span class="python_literal">'members'</span><span class="python_enclosure">))</span><span class="python_operator">
</span>
<span class="python_comment"># to specify a relation on a relation, separate the property names by a "."
</span><span class="python_name">mymapper </span><span class="python_operator">= </span><span class="python_name">oldmapper</span><span class="python_operator">.</span><span class="python_name">options</span><span class="python_enclosure">(</span><span class="python_name">eagerload</span><span class="python_enclosure">(</span><span class="python_literal">'orders.items'</span><span class="python_enclosure">))</span><span class="python_operator"></span></pre></div>
    
    
    
    </div>


    <a href="#datamapping" class="toclink">back to section top</a>


</div>





</div>


        



<A name="datamapping_onetoone"></a>

<div class="subsection" style="margin-left:20px;">

    <span class="sectionheadertext">One to One/Many to One</span>
    <div class="sectiontext">


<p>The above examples focused on the "one-to-many" relationship.  To do other forms of relationship is easy, as the <span class="codeline">relation</span> function can usually figure out what you want:</p>

        

<div class="code">
<pre><span class="python_comment"># a table to store a user's preferences for a site
</span><span class="python_name">prefs </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'user_prefs'</span><span class="python_operator">, </span><span class="python_name">engine</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'pref_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key </span><span class="python_operator">= </span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'stylename'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">20</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'save_password'</span><span class="python_operator">, </span><span class="python_name">Boolean</span><span class="python_operator">, </span><span class="python_name">nullable </span><span class="python_operator">= </span><span class="python_name">False</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'timezone'</span><span class="python_operator">, </span><span class="python_name">CHAR</span><span class="python_enclosure">(</span><span class="python_number">3</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">nullable </span><span class="python_operator">= </span><span class="python_name">False</span><span class="python_enclosure">)</span>
<span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># user table gets 'preference_id' column added
</span><span class="python_name">users </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'users'</span><span class="python_operator">, </span><span class="python_name">engine</span><span class="python_operator">, </span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'user_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key </span><span class="python_operator">= </span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'user_name'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">16</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">nullable </span><span class="python_operator">= </span><span class="python_name">False</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'password'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">20</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">nullable </span><span class="python_operator">= </span><span class="python_name">False</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'preference_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">ForeignKey</span><span class="python_enclosure">(</span><span class="python_literal">"prefs.pref_id"</span><span class="python_enclosure">))</span>
<span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># class definition for preferences
</span><span class="python_keyword">class </span><span class="python_name">UserPrefs</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">pass</span><span class="python_operator">
</span><span class="python_name">UserPrefs</span><span class="python_operator">.</span><span class="python_name">mapper </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">UserPrefs</span><span class="python_operator">, </span><span class="python_name">prefs</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># address mapper
</span><span class="python_name">Address</span><span class="python_operator">.</span><span class="python_name">mapper </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_operator">, </span><span class="python_name">addresses</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># make a new mapper referencing everything.
</span><span class="python_name">m </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">, </span><span class="python_name">properties </span><span class="python_operator">= </span><span class="python_name">dict</span><span class="python_enclosure">(</span>
    <span class="python_name">addresses </span><span class="python_operator">= </span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_operator">.</span><span class="python_name">mapper</span><span class="python_operator">, </span><span class="python_name">lazy</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_operator">, </span><span class="python_name">private</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">preferences </span><span class="python_operator">= </span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">UserPrefs</span><span class="python_operator">.</span><span class="python_name">mapper</span><span class="python_operator">, </span><span class="python_name">lazy</span><span class="python_operator">=</span><span class="python_name">False</span><span class="python_operator">, </span><span class="python_name">private</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
<span class="python_enclosure">))</span><span class="python_operator">
</span>
<span class="python_comment"># select
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_74', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">user </span><span class="python_operator">= </span><span class="python_name">m</span><span class="python_operator">.</span><span class="python_name">get_by</span><span class="python_enclosure">(</span><span class="python_name">user_name</span><span class="python_operator">=</span><span class="python_literal">'fred'</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre><div id="popbox_74_div" class="codepop" style="display:none;">SELECT users.user_id AS users_user_id, users.user_name AS users_user_name, <br/>
users.password AS users_password, users.preference_id AS users_preference_id, <br/>
user_prefs.pref_id AS user_prefs_pref_id, user_prefs.stylename AS user_prefs_stylename, <br/>
user_prefs.save_password AS user_prefs_save_password, user_prefs.timezone AS user_prefs_timezone <br/>
FROM users LEFT OUTER JOIN user_prefs ON user_prefs.pref_id = users.preference_id <br/>
WHERE users.user_name = :users_user_name ORDER BY users.oid, user_prefs.oid<br/>
<br/>
{'users_user_name': 'fred'}</div><pre><span class="python_name">save_password </span><span class="python_operator">= </span><span class="python_name">user</span><span class="python_operator">.</span><span class="python_name">preferences</span><span class="python_operator">.</span><span class="python_name">save_password</span><span class="python_operator">
</span>
<span class="python_comment"># modify
</span><span class="python_name">user</span><span class="python_operator">.</span><span class="python_name">preferences</span><span class="python_operator">.</span><span class="python_name">stylename </span><span class="python_operator">= </span><span class="python_literal">'bluesteel'</span><span class="python_operator">
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_75', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">user</span><span class="python_operator">.</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">append</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_enclosure">(</span><span class="python_literal">'freddy@hi.org'</span><span class="python_enclosure">))</span><span class="python_operator"></span></pre><div id="popbox_75_div" class="codepop" style="display:none;">SELECT email_addresses.address_id AS email_addresses_address_id, <br/>
email_addresses.user_id AS email_addresses_user_id, <br/>
email_addresses.email_address AS email_addresses_email_address <br/>
FROM email_addresses <br/>
WHERE email_addresses.user_id = :users_user_id <br/>
ORDER BY email_addresses.oid, email_addresses.oid<br/>
<br/>
{'users_user_id': 1}</div><pre><span class="python_comment"># commit
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_76', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">objectstore</span><span class="python_operator">.</span><span class="python_name">commit</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_76_div" class="codepop" style="display:none;">UPDATE user_prefs SET stylename=:stylename<br/>
WHERE user_prefs.pref_id = :pref_id<br/>
<br/>
[{'stylename': 'bluesteel', 'pref_id': 1}]<br/>
<br/>
INSERT INTO email_addresses (address_id, user_id, email_address) <br/>
VALUES (:address_id, :user_id, :email_address)<br/>
<br/>
{'email_address': 'freddy@hi.org', 'address_id': None, 'user_id': 1}</div><pre><span class="python_operator"></span></pre></div>


    </div>


    <a href="#datamapping" class="toclink">back to section top</a>


</div>


        



<A name="datamapping_manytomany"></a>

<div class="subsection" style="margin-left:20px;">

    <span class="sectionheadertext">Many to Many</span>
    <div class="sectiontext">


<p>The <span class="codeline">relation</span> function handles a basic many-to-many relationship when you specify the association table:</p>
        

<div class="code">
<pre><span class="python_name">articles </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'articles'</span><span class="python_operator">, </span><span class="python_name">engine</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'article_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key </span><span class="python_operator">= </span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'headline'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">150</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">key</span><span class="python_operator">=</span><span class="python_literal">'headline'</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'body'</span><span class="python_operator">, </span><span class="python_name">TEXT</span><span class="python_operator">, </span><span class="python_name">key</span><span class="python_operator">=</span><span class="python_literal">'body'</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
<span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_name">keywords </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'keywords'</span><span class="python_operator">, </span><span class="python_name">engine</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'keyword_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key </span><span class="python_operator">= </span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'keyword_name'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">50</span><span class="python_enclosure">))</span>
<span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_name">itemkeywords </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'article_keywords'</span><span class="python_operator">, </span><span class="python_name">engine</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'article_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">ForeignKey</span><span class="python_enclosure">(</span><span class="python_literal">"articles.article_id"</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'keyword_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">ForeignKey</span><span class="python_enclosure">(</span><span class="python_literal">"keywords.keyword_id"</span><span class="python_enclosure">))</span>
<span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># class definitions
</span><span class="python_keyword">class </span><span class="python_name">Keyword</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">def </span><span class="python_name">__init__</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">name </span><span class="python_operator">= </span><span class="python_name">None</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">keyword_name </span><span class="python_operator">= </span><span class="python_name">name</span><span class="python_operator">
</span>
<span class="python_operator"></span><span class="python_keyword">class </span><span class="python_name">Article</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">pass</span><span class="python_operator">
</span>
<span class="python_comment"># define a mapper that does many-to-many on the 'itemkeywords' association 
# table
</span><span class="python_operator"></span><span class="python_name">Article</span><span class="python_operator">.</span><span class="python_name">mapper </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Article</span><span class="python_operator">, </span><span class="python_name">articles</span><span class="python_operator">, </span><span class="python_name">properties </span><span class="python_operator">= </span><span class="python_name">dict</span><span class="python_enclosure">(</span>
        <span class="python_name">keywords </span><span class="python_operator">= </span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Keyword</span><span class="python_operator">, </span><span class="python_name">keywords</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">itemkeywords</span><span class="python_operator">, </span><span class="python_name">lazy</span><span class="python_operator">=</span><span class="python_name">False</span><span class="python_enclosure">)</span>
        <span class="python_enclosure">)</span>
    <span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_name">article </span><span class="python_operator">= </span><span class="python_name">Article</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_name">article</span><span class="python_operator">.</span><span class="python_name">headline </span><span class="python_operator">= </span><span class="python_literal">'a headline'</span><span class="python_operator">
</span><span class="python_name">article</span><span class="python_operator">.</span><span class="python_name">body </span><span class="python_operator">= </span><span class="python_literal">'this is the body'</span><span class="python_operator">
</span><span class="python_name">article</span><span class="python_operator">.</span><span class="python_name">keywords</span><span class="python_operator">.</span><span class="python_name">append</span><span class="python_enclosure">(</span><span class="python_name">Keyword</span><span class="python_enclosure">(</span><span class="python_literal">'politics'</span><span class="python_enclosure">))</span><span class="python_operator">
</span><span class="python_name">article</span><span class="python_operator">.</span><span class="python_name">keywords</span><span class="python_operator">.</span><span class="python_name">append</span><span class="python_enclosure">(</span><span class="python_name">Keyword</span><span class="python_enclosure">(</span><span class="python_literal">'entertainment'</span><span class="python_enclosure">))</span><span class="python_operator">
        </span><span class="python_literal"><a href="javascript:togglePopbox('popbox_77', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_operator">
</span><span class="python_name">objectstore</span><span class="python_operator">.</span><span class="python_name">commit</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_77_div" class="codepop" style="display:none;">INSERT INTO keywords (name) VALUES (:name)<br/>
<br/>
{'name': 'politics'}<br/>
<br/>
INSERT INTO keywords (name) VALUES (:name)<br/>
<br/>
{'name': 'entertainment'}<br/>
<br/>
INSERT INTO articles (article_headline, article_body) VALUES (:article_headline, :article_body)<br/>
<br/>
{'article_body': 'this is the body', 'article_headline': 'a headline'}<br/>
<br/>
INSERT INTO article_keywords (article_id, keyword_id) VALUES (:article_id, :keyword_id)<br/>
<br/>
[{'keyword_id': 1, 'article_id': 1}, {'keyword_id': 2, 'article_id': 1}]</div><pre><span class="python_comment"># select articles based on a keyword.  select_by will handle the extra joins.
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_78', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">articles </span><span class="python_operator">= </span><span class="python_name">Article</span><span class="python_operator">.</span><span class="python_name">mapper</span><span class="python_operator">.</span><span class="python_name">select_by</span><span class="python_enclosure">(</span><span class="python_name">keyword_name</span><span class="python_operator">=</span><span class="python_literal">'politics'</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre><div id="popbox_78_div" class="codepop" style="display:none;">SELECT articles.article_id AS articles_article_id, <br/>
articles.article_headline AS articles_article_headline, <br/>
articles.article_body AS articles_article_body, <br/>
keywords.keyword_id AS keywords_keyword_id, <br/>
keywords.keyword_name AS keywords_keyword_name <br/>
FROM keywords AS keywords_f008, <br/>
article_keywords AS article_keywords_dbf0, <br/>
articles LEFT OUTER JOIN article_keywords ON <br/>
articles.article_id = article_keywords.article_id <br/>
LEFT OUTER JOIN keywords ON <br/>
keywords.keyword_id = article_keywords.keyword_id <br/>
WHERE (keywords_f008.keyword_name = :keywords_keyword_name <br/>
AND articles.article_id = article_keywords_dbf0.article_id) <br/>
AND keywords_f008.keyword_id = article_keywords_dbf0.keyword_id <br/>
ORDER BY articles.oid, article_keywords.oid <br/>
{'keywords_keyword_name': 'politics'}</div><pre><span class="python_comment"># modify
</span><span class="python_name">a </span><span class="python_operator">= </span><span class="python_name">articles</span><span class="python_enclosure">[</span><span class="python_number">0</span><span class="python_enclosure">]</span><span class="python_operator">
</span><span class="python_keyword">del </span><span class="python_name">a</span><span class="python_operator">.</span><span class="python_name">keywords</span><span class="python_enclosure">[</span><span class="python_operator">:</span><span class="python_enclosure">]</span><span class="python_operator">
</span><span class="python_name">a</span><span class="python_operator">.</span><span class="python_name">keywords</span><span class="python_operator">.</span><span class="python_name">append</span><span class="python_enclosure">(</span><span class="python_name">Keyword</span><span class="python_enclosure">(</span><span class="python_literal">'topstories'</span><span class="python_enclosure">))</span><span class="python_operator">
</span><span class="python_name">a</span><span class="python_operator">.</span><span class="python_name">keywords</span><span class="python_operator">.</span><span class="python_name">append</span><span class="python_enclosure">(</span><span class="python_name">Keyword</span><span class="python_enclosure">(</span><span class="python_literal">'government'</span><span class="python_enclosure">))</span><span class="python_operator">
</span>
<span class="python_comment"># commit.  individual INSERT/DELETE operations will take place only for the list
# elements that changed.
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_79', 'show', 'hide')" class="codepoplink">sql</a>    </span><span class="python_operator">
</span><span class="python_name">objectstore</span><span class="python_operator">.</span><span class="python_name">commit</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_79_div" class="codepop" style="display:none;">INSERT INTO keywords (name) VALUES (:name)<br/>
<br/>
{'name': 'topstories'}<br/>
<br/>
INSERT INTO keywords (name) VALUES (:name)<br/>
<br/>
{'name': 'government'}<br/>
<br/>
DELETE FROM article_keywords <br/>
WHERE article_keywords.article_id = :article_id <br/>
AND article_keywords.keyword_id = :keyword_id<br/>
<br/>
[{'keyword_id': 1, 'article_id': 1}, {'keyword_id': 2, 'article_id': 1}]<br/>
<br/>
INSERT INTO article_keywords (article_id, keyword_id) VALUES (:article_id, :keyword_id)<br/>
<br/>
[{'keyword_id': 3, 'article_id': 1}, {'keyword_id': 4, 'article_id': 1}]</div><pre><span class="python_operator"></span></pre></div>


    </div>


    <a href="#datamapping" class="toclink">back to section top</a>


</div>


        



<A name="datamapping_association"></a>

<div class="subsection" style="margin-left:20px;">

    <span class="sectionheadertext">Association Object</span>
    <div class="sectiontext">



        <p>Many to Many can also be done with an association object, that adds additional information about how two items are related.  This association object is set up in basically the same way as any other mapped object.  However, since an association table typically has no primary key columns, you have to tell the mapper what columns will compose its "primary key", which are the two (or more) columns involved in the association.  Also, the relation function needs an additional hint as to the fact that this mapped object is an association object, via the "association" argument which points to the class or mapper representing the other side of the association.</p>
        

<div class="code">
<pre><span class="python_comment"># add "attached_by" column which will reference the user who attached this keyword
</span><span class="python_name">itemkeywords </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'article_keywords'</span><span class="python_operator">, </span><span class="python_name">engine</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'article_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">ForeignKey</span><span class="python_enclosure">(</span><span class="python_literal">"articles.article_id"</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'keyword_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">ForeignKey</span><span class="python_enclosure">(</span><span class="python_literal">"keywords.keyword_id"</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'attached_by'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">ForeignKey</span><span class="python_enclosure">(</span><span class="python_literal">"users.user_id"</span><span class="python_enclosure">))</span>
<span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># define an association class
</span><span class="python_keyword">class </span><span class="python_name">KeywordAssociation</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">pass</span><span class="python_operator">
</span>
<span class="python_comment"># mapper for KeywordAssociation
# specify "primary key" columns manually
</span><span class="python_operator"></span><span class="python_name">KeywordAssociation</span><span class="python_operator">.</span><span class="python_name">mapper </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">KeywordAssociation</span><span class="python_operator">, </span><span class="python_name">itemkeywords</span><span class="python_operator">,</span>
        <span class="python_name">primary_key </span><span class="python_operator">= </span><span class="python_enclosure">[</span><span class="python_name">itemkeywords</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">article_id</span><span class="python_operator">, </span><span class="python_name">itemkeywords</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">keyword_id</span><span class="python_enclosure">]</span><span class="python_operator">,</span>
        <span class="python_name">properties</span><span class="python_operator">=</span><span class="python_enclosure">{</span>
            <span class="python_literal">'keyword' </span><span class="python_operator">: </span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">Keyword</span><span class="python_operator">, </span><span class="python_name">lazy </span><span class="python_operator">= </span><span class="python_name">False</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_comment"># uses primary Keyword mapper</span>
            <span class="python_literal">'user' </span><span class="python_operator">: </span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">lazy </span><span class="python_operator">= </span><span class="python_name">True</span><span class="python_enclosure">) </span><span class="python_comment"># uses primary User mapper</span>
        <span class="python_enclosure">}</span>
<span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># mappers for Users, Keywords
</span><span class="python_name">User</span><span class="python_operator">.</span><span class="python_name">mapper </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">Keyword</span><span class="python_operator">.</span><span class="python_name">mapper </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Keyword</span><span class="python_operator">, </span><span class="python_name">keywords</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># define the mapper. 
</span><span class="python_name">m </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Article</span><span class="python_operator">, </span><span class="python_name">articles</span><span class="python_operator">, </span><span class="python_name">properties</span><span class="python_operator">=</span><span class="python_enclosure">{</span>
    <span class="python_literal">'keywords'</span><span class="python_operator">:</span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">KeywordAssociation</span><span class="python_operator">.</span><span class="python_name">mapper</span><span class="python_operator">, </span><span class="python_name">lazy</span><span class="python_operator">=</span><span class="python_name">False</span><span class="python_operator">, </span><span class="python_name">association</span><span class="python_operator">=</span><span class="python_name">Keyword</span><span class="python_enclosure">)</span>
        <span class="python_enclosure">}</span>
<span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># bonus step - well, we do want to load the users in one shot, 
# so modify the mapper via an option.
# this returns a new mapper with the option switched on.
</span><span class="python_name">m2 </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_operator">.</span><span class="python_name">options</span><span class="python_enclosure">(</span><span class="python_name">eagerload</span><span class="python_enclosure">(</span><span class="python_literal">'keywords.user'</span><span class="python_enclosure">))</span><span class="python_operator">
</span>
<span class="python_comment"># select by keyword again
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_80', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">alist </span><span class="python_operator">= </span><span class="python_name">m2</span><span class="python_operator">.</span><span class="python_name">select_by</span><span class="python_enclosure">(</span><span class="python_name">keyword_name</span><span class="python_operator">=</span><span class="python_literal">'jacks_stories'</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre><div id="popbox_80_div" class="codepop" style="display:none;">SELECT articles.article_id AS articles_article_id, <br/>
articles.article_headline AS articles_article_headline, <br/>
articles.article_body AS articles_article_body, <br/>
article_keywords.article_id AS article_keywords_article_id, <br/>
article_keywords.keyword_id AS article_keywords_keyword_id, <br/>
article_keywords.attached_by AS article_keywords_attached_by, <br/>
users.user_id AS users_user_id, users.user_name AS users_user_name, <br/>
users.password AS users_password, users.preference_id AS users_preference_id, <br/>
keywords.keyword_id AS keywords_keyword_id, keywords.name AS keywords_name <br/>
FROM article_keywords article_keywords_3a64, keywords keywords_11b7, <br/>
articles LEFT OUTER JOIN article_keywords ON articles.article_id = article_keywords.article_id <br/>
LEFT OUTER JOIN users ON users.user_id = article_keywords.attached_by <br/>
LEFT OUTER JOIN keywords ON keywords.keyword_id = article_keywords.keyword_id <br/>
WHERE keywords_11b7.keyword_id = article_keywords_3a64.keyword_id <br/>
AND article_keywords_3a64.article_id = articles.article_id <br/>
AND keywords_11b7.name = :keywords_name <br/>
ORDER BY articles.oid, article_keywords.oid, users.oid, keywords.oid<br/>
<br/>
{'keywords_name': 'jacks_stories'}</div><pre><span class="python_comment"># user is available
</span><span class="python_keyword">for </span><span class="python_name">a </span><span class="python_keyword">in </span><span class="python_name">alist</span><span class="python_operator">:
    </span><span class="python_keyword">for </span><span class="python_name">k </span><span class="python_keyword">in </span><span class="python_name">a</span><span class="python_operator">.</span><span class="python_name">keywords</span><span class="python_operator">:
        </span><span class="python_keyword">if </span><span class="python_name">k</span><span class="python_operator">.</span><span class="python_name">keyword</span><span class="python_operator">.</span><span class="python_name">name </span><span class="python_operator">== </span><span class="python_literal">'jacks_stories'</span><span class="python_operator">:
            </span><span class="python_keyword">print </span><span class="python_name">k</span><span class="python_operator">.</span><span class="python_name">user</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator"></span></pre></div>

        

    </div>


    <a href="#datamapping" class="toclink">back to section top</a>


</div>




    <hr width="400px" align="left" />

</div>


		</div>
		<div class="section">
					
			<A name="unitofwork"></a>
			<div class="topnavmargin">
			
	
<div class="topnav">


	
	<div class="topnavcontrol">
	View: <a href="index.html">Paged</a> &nbsp;|&nbsp; <b>One Page</b>
	</div>



<div class="topnavsectionlink">

<a href="#top">Table of Contents</a>

<div class="prevnext">
Previous: <a href="#datamapping">Basic Data Mapping</a>

&nbsp; | &nbsp;


Next: <a href="#adv_datamapping">Advanced Data Mapping</a>

</div>
</div>


<div class="topnavmain">
	<div class="topnavheader">Unit of Work</div>
	<div class="topnavitems">
	


    
    
    <div class="toclink">
        <A style="" href="#unitofwork_overview">Overview</a>
    </div>
    
    <div class="toclinkcontainer">
    </div>


    
    
    <div class="toclink">
        <A style="" href="#unitofwork_getting">Accessing UnitOfWork Instances</a>
    </div>
    
    <div class="toclinkcontainer">
    </div>


    
    
    <div class="toclink">
        <A style="" href="#unitofwork_begincommit">Begin/Commit</a>
    </div>
    
    <div class="toclinkcontainer">
        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#unitofwork_begincommit_begin">Controlling Scope with begin()</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#unitofwork_begincommit_transactionnesting">Nesting UnitOfWork in a Database Transaction</a>
    </div>

    </div>


    </div>


    
    
    <div class="toclink">
        <A style="" href="#unitofwork_identity">The Identity Map</a>
    </div>
    
    <div class="toclinkcontainer">
    </div>


    
    
    <div class="toclink">
        <A style="" href="#unitofwork_import">Bringing External Instances into the UnitOfWork</a>
    </div>
    
    <div class="toclinkcontainer">
    </div>


    
    
    <div class="toclink">
        <A style="" href="#unitofwork_advscope">Advanced UnitOfWork Management</a>
    </div>
    
    <div class="toclinkcontainer">
        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#unitofwork_advscope_object">Per-Object Sessions</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#unitofwork_advscope_scope">Custom Session Objects/Custom Scopes</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#unitofwork_advscope_logging">Analyzing Object Commits</a>
    </div>

    </div>


    </div>



	</div>
</div>

</div>

			</div>

			




<div class="subsection" style="margin-left:10px;">

    <div class="sectiontext">


    
			
    
			
    
			
    
			
    
			

    
			

    </div>

        



<A name="unitofwork_overview"></a>

<div class="subsection" style="margin-left:20px;">

    <span class="sectionheadertext">Overview</span>
    <div class="sectiontext">


    <p>The concept behind Unit of Work is to track modifications to a field of objects, and then be able to commit those changes to the database in a single operation.  Theres a lot of advantages to this, including that your application doesn't need to worry about individual save operations on objects, nor about the required order for those operations, nor about excessive repeated calls to save operations that would be more efficiently aggregated into one step.  It also simplifies database transactions, providing a neat package with which to insert into the traditional database begin/commit phase.
    </p>
    <p>SQLAlchemy's unit of work includes these functions:
    <ul>
        <li>The ability to monitor scalar and list attributes on object instances, as well as object creates.  This is handled via the attributes package.</li>
        <li>The ability to maintain and process a list of modified objects, and based on the relationships set up by the mappers for those objects as well as the foreign key relationships of the underlying tables, figure out the proper order of operations so that referential integrity is maintained, and also so that on-the-fly values such as newly created primary keys can be propigated to dependent objects that need them before they are saved.  The central algorithm for this is the <b>topological sort</b>.</li>
        <li>The ability to "roll back" the attributes that have changed on an object instance since the last commit() operation.  this is also handled by the attributes package.</li>
        <li>The ability to define custom functionality that occurs within the unit-of-work commit phase, such as "before insert", "after insert", etc.  This is accomplished via MapperExtension.</li>
        <li>an Identity Map, which is a dictionary storing the one and only instance of an object for a particular table/primary key combination.  This allows many parts of an application to get a handle to a particular object without any chance of modifications going to two different places.</li>
        <li>Thread-local operation.  the Identity map as well as the Unit of work itself are normally instantiated and accessed in a manner that is local to the current thread.  Another concurrently executing thread will therefore have its own Identity Map/Unit of Work, so unless an application explicitly shares objects between threads, the operation of the object relational mapping is automatically threadsafe.  Unit of Work objects can also be constructed manually to allow any user-defined scoping.</li>
    </ul></p>
    
    </div>


    <a href="#unitofwork" class="toclink">back to section top</a>


</div>


        



<A name="unitofwork_getting"></a>

<div class="subsection" style="margin-left:20px;">

    <span class="sectionheadertext">Accessing UnitOfWork Instances</span>
    <div class="sectiontext">


    <p>The current unit of work is accessed via the Session interface.  The Session is available in a thread-local context from the objectstore module as follows:</p>
        

<div class="code">
<pre><span class="python_comment"># get the current thread's session
</span><span class="python_name">s </span><span class="python_operator">= </span><span class="python_name">objectstore</span><span class="python_operator">.</span><span class="python_name">get_session</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre></div>

    <p>The Session object acts as a proxy to an underlying UnitOfWork object.  Common methods include commit(), begin(), clear(), and delete().  Most of these methods are available at the module level in the objectstore module, which operate upon the Session returned by the get_session() function.
    </p>
    <p>To clear out the current thread's UnitOfWork, which has the effect of discarding the Identity Map and the lists of all objects that have been modified, just issue a clear:
    </p>
    

<div class="code">
<pre><span class="python_comment"># via module
</span><span class="python_name">objectstore</span><span class="python_operator">.</span><span class="python_name">clear</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_comment"># or via Session
</span><span class="python_name">objectstore</span><span class="python_operator">.</span><span class="python_name">get_session</span><span class="python_enclosure">()</span><span class="python_operator">.</span><span class="python_name">clear</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre></div>

    <p>This is the easiest way to "start fresh", as in a web application that wants to have a newly loaded graph of objects on each request.  Any object instances before the clear operation should be discarded.</p>
    
    </div>


    <a href="#unitofwork" class="toclink">back to section top</a>


</div>


        



<A name="unitofwork_begincommit"></a>

<div class="subsection" style="margin-left:20px;">

    <span class="sectionheadertext">Begin/Commit</span>
    <div class="sectiontext">


    <p>The current thread's UnitOfWork object keeps track of objects that are modified.  It maintains the following lists:</p>
    

<div class="code">
<pre><span class="python_comment"># new objects that were just constructed
</span><span class="python_name">objectstore</span><span class="python_operator">.</span><span class="python_name">get_session</span><span class="python_enclosure">()</span><span class="python_operator">.</span><span class="python_name">new</span><span class="python_operator">
</span>
<span class="python_comment"># objects that exist in the database, that were modified
</span><span class="python_name">objectstore</span><span class="python_operator">.</span><span class="python_name">get_session</span><span class="python_enclosure">()</span><span class="python_operator">.</span><span class="python_name">dirty</span><span class="python_operator">
</span>
<span class="python_comment"># objects that have been marked as deleted via objectstore.delete()
</span><span class="python_name">objectstore</span><span class="python_operator">.</span><span class="python_name">get_session</span><span class="python_enclosure">()</span><span class="python_operator">.</span><span class="python_name">deleted</span><span class="python_operator"></span></pre></div>

    <p>To commit the changes stored in those lists, just issue a commit.  This can be called via <span class="codeline">objectstore.session().commit()</span>, or through the module-level convenience method in the objectstore module:</p>
    

<div class="code">
<pre><span class="python_name">objectstore</span><span class="python_operator">.</span><span class="python_name">commit</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre></div>

    <p>The commit operation takes place within a SQL-level transaction, so any failures that occur will roll back the state of everything to before the commit took place.</p>
    <p>When mappers are created for classes, new object construction automatically places objects in the "new" list on the UnitOfWork, and object modifications automatically place objects in the "dirty" list.  To mark objects as to be deleted, use the "delete" method on UnitOfWork, or the module level version:</p>
    

<div class="code">
<pre><span class="python_name">objectstore</span><span class="python_operator">.</span><span class="python_name">delete</span><span class="python_enclosure">(</span><span class="python_name">myobj1</span><span class="python_operator">, </span><span class="python_name">myobj2</span><span class="python_operator">, ...</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre></div>

    
    <p>Commit() can also take a list of objects which narrow its scope to looking at just those objects to save:</p>
    

<div class="code">
<pre><span class="python_name">objectstore</span><span class="python_operator">.</span><span class="python_name">commit</span><span class="python_enclosure">(</span><span class="python_name">myobj1</span><span class="python_operator">, </span><span class="python_name">myobj2</span><span class="python_operator">, ...</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre></div>

    <p>Committing just a subset of instances should be used carefully, as it may result in an inconsistent save state between dependent objects (it should manage to locate loaded dependencies and save those also, but it hasnt been tested much).</p>
    
    
			
    
			
    
    </div>

        



<A name="unitofwork_begincommit_begin"></a>

<div class="subsection" style="margin-left:30px;">

    <span class="sectionheadertext">Controlling Scope with begin()</span>
    <div class="sectiontext">


    <p><b>status</b> - release 0.1.1/SVN head</p>
    <p>The "scope" of the unit of work commit can be controlled further by issuing a begin().  A begin operation constructs a new UnitOfWork object and sets it as the currently used UOW.  It maintains a reference to the original UnitOfWork as its "parent", and shares the same "identity map" of objects that have been loaded from the database within the scope of the parent UnitOfWork.  However, the "new", "dirty", and "deleted" lists are empty.  This has the effect that only changes that take place after the begin() operation get logged to the current UnitOfWork, and therefore those are the only changes that get commit()ted.  When the commit is complete, the "begun" UnitOfWork removes itself and places the parent UnitOfWork as the current one again.</p>
<p>The begin() method returns a transactional object, upon which you can call commit() or rollback().  <b>Only this transactional object controls the transaction</b> - commit() upon the Session will do nothing until commit() or rollback() is called upon the transactional object.</p>
    

<div class="code">
<pre><span class="python_comment"># modify an object
</span><span class="python_name">myobj1</span><span class="python_operator">.</span><span class="python_name">foo </span><span class="python_operator">= </span><span class="python_literal">"something new"</span><span class="python_operator">
</span>
<span class="python_comment"># begin an objectstore scope
# this is equivalent to objectstore.get_session().begin()
</span><span class="python_name">trans </span><span class="python_operator">= </span><span class="python_name">objectstore</span><span class="python_operator">.</span><span class="python_name">begin</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_comment"># modify another object
</span><span class="python_name">myobj2</span><span class="python_operator">.</span><span class="python_name">lala </span><span class="python_operator">= </span><span class="python_literal">"something new"</span><span class="python_operator">
</span>
<span class="python_comment"># only 'myobj2' is saved
</span><span class="python_name">trans</span><span class="python_operator">.</span><span class="python_name">commit</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre></div>

    <p>begin/commit supports the same "nesting" behavior as the SQLEngine (note this behavior is not the original "nested" behavior), meaning that many begin() calls can be made, but only the outermost transactional object will actually perform a commit().  Similarly, calls to the commit() method on the Session, which might occur in function calls within the transaction, will not do anything; this allows an external function caller to control the scope of transactions used within the functions.</p>
    
    </div>


    <a href="#unitofwork" class="toclink">back to section top</a>


</div>


        



<A name="unitofwork_begincommit_transactionnesting"></a>

<div class="subsection" style="margin-left:30px;">

    <span class="sectionheadertext">Nesting UnitOfWork in a Database Transaction</span>
    <div class="sectiontext">


    <p>The UOW commit operation places its INSERT/UPDATE/DELETE operations within the scope of a database transaction controlled by a SQLEngine:
    

<div class="code">
<pre><span class="python_name">engine</span><span class="python_operator">.</span><span class="python_name">begin</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_keyword">try</span><span class="python_operator">:
    </span><span class="python_comment"># run objectstore update operations
</span><span class="python_keyword">except</span><span class="python_operator">:
    </span><span class="python_name">engine</span><span class="python_operator">.</span><span class="python_name">rollback</span><span class="python_enclosure">()</span><span class="python_operator">
    </span><span class="python_keyword">raise</span><span class="python_operator">
</span><span class="python_name">engine</span><span class="python_operator">.</span><span class="python_name">commit</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre></div>

    <p>If you recall from the <a href="#dbengine_transactions" >Transactions</a> section, the engine's begin()/commit() methods support reentrant behavior.  This means you can nest begin and commits and only have the outermost begin/commit pair actually take effect (rollbacks however, abort the whole operation at any stage).  From this it follows that the UnitOfWork commit operation can be nested within a transaction as well:</p>
    

<div class="code">
<pre><span class="python_name">engine</span><span class="python_operator">.</span><span class="python_name">begin</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_keyword">try</span><span class="python_operator">:
    </span><span class="python_comment"># perform custom SQL operations
</span><span class="python_operator">    </span><span class="python_name">objectstore</span><span class="python_operator">.</span><span class="python_name">commit</span><span class="python_enclosure">()</span><span class="python_operator">
    </span><span class="python_comment"># perform custom SQL operations
</span><span class="python_operator"></span><span class="python_keyword">except</span><span class="python_operator">:
    </span><span class="python_name">engine</span><span class="python_operator">.</span><span class="python_name">rollback</span><span class="python_enclosure">()</span><span class="python_operator">
    </span><span class="python_keyword">raise</span><span class="python_operator">
</span><span class="python_name">engine</span><span class="python_operator">.</span><span class="python_name">commit</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre></div>

    
    
    </div>


    <a href="#unitofwork" class="toclink">back to section top</a>


</div>





</div>


        



<A name="unitofwork_identity"></a>

<div class="subsection" style="margin-left:20px;">

    <span class="sectionheadertext">The Identity Map</span>
    <div class="sectiontext">


    <p>All object instances which are saved to the database, or loaded from the database, are given an identity by the mapper/objectstore.  This identity is available via the _instance_key property attached to each object instance, and is a tuple consisting of the table's class, the SQLAlchemy-specific "hash key" of the table its persisted to, and an additional tuple of primary key values, in the order that they appear within the table definition:</p>
    

<div class="code">
<pre><span class="python_operator">>>> </span><span class="python_name">obj</span><span class="python_operator">.</span><span class="python_name">_instance_key </span><span class="python_operator">
</span><span class="python_enclosure">(</span><span class="python_operator"><</span><span class="python_keyword">class </span><span class="python_literal">'test.tables.User'</span><span class="python_operator">>, </span><span class="python_literal">"Table('users',SQLiteSQLEngine(([':memory:'], {})),schema=None)"</span><span class="python_operator">, </span><span class="python_enclosure">(</span><span class="python_number">7</span><span class="python_operator">,</span><span class="python_enclosure">))</span><span class="python_operator"></span></pre></div>

    <p>Note that this identity is a database identity, not an in-memory identity.  An application can have several different objects in different unit-of-work scopes that have the same database identity, or an object can be removed from memory, and constructed again later, with the same database identity.  What can <b>never</b> happen is for two copies of the same object to exist in the same unit-of-work scope with the same database identity; this is guaranteed by the <b>identity map</b>.
    </p>
    <p>
    At the moment that an object is assigned this key, it is also added to the current thread's unit-of-work's identity map.  The identity map is just a WeakValueDictionary which maintains the one and only reference to a particular object within the current unit of work scope.  It is used when result rows are fetched from the database to insure that only one copy of a particular object actually comes from that result set in the case that eager loads or other joins are used, or if the object had already been loaded from a previous result set.  The get() method on a mapper, which retrieves an object based on primary key identity, also checks in the current identity map first to save a database round-trip if possible.  In the case of an object lazy-loading a single child object, the get() method is also used.
    </p>
    <p>Methods on mappers and the objectstore module, which are relevant to identity include the following:</p>
    

<div class="code">
<pre><span class="python_comment"># assume 'm' is a mapper
</span><span class="python_name">m </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># get the identity key corresponding to a primary key
</span><span class="python_name">key </span><span class="python_operator">= </span><span class="python_name">m</span><span class="python_operator">.</span><span class="python_name">identity_key</span><span class="python_enclosure">(</span><span class="python_number">7</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># for composite key, list out the values in the order they
# appear in the table
</span><span class="python_name">key </span><span class="python_operator">= </span><span class="python_name">m</span><span class="python_operator">.</span><span class="python_name">identity_key</span><span class="python_enclosure">(</span><span class="python_number">12</span><span class="python_operator">, </span><span class="python_literal">'rev2'</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># get the identity key given a primary key 
# value as a tuple, a class, and a table
</span><span class="python_name">key </span><span class="python_operator">= </span><span class="python_name">objectstore</span><span class="python_operator">.</span><span class="python_name">get_id_key</span><span class="python_enclosure">((</span><span class="python_number">12</span><span class="python_operator">, </span><span class="python_literal">'rev2'</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># get the identity key for an object, whether or not it actually
# has one attached to it (m is the mapper for obj's class)
</span><span class="python_name">key </span><span class="python_operator">= </span><span class="python_name">m</span><span class="python_operator">.</span><span class="python_name">instance_key</span><span class="python_enclosure">(</span><span class="python_name">obj</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># same thing, from the objectstore (works for any obj type)
</span><span class="python_name">key </span><span class="python_operator">= </span><span class="python_name">objectstore</span><span class="python_operator">.</span><span class="python_name">instance_key</span><span class="python_enclosure">(</span><span class="python_name">obj</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># is this key in the current identity map?
</span><span class="python_name">objectstore</span><span class="python_operator">.</span><span class="python_name">has_key</span><span class="python_enclosure">(</span><span class="python_name">key</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># is this object in the current identity map?
</span><span class="python_name">objectstore</span><span class="python_operator">.</span><span class="python_name">has_instance</span><span class="python_enclosure">(</span><span class="python_name">obj</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># get this object from the current identity map based on 
# singular/composite primary key, or if not go 
# and load from the database
</span><span class="python_name">obj </span><span class="python_operator">= </span><span class="python_name">m</span><span class="python_operator">.</span><span class="python_name">get</span><span class="python_enclosure">(</span><span class="python_number">12</span><span class="python_operator">, </span><span class="python_literal">'rev2'</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre></div>

    
    </div>


    <a href="#unitofwork" class="toclink">back to section top</a>


</div>


        



<A name="unitofwork_import"></a>

<div class="subsection" style="margin-left:20px;">

    <span class="sectionheadertext">Bringing External Instances into the UnitOfWork</span>
    <div class="sectiontext">


    <p>The _instance_key attribute is designed to work with objects that are serialized into strings and brought back again.  As it contains no references to internal structures or database connections, applications that use caches or session storage which require serialization (i.e. pickling) can store SQLAlchemy-loaded objects.  However, as mentioned earlier, an object with a particular database identity is only allowed to exist uniquely within the current unit-of-work scope.  So, upon deserializing such an object, it has to "check in" with the current unit-of-work/identity map combination, to insure that it is the only unique instance.  This is achieved via the <span class="codeline">import_instance()</span> function in objectstore:</p>
    

<div class="code">
<pre><span class="python_comment"># deserialize an object
</span><span class="python_name">myobj </span><span class="python_operator">= </span><span class="python_name">pickle</span><span class="python_operator">.</span><span class="python_name">loads</span><span class="python_enclosure">(</span><span class="python_name">mystring</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># "import" it.  if the objectstore already had this object in the 
# identity map, then you get back the one from the current session.
</span><span class="python_name">myobj </span><span class="python_operator">= </span><span class="python_name">objectstore</span><span class="python_operator">.</span><span class="python_name">import_instance</span><span class="python_enclosure">(</span><span class="python_name">myobj</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre></div>

<p>Note that the import_instance() function will either mark the deserialized object as the official copy in the current identity map, which includes updating its _instance_key with the current application's class instance, or it will discard it and return the corresponding object that was already present.</p>
    
    </div>


    <a href="#unitofwork" class="toclink">back to section top</a>


</div>


        



<A name="unitofwork_advscope"></a>

<div class="subsection" style="margin-left:20px;">

    <span class="sectionheadertext">Advanced UnitOfWork Management</span>
    <div class="sectiontext">



    
			

    
			

    
			
    
    
    </div>

        



<A name="unitofwork_advscope_object"></a>

<div class="subsection" style="margin-left:30px;">

    <span class="sectionheadertext">Per-Object Sessions</span>
    <div class="sectiontext">


    <p><b>status</b> - 'using' function not yet released</p>
    <p>Sessions can be created on an ad-hoc basis and used for individual groups of objects and operations.  This has the effect of bypassing the entire "global"/"threadlocal" UnitOfWork system and explicitly using a particular Session:</p>
    

<div class="code">
<pre><span class="python_comment"># make a new Session with a global UnitOfWork
</span><span class="python_name">s </span><span class="python_operator">= </span><span class="python_name">objectstore</span><span class="python_operator">.</span><span class="python_name">Session</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_comment"># make objects bound to this Session
</span><span class="python_name">x </span><span class="python_operator">= </span><span class="python_name">MyObj</span><span class="python_enclosure">(</span><span class="python_name">_sa_session</span><span class="python_operator">=</span><span class="python_name">s</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># perform mapper operations bound to this Session
# (this function coming soon)
</span><span class="python_name">r </span><span class="python_operator">= </span><span class="python_name">MyObj</span><span class="python_operator">.</span><span class="python_name">mapper</span><span class="python_operator">.</span><span class="python_name">using</span><span class="python_enclosure">(</span><span class="python_name">s</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">select_by</span><span class="python_enclosure">(</span><span class="python_name">id</span><span class="python_operator">=</span><span class="python_number">12</span><span class="python_enclosure">)</span><span class="python_operator">
    </span>
<span class="python_comment"># get the session that corresponds to an instance
</span><span class="python_name">s </span><span class="python_operator">= </span><span class="python_name">objectstore</span><span class="python_operator">.</span><span class="python_name">get_session</span><span class="python_enclosure">(</span><span class="python_name">x</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># commit 
</span><span class="python_name">s</span><span class="python_operator">.</span><span class="python_name">commit</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_comment"># perform a block of operations with this session set within the current scope
</span><span class="python_name">objectstore</span><span class="python_operator">.</span><span class="python_name">push_session</span><span class="python_enclosure">(</span><span class="python_name">s</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_keyword">try</span><span class="python_operator">:
    </span><span class="python_name">r </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_operator">.</span><span class="python_name">select_by</span><span class="python_enclosure">(</span><span class="python_name">id</span><span class="python_operator">=</span><span class="python_number">12</span><span class="python_enclosure">)</span><span class="python_operator">
    </span><span class="python_name">x </span><span class="python_operator">= </span><span class="python_name">new MyObj</span><span class="python_enclosure">()</span><span class="python_operator">
    </span><span class="python_name">objectstore</span><span class="python_operator">.</span><span class="python_name">commit</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_keyword">finally</span><span class="python_operator">:
    </span><span class="python_name">objectstore</span><span class="python_operator">.</span><span class="python_name">pop_session</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre></div>

    
    </div>


    <a href="#unitofwork" class="toclink">back to section top</a>


</div>


        



<A name="unitofwork_advscope_scope"></a>

<div class="subsection" style="margin-left:30px;">

    <span class="sectionheadertext">Custom Session Objects/Custom Scopes</span>
    <div class="sectiontext">



    <p>For users who want to make their own Session subclass, or replace the algorithm used to return scoped Session objects (i.e. the objectstore.get_session() method):</p>
    

<div class="code">
<pre><span class="python_comment"># make a new Session
</span><span class="python_name">s </span><span class="python_operator">= </span><span class="python_name">objectstore</span><span class="python_operator">.</span><span class="python_name">Session</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_comment"># set it as the current thread-local session
</span><span class="python_name">objectstore</span><span class="python_operator">.</span><span class="python_name">session_registry</span><span class="python_operator">.</span><span class="python_name">set</span><span class="python_enclosure">(</span><span class="python_name">s</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># set the objectstore's session registry to a different algorithm
</span>
<span class="python_keyword">def </span><span class="python_name">create_session</span><span class="python_enclosure">()</span><span class="python_operator">:
    </span><span class="python_literal">"""creates new sessions"""</span><span class="python_operator">
    </span><span class="python_keyword">return </span><span class="python_name">objectstore</span><span class="python_operator">.</span><span class="python_name">Session</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_keyword">def </span><span class="python_name">mykey</span><span class="python_enclosure">()</span><span class="python_operator">:
    </span><span class="python_literal">"""creates contextual keys to store scoped sessions"""</span><span class="python_operator">
    </span><span class="python_keyword">return </span><span class="python_literal">"mykey"</span><span class="python_operator">
    </span>
<span class="python_operator"></span><span class="python_name">objectstore</span><span class="python_operator">.</span><span class="python_name">session_registry </span><span class="python_operator">= </span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">util</span><span class="python_operator">.</span><span class="python_name">ScopedRegistry</span><span class="python_enclosure">(</span><span class="python_name">createfunc</span><span class="python_operator">=</span><span class="python_name">create_session</span><span class="python_operator">, </span><span class="python_name">scopefunc</span><span class="python_operator">=</span><span class="python_name">mykey</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre></div>

    
    </div>


    <a href="#unitofwork" class="toclink">back to section top</a>


</div>


        



<A name="unitofwork_advscope_logging"></a>

<div class="subsection" style="margin-left:30px;">

    <span class="sectionheadertext">Analyzing Object Commits</span>
    <div class="sectiontext">


    <p>The objectstore module can log an extensive display of its "commit plans", which is a graph of its internal representation of objects before they are committed to the database.  To turn this logging on:
    

<div class="code">
<pre><span class="python_comment"># make an engine with echo_uow
</span><span class="python_name">engine </span><span class="python_operator">= </span><span class="python_name">create_engine</span><span class="python_enclosure">(</span><span class="python_literal">'myengine...'</span><span class="python_operator">, </span><span class="python_name">echo_uow</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># globally turn on echo
</span><span class="python_name">objectstore</span><span class="python_operator">.</span><span class="python_name">LOG </span><span class="python_operator">= </span><span class="python_name">True</span><span class="python_operator"></span></pre></div>

    <p>Commits will then dump to the standard output displays like the following:</p>
    

<div class="code">
<pre>Task dump:
 UOWTask(6034768) 'User/users/6015696'
  |
  |- Save elements
  |- Save: UOWTaskElement(6034800): User(6016624) (save)
  |
  |- Save dependencies
  |- UOWDependencyProcessor(6035024) 'addresses' attribute on saved User's (UOWTask(6034768) 'User/users/6015696')
  |       |-UOWTaskElement(6034800): User(6016624) (save)
  |
  |- Delete dependencies
  |- UOWDependencyProcessor(6035056) 'addresses' attribute on User's to be deleted (UOWTask(6034768) 'User/users/6015696')
  |       |-(no objects)
  |
  |- Child tasks
  |- UOWTask(6034832) 'Address/email_addresses/6015344'
  |   |
  |   |- Save elements
  |   |- Save: UOWTaskElement(6034864): Address(6034384) (save)
  |   |- Save: UOWTaskElement(6034896): Address(6034256) (save)
  |   |----
  | 
  |----</pre></div>

    <p>The above graph can be read straight downwards to determine the order of operations.  It indicates "save User 6016624, process each element in the 'addresses' list on User 6016624, save Address 6034384, Address 6034256".
    
    </div>


    <a href="#unitofwork" class="toclink">back to section top</a>


</div>





</div>




    <hr width="400px" align="left" />

</div>


		</div>
		<div class="section">
					
			<A name="adv_datamapping"></a>
			<div class="topnavmargin">
			
	
<div class="topnav">


	
	<div class="topnavcontrol">
	View: <a href="index.html">Paged</a> &nbsp;|&nbsp; <b>One Page</b>
	</div>



<div class="topnavsectionlink">

<a href="#top">Table of Contents</a>

<div class="prevnext">
Previous: <a href="#unitofwork">Unit of Work</a>

&nbsp; | &nbsp;


Next: <a href="#types">The Types System</a>

</div>
</div>


<div class="topnavmain">
	<div class="topnavheader">Advanced Data Mapping</div>
	<div class="topnavitems">
	


    
    
    <div class="toclink">
        <A style="" href="#adv_datamapping_relations">More On Relations</a>
    </div>
    
    <div class="toclinkcontainer">
        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#adv_datamapping_relations_customjoin">Custom Join Conditions</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#adv_datamapping_relations_multiplejoin">Lazy/Eager Joins Multiple Times to One Table</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#adv_datamapping_relations_relationoptions">Relation Options</a>
    </div>

    </div>


    </div>


    
    
    <div class="toclink">
        <A style="" href="#adv_datamapping_orderby">Controlling Ordering</a>
    </div>
    
    <div class="toclinkcontainer">
    </div>


    
    
    <div class="toclink">
        <A style="" href="#adv_datamapping_limits">Limiting Rows</a>
    </div>
    
    <div class="toclinkcontainer">
    </div>


    
    
    <div class="toclink">
        <A style="" href="#adv_datamapping_colname">Overriding Column Names</a>
    </div>
    
    <div class="toclinkcontainer">
    </div>


    
    
    <div class="toclink">
        <A style="" href="#adv_datamapping_deferred">Deferred Column Loading</a>
    </div>
    
    <div class="toclinkcontainer">
    </div>


    
    
    <div class="toclink">
        <A style="" href="#adv_datamapping_options">More on Mapper Options</a>
    </div>
    
    <div class="toclinkcontainer">
    </div>


    
    
    <div class="toclink">
        <A style="" href="#adv_datamapping_inheritance">Mapping a Class with Table Inheritance</a>
    </div>
    
    <div class="toclinkcontainer">
    </div>


    
    
    <div class="toclink">
        <A style="" href="#adv_datamapping_joins">Mapping a Class against Multiple Tables</a>
    </div>
    
    <div class="toclinkcontainer">
    </div>


    
    
    <div class="toclink">
        <A style="" href="#adv_datamapping_selects">Mapping a Class against Arbitary Selects</a>
    </div>
    
    <div class="toclinkcontainer">
    </div>


    
    
    <div class="toclink">
        <A style="" href="#adv_datamapping_multiple">Multiple Mappers for One Class</a>
    </div>
    
    <div class="toclinkcontainer">
    </div>


    
    
    <div class="toclink">
        <A style="" href="#adv_datamapping_circular">Circular Mapping</a>
    </div>
    
    <div class="toclinkcontainer">
    </div>


    
    
    <div class="toclink">
        <A style="" href="#adv_datamapping_recursive">Self Referential Mappers</a>
    </div>
    
    <div class="toclinkcontainer">
    </div>


    
    
    <div class="toclink">
        <A style="" href="#adv_datamapping_resultset">Result-Set Mapping</a>
    </div>
    
    <div class="toclinkcontainer">
    </div>


    
    
    <div class="toclink">
        <A style="" href="#adv_datamapping_extending">Extending Mapper</a>
    </div>
    
    <div class="toclinkcontainer">
    </div>


    
    
    <div class="toclink">
        <A style="" href="#adv_datamapping_class">How Mapper Modifies Mapped Classes</a>
    </div>
    
    <div class="toclinkcontainer">
    </div>



	</div>
</div>

</div>

			</div>

			




<div class="subsection" style="margin-left:10px;">

    <div class="sectiontext">


<p>This section details all the options available to Mappers, as well as advanced patterns.</p>

<p>To start, heres the tables we will work with again:</p>
       

<div class="code">
<pre><span class="python_keyword">from </span><span class="python_name">sqlalchemy </span><span class="python_keyword">import </span><span class="python_operator">*
</span><span class="python_name">db </span><span class="python_operator">= </span><span class="python_name">create_engine</span><span class="python_enclosure">(</span><span class="python_literal">'sqlite://filename=mydb'</span><span class="python_operator">, </span><span class="python_name">echo</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># a table to store users
</span><span class="python_name">users </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'users'</span><span class="python_operator">, </span><span class="python_name">db</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'user_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key </span><span class="python_operator">= </span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'user_name'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">40</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'password'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">80</span><span class="python_enclosure">))</span>
<span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># a table that stores mailing addresses associated with a specific user
</span><span class="python_name">addresses </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'addresses'</span><span class="python_operator">, </span><span class="python_name">db</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'address_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key </span><span class="python_operator">= </span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'user_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">ForeignKey</span><span class="python_enclosure">(</span><span class="python_literal">"users.user_id"</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'street'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">100</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'city'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">80</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'state'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">2</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'zip'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">10</span><span class="python_enclosure">))</span>
<span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># a table that stores keywords
</span><span class="python_name">keywords </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'keywords'</span><span class="python_operator">, </span><span class="python_name">db</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'keyword_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key </span><span class="python_operator">= </span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'name'</span><span class="python_operator">, </span><span class="python_name">VARCHAR</span><span class="python_enclosure">(</span><span class="python_number">50</span><span class="python_enclosure">))</span>
<span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># a table that associates keywords with users
</span><span class="python_name">userkeywords </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'userkeywords'</span><span class="python_operator">, </span><span class="python_name">db</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'user_id'</span><span class="python_operator">, </span><span class="python_name">INT</span><span class="python_operator">, </span><span class="python_name">ForeignKey</span><span class="python_enclosure">(</span><span class="python_literal">"users"</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'keyword_id'</span><span class="python_operator">, </span><span class="python_name">INT</span><span class="python_operator">, </span><span class="python_name">ForeignKey</span><span class="python_enclosure">(</span><span class="python_literal">"keywords"</span><span class="python_enclosure">))</span>
<span class="python_enclosure">)</span><span class="python_operator"></span></pre></div>



			

			

			

			

			

			



			


			

			

			

			

			

			


			

			

    </div>

        



<A name="adv_datamapping_relations"></a>

<div class="subsection" style="margin-left:20px;">

    <span class="sectionheadertext">More On Relations</span>
    <div class="sectiontext">


    
			
    
			

    
			


    </div>

        



<A name="adv_datamapping_relations_customjoin"></a>

<div class="subsection" style="margin-left:30px;">

    <span class="sectionheadertext">Custom Join Conditions</span>
    <div class="sectiontext">


        <p>When creating relations on a mapper, most examples so far have illustrated the mapper and relationship joining up based on the foreign keys of the tables they represent.  in fact, this "automatic" inspection can be completely circumvented using the <span class="codeline">primaryjoin</span> and <span class="codeline">secondaryjoin</span> arguments to <span class="codeline">relation</span>, as in this example which creates a User object which has a relationship to all of its Addresses which are in Boston:
        

<div class="code">
<pre><span class="python_keyword">class </span><span class="python_name">User</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">pass</span><span class="python_operator">
</span><span class="python_keyword">class </span><span class="python_name">Address</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">pass</span><span class="python_operator">
</span><span class="python_name">Address</span><span class="python_operator">.</span><span class="python_name">mapper </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_operator">, </span><span class="python_name">addresses</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">User</span><span class="python_operator">.</span><span class="python_name">mapper </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">, </span><span class="python_name">properties</span><span class="python_operator">=</span><span class="python_enclosure">{</span>
    <span class="python_literal">'boston_addreses' </span><span class="python_operator">: </span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_operator">.</span><span class="python_name">mapper</span><span class="python_operator">, </span><span class="python_name">primaryjoin</span><span class="python_operator">=</span>
                <span class="python_name">and_</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">==</span><span class="python_name">Address</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">, </span>
                <span class="python_name">Addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">city</span><span class="python_operator">==</span><span class="python_literal">'Boston'</span><span class="python_enclosure">))</span>
<span class="python_enclosure">})</span><span class="python_operator"></span></pre></div>

        <P>Many to many relationships can be customized by one or both of <span class="codeline">primaryjoin</span> and <span class="codeline">secondaryjoin</span>, shown below with just the default many-to-many relationship explicitly set:</p>
        

<div class="code">
<pre><span class="python_keyword">class </span><span class="python_name">User</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">pass</span><span class="python_operator">
</span><span class="python_keyword">class </span><span class="python_name">Keyword</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">pass</span><span class="python_operator">
</span><span class="python_name">Keyword</span><span class="python_operator">.</span><span class="python_name">mapper </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Keyword</span><span class="python_operator">, </span><span class="python_name">keywords</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">User</span><span class="python_operator">.</span><span class="python_name">mapper </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">, </span><span class="python_name">properties</span><span class="python_operator">=</span><span class="python_enclosure">{</span>
    <span class="python_literal">'keywords'</span><span class="python_operator">:</span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">Keyword</span><span class="python_operator">.</span><span class="python_name">mapper</span><span class="python_operator">, </span>
        <span class="python_name">primaryjoin</span><span class="python_operator">=</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">==</span><span class="python_name">userkeywords</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">,</span>
        <span class="python_name">secondaryjoin</span><span class="python_operator">=</span><span class="python_name">userkeywords</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">keyword_id</span><span class="python_operator">==</span><span class="python_name">keywords</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">keyword_id</span>
        <span class="python_enclosure">)</span>
<span class="python_enclosure">})</span><span class="python_operator"></span></pre></div>

    
    </div>


    <a href="#adv_datamapping" class="toclink">back to section top</a>


</div>


        



<A name="adv_datamapping_relations_multiplejoin"></a>

<div class="subsection" style="margin-left:30px;">

    <span class="sectionheadertext">Lazy/Eager Joins Multiple Times to One Table</span>
    <div class="sectiontext">



        <p>The previous example leads in to the idea of joining against the same table multiple times.  Below is a User object that has lists of its Boston and New York addresses, both lazily loaded when they are first accessed:</p>
        

<div class="code">
<pre><span class="python_name">User</span><span class="python_operator">.</span><span class="python_name">mapper </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">, </span><span class="python_name">properties</span><span class="python_operator">=</span><span class="python_enclosure">{</span>
    <span class="python_literal">'boston_addreses' </span><span class="python_operator">: </span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_operator">.</span><span class="python_name">mapper</span><span class="python_operator">, </span><span class="python_name">primaryjoin</span><span class="python_operator">=</span>
                <span class="python_name">and_</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">==</span><span class="python_name">Address</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">, </span>
                <span class="python_name">Addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">city</span><span class="python_operator">==</span><span class="python_literal">'Boston'</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
    <span class="python_literal">'newyork_addresses' </span><span class="python_operator">: </span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_operator">.</span><span class="python_name">mapper</span><span class="python_operator">, </span><span class="python_name">primaryjoin</span><span class="python_operator">=</span>
                <span class="python_name">and_</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">==</span><span class="python_name">Address</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">, </span>
                <span class="python_name">Addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">city</span><span class="python_operator">==</span><span class="python_literal">'New York'</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
<span class="python_enclosure">})</span><span class="python_operator"></span></pre></div>

        <p>A complication arises with the above pattern if you want the relations to be eager loaded.  Since there will be two separate joins to the addresses table during an eager load, an alias needs to be used to separate them.  You can create an alias of the addresses table to separate them, but then you are in effect creating a brand new mapper for each property, unrelated to the main Address mapper, which can create problems with commit operations.  So an additional argument <span class="codeline">use_alias</span> can be used with an eager relationship to specify the alias to be used just within the eager query:</p>
        

<div class="code">
<pre><span class="python_name">User</span><span class="python_operator">.</span><span class="python_name">mapper </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">, </span><span class="python_name">properties</span><span class="python_operator">=</span><span class="python_enclosure">{</span>
    <span class="python_literal">'boston_addreses' </span><span class="python_operator">: </span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_operator">.</span><span class="python_name">mapper</span><span class="python_operator">, </span><span class="python_name">primaryjoin</span><span class="python_operator">=</span>
                <span class="python_name">and_</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">==</span><span class="python_name">Address</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">, </span>
                <span class="python_name">Addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">city</span><span class="python_operator">==</span><span class="python_literal">'Boston'</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">lazy</span><span class="python_operator">=</span><span class="python_name">False</span><span class="python_operator">, </span><span class="python_name">use_alias</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_literal">'newyork_addresses' </span><span class="python_operator">: </span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_operator">.</span><span class="python_name">mapper</span><span class="python_operator">, </span><span class="python_name">primaryjoin</span><span class="python_operator">=</span>
                <span class="python_name">and_</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">==</span><span class="python_name">Address</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">, </span>
                <span class="python_name">Addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">city</span><span class="python_operator">==</span><span class="python_literal">'New York'</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">lazy</span><span class="python_operator">=</span><span class="python_name">False</span><span class="python_operator">, </span><span class="python_name">use_alias</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
<span class="python_enclosure">})</span><span class="python_operator">
</span>
<span class="python_literal"><a href="javascript:togglePopbox('popbox_81', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">u </span><span class="python_operator">= </span><span class="python_name">User</span><span class="python_operator">.</span><span class="python_name">mapper</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_81_div" class="codepop" style="display:none;">SELECT users.user_id AS users_user_id, users.user_name AS users_user_name, <br/>
        users.password AS users_password, <br/>
        addresses_EF45.address_id AS addresses_EF45_address_id, addresses_EF45.user_id AS addresses_EF45_user_id, <br/>
        addresses_EF45.street AS addresses_EF45_street, addresses_EF45.city AS addresses_EF45_city, <br/>
        addresses_EF45.state AS addresses_EF45_state, addresses_EF45.zip AS addresses_EF45_zip, <br/>
        addresses_63C5.address_id AS addresses_63C5_address_id, addresses_63C5.user_id AS addresses_63C5_user_id, <br/>
        addresses_63C5.street AS addresses_63C5_street, addresses_63C5.city AS addresses_63C5_city, <br/>
        addresses_63C5.state AS addresses_63C5_state, addresses_63C5.zip AS addresses_63C5_zip <br/>
        FROM users <br/>
        LEFT OUTER JOIN addresses AS addresses_EF45 ON users.user_id = addresses_EF45.user_id <br/>
        AND addresses_EF45.city = :addresses_city <br/>
        LEFT OUTER JOIN addresses AS addresses_63C5 ON users.user_id = addresses_63C5.user_id <br/>
        AND addresses_63C5.city = :addresses_city_1<br/>
        ORDER BY users.oid, addresses_EF45.oid, addresses_63C5.oid<br/>
        {'addresses_city_1': 'New York', 'addresses_city': 'Boston'}</div><pre><span class="python_operator"></span></pre></div>

    
    </div>


    <a href="#adv_datamapping" class="toclink">back to section top</a>


</div>


        



<A name="adv_datamapping_relations_relationoptions"></a>

<div class="subsection" style="margin-left:30px;">

    <span class="sectionheadertext">Relation Options</span>
    <div class="sectiontext">


    Keyword options to the <span class="codeline">relation</span> function include:
    <ul>
        <li>lazy=(True|False|None) - specifies how the related items should be loaded.  a value of True indicates they should be loaded when the property is first accessed.  A value of False indicates they should be loaded by joining against the parent object query, so parent and child are loaded in one round trip.  A value of None indicates the related items are not loaded by the mapper in any case; the application will manually insert items into the list in some other way.  A relationship with lazy=None is still important; items added to the list or removed will cause the appropriate updates and deletes upon commit().</li>
        <li>primaryjoin - a ClauseElement that will be used as the primary join of this child object against the parent object, or in a many-to-many relationship the join of the primary object to the association table.  By default, this value is computed based on the foreign key relationships of the parent and child tables (or association table).</li>
        <li>secondaryjoin - a ClauseElement that will be used as the join of an association table to the child object.  By default, this value is computed based on the foreign key relationships of the association and child tables.</li>
        <li>foreignkey - specifies which column in this relationship is "foreign", i.e. which column refers to the parent object.  This value is automatically determined in all cases, based on the primary and secondary join conditions, except in the case of a self-referential mapper, where it is needed to indicate the child object's reference back to it's parent.</li>
        <li>uselist - a boolean that indicates if this property should be loaded as a list or a scalar.  In most cases, this value is determined based on the type and direction of the relationship - one to many forms a list, one to one forms a scalar, many to many is a list.  If a scalar is desired where normally a list would be present, set uselist to False.</li>
        <li>private - indicates if these child objects are "private" to the parent; removed items will also be deleted, and if the parent item is deleted, all child objects are deleted as well.  See the example in <a href="#datamapping_relations_private" >Useful Feature: Private Relations</a>.</li>
        <li>backreference - indicates the name of a property to be placed on the related mapper's class that will handle this relationship in the other direction, including synchronizing the object attributes on both sides of the relation.  See the example in <a href="#datamapping_relations_backreferences" >Useful Feature: Backreferences</a>.</li>
        <li>order_by - indicates the ordering that should be applied when loading these items.  See the section <a href="#adv_datamapping_orderby" >Controlling Ordering</a> for details.</li>
        <li>association - When specifying a many to many relationship with an association object, this keyword should reference the mapper of the target object of the association.  See the example in <a href="#datamapping_association" >Association Object</a>.</li>
        <li>post_update - this indicates that the relationship should be handled by a second UPDATE statement after an INSERT, or before a DELETE.  using this flag essentially means the relationship will not incur any "dependency" between parent and child item, as the particular foreign key relationship between them is handled by a second statement.  use this flag when a particular mapping arrangement will incur two rows that are dependent on each other, such as a table that has a one-to-many relationship to a set of child rows, and also has a column that references a single child row within that list (i.e. both tables contain a foreign key to each other).  If a commit() operation returns an error that a "cyclical dependency" was detected, this is a cue that you might want to use post_update.</li>
    </ul>
    
    </div>


    <a href="#adv_datamapping" class="toclink">back to section top</a>


</div>





</div>


        



<A name="adv_datamapping_orderby"></a>

<div class="subsection" style="margin-left:20px;">

    <span class="sectionheadertext">Controlling Ordering</span>
    <div class="sectiontext">


<p>By default, mappers will not supply any ORDER BY clause when selecting rows.  This can be modified in several ways.</p>

<p>A "default ordering" can be supplied by all mappers, by enabling the "default_ordering" flag to the engine, which indicates that table primary keys or object IDs should be used as the default ordering:</p>


<div class="code">
<pre><span class="python_name">db </span><span class="python_operator">= </span><span class="python_name">create_engine</span><span class="python_enclosure">(</span><span class="python_literal">'postgres://username=scott&password=tiger'</span><span class="python_operator">, </span><span class="python_name">default_ordering</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre></div>

<p>The "order_by" parameter can be sent to a mapper, overriding the per-engine ordering if any.  A value of None means that the mapper should not use any ordering, even if the engine's default_ordering property is True.  A non-None value, which can be a column, an <span class="codeline">asc</span> or <span class="codeline">desc</span> clause, or an array of either one, indicates the ORDER BY clause that should be added to all select queries:</p>


<div class="code">
<pre><span class="python_comment"># disable all ordering
</span><span class="python_name">mapper </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">, </span><span class="python_name">order_by</span><span class="python_operator">=</span><span class="python_name">None</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># order by a column
</span><span class="python_name">mapper </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">, </span><span class="python_name">order_by</span><span class="python_operator">=</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># order by multiple items
</span><span class="python_name">mapper </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">, </span><span class="python_name">order_by</span><span class="python_operator">=</span><span class="python_enclosure">[</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">, </span><span class="python_name">desc</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_enclosure">)])</span><span class="python_operator"></span></pre></div>

<p>"order_by" can also be specified to an individual <span class="codeline">select</span> method, overriding all other per-engine/per-mapper orderings:


<div class="code">
<pre><span class="python_comment"># order by a column
</span><span class="python_name">l </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator">==</span><span class="python_literal">'fred'</span><span class="python_operator">, </span><span class="python_name">order_by</span><span class="python_operator">=</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># order by multiple criterion
</span><span class="python_name">l </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator">==</span><span class="python_literal">'fred'</span><span class="python_operator">, </span><span class="python_name">order_by</span><span class="python_operator">=</span><span class="python_enclosure">[</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">, </span><span class="python_name">desc</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_enclosure">)])</span><span class="python_operator"></span></pre></div>

<p>For relations, the "order_by" property can also be specified to all forms of relation:</p>


<div class="code">
<pre><span class="python_comment"># order address objects by address id
</span><span class="python_name">mapper </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">, </span><span class="python_name">properties </span><span class="python_operator">= </span><span class="python_enclosure">{</span>
    <span class="python_literal">'addresses' </span><span class="python_operator">: </span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_operator">, </span><span class="python_name">addresses</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">order_by</span><span class="python_operator">=</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">address_id</span><span class="python_enclosure">)</span>
<span class="python_enclosure">})</span><span class="python_operator">
</span>
<span class="python_comment"># eager load with ordering - the ORDER BY clauses of parent/child will be organized properly
</span><span class="python_name">mapper </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">, </span><span class="python_name">properties </span><span class="python_operator">= </span><span class="python_enclosure">{</span>
    <span class="python_literal">'addresses' </span><span class="python_operator">: </span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_operator">, </span><span class="python_name">addresses</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">order_by</span><span class="python_operator">=</span><span class="python_name">desc</span><span class="python_enclosure">(</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">email_address</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">eager</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span>
<span class="python_enclosure">}</span><span class="python_operator">, </span><span class="python_name">order_by</span><span class="python_operator">=</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre></div>


    </div>


    <a href="#adv_datamapping" class="toclink">back to section top</a>


</div>


        



<A name="adv_datamapping_limits"></a>

<div class="subsection" style="margin-left:20px;">

    <span class="sectionheadertext">Limiting Rows</span>
    <div class="sectiontext">


<p>You can limit rows in a regular SQL query by specifying <span class="codeline">limit</span> and <span class="codeline">offset</span>.  A Mapper can handle the same concepts:</p>


<div class="code">
<pre><span class="python_keyword">class </span><span class="python_name">User</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">pass</span><span class="python_operator">
</span>
<span class="python_operator"></span><span class="python_name">m </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_82', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">r </span><span class="python_operator">= </span><span class="python_name">m</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">limit</span><span class="python_operator">=</span><span class="python_number">20</span><span class="python_operator">, </span><span class="python_name">offset</span><span class="python_operator">=</span><span class="python_number">10</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre><div id="popbox_82_div" class="codepop" style="display:none;">SELECT users.user_id AS users_user_id, <br/>
users.user_name AS users_user_name, users.password AS users_password <br/>
FROM users ORDER BY users.oid <br/>
 LIMIT 20 OFFSET 10<br/>
{}</div><pre><span class="python_operator"></span></pre></div>

However, things get tricky when dealing with eager relationships, since a straight LIMIT of rows does not represent the count of items when joining against other tables to load related items as well.  So here is what SQLAlchemy will do when you use limit or offset with an eager relationship:
    

<div class="code">
<pre><span class="python_keyword">class </span><span class="python_name">User</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">pass</span><span class="python_operator">
</span><span class="python_keyword">class </span><span class="python_name">Address</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">pass</span><span class="python_operator">
</span><span class="python_name">m </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">, </span><span class="python_name">properties</span><span class="python_operator">=</span><span class="python_enclosure">{</span>
    <span class="python_literal">'addresses' </span><span class="python_operator">: </span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_operator">, </span><span class="python_name">addresses</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">lazy</span><span class="python_operator">=</span><span class="python_name">False</span><span class="python_enclosure">)</span>
<span class="python_enclosure">})</span><span class="python_operator">
</span><span class="python_name">r </span><span class="python_operator">= </span><span class="python_name">m</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator">.</span><span class="python_name">like</span><span class="python_enclosure">(</span><span class="python_literal">'F%'</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">limit</span><span class="python_operator">=</span><span class="python_number">20</span><span class="python_operator">, </span><span class="python_name">offset</span><span class="python_operator">=</span><span class="python_number">10</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre><div class="codepop">SELECT users.user_id AS users_user_id, users.user_name AS users_user_name, <br/>
users.password AS users_password, addresses.address_id AS addresses_address_id, <br/>
addresses.user_id AS addresses_user_id, addresses.street AS addresses_street, <br/>
addresses.city AS addresses_city, addresses.state AS addresses_state, <br/>
addresses.zip AS addresses_zip <br/>
FROM <br/>
(SELECT users.user_id FROM users WHERE users.user_name LIKE %(users_user_name)s<br/>
ORDER BY users.oid LIMIT 20 OFFSET 10) AS rowcount, <br/>
 users LEFT OUTER JOIN addresses ON users.user_id = addresses.user_id <br/>
WHERE rowcount.user_id = users.user_id ORDER BY users.oid, addresses.oid<br/>
{'users_user_name': 'F%'}</div><pre><span class="python_operator"></span></pre></div>

    <p>The main WHERE clause as well as the limiting clauses are coerced into a subquery; this subquery represents the desired result of objects.  A containing query, which handles the eager relationships, is joined against the subquery to produce the result.</p>

    </div>


    <a href="#adv_datamapping" class="toclink">back to section top</a>


</div>


        



<A name="adv_datamapping_colname"></a>

<div class="subsection" style="margin-left:20px;">

    <span class="sectionheadertext">Overriding Column Names</span>
    <div class="sectiontext">


<p>When mappers are constructed, by default the column names in the Table metadata are used as the names of attributes on the mapped class.  This can be customzed within the properties by stating the key/column combinations explicitly:</p>


<div class="code">
<pre><span class="python_name">user_mapper </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">, </span><span class="python_name">properties</span><span class="python_operator">=</span><span class="python_enclosure">{</span>
    <span class="python_literal">'id' </span><span class="python_operator">: </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">,</span>
    <span class="python_literal">'name' </span><span class="python_operator">: </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator">,</span>
<span class="python_enclosure">})</span><span class="python_operator"></span></pre></div>

<p>In the situation when column names overlap in a mapper against multiple tables, columns may be referenced together with a list:


<div class="code">
<pre><span class="python_comment"># join users and addresses
</span><span class="python_name">usersaddresses </span><span class="python_operator">= </span><span class="python_name">sql</span><span class="python_operator">.</span><span class="python_name">join</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">, </span><span class="python_name">addresses</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id </span><span class="python_operator">== </span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">m </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">usersaddresses</span><span class="python_operator">,   </span>
    <span class="python_name">properties </span><span class="python_operator">= </span><span class="python_enclosure">{</span>
        <span class="python_literal">'id' </span><span class="python_operator">: </span><span class="python_enclosure">[</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">, </span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_enclosure">]</span><span class="python_operator">,</span>
    <span class="python_enclosure">}</span>
    <span class="python_enclosure">)</span><span class="python_operator"></span></pre></div>


    </div>


    <a href="#adv_datamapping" class="toclink">back to section top</a>


</div>


        



<A name="adv_datamapping_deferred"></a>

<div class="subsection" style="margin-left:20px;">

    <span class="sectionheadertext">Deferred Column Loading</span>
    <div class="sectiontext">


<p>This feature allows particular columns of a table to not be loaded by default, instead being loaded later on when first referenced.  It is essentailly "column-level lazy loading".   This feature is useful when one wants to avoid loading a large text or binary field into memory when its not needed.  Individual columns can be lazy loaded by themselves or placed into groups that lazy-load together.</p>


<div class="code">
<pre><span class="python_name">book_excerpts </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'books'</span><span class="python_operator">, </span><span class="python_name">db</span><span class="python_operator">, </span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'book_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'title'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">200</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">nullable</span><span class="python_operator">=</span><span class="python_name">False</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'summary'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">2000</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'excerpt'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'photo'</span><span class="python_operator">, </span><span class="python_name">Binary</span><span class="python_enclosure">)</span>
<span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_keyword">class </span><span class="python_name">Book</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">pass</span><span class="python_operator">
</span>
<span class="python_comment"># define a mapper that will load each of 'excerpt' and 'photo' in 
# separate, individual-row SELECT statements when each attribute
# is first referenced on the individual object instance
</span><span class="python_operator"></span><span class="python_name">book_mapper </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Book</span><span class="python_operator">, </span><span class="python_name">book_excerpts</span><span class="python_operator">, </span><span class="python_name">properties </span><span class="python_operator">= </span><span class="python_enclosure">{</span>
    <span class="python_literal">'excerpt' </span><span class="python_operator">: </span><span class="python_name">deferred</span><span class="python_enclosure">(</span><span class="python_name">book_excerpts</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">excerpt</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_literal">'photo' </span><span class="python_operator">: </span><span class="python_name">deferred</span><span class="python_enclosure">(</span><span class="python_name">book_excerpts</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">photo</span><span class="python_enclosure">)</span>
<span class="python_enclosure">})</span><span class="python_operator"></span></pre></div>

<p>Deferred columns can be placed into groups so that they load together:</p>


<div class="code">
<pre><span class="python_name">book_excerpts </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'books'</span><span class="python_operator">, </span><span class="python_name">db</span><span class="python_operator">, </span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'book_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'title'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">200</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">nullable</span><span class="python_operator">=</span><span class="python_name">False</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'summary'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">2000</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'excerpt'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'photo1'</span><span class="python_operator">, </span><span class="python_name">Binary</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'photo2'</span><span class="python_operator">, </span><span class="python_name">Binary</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'photo3'</span><span class="python_operator">, </span><span class="python_name">Binary</span><span class="python_enclosure">)</span>
<span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_keyword">class </span><span class="python_name">Book</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">pass</span><span class="python_operator">
</span>
<span class="python_comment"># define a mapper with a 'photos' deferred group.  when one photo is referenced,
# all three photos will be loaded in one SELECT statement.  The 'excerpt' will 
# be loaded separately when it is first referenced.
</span><span class="python_operator"></span><span class="python_name">book_mapper </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Book</span><span class="python_operator">, </span><span class="python_name">book_excerpts</span><span class="python_operator">, </span><span class="python_name">properties </span><span class="python_operator">= </span><span class="python_enclosure">{</span>
    <span class="python_literal">'excerpt' </span><span class="python_operator">: </span><span class="python_name">deferred</span><span class="python_enclosure">(</span><span class="python_name">book_excerpts</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">excerpt</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_literal">'photo1' </span><span class="python_operator">: </span><span class="python_name">deferred</span><span class="python_enclosure">(</span><span class="python_name">book_excerpts</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">photo1</span><span class="python_operator">, </span><span class="python_name">group</span><span class="python_operator">=</span><span class="python_literal">'photos'</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_literal">'photo2' </span><span class="python_operator">: </span><span class="python_name">deferred</span><span class="python_enclosure">(</span><span class="python_name">book_excerpts</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">photo2</span><span class="python_operator">, </span><span class="python_name">group</span><span class="python_operator">=</span><span class="python_literal">'photos'</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_literal">'photo3' </span><span class="python_operator">: </span><span class="python_name">deferred</span><span class="python_enclosure">(</span><span class="python_name">book_excerpts</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">photo3</span><span class="python_operator">, </span><span class="python_name">group</span><span class="python_operator">=</span><span class="python_literal">'photos'</span><span class="python_enclosure">)</span>
<span class="python_enclosure">})</span><span class="python_operator"></span></pre></div>


    </div>


    <a href="#adv_datamapping" class="toclink">back to section top</a>


</div>


        



<A name="adv_datamapping_options"></a>

<div class="subsection" style="margin-left:20px;">

    <span class="sectionheadertext">More on Mapper Options</span>
    <div class="sectiontext">


    <p>The <span class="codeline">options</span> method of mapper, first introduced in <a href="#datamapping_relations_options" >Switching Lazy/Eager, No Load</a>, supports the copying of a mapper into a new one, with any number of its relations replaced by new ones.  The method takes a variable number of <span class="codeline">MapperOption</span> objects which know how to change specific things about the mapper.  The five available options are <span class="codeline">eagerload</span>, <span class="codeline">lazyload</span>, <span class="codeline">noload</span>, <span class="codeline">deferred</span> and <span class="codeline">extension</span>.</p>
    <P>An example of a mapper with a lazy load relationship, upgraded to an eager load relationship:
        

<div class="code">
<pre><span class="python_keyword">class </span><span class="python_name">User</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">pass</span><span class="python_operator">
</span><span class="python_keyword">class </span><span class="python_name">Address</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">pass</span><span class="python_operator">
</span>
<span class="python_comment"># a 'lazy' relationship
</span><span class="python_operator"></span><span class="python_name">User</span><span class="python_operator">.</span><span class="python_name">mapper </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">, </span><span class="python_name">properties </span><span class="python_operator">= </span><span class="python_enclosure">{</span>
    <span class="python_literal">'addreses'</span><span class="python_operator">:</span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_operator">, </span><span class="python_name">addresses</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">lazy</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span>
<span class="python_enclosure">})</span><span class="python_operator">
    </span>
<span class="python_comment"># copy the mapper and convert 'addresses' to be eager
</span><span class="python_name">eagermapper </span><span class="python_operator">= </span><span class="python_name">User</span><span class="python_operator">.</span><span class="python_name">mapper</span><span class="python_operator">.</span><span class="python_name">options</span><span class="python_enclosure">(</span><span class="python_name">eagerload</span><span class="python_enclosure">(</span><span class="python_literal">'addresses'</span><span class="python_enclosure">))</span><span class="python_operator"></span></pre></div>

    
    <p>The load options also can take keyword arguments that apply to the new relationship.  To take the "double" address lazy relationship from the previous section and upgrade it to eager, adding the "selectalias" keywords as well:</p>
    

<div class="code">
<pre><span class="python_name">m </span><span class="python_operator">= </span><span class="python_name">User</span><span class="python_operator">.</span><span class="python_name">mapper</span><span class="python_operator">.</span><span class="python_name">options</span><span class="python_enclosure">(</span>
        <span class="python_name">eagerload</span><span class="python_enclosure">(</span><span class="python_literal">'boston_addresses'</span><span class="python_operator">, </span><span class="python_name">selectalias</span><span class="python_operator">=</span><span class="python_literal">'boston_ad'</span><span class="python_enclosure">)</span><span class="python_operator">, </span>
        <span class="python_name">eagerload</span><span class="python_enclosure">(</span><span class="python_literal">'newyork_addresses'</span><span class="python_operator">, </span><span class="python_name">selectalias</span><span class="python_operator">=</span><span class="python_literal">'newyork_ad'</span><span class="python_enclosure">)</span>
    <span class="python_enclosure">)</span><span class="python_operator"></span></pre></div>

    <p>The <span class="codeline">defer</span> and <span class="codeline">undefer</span> options can control the deferred loading of attributes:</p>
    

<div class="code">
<pre><span class="python_comment"># set the 'excerpt' deferred attribute to load normally
</span><span class="python_name">m </span><span class="python_operator">= </span><span class="python_name">book_mapper</span><span class="python_operator">.</span><span class="python_name">options</span><span class="python_enclosure">(</span><span class="python_name">undefer</span><span class="python_enclosure">(</span><span class="python_literal">'excerpt'</span><span class="python_enclosure">))</span><span class="python_operator">
</span>
<span class="python_comment"># set the referenced mapper 'photos' to defer its loading of the column 'imagedata'
</span><span class="python_name">m </span><span class="python_operator">= </span><span class="python_name">book_mapper</span><span class="python_operator">.</span><span class="python_name">options</span><span class="python_enclosure">(</span><span class="python_name">defer</span><span class="python_enclosure">(</span><span class="python_literal">'photos.imagedata'</span><span class="python_enclosure">))</span><span class="python_operator"></span></pre></div>

    
     

    </div>


    <a href="#adv_datamapping" class="toclink">back to section top</a>


</div>


        



<A name="adv_datamapping_inheritance"></a>

<div class="subsection" style="margin-left:20px;">

    <span class="sectionheadertext">Mapping a Class with Table Inheritance</span>
    <div class="sectiontext">



    <p>Table Inheritance indicates the pattern where two tables, in a parent-child relationship, are mapped to an inheritance chain of classes.  If a table "employees" contains additional information about managers in the table "managers", a corresponding object inheritance pattern would have an Employee class and a Manager class.  Loading a Manager object means you are joining managers to employees.  For SQLAlchemy, this pattern is just a special case of a mapper that maps against a joined relationship, and is provided via the <span class="codeline">inherits</span> keyword.
    

<div class="code">
<pre><span class="python_keyword">class </span><span class="python_name">User</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_literal">"""a user object."""</span><span class="python_operator">
    </span><span class="python_keyword">pass</span><span class="python_operator">
</span><span class="python_name">User</span><span class="python_operator">.</span><span class="python_name">mapper </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_keyword">class </span><span class="python_name">AddressUser</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_literal">"""a user object that also has the users mailing address."""</span><span class="python_operator">
    </span><span class="python_keyword">pass</span><span class="python_operator">
</span>
<span class="python_comment"># define a mapper for AddressUser that inherits the User.mapper, and joins on the user_id column
</span><span class="python_operator"></span><span class="python_name">AddressUser</span><span class="python_operator">.</span><span class="python_name">mapper </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_enclosure">(</span>
<span class="python_name">AddressUser</span><span class="python_operator">,</span>
        <span class="python_name">addresses</span><span class="python_operator">, </span><span class="python_name">inherits</span><span class="python_operator">=</span><span class="python_name">User</span><span class="python_operator">.</span><span class="python_name">mapper</span>
        <span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_name">items </span><span class="python_operator">= </span><span class="python_name">AddressUser</span><span class="python_operator">.</span><span class="python_name">mapper</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre></div>

<P>Above, the join condition is determined via the foreign keys between the users and the addresses table.  To specify the join condition explicitly, use <span class="codeline">inherit_condition</span>:


<div class="code">
<pre><span class="python_name">AddressUser</span><span class="python_operator">.</span><span class="python_name">mapper </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_enclosure">(</span>
        <span class="python_name">AddressUser</span><span class="python_operator">,</span>
        <span class="python_name">addresses</span><span class="python_operator">, </span><span class="python_name">inherits</span><span class="python_operator">=</span><span class="python_name">User</span><span class="python_operator">.</span><span class="python_name">mapper</span><span class="python_operator">, </span>
        <span class="python_name">inherit_condition</span><span class="python_operator">=</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">==</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span>
    <span class="python_enclosure">)</span><span class="python_operator"></span></pre></div>
    

    </div>


    <a href="#adv_datamapping" class="toclink">back to section top</a>


</div>


        



<A name="adv_datamapping_joins"></a>

<div class="subsection" style="margin-left:20px;">

    <span class="sectionheadertext">Mapping a Class against Multiple Tables</span>
    <div class="sectiontext">


    <P>The more general case of the pattern described in "table inheritance" is a mapper that maps against more than one table.  The <span class="codeline">join</span> keyword from the SQL package creates a neat selectable unit comprised of multiple tables, complete with its own composite primary key, which can be passed in to a mapper as the table.</p>
    

<div class="code">
<pre><span class="python_comment"># a class
</span><span class="python_keyword">class </span><span class="python_name">AddressUser</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">pass</span><span class="python_operator">
</span>
<span class="python_comment"># define a Join
</span><span class="python_operator"></span><span class="python_name">j </span><span class="python_operator">= </span><span class="python_name">join</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">, </span><span class="python_name">addresses</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># map to it - the identity of an AddressUser object will be 
# based on (user_id, address_id) since those are the primary keys involved
</span><span class="python_name">m </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">AddressUser</span><span class="python_operator">, </span><span class="python_name">j</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre></div>
    

    A second example:        
    

<div class="code">
<pre><span class="python_comment"># many-to-many join on an association table
</span><span class="python_name">j </span><span class="python_operator">= </span><span class="python_name">join</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">, </span><span class="python_name">userkeywords</span><span class="python_operator">, </span>
        <span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">==</span><span class="python_name">userkeywords</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">join</span><span class="python_enclosure">(</span><span class="python_name">keywords</span><span class="python_operator">, </span>
           <span class="python_name">userkeywords</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">keyword_id</span><span class="python_operator">==</span><span class="python_name">keywords</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">keyword_id</span><span class="python_enclosure">)</span><span class="python_operator">
 </span>
<span class="python_comment"># a class 
</span><span class="python_keyword">class </span><span class="python_name">KeywordUser</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">pass</span><span class="python_operator">
</span>
<span class="python_comment"># map to it - the identity of a KeywordUser object will be
# (user_id, keyword_id) since those are the primary keys involved
</span><span class="python_operator"></span><span class="python_name">m </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">KeywordUser</span><span class="python_operator">, </span><span class="python_name">j</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre></div>
    

    </div>


    <a href="#adv_datamapping" class="toclink">back to section top</a>


</div>


        



<A name="adv_datamapping_selects"></a>

<div class="subsection" style="margin-left:20px;">

    <span class="sectionheadertext">Mapping a Class against Arbitary Selects</span>
    <div class="sectiontext">


<p>Similar to mapping against a join, a plain select() object can be used with a mapper as well.  Below, an example select which contains two aggregate functions and a group_by is mapped to a class:</p>
    

<div class="code">
<pre><span class="python_name">s </span><span class="python_operator">= </span><span class="python_name">select</span><span class="python_enclosure">([</span><span class="python_name">customers</span><span class="python_operator">, </span>
            <span class="python_name">func</span><span class="python_operator">.</span><span class="python_name">count</span><span class="python_enclosure">(</span><span class="python_name">orders</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">label</span><span class="python_enclosure">(</span><span class="python_literal">'order_count'</span><span class="python_enclosure">)</span><span class="python_operator">, </span>
            <span class="python_name">func</span><span class="python_operator">.</span><span class="python_name">max</span><span class="python_enclosure">(</span><span class="python_name">orders</span><span class="python_operator">.</span><span class="python_name">price</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">label</span><span class="python_enclosure">(</span><span class="python_literal">'highest_order'</span><span class="python_enclosure">)]</span><span class="python_operator">,</span>
            <span class="python_name">customers</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">customer_id</span><span class="python_operator">==</span><span class="python_name">orders</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">customer_id</span><span class="python_operator">,</span>
            <span class="python_name">group_by</span><span class="python_operator">=</span><span class="python_enclosure">[</span><span class="python_name">c </span><span class="python_keyword">for </span><span class="python_name">c </span><span class="python_keyword">in </span><span class="python_name">customers</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_enclosure">]</span>
            <span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_keyword">class </span><span class="python_name">Customer</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">pass</span><span class="python_operator">
</span>
<span class="python_operator"></span><span class="python_name">mapper </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Customer</span><span class="python_operator">, </span><span class="python_name">s</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre></div>

<p>Above, the "customers" table is joined against the "orders" table to produce a full row for each customer row, the total count of related rows in the "orders" table, and the highest price in the "orders" table, grouped against the full set of columns in the "customers" table.  That query is then mapped against the Customer class.  New instances of Customer will contain attributes for each column in the "customers" table as well as an "order_count" and "highest_order" attribute.  Updates to the Customer object will only be reflected in the "customers" table and not the "orders" table.  This is because the primary keys of the "orders" table are not represented in this mapper and therefore the table is not affected by save or delete operations.</p>

    </div>


    <a href="#adv_datamapping" class="toclink">back to section top</a>


</div>


        



<A name="adv_datamapping_multiple"></a>

<div class="subsection" style="margin-left:20px;">

    <span class="sectionheadertext">Multiple Mappers for One Class</span>
    <div class="sectiontext">


    <p>By now it should be apparent that the mapper defined for a class is in no way the only mapper that exists for that class.  Other mappers can be created at any time; either explicitly or via the <span class="codeline">options</span> method, to provide different loading behavior.</p>
    
    <p>However, its not as simple as that.  The mapper serves a dual purpose; one is to generate select statements and load objects from executing those statements; the other is to keep track of the defined dependencies of that object when save and delete operations occur, and to extend the attributes of the object so that they store information about their history and communicate with the unit of work system.  For this reason, it is a good idea to be aware of the behavior of multiple mappers.  When creating dependency relationships between objects, one should insure that only the primary mappers are used in those relationships, else deep object traversal operations will fail to load in the expected properties, and update operations will not take all the dependencies into account.  </p>
    
    <p>Generally its as simple as, the <i>first</i> mapper that is defined for a particular class is the one that gets to define that classes' relationships to other mapped classes, and also decorates its attributes and constructors with special behavior.  Any subsequent mappers created for that class will be able to load new instances, but object manipulation operations will still function via the original mapper.  The special keyword <span class="codeline">is_primary</span> will override this behavior, and make any mapper the new "primary" mapper.
    </p>
    

<div class="code">
<pre><span class="python_keyword">class </span><span class="python_name">User</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">pass</span><span class="python_operator">
</span>
<span class="python_comment"># mapper one - mark it as "primary", meaning this mapper will handle
# saving and class-level properties
</span><span class="python_operator"></span><span class="python_name">m1 </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">, </span><span class="python_name">is_primary</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># mapper two - this one will also eager-load address objects in
</span><span class="python_name">m2 </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">, </span><span class="python_name">properties</span><span class="python_operator">=</span><span class="python_enclosure">{</span>
        <span class="python_literal">'addresses' </span><span class="python_operator">: </span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_operator">, </span><span class="python_name">addresses</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">lazy</span><span class="python_operator">=</span><span class="python_name">False</span><span class="python_enclosure">)</span>
    <span class="python_enclosure">})</span><span class="python_operator">
</span>
<span class="python_comment"># get a user.  this user will not have an 'addreses' property
</span><span class="python_name">u1 </span><span class="python_operator">= </span><span class="python_name">m1</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">==</span><span class="python_number">10</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># get another user.  this user will have an 'addreses' property.
</span><span class="python_name">u2 </span><span class="python_operator">= </span><span class="python_name">m2</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">==</span><span class="python_number">27</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># make some modifications, including adding an Address object.
</span><span class="python_name">u1</span><span class="python_operator">.</span><span class="python_name">user_name </span><span class="python_operator">= </span><span class="python_literal">'jack'</span><span class="python_operator">
</span><span class="python_name">u2</span><span class="python_operator">.</span><span class="python_name">user_name </span><span class="python_operator">= </span><span class="python_literal">'jane'</span><span class="python_operator">
</span><span class="python_name">u2</span><span class="python_operator">.</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">append</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_enclosure">(</span><span class="python_literal">'123 green street'</span><span class="python_enclosure">))</span><span class="python_operator">
</span>
<span class="python_comment"># upon commit, the User objects will be saved. 
# the Address object will not, since the primary mapper for User
# does not have an 'addresses' relationship defined
</span><span class="python_name">objectstore</span><span class="python_operator">.</span><span class="python_name">commit</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre></div>
    

    </div>


    <a href="#adv_datamapping" class="toclink">back to section top</a>


</div>


        



<A name="adv_datamapping_circular"></a>

<div class="subsection" style="margin-left:20px;">

    <span class="sectionheadertext">Circular Mapping</span>
    <div class="sectiontext">


<p>Oftentimes it is necessary for two mappers to be related to each other.  With a datamodel that consists of Users that store Addresses, you might have an Address object and want to access the "user" attribute on it, or have a User object and want to get the list of Address objects.  The easiest way to do this is via the <span class="codeline">backreference</span> keyword described in <a href="#datamapping_relations_backreferences" >Useful Feature: Backreferences</a>.  Although even when backreferences are used, it is sometimes necessary to explicitly specify the relations on both mappers pointing to each other.</p>
<p>To achieve this involves creating the first mapper by itself, then creating the second mapper referencing the first, then adding references to the first mapper to reference the second:</p>


<div class="code">
<pre><span class="python_keyword">class </span><span class="python_name">User</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">pass</span><span class="python_operator">
</span><span class="python_keyword">class </span><span class="python_name">Address</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">pass</span><span class="python_operator">
</span><span class="python_name">User</span><span class="python_operator">.</span><span class="python_name">mapper </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">Address</span><span class="python_operator">.</span><span class="python_name">mapper </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_operator">, </span><span class="python_name">addresses</span><span class="python_operator">, </span><span class="python_name">properties</span><span class="python_operator">=</span><span class="python_enclosure">{</span>
    <span class="python_literal">'user'</span><span class="python_operator">:</span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">.</span><span class="python_name">mapper</span><span class="python_enclosure">)</span>
<span class="python_enclosure">})</span><span class="python_operator">
</span><span class="python_name">User</span><span class="python_operator">.</span><span class="python_name">mapper</span><span class="python_operator">.</span><span class="python_name">add_property</span><span class="python_enclosure">(</span><span class="python_literal">'addresses'</span><span class="python_operator">, </span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_operator">.</span><span class="python_name">mapper</span><span class="python_enclosure">))</span><span class="python_operator"></span></pre></div>

<p>Note that with a circular relationship as above, you cannot declare both relationships as "eager" relationships, since that produces a circular query situation which will generate a recursion exception.  So what if you want to load an Address and its User eagerly?  Just make a second mapper using options:


<div class="code">
<pre><span class="python_name">eagermapper </span><span class="python_operator">= </span><span class="python_name">Address</span><span class="python_operator">.</span><span class="python_name">mapper</span><span class="python_operator">.</span><span class="python_name">options</span><span class="python_enclosure">(</span><span class="python_name">eagerload</span><span class="python_enclosure">(</span><span class="python_literal">'user'</span><span class="python_enclosure">))</span><span class="python_operator">
</span><span class="python_name">s </span><span class="python_operator">= </span><span class="python_name">eagermapper</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">address_id</span><span class="python_operator">==</span><span class="python_number">12</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre></div>


    </div>


    <a href="#adv_datamapping" class="toclink">back to section top</a>


</div>


        



<A name="adv_datamapping_recursive"></a>

<div class="subsection" style="margin-left:20px;">

    <span class="sectionheadertext">Self Referential Mappers</span>
    <div class="sectiontext">


<p>A self-referential mapper is a mapper that is designed to operate with an <b>adjacency list</b> table.  This is a table that contains one or more foreign keys back to itself, and is usually used to create hierarchical tree structures.  SQLAlchemy's default model of saving items based on table dependencies is not sufficient in this case, as an adjacency list table introduces dependencies between individual rows.  Fortunately, SQLAlchemy will automatically detect a self-referential mapper and do the extra lifting to make it work. </p> 
    

<div class="code">
<pre><span class="python_comment"># define a self-referential table
</span><span class="python_name">trees </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'treenodes'</span><span class="python_operator">, </span><span class="python_name">engine</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'node_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'parent_node_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">ForeignKey</span><span class="python_enclosure">(</span><span class="python_literal">'treenodes.node_id'</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">nullable</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'node_name'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">50</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">nullable</span><span class="python_operator">=</span><span class="python_name">False</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># treenode class
</span><span class="python_keyword">class </span><span class="python_name">TreeNode</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">pass</span><span class="python_operator">
</span>
<span class="python_comment"># mapper defines "children" property, pointing back to TreeNode class,
# with the mapper unspecified.  it will point back to the primary 
# mapper on the TreeNode class.
</span><span class="python_operator"></span><span class="python_name">TreeNode</span><span class="python_operator">.</span><span class="python_name">mapper </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">TreeNode</span><span class="python_operator">, </span><span class="python_name">trees</span><span class="python_operator">, </span><span class="python_name">properties</span><span class="python_operator">=</span><span class="python_enclosure">{</span>
        <span class="python_literal">'children' </span><span class="python_operator">: </span><span class="python_name">relation</span><span class="python_enclosure">(</span>
                        <span class="python_name">TreeNode</span><span class="python_operator">, </span>
                        <span class="python_name">private</span><span class="python_operator">=</span><span class="python_name">True</span>
                     <span class="python_enclosure">)</span><span class="python_operator">,</span>
        <span class="python_enclosure">}</span>
    <span class="python_enclosure">)</span><span class="python_operator">
    </span>
<span class="python_comment"># or, specify the circular relationship after establishing the original mapper:
</span><span class="python_name">mymapper </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">TreeNode</span><span class="python_operator">, </span><span class="python_name">trees</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_name">mymapper</span><span class="python_operator">.</span><span class="python_name">add_property</span><span class="python_enclosure">(</span><span class="python_literal">'children'</span><span class="python_operator">, </span><span class="python_name">relation</span><span class="python_enclosure">(</span>
                        <span class="python_name">mymapper</span><span class="python_operator">, </span>
                        <span class="python_name">private</span><span class="python_operator">=</span><span class="python_name">True</span>
                     <span class="python_enclosure">))</span><span class="python_operator"></span></pre></div>
    
    <p>This kind of mapper goes through a lot of extra effort when saving and deleting items, to determine the correct dependency graph of nodes within the tree.</p>
    
    <p>A self-referential mapper where there is more than one relationship on the table requires that all join conditions be explicitly spelled out.  Below is a self-referring table that contains a "parent_node_id" column to reference parent/child relationships, and a "root_node_id" column which points child nodes back to the ultimate root node:</p>
    

<div class="code">
<pre><span class="python_comment"># define a self-referential table with several relations
</span><span class="python_name">trees </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'treenodes'</span><span class="python_operator">, </span><span class="python_name">engine</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'node_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'parent_node_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">ForeignKey</span><span class="python_enclosure">(</span><span class="python_literal">'treenodes.node_id'</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">nullable</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'root_node_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">ForeignKey</span><span class="python_enclosure">(</span><span class="python_literal">'treenodes.node_id'</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">nullable</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'node_name'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">50</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">nullable</span><span class="python_operator">=</span><span class="python_name">False</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># treenode class
</span><span class="python_keyword">class </span><span class="python_name">TreeNode</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">pass</span><span class="python_operator">
</span>
<span class="python_comment"># define the "children" property as well as the "root" property
</span><span class="python_operator"></span><span class="python_name">TreeNode</span><span class="python_operator">.</span><span class="python_name">mapper </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">TreeNode</span><span class="python_operator">, </span><span class="python_name">trees</span><span class="python_operator">, </span><span class="python_name">properties</span><span class="python_operator">=</span><span class="python_enclosure">{</span>
        <span class="python_literal">'children' </span><span class="python_operator">: </span><span class="python_name">relation</span><span class="python_enclosure">(</span>
                        <span class="python_name">TreeNode</span><span class="python_operator">, </span>
                        <span class="python_name">primaryjoin</span><span class="python_operator">=</span><span class="python_name">trees</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">parent_node_id</span><span class="python_operator">==</span><span class="python_name">trees</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">node_id</span>
                        <span class="python_name">private</span><span class="python_operator">=</span><span class="python_name">True</span>
                     <span class="python_enclosure">)</span><span class="python_operator">,</span>
        <span class="python_literal">'root' </span><span class="python_operator">: </span><span class="python_name">relation</span><span class="python_enclosure">(</span>
                <span class="python_name">TreeNode</span><span class="python_operator">,</span>
                <span class="python_name">primaryjoin</span><span class="python_operator">=</span><span class="python_name">trees</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">root_node_id</span><span class="python_operator">=</span><span class="python_name">trees</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">node_id</span><span class="python_operator">, </span>
                <span class="python_name">foreignkey</span><span class="python_operator">=</span><span class="python_name">trees</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">node_id</span><span class="python_operator">,</span>
                <span class="python_name">uselist</span><span class="python_operator">=</span><span class="python_name">False</span>
            <span class="python_enclosure">)</span>
        <span class="python_enclosure">}</span>
    <span class="python_enclosure">)</span><span class="python_operator"></span></pre></div>
    
<p>The "root" property on a TreeNode is a many-to-one relationship.  By default, a self-referential mapper declares relationships as one-to-many, so the extra parameter <span class="codeline">foreignkey</span>, pointing to the "many" side of a relationship, is needed to indicate a "many-to-one" self-referring relationship.</p>
<p>Both TreeNode examples above are available in functional form in the <span class="codeline">examples/adjacencytree</span> directory of the distribution.</p>    

    </div>


    <a href="#adv_datamapping" class="toclink">back to section top</a>


</div>


        



<A name="adv_datamapping_resultset"></a>

<div class="subsection" style="margin-left:20px;">

    <span class="sectionheadertext">Result-Set Mapping</span>
    <div class="sectiontext">


    <p>Take any result set and feed it into a mapper to produce objects.  Multiple mappers can be combined to retrieve unrelated objects from the same row in one step.  The <span class="codeline">instances</span> method on mapper takes a ResultProxy object, which is the result type generated from SQLEngine, and delivers object instances.</p>
    

<div class="code">
    <div class="codetitle">single object</div>
<pre><span class="python_keyword">class </span><span class="python_name">User</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">pass</span><span class="python_operator">
</span>
<span class="python_operator"></span><span class="python_name">User</span><span class="python_operator">.</span><span class="python_name">mapper </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># select users
</span><span class="python_name">c </span><span class="python_operator">= </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">()</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_comment"># get objects
</span><span class="python_name">userlist </span><span class="python_operator">= </span><span class="python_name">User</span><span class="python_operator">.</span><span class="python_name">mapper</span><span class="python_operator">.</span><span class="python_name">instances</span><span class="python_enclosure">(</span><span class="python_name">c</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre></div>

    
    

<div class="code">
    <div class="codetitle">multiple objects</div>
<pre><span class="python_comment"># define a second class/mapper
</span><span class="python_keyword">class </span><span class="python_name">Address</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">pass</span><span class="python_operator">
    </span>
<span class="python_operator"></span><span class="python_name">Address</span><span class="python_operator">.</span><span class="python_name">mapper </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_operator">, </span><span class="python_name">addresses</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># select users and addresses in one query
</span><span class="python_name">s </span><span class="python_operator">= </span><span class="python_name">select</span><span class="python_enclosure">([</span><span class="python_name">users</span><span class="python_operator">, </span><span class="python_name">addresses</span><span class="python_enclosure">]</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">==</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># execute it, and process the results with the User mapper, chained to the Address mapper
</span><span class="python_name">r </span><span class="python_operator">= </span><span class="python_name">User</span><span class="python_operator">.</span><span class="python_name">mapper</span><span class="python_operator">.</span><span class="python_name">instances</span><span class="python_enclosure">(</span><span class="python_name">s</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator">, </span><span class="python_name">Address</span><span class="python_operator">.</span><span class="python_name">mapper</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># result rows are an array of objects, one for each mapper used
</span><span class="python_keyword">for </span><span class="python_name">entry </span><span class="python_keyword">in </span><span class="python_name">r</span><span class="python_operator">:
    </span><span class="python_name">user </span><span class="python_operator">= </span><span class="python_name">r</span><span class="python_enclosure">[</span><span class="python_number">0</span><span class="python_enclosure">]</span><span class="python_operator">
    </span><span class="python_name">address </span><span class="python_operator">= </span><span class="python_name">r</span><span class="python_enclosure">[</span><span class="python_number">1</span><span class="python_enclosure">]</span><span class="python_operator"></span></pre></div>
    

    </div>


    <a href="#adv_datamapping" class="toclink">back to section top</a>


</div>


        



<A name="adv_datamapping_extending"></a>

<div class="subsection" style="margin-left:20px;">

    <span class="sectionheadertext">Extending Mapper</span>
    <div class="sectiontext">


<p>Mappers can have functionality augmented or replaced at many points in its execution via the usage of the MapperExtension class.  This class is just a series of "hooks" where various functionality takes place.  An application can make its own MapperExtension objects, overriding only the methods it needs.
        

<div class="code">
<pre><span class="python_keyword">class </span><span class="python_name">MapperExtension</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">def </span><span class="python_name">create_instance</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">mapper</span><span class="python_operator">, </span><span class="python_name">row</span><span class="python_operator">, </span><span class="python_name">imap</span><span class="python_operator">, </span><span class="python_name">class_</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_literal">"""called when a new object instance is about to be created from a row.  
        the method can choose to create the instance itself, or it can return 
        None to indicate normal object creation should take place.
        
        mapper - the mapper doing the operation
        row - the result row from the database
        imap - a dictionary that is storing the running set of objects collected from the
        current result set
        class_ - the class we are mapping.
        """</span><span class="python_operator">
    </span><span class="python_keyword">def </span><span class="python_name">append_result</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">mapper</span><span class="python_operator">, </span><span class="python_name">row</span><span class="python_operator">, </span><span class="python_name">imap</span><span class="python_operator">, </span><span class="python_name">result</span><span class="python_operator">, </span><span class="python_name">instance</span><span class="python_operator">, </span><span class="python_name">isnew</span><span class="python_operator">, </span><span class="python_name">populate_existing</span><span class="python_operator">=</span><span class="python_name">False</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_literal">"""called when an object instance is being appended to a result list.
        
        If it returns True, it is assumed that this method handled the appending itself.

        mapper - the mapper doing the operation
        row - the result row from the database
        imap - a dictionary that is storing the running set of objects collected from the
        current result set
        result - an instance of util.HistoryArraySet(), which may be an attribute on an
        object if this is a related object load (lazy or eager).  use result.append_nohistory(value)
        to append objects to this list.
        instance - the object instance to be appended to the result
        isnew - indicates if this is the first time we have seen this object instance in the current result
        set.  if you are selecting from a join, such as an eager load, you might see the same object instance
        many times in the same result set.
        populate_existing - usually False, indicates if object instances that were already in the main 
        identity map, i.e. were loaded by a previous select(), get their attributes overwritten
        """</span><span class="python_operator">
    </span><span class="python_keyword">def </span><span class="python_name">before_insert</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">mapper</span><span class="python_operator">, </span><span class="python_name">instance</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_literal">"""called before an object instance is INSERTed into its table.
        
        this is a good place to set up primary key values and such that arent handled otherwise."""</span><span class="python_operator">
    </span><span class="python_keyword">def </span><span class="python_name">after_insert</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">mapper</span><span class="python_operator">, </span><span class="python_name">instance</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_literal">"""called after an object instance has been INSERTed"""</span><span class="python_operator">
    </span><span class="python_keyword">def </span><span class="python_name">before_delete</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">mapper</span><span class="python_operator">, </span><span class="python_name">instance</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_literal">"""called before an object instance is DELETEed"""</span><span class="python_operator"></span></pre></div>

        <p>To use MapperExtension, make your own subclass of it and just send it off to a mapper:</p>
        

<div class="code">
<pre><span class="python_name">mapper </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">, </span><span class="python_name">extension</span><span class="python_operator">=</span><span class="python_name">MyExtension</span><span class="python_enclosure">())</span><span class="python_operator"></span></pre></div>

        <p>An existing mapper can create a copy of itself using an extension via the <span class="codeline">extension</span> option:
        

<div class="code">
<pre><span class="python_name">extended_mapper </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_operator">.</span><span class="python_name">options</span><span class="python_enclosure">(</span><span class="python_name">extension</span><span class="python_enclosure">(</span><span class="python_name">MyExtension</span><span class="python_enclosure">()))</span><span class="python_operator"></span></pre></div>

        

    </div>


    <a href="#adv_datamapping" class="toclink">back to section top</a>


</div>


        



<A name="adv_datamapping_class"></a>

<div class="subsection" style="margin-left:20px;">

    <span class="sectionheadertext">How Mapper Modifies Mapped Classes</span>
    <div class="sectiontext">


<p>This section is a quick summary of what's going on when you send a class to the <span class="codeline">mapper()</span> function.  This material, not required to be able to use SQLAlchemy, is a little more dense and should be approached patiently!</p>

<p>The primary changes to a class that is mapped involve attaching property objects to it which represent table columns.  These property objects essentially track changes.  In addition, the __init__ method of the object is decorated to track object creates.</p>
<p>Here is a quick rundown of all the changes in code form:
    

<div class="code">
<pre><span class="python_comment"># step 1 - override __init__ to 'register_new' with the Unit of Work
</span><span class="python_name">oldinit </span><span class="python_operator">= </span><span class="python_name">myclass</span><span class="python_operator">.</span><span class="python_name">__init__</span><span class="python_operator">
</span><span class="python_keyword">def </span><span class="python_name">init</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, *</span><span class="python_name">args</span><span class="python_operator">, **</span><span class="python_name">kwargs</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_name">nohist </span><span class="python_operator">= </span><span class="python_name">kwargs</span><span class="python_operator">.</span><span class="python_name">pop</span><span class="python_enclosure">(</span><span class="python_literal">'_mapper_nohistory'</span><span class="python_operator">, </span><span class="python_name">False</span><span class="python_enclosure">)</span><span class="python_operator">
    </span><span class="python_name">oldinit</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, *</span><span class="python_name">args</span><span class="python_operator">, **</span><span class="python_name">kwargs</span><span class="python_enclosure">)</span><span class="python_operator">
    </span><span class="python_keyword">if not </span><span class="python_name">nohist</span><span class="python_operator">:
        </span><span class="python_comment"># register_new with Unit Of Work
</span><span class="python_operator">        </span><span class="python_name">objectstore</span><span class="python_operator">.</span><span class="python_name">uow</span><span class="python_enclosure">()</span><span class="python_operator">.</span><span class="python_name">register_new</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">myclass</span><span class="python_operator">.</span><span class="python_name">__init__ </span><span class="python_operator">= </span><span class="python_name">init</span><span class="python_operator">
</span>
<span class="python_comment"># step 2 - set a string identifier that will 
# locate the classes' primary mapper
</span><span class="python_name">myclass</span><span class="python_operator">.</span><span class="python_name">_mapper </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_operator">.</span><span class="python_name">hashkey</span><span class="python_operator">
</span>
<span class="python_comment"># step 3 - add column accessor
</span><span class="python_name">myclass</span><span class="python_operator">.</span><span class="python_name">c </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_operator">.</span><span class="python_name">columns</span><span class="python_operator">
</span>
<span class="python_comment"># step 4 - attribute decorating.  
# this happens mostly within the package sqlalchemy.attributes
</span>
<span class="python_comment"># this dictionary will store a series of callables 
# that generate "history" containers for
# individual object attributes
</span><span class="python_name">myclass</span><span class="python_operator">.</span><span class="python_name">_class_managed_attributes </span><span class="python_operator">= </span><span class="python_enclosure">{}</span><span class="python_operator">
</span>
<span class="python_comment"># create individual properties for each column - 
# these objects know how to talk 
# to the attribute package to create appropriate behavior.
# the next example examines the attributes package more closely.
</span><span class="python_name">myclass</span><span class="python_operator">.</span><span class="python_name">column1 </span><span class="python_operator">= </span><span class="python_name">SmartProperty</span><span class="python_enclosure">()</span><span class="python_operator">.</span><span class="python_name">property</span><span class="python_enclosure">(</span><span class="python_literal">'column1'</span><span class="python_operator">, </span><span class="python_name">uselist</span><span class="python_operator">=</span><span class="python_name">False</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">myclass</span><span class="python_operator">.</span><span class="python_name">column2 </span><span class="python_operator">= </span><span class="python_name">SmartProperty</span><span class="python_enclosure">()</span><span class="python_operator">.</span><span class="python_name">property</span><span class="python_enclosure">(</span><span class="python_literal">'column2'</span><span class="python_operator">, </span><span class="python_name">uselist</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre></div>

<p>The attribute package is used when save operations occur to get a handle on modified values.  In the example below,
a full round-trip attribute tracking operation is illustrated:</p>


<div class="code">
<pre><span class="python_keyword">import </span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">attributes as attributes</span><span class="python_operator">
</span>
<span class="python_comment"># create an attribute manager.  
# the sqlalchemy.mapping package keeps one of these around as 
# 'objectstore.global_attributes'
</span><span class="python_name">manager </span><span class="python_operator">= </span><span class="python_name">attributes</span><span class="python_operator">.</span><span class="python_name">AttributeManager</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_comment"># regular old new-style class
</span><span class="python_keyword">class </span><span class="python_name">MyClass</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">pass</span><span class="python_operator">
</span>
<span class="python_comment"># register a scalar and a list attribute
</span><span class="python_operator"></span><span class="python_name">manager</span><span class="python_operator">.</span><span class="python_name">register_attribute</span><span class="python_enclosure">(</span><span class="python_name">MyClass</span><span class="python_operator">, </span><span class="python_literal">'column1'</span><span class="python_operator">, </span><span class="python_name">uselist</span><span class="python_operator">=</span><span class="python_name">False</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">manager</span><span class="python_operator">.</span><span class="python_name">register_attribute</span><span class="python_enclosure">(</span><span class="python_name">MyClass</span><span class="python_operator">, </span><span class="python_literal">'column2'</span><span class="python_operator">, </span><span class="python_name">uselist</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">
    </span>
<span class="python_comment"># create/modify an object
</span><span class="python_name">obj </span><span class="python_operator">= </span><span class="python_name">MyClass</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_name">obj</span><span class="python_operator">.</span><span class="python_name">column1 </span><span class="python_operator">= </span><span class="python_literal">'this is a new value'</span><span class="python_operator">
</span><span class="python_name">obj</span><span class="python_operator">.</span><span class="python_name">column2</span><span class="python_operator">.</span><span class="python_name">append</span><span class="python_enclosure">(</span><span class="python_literal">'value 1'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">obj</span><span class="python_operator">.</span><span class="python_name">column2</span><span class="python_operator">.</span><span class="python_name">append</span><span class="python_enclosure">(</span><span class="python_literal">'value 2'</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># get history objects
</span><span class="python_name">col1_history </span><span class="python_operator">= </span><span class="python_name">manager</span><span class="python_operator">.</span><span class="python_name">get_history</span><span class="python_enclosure">(</span><span class="python_name">obj</span><span class="python_operator">, </span><span class="python_literal">'column1'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">col2_history </span><span class="python_operator">= </span><span class="python_name">manager</span><span class="python_operator">.</span><span class="python_name">get_history</span><span class="python_enclosure">(</span><span class="python_name">obj</span><span class="python_operator">, </span><span class="python_literal">'column2'</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># whats new ?
</span><span class="python_operator">>>> </span><span class="python_name">col1_history</span><span class="python_operator">.</span><span class="python_name">added_items</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_enclosure">[</span><span class="python_literal">'this is a new value'</span><span class="python_enclosure">]</span><span class="python_operator">
</span>
<span class="python_operator">>>> </span><span class="python_name">col2_history</span><span class="python_operator">.</span><span class="python_name">added_items</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_enclosure">[</span><span class="python_literal">'value1'</span><span class="python_operator">, </span><span class="python_literal">'value2'</span><span class="python_enclosure">]</span><span class="python_operator">
</span>
<span class="python_comment"># commit changes
</span><span class="python_name">manager</span><span class="python_operator">.</span><span class="python_name">commit</span><span class="python_enclosure">(</span><span class="python_name">obj</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># the new values become the "unchanged" values
</span><span class="python_operator">>>> </span><span class="python_name">col1_history</span><span class="python_operator">.</span><span class="python_name">added_items</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_enclosure">[]</span><span class="python_operator">
</span>
<span class="python_operator">>>> </span><span class="python_name">col1_history</span><span class="python_operator">.</span><span class="python_name">unchanged_items</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_enclosure">[</span><span class="python_literal">'this is a new value'</span><span class="python_enclosure">]</span><span class="python_operator">
</span>
<span class="python_operator">>>> </span><span class="python_name">col2_history</span><span class="python_operator">.</span><span class="python_name">added_items</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_enclosure">[]</span><span class="python_operator">
</span>
<span class="python_operator">>>> </span><span class="python_name">col2_history</span><span class="python_operator">.</span><span class="python_name">unchanged_items</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_enclosure">[</span><span class="python_literal">'value1'</span><span class="python_operator">, </span><span class="python_literal">'value2'</span><span class="python_enclosure">]</span><span class="python_operator"></span></pre></div>

<p>The above AttributeManager also includes a method <span class="codeline">value_changed</span> which is triggered whenever change events occur on the managed object attributes.  The Unit of Work (objectstore) package overrides this method in order to receive change events; its essentially this:</p>


<div class="code">
<pre><span class="python_keyword">import </span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">attributes as attributes</span><span class="python_operator">
</span><span class="python_keyword">class </span><span class="python_name">UOWAttributeManager</span><span class="python_enclosure">(</span><span class="python_name">attributes</span><span class="python_operator">.</span><span class="python_name">AttributeManager</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">def </span><span class="python_name">value_changed</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">obj</span><span class="python_operator">, </span><span class="python_name">key</span><span class="python_operator">, </span><span class="python_name">value</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_keyword">if </span><span class="python_name">hasattr</span><span class="python_enclosure">(</span><span class="python_name">obj</span><span class="python_operator">, </span><span class="python_literal">'_instance_key'</span><span class="python_enclosure">)</span><span class="python_operator">:
            </span><span class="python_name">uow</span><span class="python_enclosure">()</span><span class="python_operator">.</span><span class="python_name">register_dirty</span><span class="python_enclosure">(</span><span class="python_name">obj</span><span class="python_enclosure">)</span><span class="python_operator">
        </span><span class="python_keyword">else</span><span class="python_operator">:
            </span><span class="python_name">uow</span><span class="python_enclosure">()</span><span class="python_operator">.</span><span class="python_name">register_new</span><span class="python_enclosure">(</span><span class="python_name">obj</span><span class="python_enclosure">)</span><span class="python_operator">
            </span>
<span class="python_operator"></span><span class="python_name">global_attributes </span><span class="python_operator">= </span><span class="python_name">UOWAttributeManager</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre></div>

<p>Objects that contain the attribute "_instance_key" are already registered with the Identity Map, and are assumed to have come from the database.  They therefore get marked as "dirty" when changes happen.  Objects without an "_instance_key" are not from the database, and get marked as "new" when changes happen, although usually this will already have occured via the object's __init__ method.</p>

    </div>


    <a href="#adv_datamapping" class="toclink">back to section top</a>


</div>




    <hr width="400px" align="left" />

</div>


		</div>
		<div class="section">
					
			<A name="types"></a>
			<div class="topnavmargin">
			
	
<div class="topnav">


	
	<div class="topnavcontrol">
	View: <a href="index.html">Paged</a> &nbsp;|&nbsp; <b>One Page</b>
	</div>



<div class="topnavsectionlink">

<a href="#top">Table of Contents</a>

<div class="prevnext">
Previous: <a href="#adv_datamapping">Advanced Data Mapping</a>

&nbsp; | &nbsp;


Next: <a href="#docstrings">Modules and Classes</a>

</div>
</div>


<div class="topnavmain">
	<div class="topnavheader">The Types System</div>
	<div class="topnavitems">
	


    
    
    <div class="toclink">
        <A style="" href="#types_standard">Built-in Types</a>
    </div>
    
    <div class="toclinkcontainer">
    </div>


    
    
    <div class="toclink">
        <A style="" href="#types_custom">Creating your Own Types</a>
    </div>
    
    <div class="toclinkcontainer">
    </div>



	</div>
</div>

</div>

			</div>

			




<div class="subsection" style="margin-left:10px;">

    <div class="sectiontext">


<p>The package <span class="codeline">sqlalchemy.types</span> defines the datatype identifiers which may be used when defining <a href="#metadata" >table metadata</a>.  This package includes a set of generic types, a set of SQL-specific subclasses of those types, and a small extension system used by specific database connectors to adapt these generic types into database-specific type objects.
</p>

			


			

    </div>

        



<A name="types_standard"></a>

<div class="subsection" style="margin-left:20px;">

    <span class="sectionheadertext">Built-in Types</span>
    <div class="sectiontext">



<p>SQLAlchemy comes with a set of standard generic datatypes, which are defined as classes.  They are specified to table meta data using either the class itself, or an instance of the class.  Creating an instance of the class allows you to specify parameters for the type, such as string length, numerical precision, etc. 
</p>
<p>The standard set of generic types are:</p>


<div class="code">
<pre><span class="python_comment"># sqlalchemy.types package:
</span><span class="python_keyword">class </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_name">TypeEngine</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">def </span><span class="python_name">__init__</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">length</span><span class="python_operator">=</span><span class="python_name">None</span><span class="python_enclosure">)</span><span class="python_operator">
    </span>
<span class="python_operator"></span><span class="python_keyword">class </span><span class="python_name">Integer</span><span class="python_enclosure">(</span><span class="python_name">TypeEngine</span><span class="python_enclosure">)</span><span class="python_operator">
    </span>
<span class="python_keyword">class </span><span class="python_name">Numeric</span><span class="python_enclosure">(</span><span class="python_name">TypeEngine</span><span class="python_enclosure">)</span><span class="python_operator">: 
    </span><span class="python_keyword">def </span><span class="python_name">__init__</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">precision</span><span class="python_operator">=</span><span class="python_number">10</span><span class="python_operator">, </span><span class="python_name">length</span><span class="python_operator">=</span><span class="python_number">2</span><span class="python_enclosure">)</span><span class="python_operator">
    </span>
<span class="python_operator"></span><span class="python_keyword">class </span><span class="python_name">Float</span><span class="python_enclosure">(</span><span class="python_name">TypeEngine</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">def </span><span class="python_name">__init__</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">precision</span><span class="python_operator">=</span><span class="python_number">10</span><span class="python_enclosure">)</span><span class="python_operator">
    </span>
<span class="python_operator"></span><span class="python_keyword">class </span><span class="python_name">DateTime</span><span class="python_enclosure">(</span><span class="python_name">TypeEngine</span><span class="python_enclosure">)</span><span class="python_operator">
    </span>
<span class="python_keyword">class </span><span class="python_name">Binary</span><span class="python_enclosure">(</span><span class="python_name">TypeEngine</span><span class="python_enclosure">)</span><span class="python_operator">: 
    </span><span class="python_keyword">def </span><span class="python_name">__init__</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">length</span><span class="python_operator">=</span><span class="python_name">None</span><span class="python_enclosure">)</span><span class="python_operator">
    </span>
<span class="python_operator"></span><span class="python_keyword">class </span><span class="python_name">Boolean</span><span class="python_enclosure">(</span><span class="python_name">TypeEngine</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># converts unicode strings to raw bytes
# as bind params, raw bytes to unicode as 
# rowset values
</span><span class="python_keyword">class </span><span class="python_name">Unicode</span><span class="python_enclosure">(</span><span class="python_name">String</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre></div>

<p>More specific subclasses of these types are available, to allow finer grained control over types:</p>


<div class="code">
<pre><span class="python_keyword">class </span><span class="python_name">FLOAT</span><span class="python_enclosure">(</span><span class="python_name">Numeric</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_keyword">class </span><span class="python_name">TEXT</span><span class="python_enclosure">(</span><span class="python_name">String</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_keyword">class </span><span class="python_name">DECIMAL</span><span class="python_enclosure">(</span><span class="python_name">Numeric</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_keyword">class </span><span class="python_name">INT</span><span class="python_enclosure">(</span><span class="python_name">Integer</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">INTEGER </span><span class="python_operator">= </span><span class="python_name">INT</span><span class="python_operator">
</span><span class="python_keyword">class </span><span class="python_name">TIMESTAMP</span><span class="python_enclosure">(</span><span class="python_name">DateTime</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_keyword">class </span><span class="python_name">DATETIME</span><span class="python_enclosure">(</span><span class="python_name">DateTime</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_keyword">class </span><span class="python_name">CLOB</span><span class="python_enclosure">(</span><span class="python_name">String</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_keyword">class </span><span class="python_name">VARCHAR</span><span class="python_enclosure">(</span><span class="python_name">String</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_keyword">class </span><span class="python_name">CHAR</span><span class="python_enclosure">(</span><span class="python_name">String</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_keyword">class </span><span class="python_name">BLOB</span><span class="python_enclosure">(</span><span class="python_name">Binary</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_keyword">class </span><span class="python_name">BOOLEAN</span><span class="python_enclosure">(</span><span class="python_name">Boolean</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre></div>

<p>When using a specific database engine, these types are adapted even further via a set of database-specific subclasses defined by the database engine.</p>

    </div>


    <a href="#types" class="toclink">back to section top</a>


</div>


        



<A name="types_custom"></a>

<div class="subsection" style="margin-left:20px;">

    <span class="sectionheadertext">Creating your Own Types</span>
    <div class="sectiontext">


<p>Types also support pre-processing of query parameters as well as post-processing of result set data.  You can make your own classes to perform these operations.  They are specified by subclassing the desired type class as well as the special mixin TypeDecorator, which manages the adaptation of the underlying type to a database-specific type:</p>


<div class="code">
<pre><span class="python_keyword">import </span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">types as types</span><span class="python_operator">
</span>
<span class="python_keyword">class </span><span class="python_name">MyType</span><span class="python_enclosure">(</span><span class="python_name">types</span><span class="python_operator">.</span><span class="python_name">TypeDecorator</span><span class="python_operator">, </span><span class="python_name">types</span><span class="python_operator">.</span><span class="python_name">String</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_literal">"""basic type that decorates String, prefixes values with "PREFIX:" on 
    the way in and strips it off on the way out."""</span><span class="python_operator">
    </span><span class="python_keyword">def </span><span class="python_name">convert_bind_param</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">value</span><span class="python_operator">, </span><span class="python_name">engine</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_keyword">return </span><span class="python_literal">"PREFIX:" </span><span class="python_operator">+ </span><span class="python_name">value</span><span class="python_operator">
    </span><span class="python_keyword">def </span><span class="python_name">convert_result_value</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">value</span><span class="python_operator">, </span><span class="python_name">engine</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_keyword">return </span><span class="python_name">value</span><span class="python_enclosure">[</span><span class="python_number">7</span><span class="python_operator">:</span><span class="python_enclosure">]</span><span class="python_operator"></span></pre></div>

<p>Another example, which illustrates a fully defined datatype.  This just overrides the base type class TypeEngine:</p>


<div class="code">
<pre><span class="python_keyword">import </span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">types as types</span><span class="python_operator">
</span>
<span class="python_keyword">class </span><span class="python_name">MyType</span><span class="python_enclosure">(</span><span class="python_name">types</span><span class="python_operator">.</span><span class="python_name">TypeEngine</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">def </span><span class="python_name">__init__</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">precision </span><span class="python_operator">= </span><span class="python_number">8</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">precision </span><span class="python_operator">= </span><span class="python_name">precision</span><span class="python_operator">
    </span><span class="python_keyword">def </span><span class="python_name">get_col_spec</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_keyword">return </span><span class="python_literal">"MYTYPE(%s)" </span><span class="python_operator">% </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">precision</span><span class="python_operator">
    </span><span class="python_keyword">def </span><span class="python_name">convert_bind_param</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">value</span><span class="python_operator">, </span><span class="python_name">engine</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_keyword">return </span><span class="python_name">value</span><span class="python_operator">
    </span><span class="python_keyword">def </span><span class="python_name">convert_result_value</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">value</span><span class="python_operator">, </span><span class="python_name">engine</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_keyword">return </span><span class="python_name">value</span><span class="python_operator">
    </span><span class="python_keyword">def </span><span class="python_name">adapt</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">typeobj</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_literal">"""produces an adaptation of this object given a type which is a subclass of this object"""</span><span class="python_operator">
        </span><span class="python_keyword">return </span><span class="python_name">typeobj</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">precision</span><span class="python_enclosure">)</span><span class="python_operator">
    </span><span class="python_keyword">def </span><span class="python_name">adapt_args</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_literal">"""allows for the adaptation of this TypeEngine object into a new kind of type depending on its arguments."""</span><span class="python_operator">
        </span><span class="python_keyword">return </span><span class="python_name">self</span><span class="python_operator"></span></pre></div>


    </div>


    <a href="#types" class="toclink">back to section top</a>


</div>




    <hr width="400px" align="left" />

</div>


		</div>
		<div class="section">
					
			<A name="docstrings"></a>
			<div class="topnavmargin">
			
	
<div class="topnav">


	
	<div class="topnavcontrol">
	View: <a href="index.html">Paged</a> &nbsp;|&nbsp; <b>One Page</b>
	</div>



<div class="topnavsectionlink">

<a href="#top">Table of Contents</a>

<div class="prevnext">
Previous: <a href="#types">The Types System</a>



</div>
</div>


<div class="topnavmain">
	<div class="topnavheader">Modules and Classes</div>
	<div class="topnavitems">
	


    
    
    <div class="toclink">
        <A style="" href="#docstrings_sqlalchemy.schema">Module sqlalchemy.schema</a>
    </div>
    
    <div class="toclinkcontainer">
        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#docstrings_sqlalchemy.schema_Column">Class Column(ColumnClause)</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#docstrings_sqlalchemy.schema_ColumnDefault">Class ColumnDefault(DefaultGenerator)</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#docstrings_sqlalchemy.schema_ForeignKey">Class ForeignKey(SchemaItem)</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#docstrings_sqlalchemy.schema_Index">Class Index(SchemaItem)</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#docstrings_sqlalchemy.schema_PassiveDefault">Class PassiveDefault(DefaultGenerator)</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#docstrings_sqlalchemy.schema_SchemaEngine">Class SchemaEngine(object)</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#docstrings_sqlalchemy.schema_SchemaItem">Class SchemaItem(object)</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#docstrings_sqlalchemy.schema_SchemaVisitor">Class SchemaVisitor(ClauseVisitor)</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#docstrings_sqlalchemy.schema_Sequence">Class Sequence(DefaultGenerator)</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#docstrings_sqlalchemy.schema_Table">Class Table(TableClause)</a>
    </div>

    </div>


    </div>


    
    
    <div class="toclink">
        <A style="" href="#docstrings_sqlalchemy.engine">Module sqlalchemy.engine</a>
    </div>
    
    <div class="toclinkcontainer">
        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#docstrings_sqlalchemy.engine_modfunc">Module Functions</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#docstrings_sqlalchemy.engine_SQLEngine">Class SQLEngine(SchemaEngine)</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#docstrings_sqlalchemy.engine_ResultProxy">Class ResultProxy</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#docstrings_sqlalchemy.engine_RowProxy">Class RowProxy</a>
    </div>

    </div>


    </div>


    
    
    <div class="toclink">
        <A style="" href="#docstrings_sqlalchemy.sql">Module sqlalchemy.sql</a>
    </div>
    
    <div class="toclinkcontainer">
        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#docstrings_sqlalchemy.sql_modfunc">Module Functions</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#docstrings_sqlalchemy.sql_ClauseParameters">Class ClauseParameters(OrderedDict)</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#docstrings_sqlalchemy.sql_Compiled">Class Compiled(ClauseVisitor)</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#docstrings_sqlalchemy.sql_ClauseElement">Class ClauseElement(object)</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#docstrings_sqlalchemy.sql_TableClause">Class TableClause(FromClause)</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#docstrings_sqlalchemy.sql_ColumnClause">Class ColumnClause(ColumnElement)</a>
    </div>

    </div>


    </div>


    
    
    <div class="toclink">
        <A style="" href="#docstrings_sqlalchemy.pool">Module sqlalchemy.pool</a>
    </div>
    
    <div class="toclinkcontainer">
        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#docstrings_sqlalchemy.pool_modfunc">Module Functions</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#docstrings_sqlalchemy.pool_DBProxy">Class DBProxy(object)</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#docstrings_sqlalchemy.pool_Pool">Class Pool(object)</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#docstrings_sqlalchemy.pool_QueuePool">Class QueuePool(Pool)</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#docstrings_sqlalchemy.pool_SingletonThreadPool">Class SingletonThreadPool(Pool)</a>
    </div>

    </div>


    </div>


    
    
    <div class="toclink">
        <A style="" href="#docstrings_sqlalchemy.mapping">Module sqlalchemy.mapping</a>
    </div>
    
    <div class="toclinkcontainer">
        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#docstrings_sqlalchemy.mapping_modfunc">Module Functions</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#docstrings_sqlalchemy.mapping_MapperExtension">Class MapperExtension(object)</a>
    </div>

    </div>


    </div>


    
    
    <div class="toclink">
        <A style="" href="#docstrings_sqlalchemy.mapping.objectstore">Module sqlalchemy.mapping.objectstore</a>
    </div>
    
    <div class="toclinkcontainer">
        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#docstrings_sqlalchemy.mapping.objectstore_modfunc">Module Functions</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#docstrings_sqlalchemy.mapping.objectstore_Session">Class Session(object)</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#docstrings_sqlalchemy.mapping.objectstore_SessionTrans">Class SessionTrans(object)</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#docstrings_sqlalchemy.mapping.objectstore_UnitOfWork">Class UnitOfWork(object)</a>
    </div>

    </div>


    </div>


    
    
    <div class="toclink">
        <A style="" href="#docstrings_sqlalchemy.exceptions">Module sqlalchemy.exceptions</a>
    </div>
    
    <div class="toclinkcontainer">
        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#docstrings_sqlalchemy.exceptions_ArgumentError">Class ArgumentError</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#docstrings_sqlalchemy.exceptions_AssertionError">Class AssertionError</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#docstrings_sqlalchemy.exceptions_CommitError">Class CommitError</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#docstrings_sqlalchemy.exceptions_DBAPIError">Class DBAPIError</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#docstrings_sqlalchemy.exceptions_InvalidRequestError">Class InvalidRequestError</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#docstrings_sqlalchemy.exceptions_SQLAlchemyError">Class SQLAlchemyError</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#docstrings_sqlalchemy.exceptions_SQLError">Class SQLError</a>
    </div>

    </div>


    </div>


    
    
    <div class="toclink">
        <A style="" href="#docstrings_sqlalchemy.ext.proxy">Module sqlalchemy.ext.proxy</a>
    </div>
    
    <div class="toclinkcontainer">
        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#docstrings_sqlalchemy.ext.proxy_modfunc">Module Functions</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#docstrings_sqlalchemy.ext.proxy_AutoConnectEngine">Class AutoConnectEngine(BaseProxyEngine)</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#docstrings_sqlalchemy.ext.proxy_BaseProxyEngine">Class BaseProxyEngine(SchemaEngine)</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#docstrings_sqlalchemy.ext.proxy_ProxyEngine">Class ProxyEngine(BaseProxyEngine)</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#docstrings_sqlalchemy.ext.proxy_ProxyType">Class ProxyType(object)</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#docstrings_sqlalchemy.ext.proxy_ProxyTypeEngine">Class ProxyTypeEngine(object)</a>
    </div>

    </div>


        
        
    <div class="toclinkcontainer">
    
    <div class="smalltoclink">
    <A href="#docstrings_sqlalchemy.ext.proxy_TypeEngine">Class TypeEngine(object)</a>
    </div>

    </div>


    </div>



	</div>
</div>

</div>

			</div>

			




<div class="subsection" style="margin-left:10px;">

    <div class="sectiontext">





        

			




        

			




        

			




        

			




        

			




        

			




        

			




        

			





    </div>

        



<A name="docstrings_sqlalchemy.schema"></a>

<div class="subsection" style="margin-left:20px;">

    <span class="sectionheadertext">Module sqlalchemy.schema</span>
    <div class="sectiontext">


<p>
    the schema module provides the building blocks for database metadata.  This means all the entities within a SQL database that we might want to look at, modify, or create and delete are described by these objects, in a database-agnostic way.   </p>
<p>A structure of SchemaItems also provides a &quot;visitor&quot; interface which is the primary  method by which other methods operate upon the schema.  The SQL package extends this structure with its own clause-specific objects as well as the visitor interface, so that the schema package &quot;plugs in&quot; to the SQL package.</p>
<p></p>



    <table cellspacing="0" cellpadding="0" width="100%">
    
      
        

			



      
        

			



      
        

			



      
        

			



      
        

			



      
        

			



      
        

			



      
        

			



      
        

			



      
        

			




    </table>


    </div>

        



<A name="docstrings_sqlalchemy.schema_Column"></a>

<div class="subsection" style="margin-left:30px;">

    <span class="sectionheadertext">Class Column(ColumnClause)</span>
    <div class="sectiontext">


<p>
    represents a column in a database table.  this is a subclass of sql.ColumnClause and     represents an actual existing table in the database, in a similar fashion as TableClause/Table.
</p>


    <table cellspacing="0" cellpadding="0" width="100%">
    
    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.schema_Column_def __init__"></a>
        <b>def __init__(<i>self</i>, <i>name</i>, <i>type</i>, <i>*args</i>, <i>**kwargs</i>)</b>
        <div class="docstring">
    <p>
    constructs a new Column object.  Arguments are:
                 name : the name of this column.  this should be the identical name as it appears,
        or will appear, in the database.
                 type : this is the type of column. This can be any subclass of types.TypeEngine,
        including the database-agnostic types defined in the types module, database-specific types         defined within specific database modules, or user-defined types.
                 *args : ForeignKey and Sequence objects should be added as list values.
                 **kwargs : keyword arguments include:
                 key=None : an optional &quot;alias name&quot; for this column.  The column will then be identified everywhere         in an application, including the column list on its Table, by this key, and not the given name.           Generated SQL, however, will still reference the column by its actual name.
                 primary_key=False : True if this column is a primary key column.  Multiple columns can have this flag         set to specify composite primary keys.
                 nullable=True : True if this column should allow nulls. Defaults to True unless this column is a primary         key column.
                 default=None : a scalar, python callable, or ClauseElement representing the &quot;default value&quot; for this column,
        which will be invoked upon insert if this column is not present in the insert list or is given a value         of None.
                 hidden=False : indicates this column should not be listed in the         table's list of columns.  Used for the &quot;oid&quot; column, which generally
        isnt in column lists.</p>
<p>index=None : True or index name. Indicates that this column is
        indexed. Pass true to autogenerate the index name. Pass a string to
        specify the index name. Multiple columns that specify the same index
        name will all be included in the index, in the order of their
        creation.</p>
<p>unique=None : True or index name. Indicates that this column is
        indexed in a unique index . Pass true to autogenerate the index
        name. Pass a string to specify the index name. Multiple columns that
        specify the same index name will all be included in the index, in the
        order of their creation.  
</p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.schema_Column_def accept_schema_visitor"></a>
        <b>def accept_schema_visitor(<i>self</i>, <i>visitor</i>)</b>
        <div class="docstring">
    <p>
    traverses the given visitor to this Column's default and foreign key object,
        then calls visit_column on the visitor.
</p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.schema_Column_def append_item"></a>
        <b>def append_item(<i>self</i>, <i>item</i>)</b>
        <div class="docstring">
    <p></p>
<p></p>
    </div>
        </div>
    </td>
    </tr>


    
        
              <tr>
       <td>
           <div class="darkcell">
           <A name="docstrings_sqlalchemy.schema_Column_columns = property()"></a>
           <b>columns = property()</b></td>
           <div class="docstring">
    <p></p>
<p></p>
    </div>
           </div>
       </td>
       </tr>
    

    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.schema_Column_def copy"></a>
        <b>def copy(<i>self</i>)</b>
        <div class="docstring">
    <p>
    creates a copy of this Column, unitialized
</p>
    </div>
        </div>
    </td>
    </tr>


    
        
              <tr>
       <td>
           <div class="darkcell">
           <A name="docstrings_sqlalchemy.schema_Column_engine = property()"></a>
           <b>engine = property()</b></td>
           <div class="docstring">
    <p></p>
<p></p>
    </div>
           </div>
       </td>
       </tr>
    

    
        
              <tr>
       <td>
           <div class="darkcell">
           <A name="docstrings_sqlalchemy.schema_Column_original = property()"></a>
           <b>original = property()</b></td>
           <div class="docstring">
    <p></p>
<p></p>
    </div>
           </div>
       </td>
       </tr>
    

    
        
              <tr>
       <td>
           <div class="darkcell">
           <A name="docstrings_sqlalchemy.schema_Column_parent = property()"></a>
           <b>parent = property()</b></td>
           <div class="docstring">
    <p></p>
<p></p>
    </div>
           </div>
       </td>
       </tr>
    


    </table>



    </div>


    <a href="#docstrings" class="toclink">back to section top</a>


</div>


        



<A name="docstrings_sqlalchemy.schema_ColumnDefault"></a>

<div class="subsection" style="margin-left:30px;">

    <span class="sectionheadertext">Class ColumnDefault(DefaultGenerator)</span>
    <div class="sectiontext">


<p>
    A plain default value on a column.  this could correspond to a constant,      a callable function, or a SQL clause.
</p>


    <table cellspacing="0" cellpadding="0" width="100%">
    
    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.schema_ColumnDefault_def __init__"></a>
        <b>def __init__(<i>self</i>, <i>arg</i>, <i>**kwargs</i>)</b>
        <div class="docstring">
    <p></p>
<p></p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.schema_ColumnDefault_def accept_schema_visitor"></a>
        <b>def accept_schema_visitor(<i>self</i>, <i>visitor</i>)</b>
        <div class="docstring">
    <p>
    calls the visit_column_default method on the given visitor.
</p>
    </div>
        </div>
    </td>
    </tr>



    </table>



    </div>


    <a href="#docstrings" class="toclink">back to section top</a>


</div>


        



<A name="docstrings_sqlalchemy.schema_ForeignKey"></a>

<div class="subsection" style="margin-left:30px;">

    <span class="sectionheadertext">Class ForeignKey(SchemaItem)</span>
    <div class="sectiontext">


<p>
    defines a ForeignKey constraint between two columns.  ForeignKey is      specified as an argument to a Column object.
</p>


    <table cellspacing="0" cellpadding="0" width="100%">
    
    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.schema_ForeignKey_def __init__"></a>
        <b>def __init__(<i>self</i>, <i>column</i>)</b>
        <div class="docstring">
    <p>
    Constructs a new ForeignKey object.  &quot;column&quot; can be a schema.Column         object representing the relationship, or just its string name given as          &quot;tablename.columnname&quot;.  schema can be specified as          &quot;schemaname.tablename.columnname&quot; 
</p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.schema_ForeignKey_def accept_schema_visitor"></a>
        <b>def accept_schema_visitor(<i>self</i>, <i>visitor</i>)</b>
        <div class="docstring">
    <p>
    calls the visit_foreign_key method on the given visitor.
</p>
    </div>
        </div>
    </td>
    </tr>


    
        
              <tr>
       <td>
           <div class="darkcell">
           <A name="docstrings_sqlalchemy.schema_ForeignKey_column = property()"></a>
           <b>column = property()</b></td>
           <div class="docstring">
    <p></p>
<p></p>
    </div>
           </div>
       </td>
       </tr>
    

    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.schema_ForeignKey_def copy"></a>
        <b>def copy(<i>self</i>)</b>
        <div class="docstring">
    <p>
    produces a copy of this ForeignKey object.
</p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.schema_ForeignKey_def references"></a>
        <b>def references(<i>self</i>, <i>table</i>)</b>
        <div class="docstring">
    <p>
    returns True if the given table is referenced by this ForeignKey.
</p>
    </div>
        </div>
    </td>
    </tr>



    </table>



    </div>


    <a href="#docstrings" class="toclink">back to section top</a>


</div>


        



<A name="docstrings_sqlalchemy.schema_Index"></a>

<div class="subsection" style="margin-left:30px;">

    <span class="sectionheadertext">Class Index(SchemaItem)</span>
    <div class="sectiontext">


<p>
    Represents an index of columns from a database table     
</p>


    <table cellspacing="0" cellpadding="0" width="100%">
    
    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.schema_Index_def __init__"></a>
        <b>def __init__(<i>self</i>, <i>name</i>, <i>*columns</i>, <i>**kw</i>)</b>
        <div class="docstring">
    <p>
    Constructs an index object. Arguments are:</p>
<p>name : the name of the index</p>
<p>*columns : columns to include in the index. All columns must belong to         the same table, and no column may appear more than once.</p>
<p>**kw : keyword arguments include:</p>
<p>unique=True : create a unique index         
</p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.schema_Index_def accept_schema_visitor"></a>
        <b>def accept_schema_visitor(<i>self</i>, <i>visitor</i>)</b>
        <div class="docstring">
    <p></p>
<p></p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.schema_Index_def append_column"></a>
        <b>def append_column(<i>self</i>, <i>column</i>)</b>
        <div class="docstring">
    <p></p>
<p></p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.schema_Index_def create"></a>
        <b>def create(<i>self</i>)</b>
        <div class="docstring">
    <p></p>
<p></p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.schema_Index_def drop"></a>
        <b>def drop(<i>self</i>)</b>
        <div class="docstring">
    <p></p>
<p></p>
    </div>
        </div>
    </td>
    </tr>


    
        
              <tr>
       <td>
           <div class="darkcell">
           <A name="docstrings_sqlalchemy.schema_Index_engine = property()"></a>
           <b>engine = property()</b></td>
           <div class="docstring">
    <p></p>
<p></p>
    </div>
           </div>
       </td>
       </tr>
    

    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.schema_Index_def execute"></a>
        <b>def execute(<i>self</i>)</b>
        <div class="docstring">
    <p></p>
<p></p>
    </div>
        </div>
    </td>
    </tr>



    </table>



    </div>


    <a href="#docstrings" class="toclink">back to section top</a>


</div>


        



<A name="docstrings_sqlalchemy.schema_PassiveDefault"></a>

<div class="subsection" style="margin-left:30px;">

    <span class="sectionheadertext">Class PassiveDefault(DefaultGenerator)</span>
    <div class="sectiontext">


<p>
    a default that takes effect on the database side
</p>


    <table cellspacing="0" cellpadding="0" width="100%">
    
    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.schema_PassiveDefault_def __init__"></a>
        <b>def __init__(<i>self</i>, <i>arg</i>, <i>**kwargs</i>)</b>
        <div class="docstring">
    <p></p>
<p></p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.schema_PassiveDefault_def accept_schema_visitor"></a>
        <b>def accept_schema_visitor(<i>self</i>, <i>visitor</i>)</b>
        <div class="docstring">
    <p></p>
<p></p>
    </div>
        </div>
    </td>
    </tr>



    </table>



    </div>


    <a href="#docstrings" class="toclink">back to section top</a>


</div>


        



<A name="docstrings_sqlalchemy.schema_SchemaEngine"></a>

<div class="subsection" style="margin-left:30px;">

    <span class="sectionheadertext">Class SchemaEngine(object)</span>
    <div class="sectiontext">


<p>
    a factory object used to create implementations for schema objects.  This object     is the ultimate base class for the engine.SQLEngine class.
</p>


    <table cellspacing="0" cellpadding="0" width="100%">
    
    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.schema_SchemaEngine_def __init__"></a>
        <b>def __init__(<i>self</i>)</b>
        <div class="docstring">
    <p></p>
<p></p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.schema_SchemaEngine_def reflecttable"></a>
        <b>def reflecttable(<i>self</i>, <i>table</i>)</b>
        <div class="docstring">
    <p>
    given a table, will query the database and populate its Column and ForeignKey          objects.
</p>
    </div>
        </div>
    </td>
    </tr>



    </table>



    </div>


    <a href="#docstrings" class="toclink">back to section top</a>


</div>


        



<A name="docstrings_sqlalchemy.schema_SchemaItem"></a>

<div class="subsection" style="margin-left:30px;">

    <span class="sectionheadertext">Class SchemaItem(object)</span>
    <div class="sectiontext">


<p>
    base class for items that define a database schema.
</p>



    </div>


    <a href="#docstrings" class="toclink">back to section top</a>


</div>


        



<A name="docstrings_sqlalchemy.schema_SchemaVisitor"></a>

<div class="subsection" style="margin-left:30px;">

    <span class="sectionheadertext">Class SchemaVisitor(ClauseVisitor)</span>
    <div class="sectiontext">


<p>
    defines the visiting for SchemaItem objects
</p>


    <table cellspacing="0" cellpadding="0" width="100%">
    
    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.schema_SchemaVisitor_def visit_column"></a>
        <b>def visit_column(<i>self</i>, <i>column</i>)</b>
        <div class="docstring">
    <p>
    visit a Column.
</p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.schema_SchemaVisitor_def visit_column_default"></a>
        <b>def visit_column_default(<i>self</i>, <i>default</i>)</b>
        <div class="docstring">
    <p>
    visit a ColumnDefault.
</p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.schema_SchemaVisitor_def visit_column_onupdate"></a>
        <b>def visit_column_onupdate(<i>self</i>, <i>onupdate</i>)</b>
        <div class="docstring">
    <p>
    visit a ColumnDefault with the &quot;for_update&quot; flag set.
</p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.schema_SchemaVisitor_def visit_foreign_key"></a>
        <b>def visit_foreign_key(<i>self</i>, <i>join</i>)</b>
        <div class="docstring">
    <p>
    visit a ForeignKey.
</p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.schema_SchemaVisitor_def visit_index"></a>
        <b>def visit_index(<i>self</i>, <i>index</i>)</b>
        <div class="docstring">
    <p>
    visit an Index.
</p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.schema_SchemaVisitor_def visit_passive_default"></a>
        <b>def visit_passive_default(<i>self</i>, <i>default</i>)</b>
        <div class="docstring">
    <p>
    visit a passive default
</p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.schema_SchemaVisitor_def visit_schema"></a>
        <b>def visit_schema(<i>self</i>, <i>schema</i>)</b>
        <div class="docstring">
    <p>
    visit a generic SchemaItem
</p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.schema_SchemaVisitor_def visit_sequence"></a>
        <b>def visit_sequence(<i>self</i>, <i>sequence</i>)</b>
        <div class="docstring">
    <p>
    visit a Sequence.
</p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.schema_SchemaVisitor_def visit_table"></a>
        <b>def visit_table(<i>self</i>, <i>table</i>)</b>
        <div class="docstring">
    <p>
    visit a Table.
</p>
    </div>
        </div>
    </td>
    </tr>



    </table>



    </div>


    <a href="#docstrings" class="toclink">back to section top</a>


</div>


        



<A name="docstrings_sqlalchemy.schema_Sequence"></a>

<div class="subsection" style="margin-left:30px;">

    <span class="sectionheadertext">Class Sequence(DefaultGenerator)</span>
    <div class="sectiontext">


<p>
    represents a sequence, which applies to Oracle and Postgres databases.
</p>


    <table cellspacing="0" cellpadding="0" width="100%">
    
    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.schema_Sequence_def __init__"></a>
        <b>def __init__(<i>self</i>, <i>name</i>, <i>start=None</i>, <i>increment=None</i>, <i>optional=False</i>, <i>**kwargs</i>)</b>
        <div class="docstring">
    <p></p>
<p></p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.schema_Sequence_def accept_schema_visitor"></a>
        <b>def accept_schema_visitor(<i>self</i>, <i>visitor</i>)</b>
        <div class="docstring">
    <p>
    calls the visit_seauence method on the given visitor.
</p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.schema_Sequence_def create"></a>
        <b>def create(<i>self</i>)</b>
        <div class="docstring">
    <p></p>
<p></p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.schema_Sequence_def drop"></a>
        <b>def drop(<i>self</i>)</b>
        <div class="docstring">
    <p></p>
<p></p>
    </div>
        </div>
    </td>
    </tr>



    </table>



    </div>


    <a href="#docstrings" class="toclink">back to section top</a>


</div>


        



<A name="docstrings_sqlalchemy.schema_Table"></a>

<div class="subsection" style="margin-left:30px;">

    <span class="sectionheadertext">Class Table(TableClause)</span>
    <div class="sectiontext">


<p>
    represents a relational database table.  This subclasses sql.TableClause to provide     a table that is &quot;wired&quot; to an engine.  Whereas TableClause represents a table as its      used in a SQL expression, Table represents a table as its created in the database.            Be sure to look at sqlalchemy.sql.TableImpl for additional methods defined on a Table.
</p>


    <table cellspacing="0" cellpadding="0" width="100%">
    
    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.schema_Table_def __init__"></a>
        <b>def __init__(<i>self</i>, <i>name</i>, <i>engine</i>, <i>**kwargs</i>)</b>
        <div class="docstring">
    <p>
    Table objects can be constructed directly.  The init method is actually called via          the TableSingleton metaclass.  Arguments are:
                 name : the name of this table, exactly as it appears, or will appear, in the database.
        This property, along with the &quot;schema&quot;, indicates the &quot;singleton identity&quot; of this table.
        Further tables constructed with the same name/schema combination will return the same          Table instance.
                 engine : a SchemaEngine instance to provide services to this table.  Usually a subclass of         sql.SQLEngine.
                 *args : should contain a listing of the Column objects for this table.
                 **kwargs : options include:
                 schema=None : the &quot;schema name&quot; for this table, which is required if the table resides in a          schema other than the default selected schema for the engine's database connection.
                 autoload=False : the Columns for this table should be reflected from the database.  Usually         there will be no Column objects in the constructor if this property is set.
                 redefine=False : if this Table has already been defined in the application, clear out its columns         and redefine with new arguments.
                 mustexist=False : indicates that this Table must already have been defined elsewhere in the application,
        else an exception is raised.
                 useexisting=False : indicates that if this Table was already defined elsewhere in the application, disregard         the rest of the constructor arguments.  If this flag and the &quot;redefine&quot; flag are not set, constructing 
        the same table twice will result in an exception.</p>
<p></p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.schema_Table_def accept_schema_visitor"></a>
        <b>def accept_schema_visitor(<i>self</i>, <i>visitor</i>)</b>
        <div class="docstring">
    <p>
    traverses the given visitor across the Column objects inside this Table,
        then calls the visit_table method on the visitor.
</p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.schema_Table_def append_column"></a>
        <b>def append_column(<i>self</i>, <i>column</i>)</b>
        <div class="docstring">
    <p></p>
<p></p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.schema_Table_def append_index"></a>
        <b>def append_index(<i>self</i>, <i>index</i>)</b>
        <div class="docstring">
    <p></p>
<p></p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.schema_Table_def append_index_column"></a>
        <b>def append_index_column(<i>self</i>, <i>column</i>, <i>index=None</i>, <i>unique=None</i>)</b>
        <div class="docstring">
    <p>
    Add an index or a column to an existing index of the same name.</p>
<p></p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.schema_Table_def append_item"></a>
        <b>def append_item(<i>self</i>, <i>item</i>)</b>
        <div class="docstring">
    <p>
    appends a Column item or other schema item to this Table.
</p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.schema_Table_def create"></a>
        <b>def create(<i>self</i>, <i>**params</i>)</b>
        <div class="docstring">
    <p></p>
<p></p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.schema_Table_def deregister"></a>
        <b>def deregister(<i>self</i>)</b>
        <div class="docstring">
    <p>
    removes this table from it's engines table registry.  this does not         issue a SQL DROP statement.
</p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.schema_Table_def drop"></a>
        <b>def drop(<i>self</i>, <i>**params</i>)</b>
        <div class="docstring">
    <p></p>
<p></p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.schema_Table_def reload_values"></a>
        <b>def reload_values(<i>self</i>, <i>*args</i>)</b>
        <div class="docstring">
    <p>
    clears out the columns and other properties of this Table, and reloads them from the          given argument list.  This is used with the &quot;redefine&quot; keyword argument sent to the         metaclass constructor.
</p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.schema_Table_def toengine"></a>
        <b>def toengine(<i>self</i>, <i>engine</i>, <i>schema=None</i>)</b>
        <div class="docstring">
    <p>
    returns a singleton instance of this Table with a different engine
</p>
    </div>
        </div>
    </td>
    </tr>



    </table>



    </div>


    <a href="#docstrings" class="toclink">back to section top</a>


</div>





</div>


        



<A name="docstrings_sqlalchemy.engine"></a>

<div class="subsection" style="margin-left:20px;">

    <span class="sectionheadertext">Module sqlalchemy.engine</span>
    <div class="sectiontext">


<p>
    Defines the SQLEngine class, which serves as the primary &quot;database&quot; object used throughout the sql construction and object-relational mapper packages.
A SQLEngine is a facade around a single connection pool corresponding to a  particular set of connection parameters, and provides thread-local transactional  methods and statement execution methods for Connection objects.  It also provides  a facade around a Cursor object to allow richer column selection for result rows  as well as type conversion operations, known as a ResultProxy.</p>
<p>A SQLEngine is provided to an application as a subclass that is specific to a particular type  of DBAPI, and is the central switching point for abstracting different kinds of database behavior into a consistent set of behaviors.  It provides a variety of factory methods  to produce everything specific to a certain kind of database, including a Compiler,  schema creation/dropping objects.</p>
<p>The term &quot;database-specific&quot; will be used to describe any object or function that has behavior corresponding to a particular vendor, such as mysql-specific, sqlite-specific, etc.</p>
<p></p>


			


    <table cellspacing="0" cellpadding="0" width="100%">
    
      
        

			



      
        

			



      
        

			




    </table>


    </div>

        



<A name="docstrings_sqlalchemy.engine_modfunc"></a>

<div class="subsection" style="margin-left:30px;">

    <span class="sectionheadertext">Module Functions</span>
    <div class="sectiontext">



    <table cellspacing="0" cellpadding="0" width="100%">
    
    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.engine_modfunc_def create_engine"></a>
        <b>def create_engine(<i>name</i>, <i>opts=None</i>, <i>**kwargs</i>)</b>
        <div class="docstring">
    <p>
    creates a new SQLEngine instance.  There are two forms of calling this method.
         In the first, the &quot;name&quot; argument is the type of engine to load, i.e. 'sqlite', 'postgres',      'oracle', 'mysql'.  &quot;opts&quot; is a dictionary of options to be sent to the underlying DBAPI module      to create a connection, usually including a hostname, username, password, etc.
         In the second, the &quot;name&quot; argument is a URL in the form &lt;enginename&gt;://opt1=val1&amp;opt2=val2.       Where &lt;enginename&gt; is the name as above, and the contents of the option dictionary are      spelled out as a URL encoded string.  The &quot;opts&quot; argument is not used.
         In both cases, **kwargs represents options to be sent to the SQLEngine itself.  A possibly     partial listing of those options is as follows:
         pool=None : an instance of sqlalchemy.pool.DBProxy to be used as the underlying source      for connections (DBProxy is described in the previous section).  If None, a default DBProxy      will be created using the engine's own database module with the given arguments.
         echo=False : if True, the SQLEngine will log all statements as well as a repr() of their      parameter lists to the engines logger, which defaults to sys.stdout.  A SQLEngine instances'      &quot;echo&quot; data member can be modified at any time to turn logging on and off.  If set to the string      'debug', result rows will be printed to the standard output as well.
         logger=None : a file-like object where logging output can be sent, if echo is set to True.  
    This defaults to sys.stdout.</p>
<p>module=None : used by Oracle and Postgres, this is a reference to a DBAPI2 module to be used 
    instead of the engine's default module.  For Postgres, the default is psycopg2, or psycopg1 if 
    2 cannot be found.  For Oracle, its cx_Oracle.  For mysql, MySQLdb.</p>
<p>use_ansi=True : used only by Oracle;  when False, the Oracle driver attempts to support a 
    particular &quot;quirk&quot; of some Oracle databases, that the LEFT OUTER JOIN SQL syntax is not 
    supported, and the &quot;Oracle join&quot; syntax of using &lt;column1&gt;(+)=&lt;column2&gt; must be used 
    in order to achieve a LEFT OUTER JOIN.  Its advised that the Oracle database be configured to 
    have full ANSI support instead of using this feature.</p>
<p></p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.engine_modfunc_def engine_descriptors"></a>
        <b>def engine_descriptors()</b>
        <div class="docstring">
    <p>
    provides a listing of all the database implementations supported.  this data     is provided as a list of dictionaries, where each dictionary contains the following     key/value pairs:
         name :       the name of the engine, suitable for use in the create_engine function</p>
<p>description: a plain description of the engine.</p>
<p>arguments :  a dictionary describing the name and description of each parameter                  used to connect to this engine's underlying DBAPI.
         This function is meant for usage in automated configuration tools that wish to      query the user for database and connection information.</p>
<p></p>
    </div>
        </div>
    </td>
    </tr>



    </table>


    </div>


    <a href="#docstrings" class="toclink">back to section top</a>


</div>


        



<A name="docstrings_sqlalchemy.engine_SQLEngine"></a>

<div class="subsection" style="margin-left:30px;">

    <span class="sectionheadertext">Class SQLEngine(SchemaEngine)</span>
    <div class="sectiontext">


<p></p>
<p>The central &quot;database&quot; object used by an application.  Subclasses of this object is used     by the schema and SQL construction packages to provide database-specific behaviors,
    as well as an execution and thread-local transaction context.
         SQLEngines are constructed via the create_engine() function inside this package.</p>
<p></p>


    <table cellspacing="0" cellpadding="0" width="100%">
    
    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.engine_SQLEngine_def __init__"></a>
        <b>def __init__(<i>self</i>, <i>pool=None</i>, <i>echo=False</i>, <i>logger=None</i>, <i>default_ordering=False</i>, <i>echo_pool=False</i>, <i>echo_uow=False</i>, <i>convert_unicode=False</i>, <i>encoding='utf-8'</i>, <i>**params</i>)</b>
        <div class="docstring">
    <p>
    constructs a new SQLEngine.   SQLEngines should be constructed via the create_engine()
        function which will construct the appropriate subclass of SQLEngine.
</p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.engine_SQLEngine_def begin"></a>
        <b>def begin(<i>self</i>)</b>
        <div class="docstring">
    <p>
    &quot;begins&quot; a transaction on a pooled connection, and stores the connection in a thread-local         context.  repeated calls to begin() within the same thread will increment a counter that must be         decreased by corresponding commit() statements before an actual commit occurs.  this is to provide         &quot;nested&quot; behavior of transactions so that different functions can all call begin()/commit() and still         call each other.
</p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.engine_SQLEngine_def commit"></a>
        <b>def commit(<i>self</i>)</b>
        <div class="docstring">
    <p>
    commits the current thread-local transaction started by begin().  If begin() was called multiple         times, a counter will be decreased for each call to commit(), with the actual commit operation occuring         when the counter reaches zero.  this is to provide         &quot;nested&quot; behavior of transactions so that different functions can all call begin()/commit() and still         call each other.
</p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.engine_SQLEngine_def compile"></a>
        <b>def compile(<i>self</i>, <i>statement</i>, <i>parameters</i>, <i>**kwargs</i>)</b>
        <div class="docstring">
    <p>
    given a sql.ClauseElement statement plus optional bind parameters, creates a new         instance of this engine's SQLCompiler, compiles the ClauseElement, and returns the         newly compiled object.
</p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.engine_SQLEngine_def compiler"></a>
        <b>def compiler(<i>self</i>, <i>statement</i>, <i>parameters</i>)</b>
        <div class="docstring">
    <p>
    returns a sql.ClauseVisitor which will produce a string representation of the given         ClauseElement and parameter dictionary.  This object is usually a subclass of          ansisql.ANSICompiler.                    compiler is called within the context of the compile() method.
</p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.engine_SQLEngine_def connect_args"></a>
        <b>def connect_args(<i>self</i>)</b>
        <div class="docstring">
    <p>
    subclasses override this method to provide a two-item tuple containing the *args         and **kwargs used to establish a connection.
</p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.engine_SQLEngine_def connection"></a>
        <b>def connection(<i>self</i>)</b>
        <div class="docstring">
    <p>
    returns a managed DBAPI connection from this SQLEngine's connection pool.
</p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.engine_SQLEngine_def create"></a>
        <b>def create(<i>self</i>, <i>entity</i>, <i>**params</i>)</b>
        <div class="docstring">
    <p>
    creates a table or index within this engine's database connection given a schema.Table object.
</p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.engine_SQLEngine_def dbapi"></a>
        <b>def dbapi(<i>self</i>)</b>
        <div class="docstring">
    <p>
    subclasses override this method to provide the DBAPI module used to establish         connections.
</p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.engine_SQLEngine_def defaultrunner"></a>
        <b>def defaultrunner(<i>self</i>, <i>proxy=None</i>)</b>
        <div class="docstring">
    <p>
    Returns a schema.SchemaVisitor instance that can execute the default values on a column.
        The base class for this visitor is the DefaultRunner class inside this module.
        This visitor will typically only receive schema.DefaultGenerator schema objects.  The given          proxy is a callable that takes a string statement and a dictionary of bind parameters         to be executed.  For engines that require positional arguments, the dictionary should          be an instance of OrderedDict which returns its bind parameters in the proper order.
                 defaultrunner is called within the context of the execute_compiled() method.
</p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.engine_SQLEngine_def dispose"></a>
        <b>def dispose(<i>self</i>)</b>
        <div class="docstring">
    <p>
    disposes of the underlying pool manager for this SQLEngine.
</p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.engine_SQLEngine_def do_begin"></a>
        <b>def do_begin(<i>self</i>, <i>connection</i>)</b>
        <div class="docstring">
    <p>
    implementations might want to put logic here for turning autocommit on/off,
        etc.
</p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.engine_SQLEngine_def do_commit"></a>
        <b>def do_commit(<i>self</i>, <i>connection</i>)</b>
        <div class="docstring">
    <p>
    implementations might want to put logic here for turning autocommit on/off, etc.
</p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.engine_SQLEngine_def do_rollback"></a>
        <b>def do_rollback(<i>self</i>, <i>connection</i>)</b>
        <div class="docstring">
    <p>
    implementations might want to put logic here for turning autocommit on/off,
        etc.
</p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.engine_SQLEngine_def drop"></a>
        <b>def drop(<i>self</i>, <i>entity</i>, <i>**params</i>)</b>
        <div class="docstring">
    <p>
    drops a table or index within this engine's database connection given a schema.Table object.
</p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.engine_SQLEngine_def execute"></a>
        <b>def execute(<i>self</i>, <i>statement</i>, <i>parameters=None</i>, <i>connection=None</i>, <i>cursor=None</i>, <i>echo=None</i>, <i>typemap=None</i>, <i>commit=False</i>, <i>return_raw=False</i>, <i>**kwargs</i>)</b>
        <div class="docstring">
    <p>
    executes the given string-based SQL statement with the given parameters.  </p>
<p>The parameters can be a dictionary or a list, or a list of dictionaries or lists, depending         on the paramstyle of the DBAPI.
                 If the current thread has specified a transaction begin() for this engine, the         statement will be executed in the context of the current transactional connection.
        Otherwise, a commit() will be performed immediately after execution, since the local         pooled connection is returned to the pool after execution without a transaction set         up.</p>
<p>In all error cases, a rollback() is immediately performed on the connection before         propigating the exception outwards.</p>
<p>Other options include:</p>
<p>connection  -  a DBAPI connection to use for the execute.  If None, a connection is                        pulled from this engine's connection pool.</p>
<p>echo        -  enables echo for this execution, which causes all SQL and parameters                        to be dumped to the engine's logging output before execution.</p>
<p>typemap     -  a map of column names mapped to sqlalchemy.types.TypeEngine objects.
                       These will be passed to the created ResultProxy to perform                        post-processing on result-set values.</p>
<p>commit      -  if True, will automatically commit the statement after completion. 
</p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.engine_SQLEngine_def execute_compiled"></a>
        <b>def execute_compiled(<i>self</i>, <i>compiled</i>, <i>parameters</i>, <i>connection=None</i>, <i>cursor=None</i>, <i>echo=None</i>, <i>**kwargs</i>)</b>
        <div class="docstring">
    <p>
    executes the given compiled statement object with the given parameters.  </p>
<p>The parameters can be a dictionary of key/value pairs, or a list of dictionaries for an         executemany() style of execution.  Engines that use positional parameters will convert         the parameters to a list before execution.</p>
<p>If the current thread has specified a transaction begin() for this engine, the         statement will be executed in the context of the current transactional connection.
        Otherwise, a commit() will be performed immediately after execution, since the local         pooled connection is returned to the pool after execution without a transaction set         up.</p>
<p>In all error cases, a rollback() is immediately performed on the connection before         propigating the exception outwards.</p>
<p>Other options include:</p>
<p>connection  -  a DBAPI connection to use for the execute.  If None, a connection is                        pulled from this engine's connection pool.</p>
<p>echo        -  enables echo for this execution, which causes all SQL and parameters                        to be dumped to the engine's logging output before execution.</p>
<p>typemap     -  a map of column names mapped to sqlalchemy.types.TypeEngine objects.
                       These will be passed to the created ResultProxy to perform                        post-processing on result-set values.</p>
<p>commit      -  if True, will automatically commit the statement after completion. 
</p>
    </div>
        </div>
    </td>
    </tr>


    
        
              <tr>
       <td>
           <div class="darkcell">
           <A name="docstrings_sqlalchemy.engine_SQLEngine_func = property()"></a>
           <b>func = property()</b></td>
           <div class="docstring">
    <p></p>
<p></p>
    </div>
           </div>
       </td>
       </tr>
    

    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.engine_SQLEngine_def get_default_schema_name"></a>
        <b>def get_default_schema_name(<i>self</i>)</b>
        <div class="docstring">
    <p>
    returns the currently selected schema in the current connection.
</p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.engine_SQLEngine_def hash_key"></a>
        <b>def hash_key(<i>self</i>)</b>
        <div class="docstring">
    <p></p>
<p></p>
    </div>
        </div>
    </td>
    </tr>


    
        
              <tr>
       <td>
           <div class="darkcell">
           <A name="docstrings_sqlalchemy.engine_SQLEngine_ischema = property()"></a>
           <b>ischema = property()</b></td>
           <div class="docstring">
    <p>
    returns an ISchema object for this engine, which allows access to information_schema tables (if supported)
</p>
    </div>
           </div>
       </td>
       </tr>
    

    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.engine_SQLEngine_def last_inserted_ids"></a>
        <b>def last_inserted_ids(<i>self</i>)</b>
        <div class="docstring">
    <p>
    returns a thread-local list of the primary key values for the last insert statement executed.
        This does not apply to straight textual clauses; only to sql.Insert objects compiled against          a schema.Table object, which are executed via statement.execute().  The order of items in the          list is the same as that of the Table's 'primary_key' attribute.
                 In some cases, this method may invoke a query back to the database to retrieve the data, based on         the &quot;lastrowid&quot; value in the cursor.
</p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.engine_SQLEngine_def last_inserted_params"></a>
        <b>def last_inserted_params(<i>self</i>)</b>
        <div class="docstring">
    <p>
    returns a dictionary of the full parameter dictionary for the last compiled INSERT statement,
        including any ColumnDefaults or Sequences that were pre-executed.  this value is thread-local.
</p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.engine_SQLEngine_def last_updated_params"></a>
        <b>def last_updated_params(<i>self</i>)</b>
        <div class="docstring">
    <p>
    returns a dictionary of the full parameter dictionary for the last compiled UPDATE statement,
        including any ColumnDefaults that were pre-executed. this value is thread-local.
</p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.engine_SQLEngine_def lastrow_has_defaults"></a>
        <b>def lastrow_has_defaults(<i>self</i>)</b>
        <div class="docstring">
    <p>
    returns True if the last row INSERTED via a compiled insert statement contained PassiveDefaults,
        indicating that the database inserted data beyond that which we gave it. this value is thread-local.
</p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.engine_SQLEngine_def log"></a>
        <b>def log(<i>self</i>, <i>msg</i>)</b>
        <div class="docstring">
    <p>
    logs a message using this SQLEngine's logger stream.
</p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.engine_SQLEngine_def multi_transaction"></a>
        <b>def multi_transaction(<i>self</i>, <i>tables</i>, <i>func</i>)</b>
        <div class="docstring">
    <p>
    provides a transaction boundary across tables which may be in multiple databases.
        If you have three tables, and a function that operates upon them, providing the tables as a          list and the function will result in a begin()/commit() pair invoked for each distinct engine         represented within those tables, and the function executed within the context of that transaction.
        any exceptions will result in a rollback().
                 clearly, this approach only goes so far, such as if database A commits, then database B commits         and fails, A is already committed.  Any failure conditions have to be raised before anyone         commits for this to be useful.
</p>
    </div>
        </div>
    </td>
    </tr>


    
        
              <tr>
       <td>
           <div class="darkcell">
           <A name="docstrings_sqlalchemy.engine_SQLEngine_name = property()"></a>
           <b>name = property()</b></td>
           <div class="docstring">
    <p></p>
<p></p>
    </div>
           </div>
       </td>
       </tr>
    

    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.engine_SQLEngine_def oid_column_name"></a>
        <b>def oid_column_name(<i>self</i>)</b>
        <div class="docstring">
    <p>
    returns the oid column name for this engine, or None if the engine cant/wont support OID/ROWID.
</p>
    </div>
        </div>
    </td>
    </tr>


    
        
              <tr>
       <td>
           <div class="darkcell">
           <A name="docstrings_sqlalchemy.engine_SQLEngine_paramstyle = property()"></a>
           <b>paramstyle = property()</b></td>
           <div class="docstring">
    <p></p>
<p></p>
    </div>
           </div>
       </td>
       </tr>
    

    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.engine_SQLEngine_def post_exec"></a>
        <b>def post_exec(<i>self</i>, <i>proxy</i>, <i>compiled</i>, <i>parameters</i>, <i>**kwargs</i>)</b>
        <div class="docstring">
    <p>
    called by execute_compiled after the compiled statement is executed.
</p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.engine_SQLEngine_def pre_exec"></a>
        <b>def pre_exec(<i>self</i>, <i>proxy</i>, <i>compiled</i>, <i>parameters</i>, <i>**kwargs</i>)</b>
        <div class="docstring">
    <p>
    called by execute_compiled before the compiled statement is executed.
</p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.engine_SQLEngine_def proxy"></a>
        <b>def proxy(<i>self</i>, <i>statement=None</i>, <i>parameters=None</i>)</b>
        <div class="docstring">
    <p></p>
<p></p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.engine_SQLEngine_def reflecttable"></a>
        <b>def reflecttable(<i>self</i>, <i>table</i>)</b>
        <div class="docstring">
    <p>
    given a Table object, reflects its columns and properties from the database.
</p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.engine_SQLEngine_def rollback"></a>
        <b>def rollback(<i>self</i>)</b>
        <div class="docstring">
    <p>
    rolls back the current thread-local transaction started by begin().  the &quot;begin&quot; counter          is cleared and the transaction ended.
</p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.engine_SQLEngine_def schemadropper"></a>
        <b>def schemadropper(<i>self</i>, <i>**params</i>)</b>
        <div class="docstring">
    <p>
    returns a schema.SchemaVisitor instance that can drop schemas, when it is         invoked to traverse a set of schema objects.                   schemagenerator is called via the drop() method.</p>
<p></p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.engine_SQLEngine_def schemagenerator"></a>
        <b>def schemagenerator(<i>self</i>, <i>**params</i>)</b>
        <div class="docstring">
    <p>
    returns a schema.SchemaVisitor instance that can generate schemas, when it is         invoked to traverse a set of schema objects.                   schemagenerator is called via the create() method.</p>
<p></p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.engine_SQLEngine_def supports_sane_rowcount"></a>
        <b>def supports_sane_rowcount(<i>self</i>)</b>
        <div class="docstring">
    <p>
    Provided to indicate when MySQL is being used, which does not have standard behavior         for the &quot;rowcount&quot; function on a statement handle.  
</p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.engine_SQLEngine_def text"></a>
        <b>def text(<i>self</i>, <i>text</i>, <i>*args</i>, <i>**kwargs</i>)</b>
        <div class="docstring">
    <p>
    returns a sql.text() object for performing literal queries.
</p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.engine_SQLEngine_def transaction"></a>
        <b>def transaction(<i>self</i>, <i>func</i>)</b>
        <div class="docstring">
    <p>
    executes the given function within a transaction boundary.  this is a shortcut for         explicitly calling begin() and commit() and optionally rollback() when execptions are raised.
</p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.engine_SQLEngine_def type_descriptor"></a>
        <b>def type_descriptor(<i>self</i>, <i>typeobj</i>)</b>
        <div class="docstring">
    <p>
    provides a database-specific TypeEngine object, given the generic object         which comes from the types module.  Subclasses will usually use the adapt_type()
        method in the types module to make this job easy.
</p>
    </div>
        </div>
    </td>
    </tr>



    </table>



    </div>


    <a href="#docstrings" class="toclink">back to section top</a>


</div>


        



<A name="docstrings_sqlalchemy.engine_ResultProxy"></a>

<div class="subsection" style="margin-left:30px;">

    <span class="sectionheadertext">Class ResultProxy</span>
    <div class="sectiontext">


<p>
    wraps a DBAPI cursor object to provide access to row columns based on integer     position, case-insensitive column name, or by schema.Column object. e.g.:
         row = fetchone()</p>
<p>col1 = row[0]    # access via integer position</p>
<p>col2 = row['col2']   # access via name</p>
<p>col3 = row[mytable.c.mycol] # access via Column object.            ResultProxy also contains a map of TypeEngine objects and will invoke the appropriate     convert_result_value() method before returning columns.</p>
<p></p>


    <table cellspacing="0" cellpadding="0" width="100%">
    
    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.engine_ResultProxy_def __init__"></a>
        <b>def __init__(<i>self</i>, <i>cursor</i>, <i>engine</i>, <i>typemap=None</i>)</b>
        <div class="docstring">
    <p>
    ResultProxy objects are constructed via the execute() method on SQLEngine.
</p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.engine_ResultProxy_def fetchall"></a>
        <b>def fetchall(<i>self</i>)</b>
        <div class="docstring">
    <p>
    fetches all rows, just like DBAPI cursor.fetchall().
</p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.engine_ResultProxy_def fetchone"></a>
        <b>def fetchone(<i>self</i>)</b>
        <div class="docstring">
    <p>
    fetches one row, just like DBAPI cursor.fetchone().
</p>
    </div>
        </div>
    </td>
    </tr>



    </table>



    </div>


    <a href="#docstrings" class="toclink">back to section top</a>


</div>


        



<A name="docstrings_sqlalchemy.engine_RowProxy"></a>

<div class="subsection" style="margin-left:30px;">

    <span class="sectionheadertext">Class RowProxy</span>
    <div class="sectiontext">


<p>
    proxies a single cursor row for a parent ResultProxy.
</p>


    <table cellspacing="0" cellpadding="0" width="100%">
    
    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.engine_RowProxy_def __init__"></a>
        <b>def __init__(<i>self</i>, <i>parent</i>, <i>row</i>)</b>
        <div class="docstring">
    <p>
    RowProxy objects are constructed by ResultProxy objects.
</p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.engine_RowProxy_def items"></a>
        <b>def items(<i>self</i>)</b>
        <div class="docstring">
    <p></p>
<p></p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.engine_RowProxy_def keys"></a>
        <b>def keys(<i>self</i>)</b>
        <div class="docstring">
    <p></p>
<p></p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.engine_RowProxy_def values"></a>
        <b>def values(<i>self</i>)</b>
        <div class="docstring">
    <p></p>
<p></p>
    </div>
        </div>
    </td>
    </tr>



    </table>



    </div>


    <a href="#docstrings" class="toclink">back to section top</a>


</div>





</div>


        



<A name="docstrings_sqlalchemy.sql"></a>

<div class="subsection" style="margin-left:20px;">

    <span class="sectionheadertext">Module sqlalchemy.sql</span>
    <div class="sectiontext">


<p>
    defines the base components of SQL expression trees.
</p>


			


    <table cellspacing="0" cellpadding="0" width="100%">
    
      
        

			



      
        

			



      
        

			



      
        

			



      
        

			




    </table>


    </div>

        



<A name="docstrings_sqlalchemy.sql_modfunc"></a>

<div class="subsection" style="margin-left:30px;">

    <span class="sectionheadertext">Module Functions</span>
    <div class="sectiontext">



    <table cellspacing="0" cellpadding="0" width="100%">
    
    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.sql_modfunc_def alias"></a>
        <b>def alias(<i>*args</i>, <i>**params</i>)</b>
        <div class="docstring">
    <p></p>
<p></p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.sql_modfunc_def and_"></a>
        <b>def and_(<i>*clauses</i>)</b>
        <div class="docstring">
    <p>
    joins a list of clauses together by the AND operator.  the &amp; operator can be used as well.
</p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.sql_modfunc_def asc"></a>
        <b>def asc(<i>column</i>)</b>
        <div class="docstring">
    <p>
    returns an ascending ORDER BY clause element, e.g.:
         order_by = [asc(table1.mycol)]</p>
<p></p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.sql_modfunc_def bindparam"></a>
        <b>def bindparam(<i>key</i>, <i>value=None</i>, <i>type=None</i>)</b>
        <div class="docstring">
    <p>
    creates a bind parameter clause with the given key.            An optional default value can be specified by the value parameter, and the optional type parameter     is a sqlalchemy.types.TypeEngine object which indicates bind-parameter and result-set translation for     this bind parameter.
</p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.sql_modfunc_def column"></a>
        <b>def column(<i>text</i>, <i>table=None</i>, <i>type=None</i>)</b>
        <div class="docstring">
    <p>
    returns a textual column clause, relative to a table.  this is also the primitive version of     a schema.Column which is a subclass. 
</p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.sql_modfunc_def delete"></a>
        <b>def delete(<i>table</i>, <i>whereclause=None</i>, <i>**kwargs</i>)</b>
        <div class="docstring">
    <p>
    returns a DELETE clause element.            This can also be called from a table directly via the table's delete() method.
         'table' is the table to be updated.
    'whereclause' is a ClauseElement describing the WHERE condition of the UPDATE statement.</p>
<p></p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.sql_modfunc_def desc"></a>
        <b>def desc(<i>column</i>)</b>
        <div class="docstring">
    <p>
    returns a descending ORDER BY clause element, e.g.:
         order_by = [desc(table1.mycol)]</p>
<p></p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.sql_modfunc_def exists"></a>
        <b>def exists(<i>*args</i>, <i>**params</i>)</b>
        <div class="docstring">
    <p></p>
<p></p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.sql_modfunc_def insert"></a>
        <b>def insert(<i>table</i>, <i>values=None</i>, <i>**kwargs</i>)</b>
        <div class="docstring">
    <p>
    returns an INSERT clause element.            This can also be called from a table directly via the table's insert() method.
         'table' is the table to be inserted into.
         'values' is a dictionary which specifies the column specifications of the INSERT,      and is optional.  If left as None, the column specifications are determined from the      bind parameters used during the compile phase of the INSERT statement.  If the      bind parameters also are None during the compile phase, then the column     specifications will be generated from the full list of table columns.</p>
<p>If both 'values' and compile-time bind parameters are present, the compile-time      bind parameters override the information specified within 'values' on a per-key basis.</p>
<p>The keys within 'values' can be either Column objects or their string identifiers.       Each key may reference one of: a literal data value (i.e. string, number, etc.), a Column object,
    or a SELECT statement.  If a SELECT statement is specified which references this INSERT      statement's table, the statement will be correlated against the INSERT statement.       
</p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.sql_modfunc_def join"></a>
        <b>def join(<i>left</i>, <i>right</i>, <i>onclause=None</i>, <i>**kwargs</i>)</b>
        <div class="docstring">
    <p>
    returns a JOIN clause element (regular inner join), given the left and right      hand expressions, as well as the ON condition's expression.  To chain joins      together, use the resulting Join object's &quot;join()&quot; or &quot;outerjoin()&quot; methods.
</p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.sql_modfunc_def literal"></a>
        <b>def literal(<i>value</i>, <i>type=None</i>)</b>
        <div class="docstring">
    <p>
    returns a literal clause, bound to a bind parameter.            literal clauses are created automatically when used as the right-hand      side of a boolean or math operation against a column object.  use this      function when a literal is needed on the left-hand side (and optionally on the right as well).
         the optional type parameter is a sqlalchemy.types.TypeEngine object which indicates bind-parameter     and result-set translation for this literal.</p>
<p></p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.sql_modfunc_def not_"></a>
        <b>def not_(<i>clause</i>)</b>
        <div class="docstring">
    <p>
    returns a negation of the given clause, i.e. NOT(clause).  the ~ operator can be used as well.
</p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.sql_modfunc_def or_"></a>
        <b>def or_(<i>*clauses</i>)</b>
        <div class="docstring">
    <p>
    joins a list of clauses together by the OR operator.  the | operator can be used as well.
</p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.sql_modfunc_def outerjoin"></a>
        <b>def outerjoin(<i>left</i>, <i>right</i>, <i>onclause=None</i>, <i>**kwargs</i>)</b>
        <div class="docstring">
    <p>
    returns an OUTER JOIN clause element, given the left and right hand expressions,
    as well as the ON condition's expression.  To chain joins together, use the resulting     Join object's &quot;join()&quot; or &quot;outerjoin()&quot; methods.
</p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.sql_modfunc_def select"></a>
        <b>def select(<i>columns=None</i>, <i>whereclause=None</i>, <i>from_obj=[]</i>, <i>**kwargs</i>)</b>
        <div class="docstring">
    <p>
    returns a SELECT clause element.
         this can also be called via the table's select() method.
         'columns' is a list of columns and/or selectable items to select columns from     'whereclause' is a text or ClauseElement expression which will form the WHERE clause     'from_obj' is an list of additional &quot;FROM&quot; objects, such as Join objects, which will      extend or override the default &quot;from&quot; objects created from the column list and the      whereclause.
    **kwargs - additional parameters for the Select object.</p>
<p></p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.sql_modfunc_def subquery"></a>
        <b>def subquery(<i>alias</i>, <i>*args</i>, <i>**kwargs</i>)</b>
        <div class="docstring">
    <p></p>
<p></p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.sql_modfunc_def table"></a>
        <b>def table(<i>name</i>, <i>*columns</i>)</b>
        <div class="docstring">
    <p>
    returns a table clause.  this is a primitive version of the schema.Table object, which is a subclass     of this object.
</p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.sql_modfunc_def text"></a>
        <b>def text(<i>text</i>, <i>engine=None</i>, <i>*args</i>, <i>**kwargs</i>)</b>
        <div class="docstring">
    <p>
    creates literal text to be inserted into a query.            When constructing a query from a select(), update(), insert() or delete(), using      plain strings for argument values will usually result in text objects being created     automatically.  Use this function when creating textual clauses outside of other     ClauseElement objects, or optionally wherever plain text is to be used.
         Arguments include:</p>
<p>text - the text of the SQL statement to be created.  use :&lt;param&gt; to specify     bind parameters; they will be compiled to their engine-specific format.</p>
<p>engine - an optional engine to be used for this text query.  Alternatively, call the     text() method off the engine directly.</p>
<p>bindparams - a list of bindparam() instances which can be used to define the     types and/or initial values for the bind parameters within the textual statement;
    the keynames of the bindparams must match those within the text of the statement.
    The types will be used for pre-processing on bind values.</p>
<p>typemap - a dictionary mapping the names of columns represented in the SELECT     clause of the textual statement to type objects, which will be used to perform     post-processing on columns within the result set (for textual statements that      produce result sets).
</p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.sql_modfunc_def union"></a>
        <b>def union(<i>*selects</i>, <i>**params</i>)</b>
        <div class="docstring">
    <p></p>
<p></p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.sql_modfunc_def union_all"></a>
        <b>def union_all(<i>*selects</i>, <i>**params</i>)</b>
        <div class="docstring">
    <p></p>
<p></p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.sql_modfunc_def update"></a>
        <b>def update(<i>table</i>, <i>whereclause=None</i>, <i>values=None</i>, <i>**kwargs</i>)</b>
        <div class="docstring">
    <p>
    returns an UPDATE clause element.             This can also be called from a table directly via the table's update() method.
         'table' is the table to be updated.
    'whereclause' is a ClauseElement describing the WHERE condition of the UPDATE statement.
    'values' is a dictionary which specifies the SET conditions of the UPDATE, and is     optional. If left as None, the SET conditions are determined from the bind parameters     used during the compile phase of the UPDATE statement.  If the bind parameters also are     None during the compile phase, then the SET conditions will be generated from the full     list of table columns.</p>
<p>If both 'values' and compile-time bind parameters are present, the compile-time bind     parameters override the information specified within 'values' on a per-key basis.</p>
<p>The keys within 'values' can be either Column objects or their string identifiers. Each     key may reference one of: a literal data value (i.e. string, number, etc.), a Column     object, or a SELECT statement.  If a SELECT statement is specified which references this     UPDATE statement's table, the statement will be correlated against the UPDATE statement.</p>
<p></p>
    </div>
        </div>
    </td>
    </tr>



    </table>


    </div>


    <a href="#docstrings" class="toclink">back to section top</a>


</div>


        



<A name="docstrings_sqlalchemy.sql_ClauseParameters"></a>

<div class="subsection" style="margin-left:30px;">

    <span class="sectionheadertext">Class ClauseParameters(OrderedDict)</span>
    <div class="sectiontext">


<p>
    represents a dictionary/iterator of bind parameter key names/values.  Includes parameters compiled with a Compiled object as well as additional arguments passed to the Compiled object's get_params() method.  Parameter values will be converted as per the TypeEngine objects present in the bind parameter objects.  The non-converted value can be retrieved via the get_original method.  For Compiled objects that compile positional parameters, the values() iteration of the object will return the parameter values in the correct order.
</p>


    <table cellspacing="0" cellpadding="0" width="100%">
    
    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.sql_ClauseParameters_def __init__"></a>
        <b>def __init__(<i>self</i>, <i>engine=None</i>)</b>
        <div class="docstring">
    <p></p>
<p></p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.sql_ClauseParameters_def get_original"></a>
        <b>def get_original(<i>self</i>, <i>key</i>)</b>
        <div class="docstring">
    <p></p>
<p></p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.sql_ClauseParameters_def get_original_dict"></a>
        <b>def get_original_dict(<i>self</i>)</b>
        <div class="docstring">
    <p></p>
<p></p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.sql_ClauseParameters_def get_raw_dict"></a>
        <b>def get_raw_dict(<i>self</i>)</b>
        <div class="docstring">
    <p></p>
<p></p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.sql_ClauseParameters_def set_parameter"></a>
        <b>def set_parameter(<i>self</i>, <i>key</i>, <i>value</i>, <i>bindparam</i>)</b>
        <div class="docstring">
    <p></p>
<p></p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.sql_ClauseParameters_def values"></a>
        <b>def values(<i>self</i>)</b>
        <div class="docstring">
    <p></p>
<p></p>
    </div>
        </div>
    </td>
    </tr>



    </table>



    </div>


    <a href="#docstrings" class="toclink">back to section top</a>


</div>


        



<A name="docstrings_sqlalchemy.sql_Compiled"></a>

<div class="subsection" style="margin-left:30px;">

    <span class="sectionheadertext">Class Compiled(ClauseVisitor)</span>
    <div class="sectiontext">


<p>
    represents a compiled SQL expression.  the __str__ method of the Compiled object     should produce the actual text of the statement.  Compiled objects are specific to the     database library that created them, and also may or may not be specific to the columns     referenced within a particular set of bind parameters.  In no case should the Compiled     object be dependent on the actual values of those bind parameters, even though it may     reference those values as defaults.
</p>


    <table cellspacing="0" cellpadding="0" width="100%">
    
    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.sql_Compiled_def __init__"></a>
        <b>def __init__(<i>self</i>, <i>statement</i>, <i>parameters</i>, <i>engine=None</i>)</b>
        <div class="docstring">
    <p>
    constructs a new Compiled object.
                 statement - ClauseElement to be compiled                  parameters - optional dictionary indicating a set of bind parameters         specified with this Compiled object.  These parameters are the &quot;default&quot;
        values corresponding to the ClauseElement's BindParamClauses when the Compiled          is executed.   In the case of an INSERT or UPDATE statement, these parameters          will also result in the creation of new BindParamClause objects for each key         and will also affect the generated column list in an INSERT statement and the SET          clauses of an UPDATE statement.  The keys of the parameter dictionary can         either be the string names of columns or ColumnClause objects.
                 engine - optional SQLEngine to compile this statement against
</p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.sql_Compiled_def compile"></a>
        <b>def compile(<i>self</i>)</b>
        <div class="docstring">
    <p></p>
<p></p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.sql_Compiled_def execute"></a>
        <b>def execute(<i>self</i>, <i>*multiparams</i>, <i>**params</i>)</b>
        <div class="docstring">
    <p>
    executes this compiled object using the underlying SQLEngine
</p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.sql_Compiled_def get_params"></a>
        <b>def get_params(<i>self</i>, <i>**params</i>)</b>
        <div class="docstring">
    <p>
    returns the bind params for this compiled object.
                 Will start with the default parameters specified when this Compiled object         was first constructed, and will override those values with those sent via         **params, which are key/value pairs.  Each key should match one of the          BindParamClause objects compiled into this object; either the &quot;key&quot; or          &quot;shortname&quot; property of the BindParamClause.</p>
<p></p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.sql_Compiled_def scalar"></a>
        <b>def scalar(<i>self</i>, <i>*multiparams</i>, <i>**params</i>)</b>
        <div class="docstring">
    <p>
    executes this compiled object via the execute() method, then          returns the first column of the first row.  Useful for executing functions,
        sequences, rowcounts, etc.
</p>
    </div>
        </div>
    </td>
    </tr>



    </table>



    </div>


    <a href="#docstrings" class="toclink">back to section top</a>


</div>


        



<A name="docstrings_sqlalchemy.sql_ClauseElement"></a>

<div class="subsection" style="margin-left:30px;">

    <span class="sectionheadertext">Class ClauseElement(object)</span>
    <div class="sectiontext">


<p>
    base class for elements of a programmatically constructed SQL expression.
</p>


    <table cellspacing="0" cellpadding="0" width="100%">
    
    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.sql_ClauseElement_def accept_visitor"></a>
        <b>def accept_visitor(<i>self</i>, <i>visitor</i>)</b>
        <div class="docstring">
    <p>
    accepts a ClauseVisitor and calls the appropriate visit_xxx method.
</p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.sql_ClauseElement_def compare"></a>
        <b>def compare(<i>self</i>, <i>other</i>)</b>
        <div class="docstring">
    <p>
    compares this ClauseElement to the given ClauseElement.
                 Subclasses should override the default behavior, which is a straight         identity comparison.
</p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.sql_ClauseElement_def compile"></a>
        <b>def compile(<i>self</i>, <i>engine=None</i>, <i>parameters=None</i>, <i>typemap=None</i>, <i>compiler=None</i>)</b>
        <div class="docstring">
    <p>
    compiles this SQL expression using its underlying SQLEngine to produce         a Compiled object.  If no engine can be found, an ansisql engine is used.
        bindparams is a dictionary representing the default bind parameters to be used with          the statement.  
</p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.sql_ClauseElement_def copy_container"></a>
        <b>def copy_container(<i>self</i>)</b>
        <div class="docstring">
    <p>
    should return a copy of this ClauseElement, iff this ClauseElement contains other         ClauseElements.  Otherwise, it should be left alone to return self.  This is used to         create copies of expression trees that still reference the same &quot;leaf nodes&quot;.  The         new structure can then be restructured without affecting the original.
</p>
    </div>
        </div>
    </td>
    </tr>


    
        
              <tr>
       <td>
           <div class="darkcell">
           <A name="docstrings_sqlalchemy.sql_ClauseElement_engine = property()"></a>
           <b>engine = property()</b></td>
           <div class="docstring">
    <p>
    attempts to locate a SQLEngine within this ClauseElement structure, or returns None if none found.
</p>
    </div>
           </div>
       </td>
       </tr>
    

    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.sql_ClauseElement_def execute"></a>
        <b>def execute(<i>self</i>, <i>*multiparams</i>, <i>**params</i>)</b>
        <div class="docstring">
    <p>
    compiles and executes this SQL expression using its underlying SQLEngine. the         given **params are used as bind parameters when compiling and executing the         expression. the DBAPI cursor object is returned.
</p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.sql_ClauseElement_def is_selectable"></a>
        <b>def is_selectable(<i>self</i>)</b>
        <div class="docstring">
    <p>
    returns True if this ClauseElement is Selectable, i.e. it contains a list of Column         objects and can be used as the target of a select statement.
</p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.sql_ClauseElement_def scalar"></a>
        <b>def scalar(<i>self</i>, <i>*multiparams</i>, <i>**params</i>)</b>
        <div class="docstring">
    <p>
    executes this SQL expression via the execute() method, then          returns the first column of the first row.  Useful for executing functions,
        sequences, rowcounts, etc.
</p>
    </div>
        </div>
    </td>
    </tr>



    </table>



    </div>


    <a href="#docstrings" class="toclink">back to section top</a>


</div>


        



<A name="docstrings_sqlalchemy.sql_TableClause"></a>

<div class="subsection" style="margin-left:30px;">

    <span class="sectionheadertext">Class TableClause(FromClause)</span>
    <div class="sectiontext">


<p></p>
<p></p>


    <table cellspacing="0" cellpadding="0" width="100%">
    
    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.sql_TableClause_def __init__"></a>
        <b>def __init__(<i>self</i>, <i>name</i>, <i>*columns</i>)</b>
        <div class="docstring">
    <p></p>
<p></p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.sql_TableClause_def accept_visitor"></a>
        <b>def accept_visitor(<i>self</i>, <i>visitor</i>)</b>
        <div class="docstring">
    <p></p>
<p></p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.sql_TableClause_def alias"></a>
        <b>def alias(<i>self</i>, <i>name=None</i>)</b>
        <div class="docstring">
    <p></p>
<p></p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.sql_TableClause_def append_column"></a>
        <b>def append_column(<i>self</i>, <i>c</i>)</b>
        <div class="docstring">
    <p></p>
<p></p>
    </div>
        </div>
    </td>
    </tr>


    
        
              <tr>
       <td>
           <div class="darkcell">
           <A name="docstrings_sqlalchemy.sql_TableClause_c = property()"></a>
           <b>c = property()</b></td>
           <div class="docstring">
    <p></p>
<p></p>
    </div>
           </div>
       </td>
       </tr>
    

    
        
              <tr>
       <td>
           <div class="darkcell">
           <A name="docstrings_sqlalchemy.sql_TableClause_columns = property()"></a>
           <b>columns = property()</b></td>
           <div class="docstring">
    <p></p>
<p></p>
    </div>
           </div>
       </td>
       </tr>
    

    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.sql_TableClause_def count"></a>
        <b>def count(<i>self</i>, <i>whereclause=None</i>, <i>**params</i>)</b>
        <div class="docstring">
    <p></p>
<p></p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.sql_TableClause_def delete"></a>
        <b>def delete(<i>self</i>, <i>whereclause=None</i>)</b>
        <div class="docstring">
    <p></p>
<p></p>
    </div>
        </div>
    </td>
    </tr>


    
        
              <tr>
       <td>
           <div class="darkcell">
           <A name="docstrings_sqlalchemy.sql_TableClause_foreign_keys = property()"></a>
           <b>foreign_keys = property()</b></td>
           <div class="docstring">
    <p></p>
<p></p>
    </div>
           </div>
       </td>
       </tr>
    

    
        
              <tr>
       <td>
           <div class="darkcell">
           <A name="docstrings_sqlalchemy.sql_TableClause_indexes = property()"></a>
           <b>indexes = property()</b></td>
           <div class="docstring">
    <p></p>
<p></p>
    </div>
           </div>
       </td>
       </tr>
    

    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.sql_TableClause_def insert"></a>
        <b>def insert(<i>self</i>, <i>values=None</i>)</b>
        <div class="docstring">
    <p></p>
<p></p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.sql_TableClause_def join"></a>
        <b>def join(<i>self</i>, <i>right</i>, <i>*args</i>, <i>**kwargs</i>)</b>
        <div class="docstring">
    <p></p>
<p></p>
    </div>
        </div>
    </td>
    </tr>


    
        
              <tr>
       <td>
           <div class="darkcell">
           <A name="docstrings_sqlalchemy.sql_TableClause_oid_column = property()"></a>
           <b>oid_column = property()</b></td>
           <div class="docstring">
    <p></p>
<p></p>
    </div>
           </div>
       </td>
       </tr>
    

    
        
              <tr>
       <td>
           <div class="darkcell">
           <A name="docstrings_sqlalchemy.sql_TableClause_original_columns = property()"></a>
           <b>original_columns = property()</b></td>
           <div class="docstring">
    <p></p>
<p></p>
    </div>
           </div>
       </td>
       </tr>
    

    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.sql_TableClause_def outerjoin"></a>
        <b>def outerjoin(<i>self</i>, <i>right</i>, <i>*args</i>, <i>**kwargs</i>)</b>
        <div class="docstring">
    <p></p>
<p></p>
    </div>
        </div>
    </td>
    </tr>


    
        
              <tr>
       <td>
           <div class="darkcell">
           <A name="docstrings_sqlalchemy.sql_TableClause_primary_key = property()"></a>
           <b>primary_key = property()</b></td>
           <div class="docstring">
    <p></p>
<p></p>
    </div>
           </div>
       </td>
       </tr>
    

    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.sql_TableClause_def select"></a>
        <b>def select(<i>self</i>, <i>whereclause=None</i>, <i>**params</i>)</b>
        <div class="docstring">
    <p></p>
<p></p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.sql_TableClause_def update"></a>
        <b>def update(<i>self</i>, <i>whereclause=None</i>, <i>values=None</i>)</b>
        <div class="docstring">
    <p></p>
<p></p>
    </div>
        </div>
    </td>
    </tr>



    </table>



    </div>


    <a href="#docstrings" class="toclink">back to section top</a>


</div>


        



<A name="docstrings_sqlalchemy.sql_ColumnClause"></a>

<div class="subsection" style="margin-left:30px;">

    <span class="sectionheadertext">Class ColumnClause(ColumnElement)</span>
    <div class="sectiontext">


<p>
    represents a textual column clause in a SQL statement.  May or may not     be bound to an underlying Selectable.
</p>


    <table cellspacing="0" cellpadding="0" width="100%">
    
    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.sql_ColumnClause_def __init__"></a>
        <b>def __init__(<i>self</i>, <i>text</i>, <i>selectable=None</i>, <i>type=None</i>)</b>
        <div class="docstring">
    <p></p>
<p></p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.sql_ColumnClause_def accept_visitor"></a>
        <b>def accept_visitor(<i>self</i>, <i>visitor</i>)</b>
        <div class="docstring">
    <p></p>
<p></p>
    </div>
        </div>
    </td>
    </tr>



    </table>



    </div>


    <a href="#docstrings" class="toclink">back to section top</a>


</div>





</div>


        



<A name="docstrings_sqlalchemy.pool"></a>

<div class="subsection" style="margin-left:20px;">

    <span class="sectionheadertext">Module sqlalchemy.pool</span>
    <div class="sectiontext">


<p>
    provides a connection pool implementation, which optionally manages connections on a thread local basis.  Also provides a DBAPI2 transparency layer so that pools can be managed automatically, based on module type and connect arguments,
 simply by calling regular DBAPI connect() methods.
</p>


			


    <table cellspacing="0" cellpadding="0" width="100%">
    
      
        

			



      
        

			



      
        

			



      
        

			




    </table>


    </div>

        



<A name="docstrings_sqlalchemy.pool_modfunc"></a>

<div class="subsection" style="margin-left:30px;">

    <span class="sectionheadertext">Module Functions</span>
    <div class="sectiontext">



    <table cellspacing="0" cellpadding="0" width="100%">
    
    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.pool_modfunc_def clear_managers"></a>
        <b>def clear_managers()</b>
        <div class="docstring">
    <p>
    removes all current DBAPI2 managers.  all pools and connections are disposed.
</p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.pool_modfunc_def manage"></a>
        <b>def manage(<i>module</i>, <i>**params</i>)</b>
        <div class="docstring">
    <p>
    given a DBAPI2 module and pool management parameters, returns a proxy for the module     that will automatically pool connections.  Options are delivered to an underlying DBProxy     object.</p>
<p>Arguments:
    module : a DBAPI2 database module.
         Options:
    echo=False : if set to True, connections being pulled and retrieved from/to the pool will     be logged to the standard output, as well as pool sizing information.</p>
<p>use_threadlocal=True : if set to True, repeated calls to connect() within the same     application thread will be guaranteed to return the same connection object, if one has     already been retrieved from the pool and has not been returned yet. This allows code to     retrieve a connection from the pool, and then while still holding on to that connection,
    to call other functions which also ask the pool for a connection of the same arguments;
    those functions will act upon the same connection that the calling method is using.</p>
<p>poolclass=QueuePool : the default class used by the pool module to provide pooling.
    QueuePool uses the Python Queue.Queue class to maintain a list of available connections.</p>
<p>pool_size=5 : used by QueuePool - the size of the pool to be maintained. This is the     largest number of connections that will be kept persistently in the pool. Note that the     pool begins with no connections; once this number of connections is requested, that     number of connections will remain.</p>
<p>max_overflow=10 : the maximum overflow size of the pool. When the number of checked-out     connections reaches the size set in pool_size, additional connections will be returned up     to this limit. When those additional connections are returned to the pool, they are     disconnected and discarded. It follows then that the total number of simultaneous     connections the pool will allow is pool_size + max_overflow, and the total number of     &quot;sleeping&quot; connections the pool will allow is pool_size. max_overflow can be set to -1 to     indicate no overflow limit; no limit will be placed on the total number of concurrent
    connections.</p>
<p></p>
    </div>
        </div>
    </td>
    </tr>



    </table>


    </div>


    <a href="#docstrings" class="toclink">back to section top</a>


</div>


        



<A name="docstrings_sqlalchemy.pool_DBProxy"></a>

<div class="subsection" style="margin-left:30px;">

    <span class="sectionheadertext">Class DBProxy(object)</span>
    <div class="sectiontext">


<p>
    proxies a DBAPI2 connect() call to a pooled connection keyed to the specific connect     parameters.
</p>


    <table cellspacing="0" cellpadding="0" width="100%">
    
    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.pool_DBProxy_def __init__"></a>
        <b>def __init__(<i>self</i>, <i>module</i>, <i>poolclass=<class 'sqlalchemy.pool.QueuePool'></i>, <i>**params</i>)</b>
        <div class="docstring">
    <p></p>
<p>module is a DBAPI2 module         poolclass is a Pool class, defaulting to QueuePool.
        other parameters are sent to the Pool object's constructor.</p>
<p></p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.pool_DBProxy_def close"></a>
        <b>def close(<i>self</i>)</b>
        <div class="docstring">
    <p></p>
<p></p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.pool_DBProxy_def connect"></a>
        <b>def connect(<i>self</i>, <i>*args</i>, <i>**params</i>)</b>
        <div class="docstring">
    <p>
    connects to a database using this DBProxy's module and the given connect         arguments.  if the arguments match an existing pool, the connection will be returned         from the pool's current thread-local connection instance, or if there is no         thread-local connection instance it will be checked out from the set of pooled         connections.  If the pool has no available connections and allows new connections to         be created, a new database connection will be made.
</p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.pool_DBProxy_def dispose"></a>
        <b>def dispose(<i>self</i>, <i>*args</i>, <i>**params</i>)</b>
        <div class="docstring">
    <p>
    disposes the connection pool referenced by the given connect arguments.
</p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.pool_DBProxy_def get_pool"></a>
        <b>def get_pool(<i>self</i>, <i>*args</i>, <i>**params</i>)</b>
        <div class="docstring">
    <p></p>
<p></p>
    </div>
        </div>
    </td>
    </tr>



    </table>



    </div>


    <a href="#docstrings" class="toclink">back to section top</a>


</div>


        



<A name="docstrings_sqlalchemy.pool_Pool"></a>

<div class="subsection" style="margin-left:30px;">

    <span class="sectionheadertext">Class Pool(object)</span>
    <div class="sectiontext">


<p></p>
<p></p>


    <table cellspacing="0" cellpadding="0" width="100%">
    
    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.pool_Pool_def __init__"></a>
        <b>def __init__(<i>self</i>, <i>echo=False</i>, <i>use_threadlocal=True</i>, <i>logger=None</i>)</b>
        <div class="docstring">
    <p></p>
<p></p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.pool_Pool_def connect"></a>
        <b>def connect(<i>self</i>)</b>
        <div class="docstring">
    <p></p>
<p></p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.pool_Pool_def do_get"></a>
        <b>def do_get(<i>self</i>)</b>
        <div class="docstring">
    <p></p>
<p></p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.pool_Pool_def do_return_conn"></a>
        <b>def do_return_conn(<i>self</i>, <i>conn</i>)</b>
        <div class="docstring">
    <p></p>
<p></p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.pool_Pool_def do_return_invalid"></a>
        <b>def do_return_invalid(<i>self</i>)</b>
        <div class="docstring">
    <p></p>
<p></p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.pool_Pool_def get"></a>
        <b>def get(<i>self</i>)</b>
        <div class="docstring">
    <p></p>
<p></p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.pool_Pool_def log"></a>
        <b>def log(<i>self</i>, <i>msg</i>)</b>
        <div class="docstring">
    <p></p>
<p></p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.pool_Pool_def return_conn"></a>
        <b>def return_conn(<i>self</i>, <i>conn</i>)</b>
        <div class="docstring">
    <p></p>
<p></p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.pool_Pool_def return_invalid"></a>
        <b>def return_invalid(<i>self</i>)</b>
        <div class="docstring">
    <p></p>
<p></p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.pool_Pool_def status"></a>
        <b>def status(<i>self</i>)</b>
        <div class="docstring">
    <p></p>
<p></p>
    </div>
        </div>
    </td>
    </tr>



    </table>



    </div>


    <a href="#docstrings" class="toclink">back to section top</a>


</div>


        



<A name="docstrings_sqlalchemy.pool_QueuePool"></a>

<div class="subsection" style="margin-left:30px;">

    <span class="sectionheadertext">Class QueuePool(Pool)</span>
    <div class="sectiontext">


<p>
    uses Queue.Queue to maintain a fixed-size list of connections.
</p>


    <table cellspacing="0" cellpadding="0" width="100%">
    
    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.pool_QueuePool_def __init__"></a>
        <b>def __init__(<i>self</i>, <i>creator</i>, <i>pool_size=5</i>, <i>max_overflow=10</i>, <i>**params</i>)</b>
        <div class="docstring">
    <p></p>
<p></p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.pool_QueuePool_def checkedin"></a>
        <b>def checkedin(<i>self</i>)</b>
        <div class="docstring">
    <p></p>
<p></p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.pool_QueuePool_def checkedout"></a>
        <b>def checkedout(<i>self</i>)</b>
        <div class="docstring">
    <p></p>
<p></p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.pool_QueuePool_def do_get"></a>
        <b>def do_get(<i>self</i>)</b>
        <div class="docstring">
    <p></p>
<p></p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.pool_QueuePool_def do_return_conn"></a>
        <b>def do_return_conn(<i>self</i>, <i>conn</i>)</b>
        <div class="docstring">
    <p></p>
<p></p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.pool_QueuePool_def do_return_invalid"></a>
        <b>def do_return_invalid(<i>self</i>)</b>
        <div class="docstring">
    <p></p>
<p></p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.pool_QueuePool_def overflow"></a>
        <b>def overflow(<i>self</i>)</b>
        <div class="docstring">
    <p></p>
<p></p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.pool_QueuePool_def size"></a>
        <b>def size(<i>self</i>)</b>
        <div class="docstring">
    <p></p>
<p></p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.pool_QueuePool_def status"></a>
        <b>def status(<i>self</i>)</b>
        <div class="docstring">
    <p></p>
<p></p>
    </div>
        </div>
    </td>
    </tr>



    </table>



    </div>


    <a href="#docstrings" class="toclink">back to section top</a>


</div>


        



<A name="docstrings_sqlalchemy.pool_SingletonThreadPool"></a>

<div class="subsection" style="margin-left:30px;">

    <span class="sectionheadertext">Class SingletonThreadPool(Pool)</span>
    <div class="sectiontext">


<p>
    Maintains one connection per each thread, never moving to another thread.  this is     used for SQLite and other databases with a similar restriction.
</p>


    <table cellspacing="0" cellpadding="0" width="100%">
    
    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.pool_SingletonThreadPool_def __init__"></a>
        <b>def __init__(<i>self</i>, <i>creator</i>, <i>**params</i>)</b>
        <div class="docstring">
    <p></p>
<p></p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.pool_SingletonThreadPool_def do_get"></a>
        <b>def do_get(<i>self</i>)</b>
        <div class="docstring">
    <p></p>
<p></p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.pool_SingletonThreadPool_def do_return_conn"></a>
        <b>def do_return_conn(<i>self</i>, <i>conn</i>)</b>
        <div class="docstring">
    <p></p>
<p></p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.pool_SingletonThreadPool_def do_return_invalid"></a>
        <b>def do_return_invalid(<i>self</i>)</b>
        <div class="docstring">
    <p></p>
<p></p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.pool_SingletonThreadPool_def status"></a>
        <b>def status(<i>self</i>)</b>
        <div class="docstring">
    <p></p>
<p></p>
    </div>
        </div>
    </td>
    </tr>



    </table>



    </div>


    <a href="#docstrings" class="toclink">back to section top</a>


</div>





</div>


        



<A name="docstrings_sqlalchemy.mapping"></a>

<div class="subsection" style="margin-left:20px;">

    <span class="sectionheadertext">Module sqlalchemy.mapping</span>
    <div class="sectiontext">


<p></p>
<p>the mapper package provides object-relational functionality, building upon the schema and sql packages and tying operations to class properties and constructors.</p>
<p></p>


			


    <table cellspacing="0" cellpadding="0" width="100%">
    
      
        

			




    </table>


    </div>

        



<A name="docstrings_sqlalchemy.mapping_modfunc"></a>

<div class="subsection" style="margin-left:30px;">

    <span class="sectionheadertext">Module Functions</span>
    <div class="sectiontext">



    <table cellspacing="0" cellpadding="0" width="100%">
    
    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.mapping_modfunc_def assign_mapper"></a>
        <b>def assign_mapper(<i>class_</i>, <i>*args</i>, <i>**params</i>)</b>
        <div class="docstring">
    <p></p>
<p></p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.mapping_modfunc_def backref"></a>
        <b>def backref(<i>name</i>, <i>**kwargs</i>)</b>
        <div class="docstring">
    <p></p>
<p></p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.mapping_modfunc_def cascade_mappers"></a>
        <b>def cascade_mappers(<i>*classes_or_mappers</i>)</b>
        <div class="docstring">
    <p>
    given a list of classes and/or mappers, identifies the foreign key relationships     between the given mappers or corresponding class mappers, and creates relation()
    objects representing those relationships, including a backreference.  Attempts to find     the &quot;secondary&quot; table in a many-to-many relationship as well.  The names of the relations     will be a lowercase version of the related class.  In the case of one-to-many or many-to-many,
    the name will be &quot;pluralized&quot;, which currently is based on the English language (i.e. an 's' or      'es' added to it).
</p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.mapping_modfunc_def class_mapper"></a>
        <b>def class_mapper(<i>class_</i>)</b>
        <div class="docstring">
    <p>
    given a class, returns the primary Mapper associated with the class.
</p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.mapping_modfunc_def clear_mappers"></a>
        <b>def clear_mappers()</b>
        <div class="docstring">
    <p>
    removes all mappers that have been created thus far.  when new mappers are      created, they will be assigned to their classes as their primary mapper.
</p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.mapping_modfunc_def defer"></a>
        <b>def defer(<i>name</i>, <i>**kwargs</i>)</b>
        <div class="docstring">
    <p>
    returns a MapperOption that will convert the column property of the given      name into a deferred load.  Used with mapper.options()
</p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.mapping_modfunc_def deferred"></a>
        <b>def deferred(<i>*columns</i>, <i>**kwargs</i>)</b>
        <div class="docstring">
    <p>
    returns a DeferredColumnProperty, which indicates this object attributes should only be loaded      from its corresponding table column when first accessed.
</p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.mapping_modfunc_def eagerload"></a>
        <b>def eagerload(<i>name</i>, <i>**kwargs</i>)</b>
        <div class="docstring">
    <p>
    returns a MapperOption that will convert the property of the given name     into an eager load.  Used with mapper.options()
</p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.mapping_modfunc_def extension"></a>
        <b>def extension(<i>ext</i>)</b>
        <div class="docstring">
    <p>
    returns a MapperOption that will add the given MapperExtension to the      mapper returned by mapper.options().
</p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.mapping_modfunc_def lazyload"></a>
        <b>def lazyload(<i>name</i>, <i>**kwargs</i>)</b>
        <div class="docstring">
    <p>
    returns a MapperOption that will convert the property of the given name     into a lazy load.  Used with mapper.options()
</p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.mapping_modfunc_def mapper"></a>
        <b>def mapper(<i>class_</i>, <i>table=None</i>, <i>*args</i>, <i>**params</i>)</b>
        <div class="docstring">
    <p>
    returns a new or already cached Mapper object.
</p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.mapping_modfunc_def noload"></a>
        <b>def noload(<i>name</i>, <i>**kwargs</i>)</b>
        <div class="docstring">
    <p>
    returns a MapperOption that will convert the property of the given name     into a non-load.  Used with mapper.options()
</p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.mapping_modfunc_def object_mapper"></a>
        <b>def object_mapper(<i>object</i>)</b>
        <div class="docstring">
    <p>
    given an object, returns the primary Mapper associated with the object     or the object's class.
</p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.mapping_modfunc_def relation"></a>
        <b>def relation(<i>*args</i>, <i>**kwargs</i>)</b>
        <div class="docstring">
    <p>
    provides a relationship of a primary Mapper to a secondary Mapper, which corresponds     to a parent-child or associative table relationship.
</p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.mapping_modfunc_def undefer"></a>
        <b>def undefer(<i>name</i>, <i>**kwargs</i>)</b>
        <div class="docstring">
    <p>
    returns a MapperOption that will convert the column property of the given     name into a non-deferred (regular column) load.  Used with mapper.options.
</p>
    </div>
        </div>
    </td>
    </tr>



    </table>


    </div>


    <a href="#docstrings" class="toclink">back to section top</a>


</div>


        



<A name="docstrings_sqlalchemy.mapping_MapperExtension"></a>

<div class="subsection" style="margin-left:30px;">

    <span class="sectionheadertext">Class MapperExtension(object)</span>
    <div class="sectiontext">


<p></p>
<p></p>


    <table cellspacing="0" cellpadding="0" width="100%">
    
    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.mapping_MapperExtension_def __init__"></a>
        <b>def __init__(<i>self</i>)</b>
        <div class="docstring">
    <p></p>
<p></p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.mapping_MapperExtension_def after_insert"></a>
        <b>def after_insert(<i>self</i>, <i>mapper</i>, <i>instance</i>)</b>
        <div class="docstring">
    <p>
    called after an object instance has been INSERTed
</p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.mapping_MapperExtension_def after_update"></a>
        <b>def after_update(<i>self</i>, <i>mapper</i>, <i>instance</i>)</b>
        <div class="docstring">
    <p>
    called after an object instnace is UPDATED
</p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.mapping_MapperExtension_def append_result"></a>
        <b>def append_result(<i>self</i>, <i>mapper</i>, <i>row</i>, <i>imap</i>, <i>result</i>, <i>instance</i>, <i>isnew</i>, <i>populate_existing=False</i>)</b>
        <div class="docstring">
    <p>
    called when an object instance is being appended to a result list.
                 If it returns True, it is assumed that this method handled the appending itself.</p>
<p>mapper - the mapper doing the operation                  row - the result row from the database                  imap - a dictionary that is storing the running set of objects collected from the         current result set                  result - an instance of util.HistoryArraySet(), which may be an attribute on an         object if this is a related object load (lazy or eager).  use result.append_nohistory(value)
        to append objects to this list.
                 instance - the object instance to be appended to the result                  isnew - indicates if this is the first time we have seen this object instance in the current result         set.  if you are selecting from a join, such as an eager load, you might see the same object instance         many times in the same result set.
                 populate_existing - usually False, indicates if object instances that were already in the main          identity map, i.e. were loaded by a previous select(), get their attributes overwritten</p>
<p></p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.mapping_MapperExtension_def before_delete"></a>
        <b>def before_delete(<i>self</i>, <i>mapper</i>, <i>instance</i>)</b>
        <div class="docstring">
    <p>
    called before an object instance is DELETEed
</p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.mapping_MapperExtension_def before_insert"></a>
        <b>def before_insert(<i>self</i>, <i>mapper</i>, <i>instance</i>)</b>
        <div class="docstring">
    <p>
    called before an object instance is INSERTed into its table.
                 this is a good place to set up primary key values and such that arent handled otherwise.
</p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.mapping_MapperExtension_def before_update"></a>
        <b>def before_update(<i>self</i>, <i>mapper</i>, <i>instance</i>)</b>
        <div class="docstring">
    <p>
    called before an object instnace is UPDATED
</p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.mapping_MapperExtension_def create_instance"></a>
        <b>def create_instance(<i>self</i>, <i>mapper</i>, <i>row</i>, <i>imap</i>, <i>class_</i>)</b>
        <div class="docstring">
    <p>
    called when a new object instance is about to be created from a row.           the method can choose to create the instance itself, or it can return          None to indicate normal object creation should take place.
                 mapper - the mapper doing the operation                  row - the result row from the database                  imap - a dictionary that is storing the running set of objects collected from the         current result set                  class_ - the class we are mapping.</p>
<p></p>
    </div>
        </div>
    </td>
    </tr>



    </table>



    </div>


    <a href="#docstrings" class="toclink">back to section top</a>


</div>





</div>


        



<A name="docstrings_sqlalchemy.mapping.objectstore"></a>

<div class="subsection" style="margin-left:20px;">

    <span class="sectionheadertext">Module sqlalchemy.mapping.objectstore</span>
    <div class="sectiontext">


<p>
    maintains all currently loaded objects in memory, using the &quot;identity map&quot; pattern.  Also provides a &quot;unit of work&quot; object which tracks changes to objects so that they may be properly persisted within a transactional scope.
</p>


			


    <table cellspacing="0" cellpadding="0" width="100%">
    
      
        

			



      
        

			



      
        

			




    </table>


    </div>

        



<A name="docstrings_sqlalchemy.mapping.objectstore_modfunc"></a>

<div class="subsection" style="margin-left:30px;">

    <span class="sectionheadertext">Module Functions</span>
    <div class="sectiontext">



    <table cellspacing="0" cellpadding="0" width="100%">
    
    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.mapping.objectstore_modfunc_def begin"></a>
        <b>def begin()</b>
        <div class="docstring">
    <p>
    begins a new UnitOfWork transaction.  the next commit will affect only     objects that are created, modified, or deleted following the begin statement.
</p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.mapping.objectstore_modfunc_def clear"></a>
        <b>def clear()</b>
        <div class="docstring">
    <p>
    removes all current UnitOfWorks and IdentityMaps for this thread and      establishes a new one.  It is probably a good idea to discard all     current mapped object instances, as they are no longer in the Identity Map.
</p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.mapping.objectstore_modfunc_def commit"></a>
        <b>def commit(<i>*obj</i>)</b>
        <div class="docstring">
    <p>
    commits the current UnitOfWork transaction.  if a transaction was begun      via begin(), commits only those objects that were created, modified, or deleted     since that begin statement.  otherwise commits all objects that have been     changed.
         if individual objects are submitted, then only those objects are committed, and the      begin/commit cycle is not affected.
</p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.mapping.objectstore_modfunc_def delete"></a>
        <b>def delete(<i>*obj</i>)</b>
        <div class="docstring">
    <p>
    registers the given objects as to be deleted upon the next commit
</p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.mapping.objectstore_modfunc_def get_id_key"></a>
        <b>def get_id_key(<i>ident</i>, <i>class_</i>)</b>
        <div class="docstring">
    <p></p>
<p></p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.mapping.objectstore_modfunc_def get_row_key"></a>
        <b>def get_row_key(<i>row</i>, <i>class_</i>, <i>primary_key</i>)</b>
        <div class="docstring">
    <p></p>
<p></p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.mapping.objectstore_modfunc_def has_instance"></a>
        <b>def has_instance(<i>instance</i>)</b>
        <div class="docstring">
    <p>
    returns True if the current thread-local IdentityMap contains the given instance
</p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.mapping.objectstore_modfunc_def has_key"></a>
        <b>def has_key(<i>key</i>)</b>
        <div class="docstring">
    <p>
    returns True if the current thread-local IdentityMap contains the given instance key
</p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.mapping.objectstore_modfunc_def import_instance"></a>
        <b>def import_instance(<i>instance</i>)</b>
        <div class="docstring">
    <p></p>
<p></p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.mapping.objectstore_modfunc_def instance_key"></a>
        <b>def instance_key(<i>instance</i>)</b>
        <div class="docstring">
    <p>
    returns the IdentityMap key for the given instance
</p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.mapping.objectstore_modfunc_def is_dirty"></a>
        <b>def is_dirty(<i>obj</i>)</b>
        <div class="docstring">
    <p>
    returns True if the given object is in the current UnitOfWork's new or dirty list,
    or if its a modified list attribute on an object.
</p>
    </div>
        </div>
    </td>
    </tr>



    </table>


    </div>


    <a href="#docstrings" class="toclink">back to section top</a>


</div>


        



<A name="docstrings_sqlalchemy.mapping.objectstore_Session"></a>

<div class="subsection" style="margin-left:30px;">

    <span class="sectionheadertext">Class Session(object)</span>
    <div class="sectiontext">


<p>
    Maintains a UnitOfWork instance, including transaction state.
</p>


    <table cellspacing="0" cellpadding="0" width="100%">
    
    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.mapping.objectstore_Session_def __init__"></a>
        <b>def __init__(<i>self</i>, <i>nest_transactions=False</i>, <i>hash_key=None</i>)</b>
        <div class="docstring">
    <p>
    Initialize the objectstore with a UnitOfWork registry.  If called         with no arguments, creates a single UnitOfWork for all operations.
                 nest_transactions - indicates begin/commit statements can be executed in a         &quot;nested&quot;, defaults to False which indicates &quot;only commit on the outermost begin/commit&quot;
        hash_key - the hash_key used to identify objects against this session, which          defaults to the id of the Session instance.</p>
<p></p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.mapping.objectstore_Session_def begin"></a>
        <b>def begin(<i>self</i>)</b>
        <div class="docstring">
    <p>
    begins a new UnitOfWork transaction and returns a tranasaction-holding         object.  commit() or rollback() should be called on the returned object.
        commit() on the Session will do nothing while a transaction is pending, and further         calls to begin() will return no-op transactional objects.
</p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.mapping.objectstore_Session_def clear"></a>
        <b>def clear(<i>self</i>)</b>
        <div class="docstring">
    <p></p>
<p></p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.mapping.objectstore_Session_def commit"></a>
        <b>def commit(<i>self</i>, <i>*objects</i>)</b>
        <div class="docstring">
    <p>
    commits the current UnitOfWork transaction.  called with         no arguments, this is only used         for &quot;implicit&quot; transactions when there was no begin().
        if individual objects are submitted, then only those objects are committed, and the          begin/commit cycle is not affected.
</p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.mapping.objectstore_Session_def delete"></a>
        <b>def delete(<i>self</i>, <i>*obj</i>)</b>
        <div class="docstring">
    <p>
    registers the given objects as to be deleted upon the next commit
</p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.mapping.objectstore_Session_def expire"></a>
        <b>def expire(<i>self</i>, <i>*obj</i>)</b>
        <div class="docstring">
    <p>
    invalidates the data in the given objects and sets them to refresh themselves         the next time they are requested.
</p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.mapping.objectstore_Session_def import_instance"></a>
        <b>def import_instance(<i>self</i>, <i>instance</i>)</b>
        <div class="docstring">
    <p>
    places the given instance in the current thread's unit of work context,
        either in the current IdentityMap or marked as &quot;new&quot;.  Returns either the object         or the current corresponding version in the Identity Map.</p>
<p>this method should be used for any object instance that is coming from a serialized         storage, from another thread (assuming the regular threaded unit of work model), or any         case where the instance was loaded/created corresponding to a different base unitofwork         than the current one.
</p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.mapping.objectstore_Session_def refresh"></a>
        <b>def refresh(<i>self</i>, <i>*obj</i>)</b>
        <div class="docstring">
    <p>
    reloads the attributes for the given objects from the database, clears         any changes made.
</p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.mapping.objectstore_Session_def register_clean"></a>
        <b>def register_clean(<i>self</i>, <i>obj</i>)</b>
        <div class="docstring">
    <p></p>
<p></p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.mapping.objectstore_Session_def register_new"></a>
        <b>def register_new(<i>self</i>, <i>obj</i>)</b>
        <div class="docstring">
    <p></p>
<p></p>
    </div>
        </div>
    </td>
    </tr>



    </table>



    </div>


    <a href="#docstrings" class="toclink">back to section top</a>


</div>


        



<A name="docstrings_sqlalchemy.mapping.objectstore_SessionTrans"></a>

<div class="subsection" style="margin-left:30px;">

    <span class="sectionheadertext">Class SessionTrans(object)</span>
    <div class="sectiontext">


<p>
    returned by Session.begin(), denotes a transactionalized UnitOfWork instance.
        call commit() on this to commit the transaction.
</p>


    <table cellspacing="0" cellpadding="0" width="100%">
    
    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.mapping.objectstore_SessionTrans_def __init__"></a>
        <b>def __init__(<i>self</i>, <i>parent</i>, <i>uow</i>, <i>isactive</i>)</b>
        <div class="docstring">
    <p></p>
<p></p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.mapping.objectstore_SessionTrans_def begin"></a>
        <b>def begin(<i>self</i>)</b>
        <div class="docstring">
    <p>
    calls begin() on the underlying Session object, returning a new no-op SessionTrans object.
</p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.mapping.objectstore_SessionTrans_def commit"></a>
        <b>def commit(<i>self</i>)</b>
        <div class="docstring">
    <p>
    commits the transaction noted by this SessionTrans object.
</p>
    </div>
        </div>
    </td>
    </tr>


    
        
              <tr>
       <td>
           <div class="darkcell">
           <A name="docstrings_sqlalchemy.mapping.objectstore_SessionTrans_isactive = property()"></a>
           <b>isactive = property()</b></td>
           <div class="docstring">
    <p>
    True if this SessionTrans is the 'active' transaction marker, else its a no-op.
</p>
    </div>
           </div>
       </td>
       </tr>
    

    
        
              <tr>
       <td>
           <div class="darkcell">
           <A name="docstrings_sqlalchemy.mapping.objectstore_SessionTrans_parent = property()"></a>
           <b>parent = property()</b></td>
           <div class="docstring">
    <p>
    returns the parent Session of this SessionTrans object.
</p>
    </div>
           </div>
       </td>
       </tr>
    

    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.mapping.objectstore_SessionTrans_def rollback"></a>
        <b>def rollback(<i>self</i>)</b>
        <div class="docstring">
    <p>
    rolls back the current UnitOfWork transaction, in the case that begin()
            has been called.  The changes logged since the begin() call are discarded.
</p>
    </div>
        </div>
    </td>
    </tr>


    
        
              <tr>
       <td>
           <div class="darkcell">
           <A name="docstrings_sqlalchemy.mapping.objectstore_SessionTrans_uow = property()"></a>
           <b>uow = property()</b></td>
           <div class="docstring">
    <p>
    returns the parent UnitOfWork corresponding to this transaction.
</p>
    </div>
           </div>
       </td>
       </tr>
    


    </table>



    </div>


    <a href="#docstrings" class="toclink">back to section top</a>


</div>


        



<A name="docstrings_sqlalchemy.mapping.objectstore_UnitOfWork"></a>

<div class="subsection" style="margin-left:30px;">

    <span class="sectionheadertext">Class UnitOfWork(object)</span>
    <div class="sectiontext">


<p></p>
<p></p>


    <table cellspacing="0" cellpadding="0" width="100%">
    
    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.mapping.objectstore_UnitOfWork_def __init__"></a>
        <b>def __init__(<i>self</i>, <i>identity_map=None</i>)</b>
        <div class="docstring">
    <p></p>
<p></p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.mapping.objectstore_UnitOfWork_def commit"></a>
        <b>def commit(<i>self</i>, <i>*objects</i>)</b>
        <div class="docstring">
    <p></p>
<p></p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.mapping.objectstore_UnitOfWork_def get"></a>
        <b>def get(<i>self</i>, <i>class_</i>, <i>*id</i>)</b>
        <div class="docstring">
    <p>
    given a class and a list of primary key values in their table-order, locates the mapper          for this class and calls get with the given primary key values.
</p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.mapping.objectstore_UnitOfWork_def has_key"></a>
        <b>def has_key(<i>self</i>, <i>key</i>)</b>
        <div class="docstring">
    <p>
    returns True if the given key is present in this UnitOfWork's identity map.
</p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.mapping.objectstore_UnitOfWork_def is_dirty"></a>
        <b>def is_dirty(<i>self</i>, <i>obj</i>)</b>
        <div class="docstring">
    <p></p>
<p></p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.mapping.objectstore_UnitOfWork_def refresh"></a>
        <b>def refresh(<i>self</i>, <i>obj</i>)</b>
        <div class="docstring">
    <p></p>
<p></p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.mapping.objectstore_UnitOfWork_def register_attribute"></a>
        <b>def register_attribute(<i>self</i>, <i>class_</i>, <i>key</i>, <i>uselist</i>, <i>**kwargs</i>)</b>
        <div class="docstring">
    <p></p>
<p></p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.mapping.objectstore_UnitOfWork_def register_callable"></a>
        <b>def register_callable(<i>self</i>, <i>obj</i>, <i>key</i>, <i>func</i>, <i>uselist</i>, <i>**kwargs</i>)</b>
        <div class="docstring">
    <p></p>
<p></p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.mapping.objectstore_UnitOfWork_def register_clean"></a>
        <b>def register_clean(<i>self</i>, <i>obj</i>)</b>
        <div class="docstring">
    <p></p>
<p></p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.mapping.objectstore_UnitOfWork_def register_deleted"></a>
        <b>def register_deleted(<i>self</i>, <i>obj</i>)</b>
        <div class="docstring">
    <p></p>
<p></p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.mapping.objectstore_UnitOfWork_def register_dirty"></a>
        <b>def register_dirty(<i>self</i>, <i>obj</i>)</b>
        <div class="docstring">
    <p></p>
<p></p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.mapping.objectstore_UnitOfWork_def register_new"></a>
        <b>def register_new(<i>self</i>, <i>obj</i>)</b>
        <div class="docstring">
    <p></p>
<p></p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.mapping.objectstore_UnitOfWork_def rollback_object"></a>
        <b>def rollback_object(<i>self</i>, <i>obj</i>)</b>
        <div class="docstring">
    <p>
    'rolls back' the attributes that have been changed on an object instance.
</p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.mapping.objectstore_UnitOfWork_def unregister_deleted"></a>
        <b>def unregister_deleted(<i>self</i>, <i>obj</i>)</b>
        <div class="docstring">
    <p></p>
<p></p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.mapping.objectstore_UnitOfWork_def update"></a>
        <b>def update(<i>self</i>, <i>obj</i>)</b>
        <div class="docstring">
    <p>
    called to add an object to this UnitOfWork as though it were loaded from the DB,
        but is actually coming from somewhere else, like a web session or similar.
</p>
    </div>
        </div>
    </td>
    </tr>



    </table>



    </div>


    <a href="#docstrings" class="toclink">back to section top</a>


</div>





</div>


        



<A name="docstrings_sqlalchemy.exceptions"></a>

<div class="subsection" style="margin-left:20px;">

    <span class="sectionheadertext">Module sqlalchemy.exceptions</span>
    <div class="sectiontext">


<p></p>
<p></p>



    <table cellspacing="0" cellpadding="0" width="100%">
    
      
        

			



      
        

			



      
        

			



      
        

			



      
        

			



      
        

			



      
        

			




    </table>


    </div>

        



<A name="docstrings_sqlalchemy.exceptions_ArgumentError"></a>

<div class="subsection" style="margin-left:30px;">

    <span class="sectionheadertext">Class ArgumentError</span>
    <div class="sectiontext">


<p>
    raised for all those conditions where invalid arguments are sent to constructed     objects.  This error generally corresponds to construction time state errors.
</p>



    </div>


    <a href="#docstrings" class="toclink">back to section top</a>


</div>


        



<A name="docstrings_sqlalchemy.exceptions_AssertionError"></a>

<div class="subsection" style="margin-left:30px;">

    <span class="sectionheadertext">Class AssertionError</span>
    <div class="sectiontext">


<p>
    corresponds to internal state being detected in an invalid state
</p>



    </div>


    <a href="#docstrings" class="toclink">back to section top</a>


</div>


        



<A name="docstrings_sqlalchemy.exceptions_CommitError"></a>

<div class="subsection" style="margin-left:30px;">

    <span class="sectionheadertext">Class CommitError</span>
    <div class="sectiontext">


<p>
    raised when an invalid condition is detected upon a commit()
</p>



    </div>


    <a href="#docstrings" class="toclink">back to section top</a>


</div>


        



<A name="docstrings_sqlalchemy.exceptions_DBAPIError"></a>

<div class="subsection" style="margin-left:30px;">

    <span class="sectionheadertext">Class DBAPIError</span>
    <div class="sectiontext">


<p>
    something weird happened with a particular DBAPI version
</p>



    </div>


    <a href="#docstrings" class="toclink">back to section top</a>


</div>


        



<A name="docstrings_sqlalchemy.exceptions_InvalidRequestError"></a>

<div class="subsection" style="margin-left:30px;">

    <span class="sectionheadertext">Class InvalidRequestError</span>
    <div class="sectiontext">


<p>
    sqlalchemy was asked to do something it cant do, return nonexistent data, etc.
    This error generally corresponds to runtime state errors.
</p>



    </div>


    <a href="#docstrings" class="toclink">back to section top</a>


</div>


        



<A name="docstrings_sqlalchemy.exceptions_SQLAlchemyError"></a>

<div class="subsection" style="margin-left:30px;">

    <span class="sectionheadertext">Class SQLAlchemyError</span>
    <div class="sectiontext">


<p>
    generic error class
</p>



    </div>


    <a href="#docstrings" class="toclink">back to section top</a>


</div>


        



<A name="docstrings_sqlalchemy.exceptions_SQLError"></a>

<div class="subsection" style="margin-left:30px;">

    <span class="sectionheadertext">Class SQLError</span>
    <div class="sectiontext">


<p>
    raised when the execution of a SQL statement fails.  includes accessors     for the underlying exception, as well as the SQL and bind parameters
</p>


    <table cellspacing="0" cellpadding="0" width="100%">
    
    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.exceptions_SQLError_def __init__"></a>
        <b>def __init__(<i>self</i>, <i>statement</i>, <i>params</i>, <i>orig</i>)</b>
        <div class="docstring">
    <p></p>
<p></p>
    </div>
        </div>
    </td>
    </tr>



    </table>



    </div>


    <a href="#docstrings" class="toclink">back to section top</a>


</div>





</div>


        



<A name="docstrings_sqlalchemy.ext.proxy"></a>

<div class="subsection" style="margin-left:20px;">

    <span class="sectionheadertext">Module sqlalchemy.ext.proxy</span>
    <div class="sectiontext">


<p></p>
<p></p>


			


    <table cellspacing="0" cellpadding="0" width="100%">
    
      
        

			



      
        

			



      
        

			



      
        

			



      
        

			



      
        

			




    </table>


    </div>

        



<A name="docstrings_sqlalchemy.ext.proxy_modfunc"></a>

<div class="subsection" style="margin-left:30px;">

    <span class="sectionheadertext">Module Functions</span>
    <div class="sectiontext">



    <table cellspacing="0" cellpadding="0" width="100%">
    
    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.ext.proxy_modfunc_def create_engine"></a>
        <b>def create_engine(<i>name</i>, <i>opts=None</i>, <i>**kwargs</i>)</b>
        <div class="docstring">
    <p>
    creates a new SQLEngine instance.  There are two forms of calling this method.
         In the first, the &quot;name&quot; argument is the type of engine to load, i.e. 'sqlite', 'postgres',      'oracle', 'mysql'.  &quot;opts&quot; is a dictionary of options to be sent to the underlying DBAPI module      to create a connection, usually including a hostname, username, password, etc.
         In the second, the &quot;name&quot; argument is a URL in the form &lt;enginename&gt;://opt1=val1&amp;opt2=val2.       Where &lt;enginename&gt; is the name as above, and the contents of the option dictionary are      spelled out as a URL encoded string.  The &quot;opts&quot; argument is not used.
         In both cases, **kwargs represents options to be sent to the SQLEngine itself.  A possibly     partial listing of those options is as follows:
         pool=None : an instance of sqlalchemy.pool.DBProxy to be used as the underlying source      for connections (DBProxy is described in the previous section).  If None, a default DBProxy      will be created using the engine's own database module with the given arguments.
         echo=False : if True, the SQLEngine will log all statements as well as a repr() of their      parameter lists to the engines logger, which defaults to sys.stdout.  A SQLEngine instances'      &quot;echo&quot; data member can be modified at any time to turn logging on and off.  If set to the string      'debug', result rows will be printed to the standard output as well.
         logger=None : a file-like object where logging output can be sent, if echo is set to True.  
    This defaults to sys.stdout.</p>
<p>module=None : used by Oracle and Postgres, this is a reference to a DBAPI2 module to be used 
    instead of the engine's default module.  For Postgres, the default is psycopg2, or psycopg1 if 
    2 cannot be found.  For Oracle, its cx_Oracle.  For mysql, MySQLdb.</p>
<p>use_ansi=True : used only by Oracle;  when False, the Oracle driver attempts to support a 
    particular &quot;quirk&quot; of some Oracle databases, that the LEFT OUTER JOIN SQL syntax is not 
    supported, and the &quot;Oracle join&quot; syntax of using &lt;column1&gt;(+)=&lt;column2&gt; must be used 
    in order to achieve a LEFT OUTER JOIN.  Its advised that the Oracle database be configured to 
    have full ANSI support instead of using this feature.</p>
<p></p>
    </div>
        </div>
    </td>
    </tr>



    </table>


    </div>


    <a href="#docstrings" class="toclink">back to section top</a>


</div>


        



<A name="docstrings_sqlalchemy.ext.proxy_AutoConnectEngine"></a>

<div class="subsection" style="margin-left:30px;">

    <span class="sectionheadertext">Class AutoConnectEngine(BaseProxyEngine)</span>
    <div class="sectiontext">


<p></p>
<p>An SQLEngine proxy that automatically connects when necessary.</p>
<p></p>


    <table cellspacing="0" cellpadding="0" width="100%">
    
    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.ext.proxy_AutoConnectEngine_def __init__"></a>
        <b>def __init__(<i>self</i>, <i>dburi</i>, <i>opts=None</i>, <i>**kwargs</i>)</b>
        <div class="docstring">
    <p></p>
<p></p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.ext.proxy_AutoConnectEngine_def get_engine"></a>
        <b>def get_engine(<i>self</i>)</b>
        <div class="docstring">
    <p></p>
<p></p>
    </div>
        </div>
    </td>
    </tr>



    </table>



    </div>


    <a href="#docstrings" class="toclink">back to section top</a>


</div>


        



<A name="docstrings_sqlalchemy.ext.proxy_BaseProxyEngine"></a>

<div class="subsection" style="margin-left:30px;">

    <span class="sectionheadertext">Class BaseProxyEngine(SchemaEngine)</span>
    <div class="sectiontext">


<p></p>
<p>Basis for all proxy engines     
</p>


    <table cellspacing="0" cellpadding="0" width="100%">
    
    
        
              <tr>
       <td>
           <div class="darkcell">
           <A name="docstrings_sqlalchemy.ext.proxy_BaseProxyEngine_engine = property()"></a>
           <b>engine = property()</b></td>
           <div class="docstring">
    <p></p>
<p></p>
    </div>
           </div>
       </td>
       </tr>
    

    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.ext.proxy_BaseProxyEngine_def get_engine"></a>
        <b>def get_engine(<i>self</i>)</b>
        <div class="docstring">
    <p></p>
<p></p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.ext.proxy_BaseProxyEngine_def hash_key"></a>
        <b>def hash_key(<i>self</i>)</b>
        <div class="docstring">
    <p></p>
<p></p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.ext.proxy_BaseProxyEngine_def oid_column_name"></a>
        <b>def oid_column_name(<i>self</i>)</b>
        <div class="docstring">
    <p></p>
<p></p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.ext.proxy_BaseProxyEngine_def reflecttable"></a>
        <b>def reflecttable(<i>self</i>, <i>table</i>)</b>
        <div class="docstring">
    <p></p>
<p></p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.ext.proxy_BaseProxyEngine_def set_engine"></a>
        <b>def set_engine(<i>self</i>, <i>engine</i>)</b>
        <div class="docstring">
    <p></p>
<p></p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.ext.proxy_BaseProxyEngine_def type_descriptor"></a>
        <b>def type_descriptor(<i>self</i>, <i>typeobj</i>)</b>
        <div class="docstring">
    <p>
    Proxy point: return a ProxyTypeEngine          
</p>
    </div>
        </div>
    </td>
    </tr>



    </table>



    </div>


    <a href="#docstrings" class="toclink">back to section top</a>


</div>


        



<A name="docstrings_sqlalchemy.ext.proxy_ProxyEngine"></a>

<div class="subsection" style="margin-left:30px;">

    <span class="sectionheadertext">Class ProxyEngine(BaseProxyEngine)</span>
    <div class="sectiontext">


<p></p>
<p>SQLEngine proxy. Supports lazy and late initialization by     delegating to a real engine (set with connect()), and using proxy     classes for TypeEngine.</p>
<p></p>


    <table cellspacing="0" cellpadding="0" width="100%">
    
    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.ext.proxy_ProxyEngine_def __init__"></a>
        <b>def __init__(<i>self</i>, <i>**kwargs</i>)</b>
        <div class="docstring">
    <p></p>
<p></p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.ext.proxy_ProxyEngine_def connect"></a>
        <b>def connect(<i>self</i>, <i>uri</i>, <i>opts=None</i>, <i>**kwargs</i>)</b>
        <div class="docstring">
    <p>
    Establish connection to a real engine.</p>
<p></p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.ext.proxy_ProxyEngine_def get_engine"></a>
        <b>def get_engine(<i>self</i>)</b>
        <div class="docstring">
    <p></p>
<p></p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.ext.proxy_ProxyEngine_def set_engine"></a>
        <b>def set_engine(<i>self</i>, <i>engine</i>)</b>
        <div class="docstring">
    <p></p>
<p></p>
    </div>
        </div>
    </td>
    </tr>



    </table>



    </div>


    <a href="#docstrings" class="toclink">back to section top</a>


</div>


        



<A name="docstrings_sqlalchemy.ext.proxy_ProxyType"></a>

<div class="subsection" style="margin-left:30px;">

    <span class="sectionheadertext">Class ProxyType(object)</span>
    <div class="sectiontext">


<p>
    ProxyType base class; used by ProxyTypeEngine to construct proxying     types         
</p>


    <table cellspacing="0" cellpadding="0" width="100%">
    
    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.ext.proxy_ProxyType_def __init__"></a>
        <b>def __init__(<i>self</i>, <i>engine</i>, <i>typeobj</i>)</b>
        <div class="docstring">
    <p></p>
<p></p>
    </div>
        </div>
    </td>
    </tr>



    </table>



    </div>


    <a href="#docstrings" class="toclink">back to section top</a>


</div>


        



<A name="docstrings_sqlalchemy.ext.proxy_ProxyTypeEngine"></a>

<div class="subsection" style="margin-left:30px;">

    <span class="sectionheadertext">Class ProxyTypeEngine(object)</span>
    <div class="sectiontext">


<p>
    Proxy type engine; creates dynamic proxy type subclass that is instance     of actual type, but proxies engine-dependant operations through the proxy     engine.         
</p>



    </div>


    <a href="#docstrings" class="toclink">back to section top</a>


</div>


        



<A name="docstrings_sqlalchemy.ext.proxy_TypeEngine"></a>

<div class="subsection" style="margin-left:30px;">

    <span class="sectionheadertext">Class TypeEngine(object)</span>
    <div class="sectiontext">


<p></p>
<p></p>


    <table cellspacing="0" cellpadding="0" width="100%">
    
    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.ext.proxy_TypeEngine_def __init__"></a>
        <b>def __init__(<i>self</i>, <i>*args</i>, <i>**kwargs</i>)</b>
        <div class="docstring">
    <p></p>
<p></p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.ext.proxy_TypeEngine_def adapt_args"></a>
        <b>def adapt_args(<i>self</i>)</b>
        <div class="docstring">
    <p></p>
<p></p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.ext.proxy_TypeEngine_def convert_bind_param"></a>
        <b>def convert_bind_param(<i>self</i>, <i>value</i>, <i>engine</i>)</b>
        <div class="docstring">
    <p></p>
<p></p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.ext.proxy_TypeEngine_def convert_result_value"></a>
        <b>def convert_result_value(<i>self</i>, <i>value</i>, <i>engine</i>)</b>
        <div class="docstring">
    <p></p>
<p></p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.ext.proxy_TypeEngine_def get_col_spec"></a>
        <b>def get_col_spec(<i>self</i>)</b>
        <div class="docstring">
    <p></p>
<p></p>
    </div>
        </div>
    </td>
    </tr>


    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.ext.proxy_TypeEngine_def get_constructor_args"></a>
        <b>def get_constructor_args(<i>self</i>)</b>
        <div class="docstring">
    <p></p>
<p></p>
    </div>
        </div>
    </td>
    </tr>


    
        
              <tr>
       <td>
           <div class="darkcell">
           <A name="docstrings_sqlalchemy.ext.proxy_TypeEngine_impl = property()"></a>
           <b>impl = property()</b></td>
           <div class="docstring">
    <p></p>
<p></p>
    </div>
           </div>
       </td>
       </tr>
    

    
            
    
        <tr>
    <td>
        <div class="darkcell">
        <A name="docstrings_sqlalchemy.ext.proxy_TypeEngine_def set_impl"></a>
        <b>def set_impl(<i>self</i>, <i>impltype</i>)</b>
        <div class="docstring">
    <p></p>
<p></p>
    </div>
        </div>
    </td>
    </tr>



    </table>



    </div>


    <a href="#docstrings" class="toclink">back to section top</a>


</div>





</div>




    <hr width="400px" align="left" />

</div>


		</div>
	</div>
	






</div>

















<center>
</center>
</body>
</html>




